Index: blcr-0.8.5/tests/dlopen_aux.c
===================================================================
--- blcr-0.8.5.orig/tests/dlopen_aux.c	2008-05-20 01:44:57.000000000 +0100
+++ blcr-0.8.5/tests/dlopen_aux.c	2013-03-26 22:49:53.000000000 +0000
@@ -9,6 +9,13 @@
 
 #include "libcr.h"
 
+#ifndef STRINGIFY
+  #define STRINGIFY_HELPER(x) #x
+  #define STRINGIFY(x) STRINGIFY_HELPER(x)
+#endif
+
+#define THE_LIBRARY "libcr.so." STRINGIFY(LIBCR_MAJOR)
+
 int main(void)
 {
     cr_client_id_t (*my_cr_init)(void);
@@ -28,9 +35,9 @@
 	exit(1);
     }
 
-    libcr_handle = dlopen("libcr.so", RTLD_NOW);
+    libcr_handle = dlopen(THE_LIBRARY, RTLD_NOW);
     if (libcr_handle == NULL) {
-	fprintf(stderr, "dlopen(libcr.so) failed unexpectedly.  Bad LD_LIBRARY_PATH?\n");
+	fprintf(stderr, "dlopen(" THE_LIBRARY ") failed unexpectedly.  Bad LD_LIBRARY_PATH?\n");
 	exit(1);
     }
 
