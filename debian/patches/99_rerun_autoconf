Index: blcr-0.8.5/Makefile.in
===================================================================
--- blcr-0.8.5.orig/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/Makefile.in	2013-03-26 22:50:51.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -63,6 +80,11 @@
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -74,9 +96,11 @@
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
 am__remove_distdir = \
-  { test ! -d "$(distdir)" \
-    || { find "$(distdir)" -type d ! -perm -200 -exec chmod u+w {} ';' \
-         && rm -fr "$(distdir)"; }; }
+  if test -d "$(distdir)"; then \
+    find "$(distdir)" -type d ! -perm -200 -exec chmod u+w {} ';' \
+      && rm -rf "$(distdir)" \
+      || { sleep 5 && rm -rf "$(distdir)"; }; \
+  else :; fi
 am__relativize = \
   dir0=`pwd`; \
   sed_first='s,^\([^/]*\)/.*$$,\1,'; \
@@ -105,6 +129,8 @@
 DIST_ARCHIVES = $(distdir).tar.gz
 GZIP_ENV = --best
 distuninstallcheck_listfiles = find . -type f -print
+am__distuninstallcheck_listfiles = $(distuninstallcheck_listfiles) \
+  | sed 's|^\./|$(prefix)/|' | grep -v '$(infodir)/dir$$'
 distcleancheck_listfiles = find . -type f -print
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -148,6 +174,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -193,8 +220,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -207,6 +236,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -224,6 +254,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -257,7 +288,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -339,9 +369,9 @@
 	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 
 .SUFFIXES:
-am--refresh:
+am--refresh: Makefile
 	@:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -368,22 +398,20 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	$(SHELL) ./config.status --recheck
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	$(am__cd) $(srcdir) && $(AUTOCONF)
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	$(am__cd) $(srcdir) && $(ACLOCAL) $(ACLOCAL_AMFLAGS)
 $(am__aclocal_m4_deps):
 
 blcr_config.h: stamp-h1
-	@if test ! -f $@; then \
-	  rm -f stamp-h1; \
-	  $(MAKE) $(AM_MAKEFLAGS) stamp-h1; \
-	else :; fi
+	@if test ! -f $@; then rm -f stamp-h1; else :; fi
+	@if test ! -f $@; then $(MAKE) $(AM_MAKEFLAGS) stamp-h1; else :; fi
 
 stamp-h1: $(srcdir)/blcr_config.h.in $(top_builddir)/config.status
 	@rm -f stamp-h1
 	cd $(top_builddir) && $(SHELL) ./config.status blcr_config.h
-$(srcdir)/blcr_config.h.in:  $(am__configure_deps) 
+$(srcdir)/blcr_config.h.in: @MAINTAINER_MODE_TRUE@ $(am__configure_deps) 
 	($(am__cd) $(top_srcdir) && $(AUTOHEADER))
 	rm -f stamp-h1
 	touch $@
@@ -575,13 +603,10 @@
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -616,7 +641,11 @@
 	$(am__remove_distdir)
 
 dist-bzip2: distdir
-	tardir=$(distdir) && $(am__tar) | bzip2 -9 -c >$(distdir).tar.bz2
+	tardir=$(distdir) && $(am__tar) | BZIP2=$${BZIP2--9} bzip2 -c >$(distdir).tar.bz2
+	$(am__remove_distdir)
+
+dist-lzip: distdir
+	tardir=$(distdir) && $(am__tar) | lzip -c $${LZIP_OPT--9} >$(distdir).tar.lz
 	$(am__remove_distdir)
 
 dist-lzma: distdir
@@ -624,7 +653,7 @@
 	$(am__remove_distdir)
 
 dist-xz: distdir
-	tardir=$(distdir) && $(am__tar) | xz -c >$(distdir).tar.xz
+	tardir=$(distdir) && $(am__tar) | XZ_OPT=$${XZ_OPT--e} xz -c >$(distdir).tar.xz
 	$(am__remove_distdir)
 
 dist-tarZ: distdir
@@ -655,6 +684,8 @@
 	  bzip2 -dc $(distdir).tar.bz2 | $(am__untar) ;;\
 	*.tar.lzma*) \
 	  lzma -dc $(distdir).tar.lzma | $(am__untar) ;;\
+	*.tar.lz*) \
+	  lzip -dc $(distdir).tar.lz | $(am__untar) ;;\
 	*.tar.xz*) \
 	  xz -dc $(distdir).tar.xz | $(am__untar) ;;\
 	*.tar.Z*) \
@@ -664,7 +695,7 @@
 	*.zip*) \
 	  unzip $(distdir).zip ;;\
 	esac
-	chmod -R a-w $(distdir); chmod a+w $(distdir)
+	chmod -R a-w $(distdir); chmod u+w $(distdir)
 	mkdir $(distdir)/_build
 	mkdir $(distdir)/_inst
 	chmod a-w $(distdir)
@@ -674,6 +705,7 @@
 	  && am__cwd=`pwd` \
 	  && $(am__cd) $(distdir)/_build \
 	  && ../configure --srcdir=.. --prefix="$$dc_install_base" \
+	    $(AM_DISTCHECK_CONFIGURE_FLAGS) \
 	    $(DISTCHECK_CONFIGURE_FLAGS) \
 	  && $(MAKE) $(AM_MAKEFLAGS) \
 	  && $(MAKE) $(AM_MAKEFLAGS) dvi \
@@ -702,8 +734,16 @@
 	  list='$(DIST_ARCHIVES)'; for i in $$list; do echo $$i; done) | \
 	  sed -e 1h -e 1s/./=/g -e 1p -e 1x -e '$$p' -e '$$x'
 distuninstallcheck:
-	@$(am__cd) '$(distuninstallcheck_dir)' \
-	&& test `$(distuninstallcheck_listfiles) | wc -l` -le 1 \
+	@test -n '$(distuninstallcheck_dir)' || { \
+	  echo 'ERROR: trying to run $@ with an empty' \
+	       '$$(distuninstallcheck_dir)' >&2; \
+	  exit 1; \
+	}; \
+	$(am__cd) '$(distuninstallcheck_dir)' || { \
+	  echo 'ERROR: cannot chdir into $(distuninstallcheck_dir)' >&2; \
+	  exit 1; \
+	}; \
+	test `$(am__distuninstallcheck_listfiles) | wc -l` -eq 0 \
 	   || { echo "ERROR: files left after uninstall:" ; \
 	        if test -n "$(DESTDIR)"; then \
 	          echo "  (check DESTDIR support)"; \
@@ -735,10 +775,15 @@
 
 installcheck: installcheck-recursive
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
@@ -828,13 +873,13 @@
 	all all-am all-local am--refresh check check-am check-local \
 	clean clean-generic clean-libtool clean-local ctags \
 	ctags-recursive dist dist-all dist-bzip2 dist-gzip dist-hook \
-	dist-lzma dist-shar dist-tarZ dist-xz dist-zip distcheck \
-	distclean distclean-generic distclean-hdr distclean-libtool \
-	distclean-local distclean-tags distcleancheck distdir \
-	distuninstallcheck dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am \
-	install-data-local install-dvi install-dvi-am install-exec \
-	install-exec-am install-exec-local install-html \
+	dist-lzip dist-lzma dist-shar dist-tarZ dist-xz dist-zip \
+	distcheck distclean distclean-generic distclean-hdr \
+	distclean-libtool distclean-local distclean-tags \
+	distcleancheck distdir distuninstallcheck dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-data-local install-dvi install-dvi-am \
+	install-exec install-exec-am install-exec-local install-html \
 	install-html-am install-info install-info-am install-man \
 	install-pdf install-pdf-am install-ps install-ps-am \
 	install-strip installcheck installcheck-am installdirs \
Index: blcr-0.8.5/aclocal.m4
===================================================================
--- blcr-0.8.5.orig/aclocal.m4	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/aclocal.m4	2013-03-26 22:50:45.000000000 +0000
@@ -1,7 +1,8 @@
-# generated automatically by aclocal 1.11.1 -*- Autoconf -*-
+# generated automatically by aclocal 1.11.6 -*- Autoconf -*-
 
 # Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2007, 2008, 2009  Free Software Foundation, Inc.
+# 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software Foundation,
+# Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -13,8 +14,8 @@
 
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
-m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.63],,
-[m4_warning([this file was generated for autoconf 2.63.
+m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.69],,
+[m4_warning([this file was generated for autoconf 2.69.
 You have another version of autoconf.  It may work, but is not guaranteed to.
 If you have problems, you may need to regenerate the build system entirely.
 To do so, use the procedure documented by the package, typically `autoreconf'.])])
@@ -22,7 +23,8 @@
 # libtool.m4 - Configure libtool for the host system. -*-Autoconf-*-
 #
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008 Free Software Foundation, Inc.
+#                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+#                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 # This file is free software; the Free Software Foundation gives
@@ -31,7 +33,8 @@
 
 m4_define([_LT_COPYING], [dnl
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008 Free Software Foundation, Inc.
+#                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+#                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 #   This file is part of GNU Libtool.
@@ -58,7 +61,7 @@
 # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 ])
 
-# serial 56 LT_INIT
+# serial 57 LT_INIT
 
 
 # LT_PREREQ(VERSION)
@@ -87,6 +90,7 @@
 # ------------------
 AC_DEFUN([LT_INIT],
 [AC_PREREQ([2.58])dnl We use AC_INCLUDES_DEFAULT
+AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT])dnl
 AC_BEFORE([$0], [LT_LANG])dnl
 AC_BEFORE([$0], [LT_OUTPUT])dnl
 AC_BEFORE([$0], [LTDL_INIT])dnl
@@ -103,6 +107,8 @@
 AC_REQUIRE([LTOBSOLETE_VERSION])dnl
 m4_require([_LT_PROG_LTMAIN])dnl
 
+_LT_SHELL_INIT([SHELL=${CONFIG_SHELL-/bin/sh}])
+
 dnl Parse OPTIONS
 _LT_SET_OPTIONS([$0], [$1])
 
@@ -139,7 +145,7 @@
     *) break;;
   esac
 done
-cc_basename=`$ECHO "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
+cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
 ])
 
 
@@ -159,6 +165,11 @@
 m4_defun([_LT_SETUP],
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 AC_REQUIRE([AC_CANONICAL_BUILD])dnl
+AC_REQUIRE([_LT_PREPARE_SED_QUOTE_VARS])dnl
+AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])dnl
+
+_LT_DECL([], [PATH_SEPARATOR], [1], [The PATH separator for the build system])dnl
+dnl
 _LT_DECL([], [host_alias], [0], [The host system])dnl
 _LT_DECL([], [host], [0])dnl
 _LT_DECL([], [host_os], [0])dnl
@@ -181,10 +192,13 @@
 dnl
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_CHECK_SHELL_FEATURES])dnl
+m4_require([_LT_PATH_CONVERSION_FUNCTIONS])dnl
 m4_require([_LT_CMD_RELOAD])dnl
 m4_require([_LT_CHECK_MAGIC_METHOD])dnl
+m4_require([_LT_CHECK_SHAREDLIB_FROM_LINKLIB])dnl
 m4_require([_LT_CMD_OLD_ARCHIVE])dnl
 m4_require([_LT_CMD_GLOBAL_SYMBOLS])dnl
+m4_require([_LT_WITH_SYSROOT])dnl
 
 _LT_CONFIG_LIBTOOL_INIT([
 # See if we are running on zsh, and set the options which allow our
@@ -200,7 +214,6 @@
 _LT_CHECK_OBJDIR
 
 m4_require([_LT_TAG_COMPILER])dnl
-_LT_PROG_ECHO_BACKSLASH
 
 case $host_os in
 aix3*)
@@ -214,23 +227,6 @@
   ;;
 esac
 
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-sed_quote_subst='s/\([["`$\\]]\)/\\\1/g'
-
-# Same as above, but do not quote variable references.
-double_quote_subst='s/\([["`\\]]\)/\\\1/g'
-
-# Sed substitution to delay expansion of an escaped shell variable in a
-# double_quote_subst'ed string.
-delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
-
-# Sed substitution to delay expansion of an escaped single quote.
-delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
-
-# Sed substitution to avoid accidental globbing in evaled expressions
-no_glob_subst='s/\*/\\\*/g'
-
 # Global variables:
 ofile=libtool
 can_build_shared=yes
@@ -271,6 +267,28 @@
 ])# _LT_SETUP
 
 
+# _LT_PREPARE_SED_QUOTE_VARS
+# --------------------------
+# Define a few sed substitution that help us do robust quoting.
+m4_defun([_LT_PREPARE_SED_QUOTE_VARS],
+[# Backslashify metacharacters that are still active within
+# double-quoted strings.
+sed_quote_subst='s/\([["`$\\]]\)/\\\1/g'
+
+# Same as above, but do not quote variable references.
+double_quote_subst='s/\([["`\\]]\)/\\\1/g'
+
+# Sed substitution to delay expansion of an escaped shell variable in a
+# double_quote_subst'ed string.
+delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
+
+# Sed substitution to delay expansion of an escaped single quote.
+delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
+
+# Sed substitution to avoid accidental globbing in evaled expressions
+no_glob_subst='s/\*/\\\*/g'
+])
+
 # _LT_PROG_LTMAIN
 # ---------------
 # Note that this code is called both from `configure', and `config.status'
@@ -423,7 +441,7 @@
 # declaration there will have the same value as in `configure'.  VARNAME
 # must have a single quote delimited value for this to work.
 m4_define([_LT_CONFIG_STATUS_DECLARE],
-[$1='`$ECHO "X$][$1" | $Xsed -e "$delay_single_quote_subst"`'])
+[$1='`$ECHO "$][$1" | $SED "$delay_single_quote_subst"`'])
 
 
 # _LT_CONFIG_STATUS_DECLARATIONS
@@ -433,7 +451,7 @@
 # embedded single quotes properly.  In configure, this macro expands
 # each variable declared with _LT_DECL (and _LT_TAGDECL) into:
 #
-#    <var>='`$ECHO "X$<var>" | $Xsed -e "$delay_single_quote_subst"`'
+#    <var>='`$ECHO "$<var>" | $SED "$delay_single_quote_subst"`'
 m4_defun([_LT_CONFIG_STATUS_DECLARATIONS],
 [m4_foreach([_lt_var], m4_quote(lt_decl_all_varnames),
     [m4_n([_LT_CONFIG_STATUS_DECLARE(_lt_var)])])])
@@ -532,12 +550,20 @@
 LTCFLAGS='$LTCFLAGS'
 compiler='$compiler_DEFAULT'
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+\$[]1
+_LTECHO_EOF'
+}
+
 # Quote evaled strings.
 for var in lt_decl_all_varnames([[ \
 ]], lt_decl_quote_varnames); do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[[\\\\\\\`\\"\\\$]]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -548,9 +574,9 @@
 # Double-quote double-evaled strings.
 for var in lt_decl_all_varnames([[ \
 ]], lt_decl_dquote_varnames); do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[[\\\\\\\`\\"\\\$]]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -558,16 +584,38 @@
     esac
 done
 
-# Fix-up fallback echo if it was mangled by the above quoting rules.
-case \$lt_ECHO in
-*'\\\[$]0 --fallback-echo"')dnl "
-  lt_ECHO=\`\$ECHO "X\$lt_ECHO" | \$Xsed -e 's/\\\\\\\\\\\\\\\[$]0 --fallback-echo"\[$]/\[$]0 --fallback-echo"/'\`
-  ;;
-esac
-
 _LT_OUTPUT_LIBTOOL_INIT
 ])
 
+# _LT_GENERATED_FILE_INIT(FILE, [COMMENT])
+# ------------------------------------
+# Generate a child script FILE with all initialization necessary to
+# reuse the environment learned by the parent script, and make the
+# file executable.  If COMMENT is supplied, it is inserted after the
+# `#!' sequence but before initialization text begins.  After this
+# macro, additional text can be appended to FILE to form the body of
+# the child script.  The macro ends with non-zero status if the
+# file could not be fully written (such as if the disk is full).
+m4_ifdef([AS_INIT_GENERATED],
+[m4_defun([_LT_GENERATED_FILE_INIT],[AS_INIT_GENERATED($@)])],
+[m4_defun([_LT_GENERATED_FILE_INIT],
+[m4_require([AS_PREPARE])]dnl
+[m4_pushdef([AS_MESSAGE_LOG_FD])]dnl
+[lt_write_fail=0
+cat >$1 <<_ASEOF || lt_write_fail=1
+#! $SHELL
+# Generated by $as_me.
+$2
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$1 <<\_ASEOF || lt_write_fail=1
+AS_SHELL_SANITIZE
+_AS_PREPARE
+exec AS_MESSAGE_FD>&1
+_ASEOF
+test $lt_write_fail = 0 && chmod +x $1[]dnl
+m4_popdef([AS_MESSAGE_LOG_FD])])])# _LT_GENERATED_FILE_INIT
 
 # LT_OUTPUT
 # ---------
@@ -577,20 +625,11 @@
 AC_DEFUN([LT_OUTPUT],
 [: ${CONFIG_LT=./config.lt}
 AC_MSG_NOTICE([creating $CONFIG_LT])
-cat >"$CONFIG_LT" <<_LTEOF
-#! $SHELL
-# Generated by $as_me.
-# Run this file to recreate a libtool stub with the current configuration.
-
-lt_cl_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_LTEOF
+_LT_GENERATED_FILE_INIT(["$CONFIG_LT"],
+[# Run this file to recreate a libtool stub with the current configuration.])
 
 cat >>"$CONFIG_LT" <<\_LTEOF
-AS_SHELL_SANITIZE
-_AS_PREPARE
-
-exec AS_MESSAGE_FD>&1
+lt_cl_silent=false
 exec AS_MESSAGE_LOG_FD>>config.log
 {
   echo
@@ -616,7 +655,7 @@
 m4_ifset([AC_PACKAGE_VERSION], [ AC_PACKAGE_VERSION])
 configured by $[0], generated by m4_PACKAGE_STRING.
 
-Copyright (C) 2008 Free Software Foundation, Inc.
+Copyright (C) 2011 Free Software Foundation, Inc.
 This config.lt script is free software; the Free Software Foundation
 gives unlimited permision to copy, distribute and modify it."
 
@@ -661,15 +700,13 @@
 # appending to config.log, which fails on DOS, as config.log is still kept
 # open by configure.  Here we exec the FD to /dev/null, effectively closing
 # config.log, so it can be properly (re)opened and appended to by config.lt.
-if test "$no_create" != yes; then
-  lt_cl_success=:
-  test "$silent" = yes &&
-    lt_config_lt_args="$lt_config_lt_args --quiet"
-  exec AS_MESSAGE_LOG_FD>/dev/null
-  $SHELL "$CONFIG_LT" $lt_config_lt_args || lt_cl_success=false
-  exec AS_MESSAGE_LOG_FD>>config.log
-  $lt_cl_success || AS_EXIT(1)
-fi
+lt_cl_success=:
+test "$silent" = yes &&
+  lt_config_lt_args="$lt_config_lt_args --quiet"
+exec AS_MESSAGE_LOG_FD>/dev/null
+$SHELL "$CONFIG_LT" $lt_config_lt_args || lt_cl_success=false
+exec AS_MESSAGE_LOG_FD>>config.log
+$lt_cl_success || AS_EXIT(1)
 ])# LT_OUTPUT
 
 
@@ -732,15 +769,12 @@
   # if finds mixed CR/LF and LF-only lines.  Since sed operates in
   # text mode, it properly converts lines to CR/LF.  This bash problem
   # is reportedly fixed, but why not run on old versions too?
-  sed '/^# Generated shell functions inserted here/q' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
+  sed '$q' "$ltmain" >> "$cfgfile" \
+     || (rm -f "$cfgfile"; exit 1)
 
-  _LT_PROG_XSI_SHELLFNS
+  _LT_PROG_REPLACE_SHELLFNS
 
-  sed -n '/^# Generated shell functions inserted here/,$p' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
-
-  mv -f "$cfgfile" "$ofile" ||
+   mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
 ],
@@ -785,6 +819,7 @@
 m4_case([$1],
   [C],			[_LT_LANG(C)],
   [C++],		[_LT_LANG(CXX)],
+  [Go],			[_LT_LANG(GO)],
   [Java],		[_LT_LANG(GCJ)],
   [Fortran 77],		[_LT_LANG(F77)],
   [Fortran],		[_LT_LANG(FC)],
@@ -806,6 +841,29 @@
 ])# _LT_LANG
 
 
+m4_ifndef([AC_PROG_GO], [
+# NOTE: This macro has been submitted for inclusion into   #
+#  GNU Autoconf as AC_PROG_GO.  When it is available in    #
+#  a released version of Autoconf we should remove this    #
+#  macro and use it instead.                               #
+m4_defun([AC_PROG_GO],
+[AC_LANG_PUSH(Go)dnl
+AC_ARG_VAR([GOC],     [Go compiler command])dnl
+AC_ARG_VAR([GOFLAGS], [Go compiler flags])dnl
+_AC_ARG_VAR_LDFLAGS()dnl
+AC_CHECK_TOOL(GOC, gccgo)
+if test -z "$GOC"; then
+  if test -n "$ac_tool_prefix"; then
+    AC_CHECK_PROG(GOC, [${ac_tool_prefix}gccgo], [${ac_tool_prefix}gccgo])
+  fi
+fi
+if test -z "$GOC"; then
+  AC_CHECK_PROG(GOC, gccgo, gccgo, false)
+fi
+])#m4_defun
+])#m4_ifndef
+
+
 # _LT_LANG_DEFAULT_CONFIG
 # -----------------------
 m4_defun([_LT_LANG_DEFAULT_CONFIG],
@@ -836,6 +894,10 @@
        m4_ifdef([LT_PROG_GCJ],
 	[m4_define([LT_PROG_GCJ], defn([LT_PROG_GCJ])[LT_LANG(GCJ)])])])])])
 
+AC_PROVIDE_IFELSE([AC_PROG_GO],
+  [LT_LANG(GO)],
+  [m4_define([AC_PROG_GO], defn([AC_PROG_GO])[LT_LANG(GO)])])
+
 AC_PROVIDE_IFELSE([LT_PROG_RC],
   [LT_LANG(RC)],
   [m4_define([LT_PROG_RC], defn([LT_PROG_RC])[LT_LANG(RC)])])
@@ -846,11 +908,13 @@
 AU_DEFUN([AC_LIBTOOL_F77], [LT_LANG(Fortran 77)])
 AU_DEFUN([AC_LIBTOOL_FC], [LT_LANG(Fortran)])
 AU_DEFUN([AC_LIBTOOL_GCJ], [LT_LANG(Java)])
+AU_DEFUN([AC_LIBTOOL_RC], [LT_LANG(Windows Resource)])
 dnl aclocal-1.4 backwards compatibility:
 dnl AC_DEFUN([AC_LIBTOOL_CXX], [])
 dnl AC_DEFUN([AC_LIBTOOL_F77], [])
 dnl AC_DEFUN([AC_LIBTOOL_FC], [])
 dnl AC_DEFUN([AC_LIBTOOL_GCJ], [])
+dnl AC_DEFUN([AC_LIBTOOL_RC], [])
 
 
 # _LT_TAG_COMPILER
@@ -936,7 +1000,13 @@
 	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
 	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
         _lt_result=$?
-	if test -f libconftest.dylib && test ! -s conftest.err && test $_lt_result = 0; then
+	# If there is a non-empty error log, and "single_module"
+	# appears in it, assume the flag caused a linker warning
+        if test -s conftest.err && $GREP single_module conftest.err; then
+	  cat conftest.err >&AS_MESSAGE_LOG_FD
+	# Otherwise, if the output was created with a 0 exit code from
+	# the compiler, it worked.
+	elif test -f libconftest.dylib && test $_lt_result -eq 0; then
 	  lt_cv_apple_cc_single_mod=yes
 	else
 	  cat conftest.err >&AS_MESSAGE_LOG_FD
@@ -944,6 +1014,7 @@
 	rm -rf libconftest.dylib*
 	rm -f conftest.*
       fi])
+
     AC_CACHE_CHECK([for -exported_symbols_list linker flag],
       [lt_cv_ld_exported_symbols_list],
       [lt_cv_ld_exported_symbols_list=no
@@ -955,6 +1026,34 @@
 	[lt_cv_ld_exported_symbols_list=no])
 	LDFLAGS="$save_LDFLAGS"
     ])
+
+    AC_CACHE_CHECK([for -force_load linker flag],[lt_cv_ld_force_load],
+      [lt_cv_ld_force_load=no
+      cat > conftest.c << _LT_EOF
+int forced_loaded() { return 2;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS -c -o conftest.o conftest.c" >&AS_MESSAGE_LOG_FD
+      $LTCC $LTCFLAGS -c -o conftest.o conftest.c 2>&AS_MESSAGE_LOG_FD
+      echo "$AR cru libconftest.a conftest.o" >&AS_MESSAGE_LOG_FD
+      $AR cru libconftest.a conftest.o 2>&AS_MESSAGE_LOG_FD
+      echo "$RANLIB libconftest.a" >&AS_MESSAGE_LOG_FD
+      $RANLIB libconftest.a 2>&AS_MESSAGE_LOG_FD
+      cat > conftest.c << _LT_EOF
+int main() { return 0;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&AS_MESSAGE_LOG_FD
+      $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
+      _lt_result=$?
+      if test -s conftest.err && $GREP force_load conftest.err; then
+	cat conftest.err >&AS_MESSAGE_LOG_FD
+      elif test -f conftest && test $_lt_result -eq 0 && $GREP forced_load conftest >/dev/null 2>&1 ; then
+	lt_cv_ld_force_load=yes
+      else
+	cat conftest.err >&AS_MESSAGE_LOG_FD
+      fi
+        rm -f conftest.err libconftest.a conftest conftest.c
+        rm -rf conftest.dSYM
+    ])
     case $host_os in
     rhapsody* | darwin1.[[012]])
       _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
@@ -982,7 +1081,7 @@
     else
       _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
     fi
-    if test "$DSYMUTIL" != ":"; then
+    if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
       _lt_dsymutil='~$DSYMUTIL $lib || :'
     else
       _lt_dsymutil=
@@ -992,8 +1091,8 @@
 ])
 
 
-# _LT_DARWIN_LINKER_FEATURES
-# --------------------------
+# _LT_DARWIN_LINKER_FEATURES([TAG])
+# ---------------------------------
 # Checks for linker and compiler features on darwin
 m4_defun([_LT_DARWIN_LINKER_FEATURES],
 [
@@ -1002,7 +1101,13 @@
   _LT_TAGVAR(hardcode_direct, $1)=no
   _LT_TAGVAR(hardcode_automatic, $1)=yes
   _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
-  _LT_TAGVAR(whole_archive_flag_spec, $1)=''
+  if test "$lt_cv_ld_force_load" = "yes"; then
+    _LT_TAGVAR(whole_archive_flag_spec, $1)='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+    m4_case([$1], [F77], [_LT_TAGVAR(compiler_needs_object, $1)=yes],
+                  [FC],  [_LT_TAGVAR(compiler_needs_object, $1)=yes])
+  else
+    _LT_TAGVAR(whole_archive_flag_spec, $1)=''
+  fi
   _LT_TAGVAR(link_all_deplibs, $1)=yes
   _LT_TAGVAR(allow_undefined_flag, $1)="$_lt_dar_allow_undefined"
   case $cc_basename in
@@ -1010,7 +1115,7 @@
      *) _lt_dar_can_shared=$GCC ;;
   esac
   if test "$_lt_dar_can_shared" = "yes"; then
-    output_verbose_link_cmd=echo
+    output_verbose_link_cmd=func_echo_all
     _LT_TAGVAR(archive_cmds, $1)="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
     _LT_TAGVAR(module_cmds, $1)="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
     _LT_TAGVAR(archive_expsym_cmds, $1)="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
@@ -1026,203 +1131,142 @@
   fi
 ])
 
-# _LT_SYS_MODULE_PATH_AIX
-# -----------------------
+# _LT_SYS_MODULE_PATH_AIX([TAGNAME])
+# ----------------------------------
 # Links a minimal program and checks the executable
 # for the system default hardcoded library path. In most cases,
 # this is /usr/lib:/lib, but when the MPI compilers are used
 # the location of the communication and MPI libs are included too.
 # If we don't find anything, use the default library path according
 # to the aix ld manual.
+# Store the results from the different compilers for each TAGNAME.
+# Allow to override them for all tags through lt_cv_aix_libpath.
 m4_defun([_LT_SYS_MODULE_PATH_AIX],
 [m4_require([_LT_DECL_SED])dnl
-AC_LINK_IFELSE(AC_LANG_PROGRAM,[
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-fi],[])
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
+if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  AC_CACHE_VAL([_LT_TAGVAR([lt_cv_aix_libpath_], [$1])],
+  [AC_LINK_IFELSE([AC_LANG_PROGRAM],[
+  lt_aix_libpath_sed='[
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }]'
+  _LT_TAGVAR([lt_cv_aix_libpath_], [$1])=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])"; then
+    _LT_TAGVAR([lt_cv_aix_libpath_], [$1])=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi],[])
+  if test -z "$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])"; then
+    _LT_TAGVAR([lt_cv_aix_libpath_], [$1])="/usr/lib:/lib"
+  fi
+  ])
+  aix_libpath=$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])
+fi
 ])# _LT_SYS_MODULE_PATH_AIX
 
 
 # _LT_SHELL_INIT(ARG)
 # -------------------
 m4_define([_LT_SHELL_INIT],
-[ifdef([AC_DIVERSION_NOTICE],
-	     [AC_DIVERT_PUSH(AC_DIVERSION_NOTICE)],
-	 [AC_DIVERT_PUSH(NOTICE)])
-$1
-AC_DIVERT_POP
-])# _LT_SHELL_INIT
+[m4_divert_text([M4SH-INIT], [$1
+])])# _LT_SHELL_INIT
+
 
 
 # _LT_PROG_ECHO_BACKSLASH
 # -----------------------
-# Add some code to the start of the generated configure script which
-# will find an echo command which doesn't interpret backslashes.
+# Find how we can fake an echo command that does not interpret backslash.
+# In particular, with Autoconf 2.60 or later we add some code to the start
+# of the generated configure script which will find a shell with a builtin
+# printf (which we can use as an echo command).
 m4_defun([_LT_PROG_ECHO_BACKSLASH],
-[_LT_SHELL_INIT([
-# Check that we are running under the correct shell.
-SHELL=${CONFIG_SHELL-/bin/sh}
-
-case X$lt_ECHO in
-X*--fallback-echo)
-  # Remove one level of quotation (which was required for Make).
-  ECHO=`echo "$lt_ECHO" | sed 's,\\\\\[$]\\[$]0,'[$]0','`
-  ;;
-esac
-
-ECHO=${lt_ECHO-echo}
-if test "X[$]1" = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test "X[$]1" = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' ; then
-  # Yippee, $ECHO works!
-  :
+[ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
+
+AC_MSG_CHECKING([how to print strings])
+# Test print first, because it will be a builtin if present.
+if test "X`( print -r -- -n ) 2>/dev/null`" = X-n && \
+   test "X`print -r -- $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='print -r --'
+elif test "X`printf %s $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='printf %s\n'
 else
-  # Restart under the correct shell.
-  exec $SHELL "[$]0" --no-reexec ${1+"[$]@"}
-fi
-
-if test "X[$]1" = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat <<_LT_EOF
-[$]*
-_LT_EOF
-  exit 0
+  # Use this function as a fallback that always works.
+  func_fallback_echo ()
+  {
+    eval 'cat <<_LTECHO_EOF
+$[]1
+_LTECHO_EOF'
+  }
+  ECHO='func_fallback_echo'
 fi
 
-# The HP-UX ksh and POSIX shell print the target directory to stdout
-# if CDPATH is set.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
-
-if test -z "$lt_ECHO"; then
-  if test "X${echo_test_string+set}" != Xset; then
-    # find a string as large as possible, as long as the shell can cope with it
-    for cmd in 'sed 50q "[$]0"' 'sed 20q "[$]0"' 'sed 10q "[$]0"' 'sed 2q "[$]0"' 'echo test'; do
-      # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
-      if { echo_test_string=`eval $cmd`; } 2>/dev/null &&
-	 { test "X$echo_test_string" = "X$echo_test_string"; } 2>/dev/null
-      then
-        break
-      fi
-    done
-  fi
-
-  if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-     echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-     test "X$echo_testing_string" = "X$echo_test_string"; then
-    :
-  else
-    # The Solaris, AIX, and Digital Unix default echo programs unquote
-    # backslashes.  This makes it impossible to quote backslashes using
-    #   echo "$something" | sed 's/\\/\\\\/g'
-    #
-    # So, first we look for a working echo in the user's PATH.
-
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-    for dir in $PATH /usr/ucb; do
-      IFS="$lt_save_ifs"
-      if (test -f $dir/echo || test -f $dir/echo$ac_exeext) &&
-         test "X`($dir/echo '\t') 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`($dir/echo "$echo_test_string") 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        ECHO="$dir/echo"
-        break
-      fi
-    done
-    IFS="$lt_save_ifs"
-
-    if test "X$ECHO" = Xecho; then
-      # We didn't find a better echo, so look for alternatives.
-      if test "X`{ print -r '\t'; } 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`{ print -r "$echo_test_string"; } 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        # This shell has a builtin print -r that does the trick.
-        ECHO='print -r'
-      elif { test -f /bin/ksh || test -f /bin/ksh$ac_exeext; } &&
-	   test "X$CONFIG_SHELL" != X/bin/ksh; then
-        # If we have ksh, try running configure again with it.
-        ORIGINAL_CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}
-        export ORIGINAL_CONFIG_SHELL
-        CONFIG_SHELL=/bin/ksh
-        export CONFIG_SHELL
-        exec $CONFIG_SHELL "[$]0" --no-reexec ${1+"[$]@"}
-      else
-        # Try using printf.
-        ECHO='printf %s\n'
-        if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-	   echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-	   test "X$echo_testing_string" = "X$echo_test_string"; then
-	  # Cool, printf works
-	  :
-        elif echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  CONFIG_SHELL=$ORIGINAL_CONFIG_SHELL
-	  export CONFIG_SHELL
-	  SHELL="$CONFIG_SHELL"
-	  export SHELL
-	  ECHO="$CONFIG_SHELL [$]0 --fallback-echo"
-        elif echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  ECHO="$CONFIG_SHELL [$]0 --fallback-echo"
-        else
-	  # maybe with a smaller string...
-	  prev=:
-
-	  for cmd in 'echo test' 'sed 2q "[$]0"' 'sed 10q "[$]0"' 'sed 20q "[$]0"' 'sed 50q "[$]0"'; do
-	    if { test "X$echo_test_string" = "X`eval $cmd`"; } 2>/dev/null
-	    then
-	      break
-	    fi
-	    prev="$cmd"
-	  done
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO "$*" 
+}
 
-	  if test "$prev" != 'sed 50q "[$]0"'; then
-	    echo_test_string=`eval $prev`
-	    export echo_test_string
-	    exec ${ORIGINAL_CONFIG_SHELL-${CONFIG_SHELL-/bin/sh}} "[$]0" ${1+"[$]@"}
-	  else
-	    # Oops.  We lost completely, so just stick with echo.
-	    ECHO=echo
-	  fi
-        fi
-      fi
-    fi
-  fi
-fi
+case "$ECHO" in
+  printf*) AC_MSG_RESULT([printf]) ;;
+  print*) AC_MSG_RESULT([print -r]) ;;
+  *) AC_MSG_RESULT([cat]) ;;
+esac
 
-# Copy echo and quote the copy suitably for passing to libtool from
-# the Makefile, instead of quoting the original, which is used later.
-lt_ECHO=$ECHO
-if test "X$lt_ECHO" = "X$CONFIG_SHELL [$]0 --fallback-echo"; then
-   lt_ECHO="$CONFIG_SHELL \\\$\[$]0 --fallback-echo"
-fi
+m4_ifdef([_AS_DETECT_SUGGESTED],
+[_AS_DETECT_SUGGESTED([
+  test -n "${ZSH_VERSION+set}${BASH_VERSION+set}" || (
+    ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+    ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
+    ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
+    PATH=/empty FPATH=/empty; export PATH FPATH
+    test "X`printf %s $ECHO`" = "X$ECHO" \
+      || test "X`print -r -- $ECHO`" = "X$ECHO" )])])
 
-AC_SUBST(lt_ECHO)
-])
 _LT_DECL([], [SHELL], [1], [Shell to use when invoking shell scripts])
-_LT_DECL([], [ECHO], [1],
-    [An echo program that does not interpret backslashes])
+_LT_DECL([], [ECHO], [1], [An echo program that protects backslashes])
 ])# _LT_PROG_ECHO_BACKSLASH
 
 
+# _LT_WITH_SYSROOT
+# ----------------
+AC_DEFUN([_LT_WITH_SYSROOT],
+[AC_MSG_CHECKING([for sysroot])
+AC_ARG_WITH([sysroot],
+[  --with-sysroot[=DIR] Search for dependent libraries within DIR
+                        (or the compiler's sysroot if not specified).],
+[], [with_sysroot=no])
+
+dnl lt_sysroot will always be passed unquoted.  We quote it here
+dnl in case the user passed a directory name.
+lt_sysroot=
+case ${with_sysroot} in #(
+ yes)
+   if test "$GCC" = yes; then
+     lt_sysroot=`$CC --print-sysroot 2>/dev/null`
+   fi
+   ;; #(
+ /*)
+   lt_sysroot=`echo "$with_sysroot" | sed -e "$sed_quote_subst"`
+   ;; #(
+ no|'')
+   ;; #(
+ *)
+   AC_MSG_RESULT([${with_sysroot}])
+   AC_MSG_ERROR([The sysroot must be an absolute path.])
+   ;;
+esac
+
+ AC_MSG_RESULT([${lt_sysroot:-no}])
+_LT_DECL([], [lt_sysroot], [0], [The root where to search for ]dnl
+[dependent libraries, and in which our libraries should be installed.])])
+
 # _LT_ENABLE_LOCK
 # ---------------
 m4_defun([_LT_ENABLE_LOCK],
@@ -1251,7 +1295,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '[#]line __oline__ "configure"' > conftest.$ac_ext
+  echo '[#]line '$LINENO' "configure"' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     if test "$lt_cv_prog_gnu_ld" = yes; then
       case `/usr/bin/file conftest.$ac_objext` in
@@ -1344,14 +1388,27 @@
     CFLAGS="$SAVE_CFLAGS"
   fi
   ;;
-sparc*-*solaris*)
+*-*solaris*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     case `/usr/bin/file conftest.o` in
     *64-bit*)
       case $lt_cv_prog_gnu_ld in
-      yes*) LD="${LD-ld} -m elf64_sparc" ;;
+      yes*)
+        case $host in
+        i?86-*-solaris*)
+          LD="${LD-ld} -m elf_x86_64"
+          ;;
+        sparc*-*-solaris*)
+          LD="${LD-ld} -m elf64_sparc"
+          ;;
+        esac
+        # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
+        if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
+          LD="${LD-ld}_sol2"
+        fi
+        ;;
       *)
 	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
 	  LD="${LD-ld} -64"
@@ -1369,14 +1426,47 @@
 ])# _LT_ENABLE_LOCK
 
 
+# _LT_PROG_AR
+# -----------
+m4_defun([_LT_PROG_AR],
+[AC_CHECK_TOOLS(AR, [ar], false)
+: ${AR=ar}
+: ${AR_FLAGS=cru}
+_LT_DECL([], [AR], [1], [The archiver])
+_LT_DECL([], [AR_FLAGS], [1], [Flags to create an archive])
+
+AC_CACHE_CHECK([for archiver @FILE support], [lt_cv_ar_at_file],
+  [lt_cv_ar_at_file=no
+   AC_COMPILE_IFELSE([AC_LANG_PROGRAM],
+     [echo conftest.$ac_objext > conftest.lst
+      lt_ar_try='$AR $AR_FLAGS libconftest.a @conftest.lst >&AS_MESSAGE_LOG_FD'
+      AC_TRY_EVAL([lt_ar_try])
+      if test "$ac_status" -eq 0; then
+	# Ensure the archiver fails upon bogus file names.
+	rm -f conftest.$ac_objext libconftest.a
+	AC_TRY_EVAL([lt_ar_try])
+	if test "$ac_status" -ne 0; then
+          lt_cv_ar_at_file=@
+        fi
+      fi
+      rm -f conftest.* libconftest.a
+     ])
+  ])
+
+if test "x$lt_cv_ar_at_file" = xno; then
+  archiver_list_spec=
+else
+  archiver_list_spec=$lt_cv_ar_at_file
+fi
+_LT_DECL([], [archiver_list_spec], [1],
+  [How to feed a file listing to the archiver])
+])# _LT_PROG_AR
+
+
 # _LT_CMD_OLD_ARCHIVE
 # -------------------
 m4_defun([_LT_CMD_OLD_ARCHIVE],
-[AC_CHECK_TOOL(AR, ar, false)
-test -z "$AR" && AR=ar
-test -z "$AR_FLAGS" && AR_FLAGS=cru
-_LT_DECL([], [AR], [1], [The archiver])
-_LT_DECL([], [AR_FLAGS], [1])
+[_LT_PROG_AR
 
 AC_CHECK_TOOL(STRIP, strip, :)
 test -z "$STRIP" && STRIP=:
@@ -1395,18 +1485,27 @@
 if test -n "$RANLIB"; then
   case $host_os in
   openbsd*)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
     ;;
   *)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
     ;;
   esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
+  old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
 fi
+
+case $host_os in
+  darwin*)
+    lock_old_archive_extraction=yes ;;
+  *)
+    lock_old_archive_extraction=no ;;
+esac
 _LT_DECL([], [old_postinstall_cmds], [2])
 _LT_DECL([], [old_postuninstall_cmds], [2])
 _LT_TAGDECL([], [old_archive_cmds], [2],
     [Commands used to build an old-style archive])
+_LT_DECL([], [lock_old_archive_extraction], [0],
+    [Whether to use a lock for old archive extraction])
 ])# _LT_CMD_OLD_ARCHIVE
 
 
@@ -1431,15 +1530,15 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [[^ ]]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:__oline__: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&AS_MESSAGE_LOG_FD
-   echo "$as_me:__oline__: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
+   echo "$as_me:$LINENO: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
        $2=yes
@@ -1479,7 +1578,7 @@
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1>&AS_MESSAGE_LOG_FD
-       $ECHO "X$_lt_linker_boilerplate" | $Xsed -e '/^$/d' > conftest.exp
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
        $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
        if diff conftest.exp conftest.er2 >/dev/null; then
          $2=yes
@@ -1542,6 +1641,11 @@
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
+  mint*)
+    # On MiNT this can take a long time and run out of memory.
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
   amigaos*)
     # On AmigaOS with pdksh, this test takes hours, literally.
     # So we just punt and use a minimum line length of 8192.
@@ -1567,6 +1671,11 @@
     lt_cv_sys_max_cmd_len=196608
     ;;
 
+  os2*)
+    # The test takes a long time on OS/2.
+    lt_cv_sys_max_cmd_len=8192
+    ;;
+
   osf*)
     # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
     # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
@@ -1606,8 +1715,8 @@
       # If test is not a shell built-in, we'll probably end up computing a
       # maximum length that is only half of the actual maximum length, but
       # we can't tell.
-      while { test "X"`$SHELL [$]0 --fallback-echo "X$teststring$teststring" 2>/dev/null` \
-	         = "XX$teststring$teststring"; } >/dev/null 2>&1 &&
+      while { test "X"`env echo "$teststring$teststring" 2>/dev/null` \
+	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
 	      test $i != 17 # 1/2 MB should be enough
       do
         i=`expr $i + 1`
@@ -1658,7 +1767,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-[#line __oline__ "configure"
+[#line $LINENO "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -1699,7 +1808,13 @@
 #  endif
 #endif
 
-void fnord() { int i=42;}
+/* When -fvisbility=hidden is used, assume the code has been annotated
+   correspondingly for the symbols needed.  */
+#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+int fnord () __attribute__((visibility("default")));
+#endif
+
+int fnord () { return 42; }
 int main ()
 {
   void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
@@ -1708,7 +1823,11 @@
   if (self)
     {
       if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
-      else if (dlsym( self,"_fnord")) status = $lt_dlneed_uscore;
+      else
+        {
+	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
+          else puts (dlerror ());
+	}
       /* dlclose (self); */
     }
   else
@@ -1884,16 +2003,16 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [[^ ]]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:__oline__: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&AS_MESSAGE_LOG_FD)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&AS_MESSAGE_LOG_FD
-   echo "$as_me:__oline__: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
+   echo "$as_me:$LINENO: \$? = $ac_status" >&AS_MESSAGE_LOG_FD
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
        _LT_TAGVAR(lt_cv_prog_compiler_c_o, $1)=yes
@@ -2052,6 +2171,7 @@
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_OBJDUMP])dnl
 m4_require([_LT_DECL_SED])dnl
+m4_require([_LT_CHECK_SHELL_FEATURES])dnl
 AC_MSG_CHECKING([dynamic linker characteristics])
 m4_if([$1],
 	[], [
@@ -2060,16 +2180,23 @@
     darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
     *) lt_awk_arg="/^libraries:/" ;;
   esac
-  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-  if $ECHO "$lt_search_path_spec" | $GREP ';' >/dev/null ; then
+  case $host_os in
+    mingw* | cegcc*) lt_sed_strip_eq="s,=\([[A-Za-z]]:\),\1,g" ;;
+    *) lt_sed_strip_eq="s,=/,/,g" ;;
+  esac
+  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
+  case $lt_search_path_spec in
+  *\;*)
     # if the path contains ";" then we assume it to be the separator
     # otherwise default to the standard path separator (i.e. ":") - it is
     # assumed that no part of a normal pathname contains ";" but that should
     # okay in the real world where ";" in dirpaths is itself problematic.
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED -e 's/;/ /g'`
-  else
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-  fi
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED 's/;/ /g'`
+    ;;
+  *)
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED "s/$PATH_SEPARATOR/ /g"`
+    ;;
+  esac
   # Ok, now we have the path, separated by spaces, we can step through it
   # and add multilib dir if necessary.
   lt_tmp_lt_search_path_spec=
@@ -2082,7 +2209,7 @@
 	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
     fi
   done
-  lt_search_path_spec=`$ECHO $lt_tmp_lt_search_path_spec | awk '
+  lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
 BEGIN {RS=" "; FS="/|\n";} {
   lt_foo="";
   lt_count=0;
@@ -2102,7 +2229,13 @@
   if (lt_foo != "") { lt_freq[[lt_foo]]++; }
   if (lt_freq[[lt_foo]] == 1) { print lt_foo; }
 }'`
-  sys_lib_search_path_spec=`$ECHO $lt_search_path_spec`
+  # AWK program above erroneously prepends '/' to C:/dos/paths
+  # for these hosts.
+  case $host_os in
+    mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
+      $SED 's,/\([[A-Za-z]]:\),\1,g'` ;;
+  esac
+  sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
 else
   sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
 fi])
@@ -2128,7 +2261,7 @@
 
 case $host_os in
 aix3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
@@ -2137,7 +2270,7 @@
   ;;
 
 aix[[4-9]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   hardcode_into_libs=yes
@@ -2190,7 +2323,7 @@
   m68k)
     library_names_spec='$libname.ixlibrary $libname.a'
     # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$ECHO "X$lib" | $Xsed -e '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
     ;;
   esac
   ;;
@@ -2202,7 +2335,7 @@
   ;;
 
 bsdi[[45]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
@@ -2221,8 +2354,9 @@
   need_version=no
   need_lib_prefix=no
 
-  case $GCC,$host_os in
-  yes,cygwin* | yes,mingw* | yes,pw32* | yes,cegcc*)
+  case $GCC,$cc_basename in
+  yes,*)
+    # gcc
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
     postinstall_cmds='base_file=`basename \${file}`~
@@ -2243,36 +2377,83 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+m4_if([$1], [],[
+      sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"])
       ;;
     mingw* | cegcc*)
       # MinGW DLLs use traditional 'lib' prefix
       soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec=`$CC -print-search-dirs | $GREP "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-      if $ECHO "$sys_lib_search_path_spec" | [$GREP ';[c-zC-Z]:/' >/dev/null]; then
-        # It is most probably a Windows format PATH printed by
-        # mingw gcc, but we are running on Cygwin. Gcc prints its search
-        # path with ; separators, and with drive letters. We can handle the
-        # drive letters (cygwin fileutils understands them), so leave them,
-        # especially as we might pass files found there to a mingw objdump,
-        # which wouldn't understand a cygwinified path. Ahh.
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-      else
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-      fi
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
       library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
+    dynamic_linker='Win32 ld.exe'
+    ;;
+
+  *,cl*)
+    # Native MSVC
+    libname_spec='$name'
+    soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+    library_names_spec='${libname}.dll.lib'
+
+    case $build_os in
+    mingw*)
+      sys_lib_search_path_spec=
+      lt_save_ifs=$IFS
+      IFS=';'
+      for lt_path in $LIB
+      do
+        IFS=$lt_save_ifs
+        # Let DOS variable expansion print the short 8.3 style file name.
+        lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
+        sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
+      done
+      IFS=$lt_save_ifs
+      # Convert to MSYS style.
+      sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([[a-zA-Z]]\\):| /\\1|g' -e 's|^ ||'`
+      ;;
+    cygwin*)
+      # Convert to unix form, then to dos form, then back to unix form
+      # but this time dos style (no spaces!) so that the unix form looks
+      # like /cygdrive/c/PROGRA~1:/cygdr...
+      sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
+      sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
+      sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      ;;
+    *)
+      sys_lib_search_path_spec="$LIB"
+      if $ECHO "$sys_lib_search_path_spec" | [$GREP ';[c-zC-Z]:/' >/dev/null]; then
+        # It is most probably a Windows format PATH.
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      fi
+      # FIXME: find the short name or the path components, as spaces are
+      # common. (e.g. "Program Files" -> "PROGRA~1")
+      ;;
+    esac
+
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+    dynamic_linker='Win32 link.exe'
     ;;
 
   *)
+    # Assume MSVC wrapper
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    dynamic_linker='Win32 ld.exe'
     ;;
   esac
-  dynamic_linker='Win32 ld.exe'
   # FIXME: first we should search . and the directory the executable is in
   shlibpath_var=PATH
   ;;
@@ -2293,7 +2474,7 @@
   ;;
 
 dgux*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
@@ -2301,10 +2482,6 @@
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
-
 freebsd* | dragonfly*)
   # DragonFly does not have aout.  When/if they implement a new
   # versioning mechanism, adjust this.
@@ -2312,7 +2489,7 @@
     objformat=`/usr/bin/objformat`
   else
     case $host_os in
-    freebsd[[123]]*) objformat=aout ;;
+    freebsd[[23]].*) objformat=aout ;;
     *) objformat=elf ;;
     esac
   fi
@@ -2330,7 +2507,7 @@
   esac
   shlibpath_var=LD_LIBRARY_PATH
   case $host_os in
-  freebsd2*)
+  freebsd2.*)
     shlibpath_overrides_runpath=yes
     ;;
   freebsd3.[[01]]* | freebsdelf3.[[01]]*)
@@ -2349,13 +2526,16 @@
   esac
   ;;
 
-gnu*)
-  version_type=linux
+haiku*)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
+  dynamic_linker="$host_os runtime_loader"
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_var=LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
   hardcode_into_libs=yes
   ;;
 
@@ -2401,12 +2581,14 @@
     soname_spec='${libname}${release}${shared_ext}$major'
     ;;
   esac
-  # HP-UX runs *really* slowly unless shared libraries are mode 555.
+  # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
   postinstall_cmds='chmod 555 $lib'
+  # or fails outright, so override atomically:
+  install_override_mode=555
   ;;
 
 interix[[3-9]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
@@ -2422,7 +2604,7 @@
     nonstopux*) version_type=nonstopux ;;
     *)
 	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
+		version_type=linux # correct to gnu/linux during the next big refactor
 	else
 		version_type=irix
 	fi ;;
@@ -2459,9 +2641,9 @@
   dynamic_linker=no
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
-  version_type=linux
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -2469,29 +2651,31 @@
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
+
   # Some binutils ld are patched to set DT_RUNPATH
-  save_LDFLAGS=$LDFLAGS
-  save_libdir=$libdir
-  eval "libdir=/foo; wl=\"$_LT_TAGVAR(lt_prog_compiler_wl, $1)\"; \
-       LDFLAGS=\"\$LDFLAGS $_LT_TAGVAR(hardcode_libdir_flag_spec, $1)\""
-  AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
-    [AS_IF([ ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null],
-       [shlibpath_overrides_runpath=yes])])
-  LDFLAGS=$save_LDFLAGS
-  libdir=$save_libdir
+  AC_CACHE_VAL([lt_cv_shlibpath_overrides_runpath],
+    [lt_cv_shlibpath_overrides_runpath=no
+    save_LDFLAGS=$LDFLAGS
+    save_libdir=$libdir
+    eval "libdir=/foo; wl=\"$_LT_TAGVAR(lt_prog_compiler_wl, $1)\"; \
+	 LDFLAGS=\"\$LDFLAGS $_LT_TAGVAR(hardcode_libdir_flag_spec, $1)\""
+    AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
+      [AS_IF([ ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null],
+	 [lt_cv_shlibpath_overrides_runpath=yes])])
+    LDFLAGS=$save_LDFLAGS
+    libdir=$save_libdir
+    ])
+  shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
 
   # This implies no fast_install, which is unacceptable.
   # Some rework will be needed to allow for fast_install
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Add ABI-specific directories to the system library path.
-  sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
-
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \[$]2)); skip = 1; } { if (!skip) print \[$]0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec $lt_ld_extra"
+    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \[$]2)); skip = 1; } { if (!skip) print \[$]0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
+    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
   fi
 
   # We used to test for /lib/ld.so.1 and disable shared libraries on
@@ -2503,6 +2687,18 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
+netbsdelf*-gnu)
+  version_type=linux
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='NetBSD ld.elf_so'
+  ;;
+
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -2522,7 +2718,7 @@
   ;;
 
 newsos6)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
@@ -2591,7 +2787,7 @@
   ;;
 
 solaris*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -2616,7 +2812,7 @@
   ;;
 
 sysv4 | sysv4.3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -2640,7 +2836,7 @@
 
 sysv4*MP*)
   if test -d /usr/nec ;then
-    version_type=linux
+    version_type=linux # correct to gnu/linux during the next big refactor
     library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
     soname_spec='$libname${shared_ext}.$major'
     shlibpath_var=LD_LIBRARY_PATH
@@ -2671,7 +2867,7 @@
 
 tpf*)
   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -2681,7 +2877,7 @@
   ;;
 
 uts4*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -2723,6 +2919,8 @@
     The last name is the one that the linker finds with -lNAME]])
 _LT_DECL([], [soname_spec], [1],
     [[The coded name of the library, if different from the real name]])
+_LT_DECL([], [install_override_mode], [1],
+    [Permission mode override for installation of shared libraries])
 _LT_DECL([], [postinstall_cmds], [2],
     [Command to use after installation of a shared archive])
 _LT_DECL([], [postuninstall_cmds], [2],
@@ -2835,6 +3033,7 @@
 AC_REQUIRE([AC_CANONICAL_BUILD])dnl
 m4_require([_LT_DECL_SED])dnl
 m4_require([_LT_DECL_EGREP])dnl
+m4_require([_LT_PROG_ECHO_BACKSLASH])dnl
 
 AC_ARG_WITH([gnu-ld],
     [AS_HELP_STRING([--with-gnu-ld],
@@ -2956,6 +3155,11 @@
 esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
 case $host_os in
+  cygwin* | mingw* | pw32* | cegcc*)
+    if test "$GCC" != yes; then
+      reload_cmds=false
+    fi
+    ;;
   darwin*)
     if test "$GCC" = yes; then
       reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
@@ -2964,8 +3168,8 @@
     fi
     ;;
 esac
-_LT_DECL([], [reload_flag], [1], [How to create reloadable object files])dnl
-_LT_DECL([], [reload_cmds], [2])dnl
+_LT_TAGDECL([], [reload_flag], [1], [How to create reloadable object files])dnl
+_LT_TAGDECL([], [reload_cmds], [2])dnl
 ])# _LT_CMD_RELOAD
 
 
@@ -3017,16 +3221,18 @@
   # Base MSYS/MinGW do not provide the 'file' command needed by
   # func_win32_libid shell function, so use a weaker test based on 'objdump',
   # unless we find 'file', for example because we are cross-compiling.
-  if ( file / ) >/dev/null 2>&1; then
+  # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
+  if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
     lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
     lt_cv_file_magic_cmd='func_win32_libid'
   else
-    lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'
+    # Keep this pattern in sync with the one in func_win32_libid.
+    lt_cv_deplibs_check_method='file_magic file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)'
     lt_cv_file_magic_cmd='$OBJDUMP -f'
   fi
   ;;
 
-cegcc)
+cegcc*)
   # use the weaker test based on 'objdump'. See mingw*.
   lt_cv_deplibs_check_method='file_magic file format pe-arm-.*little(.*architecture: arm)?'
   lt_cv_file_magic_cmd='$OBJDUMP -f'
@@ -3052,7 +3258,7 @@
   fi
   ;;
 
-gnu*)
+haiku*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -3064,11 +3270,11 @@
     lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
     ;;
   hppa*64*)
-    [lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - PA-RISC [0-9].[0-9]']
+    [lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF[ -][0-9][0-9])(-bit)?( [LM]SB)? shared object( file)?[, -]* PA-RISC [0-9]\.[0-9]']
     lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
     ;;
   *)
-    lt_cv_deplibs_check_method='file_magic (s[[0-9]][[0-9]][[0-9]]|PA-RISC[[0-9]].[[0-9]]) shared library'
+    lt_cv_deplibs_check_method='file_magic (s[[0-9]][[0-9]][[0-9]]|PA-RISC[[0-9]]\.[[0-9]]) shared library'
     lt_cv_file_magic_test_file=/usr/lib/libc.sl
     ;;
   esac
@@ -3089,12 +3295,12 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd*)
+netbsd* | netbsdelf*-gnu)
   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
   else
@@ -3168,6 +3374,21 @@
   ;;
 esac
 ])
+
+file_magic_glob=
+want_nocaseglob=no
+if test "$build" = "$host"; then
+  case $host_os in
+  mingw* | pw32*)
+    if ( shopt | grep nocaseglob ) >/dev/null 2>&1; then
+      want_nocaseglob=yes
+    else
+      file_magic_glob=`echo aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ | $SED -e "s/\(..\)/s\/[[\1]]\/[[\1]]\/g;/g"`
+    fi
+    ;;
+  esac
+fi
+
 file_magic_cmd=$lt_cv_file_magic_cmd
 deplibs_check_method=$lt_cv_deplibs_check_method
 test -z "$deplibs_check_method" && deplibs_check_method=unknown
@@ -3175,7 +3396,11 @@
 _LT_DECL([], [deplibs_check_method], [1],
     [Method to check whether dependent libraries are shared objects])
 _LT_DECL([], [file_magic_cmd], [1],
-    [Command to use when deplibs_check_method == "file_magic"])
+    [Command to use when deplibs_check_method = "file_magic"])
+_LT_DECL([], [file_magic_glob], [1],
+    [How to find potential files when deplibs_check_method = "file_magic"])
+_LT_DECL([], [want_nocaseglob], [1],
+    [Find potential files using nocaseglob when deplibs_check_method = "file_magic"])
 ])# _LT_CHECK_MAGIC_METHOD
 
 
@@ -3232,7 +3457,19 @@
   NM="$lt_cv_path_NM"
 else
   # Didn't find any BSD compatible name lister, look for dumpbin.
-  AC_CHECK_TOOLS(DUMPBIN, ["dumpbin -symbols" "link -dump -symbols"], :)
+  if test -n "$DUMPBIN"; then :
+    # Let the user override the test.
+  else
+    AC_CHECK_TOOLS(DUMPBIN, [dumpbin "link -dump"], :)
+    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    *COFF*)
+      DUMPBIN="$DUMPBIN -symbols"
+      ;;
+    *)
+      DUMPBIN=:
+      ;;
+    esac
+  fi
   AC_SUBST([DUMPBIN])
   if test "$DUMPBIN" != ":"; then
     NM="$DUMPBIN"
@@ -3245,13 +3482,13 @@
 AC_CACHE_CHECK([the name lister ($NM) interface], [lt_cv_nm_interface],
   [lt_cv_nm_interface="BSD nm"
   echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:__oline__: $ac_compile\"" >&AS_MESSAGE_LOG_FD)
+  (eval echo "\"\$as_me:$LINENO: $ac_compile\"" >&AS_MESSAGE_LOG_FD)
   (eval "$ac_compile" 2>conftest.err)
   cat conftest.err >&AS_MESSAGE_LOG_FD
-  (eval echo "\"\$as_me:__oline__: $NM \\\"conftest.$ac_objext\\\"\"" >&AS_MESSAGE_LOG_FD)
+  (eval echo "\"\$as_me:$LINENO: $NM \\\"conftest.$ac_objext\\\"\"" >&AS_MESSAGE_LOG_FD)
   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
   cat conftest.err >&AS_MESSAGE_LOG_FD
-  (eval echo "\"\$as_me:__oline__: output\"" >&AS_MESSAGE_LOG_FD)
+  (eval echo "\"\$as_me:$LINENO: output\"" >&AS_MESSAGE_LOG_FD)
   cat conftest.out >&AS_MESSAGE_LOG_FD
   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
     lt_cv_nm_interface="MS dumpbin"
@@ -3266,6 +3503,67 @@
 dnl AC_DEFUN([AM_PROG_NM], [])
 dnl AC_DEFUN([AC_PROG_NM], [])
 
+# _LT_CHECK_SHAREDLIB_FROM_LINKLIB
+# --------------------------------
+# how to determine the name of the shared library
+# associated with a specific link library.
+#  -- PORTME fill in with the dynamic library characteristics
+m4_defun([_LT_CHECK_SHAREDLIB_FROM_LINKLIB],
+[m4_require([_LT_DECL_EGREP])
+m4_require([_LT_DECL_OBJDUMP])
+m4_require([_LT_DECL_DLLTOOL])
+AC_CACHE_CHECK([how to associate runtime and link libraries],
+lt_cv_sharedlib_from_linklib_cmd,
+[lt_cv_sharedlib_from_linklib_cmd='unknown'
+
+case $host_os in
+cygwin* | mingw* | pw32* | cegcc*)
+  # two different shell functions defined in ltmain.sh
+  # decide which to use based on capabilities of $DLLTOOL
+  case `$DLLTOOL --help 2>&1` in
+  *--identify-strict*)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
+    ;;
+  *)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib_fallback
+    ;;
+  esac
+  ;;
+*)
+  # fallback: assume linklib IS sharedlib
+  lt_cv_sharedlib_from_linklib_cmd="$ECHO"
+  ;;
+esac
+])
+sharedlib_from_linklib_cmd=$lt_cv_sharedlib_from_linklib_cmd
+test -z "$sharedlib_from_linklib_cmd" && sharedlib_from_linklib_cmd=$ECHO
+
+_LT_DECL([], [sharedlib_from_linklib_cmd], [1],
+    [Command to associate shared and link libraries])
+])# _LT_CHECK_SHAREDLIB_FROM_LINKLIB
+
+
+# _LT_PATH_MANIFEST_TOOL
+# ----------------------
+# locate the manifest tool
+m4_defun([_LT_PATH_MANIFEST_TOOL],
+[AC_CHECK_TOOL(MANIFEST_TOOL, mt, :)
+test -z "$MANIFEST_TOOL" && MANIFEST_TOOL=mt
+AC_CACHE_CHECK([if $MANIFEST_TOOL is a manifest tool], [lt_cv_path_mainfest_tool],
+  [lt_cv_path_mainfest_tool=no
+  echo "$as_me:$LINENO: $MANIFEST_TOOL '-?'" >&AS_MESSAGE_LOG_FD
+  $MANIFEST_TOOL '-?' 2>conftest.err > conftest.out
+  cat conftest.err >&AS_MESSAGE_LOG_FD
+  if $GREP 'Manifest Tool' conftest.out > /dev/null; then
+    lt_cv_path_mainfest_tool=yes
+  fi
+  rm -f conftest*])
+if test "x$lt_cv_path_mainfest_tool" != xyes; then
+  MANIFEST_TOOL=:
+fi
+_LT_DECL([], [MANIFEST_TOOL], [1], [Manifest tool])dnl
+])# _LT_PATH_MANIFEST_TOOL
+
 
 # LT_LIB_M
 # --------
@@ -3274,7 +3572,7 @@
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 LIBM=
 case $host in
-*-*-beos* | *-*-cygwin* | *-*-pw32* | *-*-darwin*)
+*-*-beos* | *-*-cegcc* | *-*-cygwin* | *-*-haiku* | *-*-pw32* | *-*-darwin*)
   # These system don't have libm, or don't need it
   ;;
 *-ncr-sysv4.3*)
@@ -3302,7 +3600,12 @@
 _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=
 
 if test "$GCC" = yes; then
-  _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -fno-builtin'
+  case $cc_basename in
+  nvcc*)
+    _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -Xcompiler -fno-builtin' ;;
+  *)
+    _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -fno-builtin' ;;
+  esac
 
   _LT_COMPILER_OPTION([if $compiler supports -fno-rtti -fno-exceptions],
     lt_cv_prog_compiler_rtti_exceptions,
@@ -3319,6 +3622,7 @@
 m4_defun([_LT_CMD_GLOBAL_SYMBOLS],
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 AC_REQUIRE([AC_PROG_CC])dnl
+AC_REQUIRE([AC_PROG_AWK])dnl
 AC_REQUIRE([LT_PATH_NM])dnl
 AC_REQUIRE([LT_PATH_LD])dnl
 m4_require([_LT_DECL_SED])dnl
@@ -3386,8 +3690,8 @@
 lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
 
 # Transform an extracted symbol line into symbol name and symbol address
-lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([[^ ]]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p'"
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([[^ ]]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \(lib[[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([[^ ]]*\)[[ ]]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([[^ ]]*\)[[ ]]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \(lib[[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
 
 # Handle CRLF in mingw tool chain
 opt_cr=
@@ -3411,6 +3715,7 @@
     # which start with @ or ?.
     lt_cv_sys_global_symbol_pipe="$AWK ['"\
 "     {last_section=section; section=\$ 3};"\
+"     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
 "     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
 "     \$ 0!~/External *\|/{next};"\
 "     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
@@ -3423,6 +3728,7 @@
   else
     lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[[	 ]]\($symcode$symcode*\)[[	 ]][[	 ]]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
   fi
+  lt_cv_sys_global_symbol_pipe="$lt_cv_sys_global_symbol_pipe | sed '/ __gnu_lto/d'"
 
   # Check to see that the pipe works correctly.
   pipe_works=no
@@ -3444,7 +3750,7 @@
   if AC_TRY_EVAL(ac_compile); then
     # Now try to grab the symbols.
     nlist=conftest.nm
-    if AC_TRY_EVAL(NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist) && test -s "$nlist"; then
+    if AC_TRY_EVAL(NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist) && test -s "$nlist"; then
       # Try sorting and uniquifying the output.
       if sort "$nlist" | uniq > "$nlist"T; then
 	mv -f "$nlist"T "$nlist"
@@ -3456,6 +3762,18 @@
       if $GREP ' nm_test_var$' "$nlist" >/dev/null; then
 	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
 	  cat <<_LT_EOF > conftest.$ac_ext
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT@&t@_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT@&t@_DLSYM_CONST
+#else
+# define LT@&t@_DLSYM_CONST const
+#endif
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -3467,7 +3785,7 @@
 	  cat <<_LT_EOF >> conftest.$ac_ext
 
 /* The mapping between symbol names and symbols.  */
-const struct {
+LT@&t@_DLSYM_CONST struct {
   const char *name;
   void       *address;
 }
@@ -3493,15 +3811,15 @@
 _LT_EOF
 	  # Now try linking the two files.
 	  mv conftest.$ac_objext conftstm.$ac_objext
-	  lt_save_LIBS="$LIBS"
-	  lt_save_CFLAGS="$CFLAGS"
+	  lt_globsym_save_LIBS=$LIBS
+	  lt_globsym_save_CFLAGS=$CFLAGS
 	  LIBS="conftstm.$ac_objext"
 	  CFLAGS="$CFLAGS$_LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)"
 	  if AC_TRY_EVAL(ac_link) && test -s conftest${ac_exeext}; then
 	    pipe_works=yes
 	  fi
-	  LIBS="$lt_save_LIBS"
-	  CFLAGS="$lt_save_CFLAGS"
+	  LIBS=$lt_globsym_save_LIBS
+	  CFLAGS=$lt_globsym_save_CFLAGS
 	else
 	  echo "cannot find nm_test_func in $nlist" >&AS_MESSAGE_LOG_FD
 	fi
@@ -3534,6 +3852,13 @@
   AC_MSG_RESULT(ok)
 fi
 
+# Response file support.
+if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+  nm_file_list_spec='@'
+elif $NM --help 2>/dev/null | grep '[[@]]FILE' >/dev/null; then
+  nm_file_list_spec='@'
+fi
+
 _LT_DECL([global_symbol_pipe], [lt_cv_sys_global_symbol_pipe], [1],
     [Take the output of nm and produce a listing of raw symbols and C names])
 _LT_DECL([global_symbol_to_cdecl], [lt_cv_sys_global_symbol_to_cdecl], [1],
@@ -3544,6 +3869,8 @@
 _LT_DECL([global_symbol_to_c_name_address_lib_prefix],
     [lt_cv_sys_global_symbol_to_c_name_address_lib_prefix], [1],
     [Transform the output of nm in a C name address pair when lib prefix is needed])
+_LT_DECL([], [nm_file_list_spec], [1],
+    [Specify filename containing input files for $NM])
 ]) # _LT_CMD_GLOBAL_SYMBOLS
 
 
@@ -3555,7 +3882,6 @@
 _LT_TAGVAR(lt_prog_compiler_pic, $1)=
 _LT_TAGVAR(lt_prog_compiler_static, $1)=
 
-AC_MSG_CHECKING([for $compiler option to produce PIC])
 m4_if([$1], [CXX], [
   # C++ specific cases for pic, static, wl, etc.
   if test "$GXX" = yes; then
@@ -3606,6 +3932,11 @@
       # DJGPP does not support shared libraries at all
       _LT_TAGVAR(lt_prog_compiler_pic, $1)=
       ;;
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      _LT_TAGVAR(lt_prog_compiler_static, $1)=
+      ;;
     interix[[3-9]]*)
       # Interix 3.x gcc -fpic/-fPIC options generate broken code.
       # Instead, we relocate shared libraries at runtime.
@@ -3655,6 +3986,12 @@
 	  ;;
 	esac
 	;;
+      mingw* | cygwin* | os2* | pw32* | cegcc*)
+	# This hack is so that the source file can tell whether it is being
+	# built for inclusion in a dll (and should export symbols for example).
+	m4_if([$1], [GCJ], [],
+	  [_LT_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'])
+	;;
       dgux*)
 	case $cc_basename in
 	  ec++*)
@@ -3711,7 +4048,7 @@
 	    ;;
 	esac
 	;;
-      linux* | k*bsd*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
 	case $cc_basename in
 	  KCC*)
 	    # KAI C++ Compiler
@@ -3744,8 +4081,8 @@
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)=
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
 	    ;;
-	  xlc* | xlC*)
-	    # IBM XL 8.0 on PPC
+	  xlc* | xlC* | bgxl[[cC]]* | mpixl[[cC]]*)
+	    # IBM XL 8.0, 9.0 on PPC and BlueGene
 	    _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)='-qpic'
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-qstaticlink'
@@ -3775,7 +4112,7 @@
 	    ;;
 	esac
 	;;
-      netbsd*)
+      netbsd* | netbsdelf*-gnu)
 	;;
       *qnx* | *nto*)
         # QNX uses GNU C++, but need to define -shared option too, otherwise
@@ -3807,7 +4144,7 @@
 	;;
       solaris*)
 	case $cc_basename in
-	  CC*)
+	  CC* | sunCC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
@@ -3911,6 +4248,12 @@
       _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fno-common'
       ;;
 
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      _LT_TAGVAR(lt_prog_compiler_static, $1)=
+      ;;
+
     hpux*)
       # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
       # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
@@ -3953,6 +4296,15 @@
       _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
       ;;
     esac
+
+    case $cc_basename in
+    nvcc*) # Cuda Compiler Driver 2.2
+      _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Xlinker '
+      if test -n "$_LT_TAGVAR(lt_prog_compiler_pic, $1)"; then
+        _LT_TAGVAR(lt_prog_compiler_pic, $1)="-Xcompiler $_LT_TAGVAR(lt_prog_compiler_pic, $1)"
+      fi
+      ;;
+    esac
   else
     # PORTME Check for flag to pass linker flags through the system compiler.
     case $host_os in
@@ -3995,7 +4347,7 @@
       _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
       ;;
 
-    linux* | k*bsd*-gnu)
+    linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
       case $cc_basename in
       # old Intel for x86_64 which still supported -KPIC.
       ecc*)
@@ -4016,7 +4368,13 @@
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='--shared'
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='--static'
 	;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
+      nagfor*)
+	# NAG Fortran compiler
+	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,-Wl,,'
+	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-PIC'
+	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	;;
+      pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
         # Portland Group compilers (*not* the Pentium gcc compiler,
 	# which looks to be a dead project)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
@@ -4028,25 +4386,40 @@
         # All Alpha code is PIC.
         _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
         ;;
-      xl*)
-	# IBM XL C 8.0/Fortran 10.1 on PPC
+      xl* | bgxl* | bgf* | mpixl*)
+	# IBM XL C 8.0/Fortran 10.1, 11.1 on PPC and BlueGene
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-qpic'
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-qstaticlink'
 	;;
       *)
 	case `$CC -V 2>&1 | sed 5q` in
+	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [[1-7]].* | *Sun*Fortran*\ 8.[[0-3]]*)
+	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)=''
+	  ;;
+	*Sun\ F* | *Sun*Fortran*)
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld '
+	  ;;
 	*Sun\ C*)
 	  # Sun C 5.9
 	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	  ;;
-	*Sun\ F*)
-	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
-	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+        *Intel*\ [[CF]]*Compiler*)
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
+	  ;;
+	*Portland\ Group*)
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fpic'
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
-	  _LT_TAGVAR(lt_prog_compiler_wl, $1)=''
 	  ;;
 	esac
 	;;
@@ -4078,7 +4451,7 @@
       _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
       _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       case $cc_basename in
-      f77* | f90* | f95*)
+      f77* | f90* | f95* | sunf77* | sunf90* | sunf95*)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld ';;
       *)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,';;
@@ -4135,9 +4508,11 @@
     _LT_TAGVAR(lt_prog_compiler_pic, $1)="$_LT_TAGVAR(lt_prog_compiler_pic, $1)@&t@m4_if([$1],[],[ -DPIC],[m4_if([$1],[CXX],[ -DPIC],[])])"
     ;;
 esac
-AC_MSG_RESULT([$_LT_TAGVAR(lt_prog_compiler_pic, $1)])
-_LT_TAGDECL([wl], [lt_prog_compiler_wl], [1],
-	[How to pass a linker flag through the compiler])
+
+AC_CACHE_CHECK([for $compiler option to produce PIC],
+  [_LT_TAGVAR(lt_cv_prog_compiler_pic, $1)],
+  [_LT_TAGVAR(lt_cv_prog_compiler_pic, $1)=$_LT_TAGVAR(lt_prog_compiler_pic, $1)])
+_LT_TAGVAR(lt_prog_compiler_pic, $1)=$_LT_TAGVAR(lt_cv_prog_compiler_pic, $1)
 
 #
 # Check to make sure the PIC flag actually works.
@@ -4156,6 +4531,8 @@
 _LT_TAGDECL([pic_flag], [lt_prog_compiler_pic], [1],
 	[Additional compiler flags for building library objects])
 
+_LT_TAGDECL([wl], [lt_prog_compiler_wl], [1],
+	[How to pass a linker flag through the compiler])
 #
 # Check to make sure the static flag actually works.
 #
@@ -4176,6 +4553,7 @@
 m4_defun([_LT_LINKER_SHLIBS],
 [AC_REQUIRE([LT_PATH_LD])dnl
 AC_REQUIRE([LT_PATH_NM])dnl
+m4_require([_LT_PATH_MANIFEST_TOOL])dnl
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_EGREP])dnl
 m4_require([_LT_DECL_SED])dnl
@@ -4184,27 +4562,40 @@
 AC_MSG_CHECKING([whether the $compiler linker ($LD) supports shared libraries])
 m4_if([$1], [CXX], [
   _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
+  _LT_TAGVAR(exclude_expsyms, $1)=['_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*']
   case $host_os in
   aix[[4-9]]*)
     # If we're using GNU nm, then we don't want the "-C" option.
     # -C means demangle to AIX nm, but means don't demangle with GNU nm
+    # Also, AIX nm treats weak defined symbols like other global defined
+    # symbols, whereas GNU nm marks them as "W".
     if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
     else
       _LT_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
     fi
     ;;
   pw32*)
     _LT_TAGVAR(export_symbols_cmds, $1)="$ltdll_cmds"
-  ;;
+    ;;
   cygwin* | mingw* | cegcc*)
-    _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;/^.*[[ ]]__nm__/s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
-  ;;
+    case $cc_basename in
+    cl*)
+      _LT_TAGVAR(exclude_expsyms, $1)='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+      ;;
+    *)
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
+      _LT_TAGVAR(exclude_expsyms, $1)=['[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname']
+      ;;
+    esac
+    ;;
+  linux* | k*bsd*-gnu | gnu*)
+    _LT_TAGVAR(link_all_deplibs, $1)=no
+    ;;
   *)
     _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
-  ;;
+    ;;
   esac
-  _LT_TAGVAR(exclude_expsyms, $1)=['_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*']
 ], [
   runpath_var=
   _LT_TAGVAR(allow_undefined_flag, $1)=
@@ -4219,7 +4610,6 @@
   _LT_TAGVAR(hardcode_direct, $1)=no
   _LT_TAGVAR(hardcode_direct_absolute, $1)=no
   _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-  _LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
   _LT_TAGVAR(hardcode_libdir_separator, $1)=
   _LT_TAGVAR(hardcode_minus_L, $1)=no
   _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
@@ -4264,10 +4654,39 @@
   openbsd*)
     with_gnu_ld=no
     ;;
+  linux* | k*bsd*-gnu | gnu*)
+    _LT_TAGVAR(link_all_deplibs, $1)=no
+    ;;
   esac
 
   _LT_TAGVAR(ld_shlibs, $1)=yes
+
+  # On some targets, GNU ld is compatible enough with the native linker
+  # that we're better off using the native interface for both.
+  lt_use_gnu_ld_interface=no
   if test "$with_gnu_ld" = yes; then
+    case $host_os in
+      aix*)
+	# The AIX port of GNU ld has always aspired to compatibility
+	# with the native linker.  However, as the warning in the GNU ld
+	# block says, versions before 2.19.5* couldn't really create working
+	# shared libraries, regardless of the interface used.
+	case `$LD -v 2>&1` in
+	  *\ \(GNU\ Binutils\)\ 2.19.5*) ;;
+	  *\ \(GNU\ Binutils\)\ 2.[[2-9]]*) ;;
+	  *\ \(GNU\ Binutils\)\ [[3-9]]*) ;;
+	  *)
+	    lt_use_gnu_ld_interface=yes
+	    ;;
+	esac
+	;;
+      *)
+	lt_use_gnu_ld_interface=yes
+	;;
+    esac
+  fi
+
+  if test "$lt_use_gnu_ld_interface" = yes; then
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
@@ -4285,6 +4704,7 @@
     fi
     supports_anon_versioning=no
     case `$LD -v 2>&1` in
+      *GNU\ gold*) supports_anon_versioning=yes ;;
       *\ [[01]].* | *\ 2.[[0-9]].* | *\ 2.10.*) ;; # catch versions < 2.11
       *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
       *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
@@ -4300,11 +4720,12 @@
 	_LT_TAGVAR(ld_shlibs, $1)=no
 	cat <<_LT_EOF 1>&2
 
-*** Warning: the GNU linker, at least up to release 2.9.1, is reported
+*** Warning: the GNU linker, at least up to release 2.19, is reported
 *** to be unable to reliably create shared libraries on AIX.
 *** Therefore, libtool is disabling shared libraries support.  If you
-*** really care for shared libraries, you may want to modify your PATH
-*** so that a non-GNU linker is found, and then restart.
+*** really care for shared libraries, you may want to install binutils
+*** 2.20 or above, or modify your PATH so that a non-GNU linker is found.
+*** You will then need to restart the configuration process.
 
 _LT_EOF
       fi
@@ -4340,10 +4761,12 @@
       # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
       # as there is no search path for DLLs.
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-all-symbols'
       _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
       _LT_TAGVAR(always_export_symbols, $1)=no
       _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
-      _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]][[ ]]/s/.*[[ ]]//'\'' | sort | uniq > $export_symbols'
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
+      _LT_TAGVAR(exclude_expsyms, $1)=['[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname']
 
       if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
         _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
@@ -4361,6 +4784,11 @@
       fi
       ;;
 
+    haiku*)
+      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      _LT_TAGVAR(link_all_deplibs, $1)=yes
+      ;;
+
     interix[[3-9]]*)
       _LT_TAGVAR(hardcode_direct, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
@@ -4376,7 +4804,7 @@
       _LT_TAGVAR(archive_expsym_cmds, $1)='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
       ;;
 
-    gnu* | linux* | tpf* | k*bsd*-gnu)
+    gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
       tmp_diet=no
       if test "$host_os" = linux-dietlibc; then
 	case $cc_basename in
@@ -4386,15 +4814,16 @@
       if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
 	 && test "$tmp_diet" = no
       then
-	tmp_addflag=
+	tmp_addflag=' $pic_flag'
 	tmp_sharedflag='-shared'
 	case $cc_basename,$host_cpu in
         pgcc*)				# Portland Group C compiler
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  tmp_addflag=' $pic_flag'
 	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	pgf77* | pgf90* | pgf95* | pgfortran*)
+					# Portland Group f77 and f90 compilers
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  tmp_addflag=' $pic_flag -Mnomain' ;;
 	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
 	  tmp_addflag=' -i_dynamic' ;;
@@ -4405,13 +4834,17 @@
 	lf95*)				# Lahey Fortran 8.1
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)=
 	  tmp_sharedflag='--shared' ;;
-	xl[[cC]]*)			# IBM XL C 8.0 on PPC (deal with xlf below)
+	xl[[cC]]* | bgxl[[cC]]* | mpixl[[cC]]*) # IBM XL C 8.0 on PPC (deal with xlf below)
 	  tmp_sharedflag='-qmkshrobj'
 	  tmp_addflag= ;;
+	nvcc*)	# Cuda Compiler Driver 2.2
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(compiler_needs_object, $1)=yes
+	  ;;
 	esac
 	case `$CC -V 2>&1 | sed 5q` in
 	*Sun\ C*)			# Sun C 5.9
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  _LT_TAGVAR(compiler_needs_object, $1)=yes
 	  tmp_sharedflag='-G' ;;
 	*Sun\ F*)			# Sun Fortran 8.3
@@ -4427,17 +4860,16 @@
         fi
 
 	case $cc_basename in
-	xlf*)
+	xlf* | bgf* | bgxlf* | mpixlf*)
 	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)='--whole-archive$convenience --no-whole-archive'
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-	  _LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='-rpath $libdir'
-	  _LT_TAGVAR(archive_cmds, $1)='$LD -shared $libobjs $deplibs $compiler_flags -soname $soname -o $lib'
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+	  _LT_TAGVAR(archive_cmds, $1)='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
 	  if test "x$supports_anon_versioning" = xyes; then
 	    _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $output_objdir/$libname.ver~
 	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
 	      echo "local: *; };" >> $output_objdir/$libname.ver~
-	      $LD -shared $libobjs $deplibs $compiler_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
+	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
 	  fi
 	  ;;
 	esac
@@ -4446,13 +4878,13 @@
       fi
       ;;
 
-    netbsd*)
+    netbsd* | netbsdelf*-gnu)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       fi
       ;;
 
@@ -4470,8 +4902,8 @@
 
 _LT_EOF
       elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
@@ -4517,8 +4949,8 @@
 
     *)
       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
@@ -4558,8 +4990,10 @@
       else
 	# If we're using GNU nm, then we don't want the "-C" option.
 	# -C means demangle to AIX nm, but means don't demangle with GNU nm
+	# Also, AIX nm treats weak defined symbols like other global
+	# defined symbols, whereas GNU nm marks them as "W".
 	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
 	else
 	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
 	fi
@@ -4621,6 +5055,7 @@
 	if test "$aix_use_runtimelinking" = yes; then
 	  shared_flag="$shared_flag "'${wl}-G'
 	fi
+	_LT_TAGVAR(link_all_deplibs, $1)=no
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -4646,9 +5081,9 @@
 	_LT_TAGVAR(allow_undefined_flag, $1)='-berok'
         # Determine the default libpath from the value encoded in an
         # empty executable.
-        _LT_SYS_MODULE_PATH_AIX
+        _LT_SYS_MODULE_PATH_AIX([$1])
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
       else
 	if test "$host_cpu" = ia64; then
 	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $libdir:/usr/lib:/lib'
@@ -4657,14 +5092,19 @@
 	else
 	 # Determine the default libpath from the value encoded in an
 	 # empty executable.
-	 _LT_SYS_MODULE_PATH_AIX
+	 _LT_SYS_MODULE_PATH_AIX([$1])
 	 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
 	  # Warning - without using the other run time loading flags,
 	  # -berok will link without error, but may produce a broken library.
 	  _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-bernotok'
 	  _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-berok'
-	  # Exported symbols can be pulled into shared objects from archives
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	  if test "$with_gnu_ld" = yes; then
+	    # We only use this code for GNU lds that support --whole-archive.
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	  else
+	    # Exported symbols can be pulled into shared objects from archives
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	  fi
 	  _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
 	  # This is similar to how AIX traditionally builds its shared libraries.
 	  _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
@@ -4696,20 +5136,64 @@
       # Microsoft Visual C++.
       # hardcode_libdir_flag_spec is actually meaningless, as there is
       # no search path for DLLs.
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
-      _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-      # Tell ltmain to make .lib files, not .a files.
-      libext=lib
-      # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
-      # FIXME: Setting linknames here is a bad hack.
-      _LT_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `$ECHO "X$deplibs" | $Xsed -e '\''s/ -lc$//'\''` -link -dll~linknames='
-      # The linker will automatically build a .lib file if we build a DLL.
-      _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
-      # FIXME: Should let the user specify the lib program.
-      _LT_TAGVAR(old_archive_cmds, $1)='lib -OUT:$oldlib$oldobjs$old_deplibs'
-      _LT_TAGVAR(fix_srcfile_path, $1)='`cygpath -w "$srcfile"`'
-      _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+      case $cc_basename in
+      cl*)
+	# Native MSVC
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
+	_LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	_LT_TAGVAR(always_export_symbols, $1)=yes
+	_LT_TAGVAR(file_list_spec, $1)='@'
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	_LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	_LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	  else
+	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	  fi~
+	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	  linknames='
+	# The linker will not automatically build a static lib if we build a DLL.
+	# _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
+	_LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	_LT_TAGVAR(exclude_expsyms, $1)='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+	_LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1,DATA/'\'' | $SED -e '\''/^[[AITW]][[ ]]/s/.*[[ ]]//'\'' | sort | uniq > $export_symbols'
+	# Don't use ranlib
+	_LT_TAGVAR(old_postinstall_cmds, $1)='chmod 644 $oldlib'
+	_LT_TAGVAR(postlink_cmds, $1)='lt_outputfile="@OUTPUT@"~
+	  lt_tool_outputfile="@TOOL_OUTPUT@"~
+	  case $lt_outputfile in
+	    *.exe|*.EXE) ;;
+	    *)
+	      lt_outputfile="$lt_outputfile.exe"
+	      lt_tool_outputfile="$lt_tool_outputfile.exe"
+	      ;;
+	  esac~
+	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	    $RM "$lt_outputfile.manifest";
+	  fi'
+	;;
+      *)
+	# Assume MSVC wrapper
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
+	_LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	_LT_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
+	# The linker will automatically build a .lib file if we build a DLL.
+	_LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
+	# FIXME: Should let the user specify the lib program.
+	_LT_TAGVAR(old_archive_cmds, $1)='lib -OUT:$oldlib$oldobjs$old_deplibs'
+	_LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	;;
+      esac
       ;;
 
     darwin* | rhapsody*)
@@ -4722,10 +5206,6 @@
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
 
-    freebsd1*)
-      _LT_TAGVAR(ld_shlibs, $1)=no
-      ;;
-
     # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
     # support.  Future versions do this automatically, but an explicit c++rt0.o
     # does not break anything, and helps significantly (at the cost of a little
@@ -4738,7 +5218,7 @@
       ;;
 
     # Unfortunately, older versions of FreeBSD 2 do not have this feature.
-    freebsd2*)
+    freebsd2.*)
       _LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
       _LT_TAGVAR(hardcode_direct, $1)=yes
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
@@ -4747,7 +5227,7 @@
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
     freebsd* | dragonfly*)
-      _LT_TAGVAR(archive_cmds, $1)='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
+      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
       _LT_TAGVAR(hardcode_direct, $1)=yes
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
@@ -4755,7 +5235,7 @@
 
     hpux9*)
       if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
 	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
@@ -4770,14 +5250,13 @@
       ;;
 
     hpux10*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
       else
 	_LT_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
       fi
       if test "$with_gnu_ld" = no; then
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
-	_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='+b $libdir'
 	_LT_TAGVAR(hardcode_libdir_separator, $1)=:
 	_LT_TAGVAR(hardcode_direct, $1)=yes
 	_LT_TAGVAR(hardcode_direct_absolute, $1)=yes
@@ -4789,16 +5268,16 @@
       ;;
 
     hpux11*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
 	case $host_cpu in
 	hppa*64*)
 	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	esac
       else
@@ -4810,7 +5289,14 @@
 	  _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	m4_if($1, [], [
+	  # Older versions of the 11.00 compiler do not understand -b yet
+	  # (HP92453-01 A.11.01.20 doesn't, HP92453-01 B.11.X.35175-35176.GP does)
+	  _LT_LINKER_OPTION([if $CC understands -b],
+	    _LT_TAGVAR(lt_cv_prog_compiler__b, $1), [-b],
+	    [_LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'],
+	    [_LT_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'])],
+	  [_LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'])
 	  ;;
 	esac
       fi
@@ -4838,19 +5324,34 @@
 
     irix5* | irix6* | nonstopux*)
       if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	# Try to use the -exported_symbol ld option, if it does not
 	# work, assume that -exports_file does not work either and
 	# implicitly export all symbols.
-        save_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
-        AC_LINK_IFELSE(int foo(void) {},
-          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
-        )
-        LDFLAGS="$save_LDFLAGS"
+	# This should be the same for all languages, so no per-tag cache variable.
+	AC_CACHE_CHECK([whether the $host_os linker accepts -exported_symbol],
+	  [lt_cv_irix_exported_symbol],
+	  [save_LDFLAGS="$LDFLAGS"
+	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
+	   AC_LINK_IFELSE(
+	     [AC_LANG_SOURCE(
+	        [AC_LANG_CASE([C], [[int foo (void) { return 0; }]],
+			      [C++], [[int foo (void) { return 0; }]],
+			      [Fortran 77], [[
+      subroutine foo
+      end]],
+			      [Fortran], [[
+      subroutine foo
+      end]])])],
+	      [lt_cv_irix_exported_symbol=yes],
+	      [lt_cv_irix_exported_symbol=no])
+           LDFLAGS="$save_LDFLAGS"])
+	if test "$lt_cv_irix_exported_symbol" = yes; then
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
+	fi
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
       fi
       _LT_TAGVAR(archive_cmds_need_lc, $1)='no'
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
@@ -4859,7 +5360,7 @@
       _LT_TAGVAR(link_all_deplibs, $1)=yes
       ;;
 
-    netbsd*)
+    netbsd* | netbsdelf*-gnu)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -4912,17 +5413,17 @@
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
       _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$ECHO DATA >> $output_objdir/$libname.def~$ECHO " SINGLE NONSHARED" >> $output_objdir/$libname.def~$ECHO EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
       _LT_TAGVAR(old_archive_from_new_cmds, $1)='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
     osf3*)
       if test "$GCC" = yes; then
 	_LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
       else
 	_LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
       fi
       _LT_TAGVAR(archive_cmds_need_lc, $1)='no'
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
@@ -4932,13 +5433,13 @@
     osf4* | osf5*)	# as osf3* with the addition of -msym flag
       if test "$GCC" = yes; then
 	_LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
       else
 	_LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	_LT_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
-	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
+	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
@@ -4951,9 +5452,9 @@
       _LT_TAGVAR(no_undefined_flag, $1)=' -z defs'
       if test "$GCC" = yes; then
 	wlarc='${wl}'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	_LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
       else
 	case `$CC -V 2>&1` in
 	*"Compilers 5.0"*)
@@ -5129,36 +5630,38 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      AC_MSG_CHECKING([whether -lc should be explicitly linked in])
-      $RM conftest*
-      echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-
-      if AC_TRY_EVAL(ac_compile) 2>conftest.err; then
-        soname=conftest
-        lib=conftest
-        libobjs=conftest.$ac_objext
-        deplibs=
-        wl=$_LT_TAGVAR(lt_prog_compiler_wl, $1)
-	pic_flag=$_LT_TAGVAR(lt_prog_compiler_pic, $1)
-        compiler_flags=-v
-        linker_flags=-v
-        verstring=
-        output_objdir=.
-        libname=conftest
-        lt_save_allow_undefined_flag=$_LT_TAGVAR(allow_undefined_flag, $1)
-        _LT_TAGVAR(allow_undefined_flag, $1)=
-        if AC_TRY_EVAL(_LT_TAGVAR(archive_cmds, $1) 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1)
-        then
-	  _LT_TAGVAR(archive_cmds_need_lc, $1)=no
-        else
-	  _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
-        fi
-        _LT_TAGVAR(allow_undefined_flag, $1)=$lt_save_allow_undefined_flag
-      else
-        cat conftest.err 1>&5
-      fi
-      $RM conftest*
-      AC_MSG_RESULT([$_LT_TAGVAR(archive_cmds_need_lc, $1)])
+      AC_CACHE_CHECK([whether -lc should be explicitly linked in],
+	[lt_cv_]_LT_TAGVAR(archive_cmds_need_lc, $1),
+	[$RM conftest*
+	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+
+	if AC_TRY_EVAL(ac_compile) 2>conftest.err; then
+	  soname=conftest
+	  lib=conftest
+	  libobjs=conftest.$ac_objext
+	  deplibs=
+	  wl=$_LT_TAGVAR(lt_prog_compiler_wl, $1)
+	  pic_flag=$_LT_TAGVAR(lt_prog_compiler_pic, $1)
+	  compiler_flags=-v
+	  linker_flags=-v
+	  verstring=
+	  output_objdir=.
+	  libname=conftest
+	  lt_save_allow_undefined_flag=$_LT_TAGVAR(allow_undefined_flag, $1)
+	  _LT_TAGVAR(allow_undefined_flag, $1)=
+	  if AC_TRY_EVAL(_LT_TAGVAR(archive_cmds, $1) 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1)
+	  then
+	    lt_cv_[]_LT_TAGVAR(archive_cmds_need_lc, $1)=no
+	  else
+	    lt_cv_[]_LT_TAGVAR(archive_cmds_need_lc, $1)=yes
+	  fi
+	  _LT_TAGVAR(allow_undefined_flag, $1)=$lt_save_allow_undefined_flag
+	else
+	  cat conftest.err 1>&5
+	fi
+	$RM conftest*
+	])
+      _LT_TAGVAR(archive_cmds_need_lc, $1)=$lt_cv_[]_LT_TAGVAR(archive_cmds_need_lc, $1)
       ;;
     esac
   fi
@@ -5195,9 +5698,6 @@
 _LT_TAGDECL([], [hardcode_libdir_flag_spec], [1],
     [Flag to hardcode $libdir into a binary during linking.
     This must work even if $libdir does not exist])
-_LT_TAGDECL([], [hardcode_libdir_flag_spec_ld], [1],
-    [[If ld is used when linking, flag to hardcode $libdir into a binary
-    during linking.  This must work even if $libdir does not exist]])
 _LT_TAGDECL([], [hardcode_libdir_separator], [1],
     [Whether we need a single "-rpath" flag with a separated argument])
 _LT_TAGDECL([], [hardcode_direct], [0],
@@ -5223,8 +5723,6 @@
     to runtime path list])
 _LT_TAGDECL([], [link_all_deplibs], [0],
     [Whether libtool must link a program against all its dependency libraries])
-_LT_TAGDECL([], [fix_srcfile_path], [1],
-    [Fix the shell variable $srcfile for the compiler])
 _LT_TAGDECL([], [always_export_symbols], [0],
     [Set to "yes" if exported symbols are required])
 _LT_TAGDECL([], [export_symbols_cmds], [2],
@@ -5235,6 +5733,8 @@
     [Symbols that must always be exported])
 _LT_TAGDECL([], [prelink_cmds], [2],
     [Commands necessary for linking programs (against libraries) with templates])
+_LT_TAGDECL([], [postlink_cmds], [2],
+    [Commands necessary for finishing linking programs])
 _LT_TAGDECL([], [file_list_spec], [1],
     [Specify filename containing input files])
 dnl FIXME: Not yet implemented
@@ -5324,37 +5824,22 @@
 ])# _LT_LANG_C_CONFIG
 
 
-# _LT_PROG_CXX
-# ------------
-# Since AC_PROG_CXX is broken, in that it returns g++ if there is no c++
-# compiler, we have our own version here.
-m4_defun([_LT_PROG_CXX],
-[
-pushdef([AC_MSG_ERROR], [_lt_caught_CXX_error=yes])
-AC_PROG_CXX
-if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
-    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
-    (test "X$CXX" != "Xg++"))) ; then
-  AC_PROG_CXXCPP
-else
-  _lt_caught_CXX_error=yes
-fi
-popdef([AC_MSG_ERROR])
-])# _LT_PROG_CXX
-
-dnl aclocal-1.4 backwards compatibility:
-dnl AC_DEFUN([_LT_PROG_CXX], [])
-
-
 # _LT_LANG_CXX_CONFIG([TAG])
 # --------------------------
 # Ensure that the configuration variables for a C++ compiler are suitably
 # defined.  These variables are subsequently used by _LT_CONFIG to write
 # the compiler configuration to `libtool'.
 m4_defun([_LT_LANG_CXX_CONFIG],
-[AC_REQUIRE([_LT_PROG_CXX])dnl
-m4_require([_LT_FILEUTILS_DEFAULTS])dnl
+[m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_EGREP])dnl
+m4_require([_LT_PATH_MANIFEST_TOOL])dnl
+if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
+    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
+    (test "X$CXX" != "Xg++"))) ; then
+  AC_PROG_CXXCPP
+else
+  _lt_caught_CXX_error=yes
+fi
 
 AC_LANG_PUSH(C++)
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
@@ -5366,7 +5851,6 @@
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
@@ -5376,6 +5860,8 @@
 _LT_TAGVAR(module_expsym_cmds, $1)=
 _LT_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 _LT_TAGVAR(no_undefined_flag, $1)=
 _LT_TAGVAR(whole_archive_flag_spec, $1)=
 _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=no
@@ -5407,6 +5893,7 @@
 
   # Allow CC to be a program name with arguments.
   lt_save_CC=$CC
+  lt_save_CFLAGS=$CFLAGS
   lt_save_LD=$LD
   lt_save_GCC=$GCC
   GCC=$GXX
@@ -5424,6 +5911,7 @@
   fi
   test -z "${LDCXX+set}" || LD=$LDCXX
   CC=${CXX-"c++"}
+  CFLAGS=$CXXFLAGS
   compiler=$CC
   _LT_TAGVAR(compiler, $1)=$CC
   _LT_CC_BASENAME([$compiler])
@@ -5445,8 +5933,8 @@
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
         _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -5478,7 +5966,7 @@
       # Commands to make compiler produce verbose output that lists
       # what "hidden" libraries, object files and flags are used when
       # linking a shared library.
-      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
     else
       GXX=no
@@ -5587,10 +6075,10 @@
           _LT_TAGVAR(allow_undefined_flag, $1)='-berok'
           # Determine the default libpath from the value encoded in an empty
           # executable.
-          _LT_SYS_MODULE_PATH_AIX
+          _LT_SYS_MODULE_PATH_AIX([$1])
           _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
 
-          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
         else
           if test "$host_cpu" = ia64; then
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $libdir:/usr/lib:/lib'
@@ -5599,14 +6087,19 @@
           else
 	    # Determine the default libpath from the value encoded in an
 	    # empty executable.
-	    _LT_SYS_MODULE_PATH_AIX
+	    _LT_SYS_MODULE_PATH_AIX([$1])
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
 	    # Warning - without using the other run time loading flags,
 	    # -berok will link without error, but may produce a broken library.
 	    _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-bernotok'
 	    _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-berok'
-	    # Exported symbols can be pulled into shared objects from archives
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	    if test "$with_gnu_ld" = yes; then
+	      # We only use this code for GNU lds that support --whole-archive.
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    else
+	      # Exported symbols can be pulled into shared objects from archives
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
+	    fi
 	    _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
 	    # This is similar to how AIX traditionally builds its shared
 	    # libraries.
@@ -5632,32 +6125,79 @@
 	  # FIXME: insert proper C++ library support
 	  _LT_TAGVAR(ld_shlibs, $1)=no
 	  ;;
-        esac
-        ;;
+        esac
+        ;;
+
+      cygwin* | mingw* | pw32* | cegcc*)
+	case $GXX,$cc_basename in
+	,cl* | no,cl*)
+	  # Native MSVC
+	  # hardcode_libdir_flag_spec is actually meaningless, as there is
+	  # no search path for DLLs.
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
+	  _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	  _LT_TAGVAR(always_export_symbols, $1)=yes
+	  _LT_TAGVAR(file_list_spec, $1)='@'
+	  # Tell ltmain to make .lib files, not .a files.
+	  libext=lib
+	  # Tell ltmain to make .dll files, not .so files.
+	  shrext_cmds=".dll"
+	  # FIXME: Setting linknames here is a bad hack.
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      $SED -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	    else
+	      $SED -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	    fi~
+	    $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	    linknames='
+	  # The linker will not automatically build a static lib if we build a DLL.
+	  # _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
+	  _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	  # Don't use ranlib
+	  _LT_TAGVAR(old_postinstall_cmds, $1)='chmod 644 $oldlib'
+	  _LT_TAGVAR(postlink_cmds, $1)='lt_outputfile="@OUTPUT@"~
+	    lt_tool_outputfile="@TOOL_OUTPUT@"~
+	    case $lt_outputfile in
+	      *.exe|*.EXE) ;;
+	      *)
+		lt_outputfile="$lt_outputfile.exe"
+		lt_tool_outputfile="$lt_tool_outputfile.exe"
+		;;
+	    esac~
+	    func_to_tool_file "$lt_outputfile"~
+	    if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	      $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	      $RM "$lt_outputfile.manifest";
+	    fi'
+	  ;;
+	*)
+	  # g++
+	  # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
+	  # as there is no search path for DLLs.
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-all-symbols'
+	  _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	  _LT_TAGVAR(always_export_symbols, $1)=no
+	  _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
 
-      cygwin* | mingw* | pw32* | cegcc*)
-        # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
-        # as there is no search path for DLLs.
-        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-        _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-        _LT_TAGVAR(always_export_symbols, $1)=no
-        _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
-
-        if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-          # If the export-symbols file already is a .def file (1st line
-          # is EXPORTS), use it as is; otherwise, prepend...
-          _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	    cp $export_symbols $output_objdir/$soname.def;
-          else
-	    echo EXPORTS > $output_objdir/$soname.def;
-	    cat $export_symbols >> $output_objdir/$soname.def;
-          fi~
-          $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-        else
-          _LT_TAGVAR(ld_shlibs, $1)=no
-        fi
-        ;;
+	  if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	    # If the export-symbols file already is a .def file (1st line
+	    # is EXPORTS), use it as is; otherwise, prepend...
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      cp $export_symbols $output_objdir/$soname.def;
+	    else
+	      echo EXPORTS > $output_objdir/$soname.def;
+	      cat $export_symbols >> $output_objdir/$soname.def;
+	    fi~
+	    $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	  else
+	    _LT_TAGVAR(ld_shlibs, $1)=no
+	  fi
+	  ;;
+	esac
+	;;
       darwin* | rhapsody*)
         _LT_DARWIN_LINKER_FEATURES($1)
 	;;
@@ -5680,7 +6220,7 @@
         esac
         ;;
 
-      freebsd[[12]]*)
+      freebsd2.*)
         # C++ shared libraries reported to be fairly broken before
 	# switch to ELF
         _LT_TAGVAR(ld_shlibs, $1)=no
@@ -5696,7 +6236,9 @@
         _LT_TAGVAR(ld_shlibs, $1)=yes
         ;;
 
-      gnu*)
+      haiku*)
+        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        _LT_TAGVAR(link_all_deplibs, $1)=yes
         ;;
 
       hpux9*)
@@ -5723,11 +6265,11 @@
             # explicitly linking system object files so we need to strip them
             # from the output so that they don't get included in the library
             # dependencies.
-            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
             ;;
           *)
             if test "$GXX" = yes; then
-              _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+              _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -nostdlib $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
             else
               # FIXME: insert proper C++ library support
               _LT_TAGVAR(ld_shlibs, $1)=no
@@ -5788,7 +6330,7 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
           *)
 	    if test "$GXX" = yes; then
@@ -5798,10 +6340,10 @@
 	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          ia64*)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          *)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	        esac
 	      fi
@@ -5831,7 +6373,7 @@
         case $cc_basename in
           CC*)
 	    # SGI C++
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -ar", where "CC" is the IRIX C++ compiler.  This is
@@ -5842,9 +6384,9 @@
           *)
 	    if test "$GXX" = yes; then
 	      if test "$with_gnu_ld" = no; then
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	      else
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` -o $lib'
 	      fi
 	    fi
 	    _LT_TAGVAR(link_all_deplibs, $1)=yes
@@ -5855,7 +6397,7 @@
         _LT_TAGVAR(inherit_rpath, $1)=yes
         ;;
 
-      linux* | k*bsd*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
         case $cc_basename in
           KCC*)
 	    # Kuck and Associates, Inc. (KAI) C++ Compiler
@@ -5873,7 +6415,7 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -5910,26 +6452,26 @@
           pgCC* | pgcpp*)
             # Portland Group C++ compiler
 	    case `$CC -V` in
-	    *pgCC\ [[1-5]]* | *pgcpp\ [[1-5]]*)
+	    *pgCC\ [[1-5]].* | *pgcpp\ [[1-5]].*)
 	      _LT_TAGVAR(prelink_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $objs $libobjs $compile_deplibs~
-		compile_command="$compile_command `find $tpldir -name \*.o | $NL2SP`"'
+		compile_command="$compile_command `find $tpldir -name \*.o | sort | $NL2SP`"'
 	      _LT_TAGVAR(old_archive_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $oldobjs$old_deplibs~
-		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | $NL2SP`~
+		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | sort | $NL2SP`~
 		$RANLIB $oldlib'
 	      _LT_TAGVAR(archive_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
 	      ;;
-	    *) # Version 6 will use weak symbols
+	    *) # Version 6 and above use weak symbols
 	      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
 	      ;;
@@ -5937,7 +6479,7 @@
 
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
             ;;
 	  cxx*)
 	    # Compaq C++
@@ -5956,9 +6498,9 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`$ECHO "X$templist" | $Xsed -e "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "X$list" | $Xsed'
 	    ;;
-	  xl*)
+	  xl* | mpixl* | bgxl*)
 	    # IBM XL 8.0 on PPC, with GNU ld
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -5978,13 +6520,13 @@
 	      _LT_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file ${wl}$export_symbols'
 	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
-	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	      _LT_TAGVAR(compiler_needs_object, $1)=yes
 
 	      # Not sure whether something based on
 	      # $CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1
 	      # would be better.
-	      output_verbose_link_cmd='echo'
+	      output_verbose_link_cmd='func_echo_all'
 
 	      # Archives containing C++ object files must be created using
 	      # "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -6053,7 +6595,7 @@
 	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
 	    _LT_TAGVAR(whole_archive_flag_spec, $1)="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
 	  fi
-	  output_verbose_link_cmd=echo
+	  output_verbose_link_cmd=func_echo_all
 	else
 	  _LT_TAGVAR(ld_shlibs, $1)=no
 	fi
@@ -6088,15 +6630,15 @@
 	    case $host in
 	      osf3*)
 	        _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && $ECHO "X${wl}-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && func_echo_all "${wl}-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 		;;
 	      *)
 	        _LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done~
 	          echo "-hidden">> $lib.exp~
-	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~
+	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~
 	          $RM $lib.exp'
 	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
 		;;
@@ -6112,17 +6654,17 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`$ECHO "X$templist" | $Xsed -e "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
 	  *)
 	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	      _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
 	      case $host in
 	        osf3*)
-	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 		  ;;
 	        *)
-	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 		  ;;
 	      esac
 
@@ -6132,7 +6674,7 @@
 	      # Commands to make compiler produce verbose output that lists
 	      # what "hidden" libraries, object files and flags are used when
 	      # linking a shared library.
-	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
 	    else
 	      # FIXME: insert proper C++ library support
@@ -6168,7 +6710,7 @@
 
       solaris*)
         case $cc_basename in
-          CC*)
+          CC* | sunCC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
             _LT_TAGVAR(archive_cmds_need_lc,$1)=yes
 	    _LT_TAGVAR(no_undefined_flag, $1)=' -zdefs'
@@ -6189,7 +6731,7 @@
 	    esac
 	    _LT_TAGVAR(link_all_deplibs, $1)=yes
 
-	    output_verbose_link_cmd='echo'
+	    output_verbose_link_cmd='func_echo_all'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -6209,14 +6751,14 @@
 	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	      _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-z ${wl}defs'
 	      if $CC --version | $GREP -v '^2\.7' > /dev/null; then
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-		  $CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+		  $CC -shared $pic_flag -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
 
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
-	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      else
 	        # g++ 2.7 appears to require `-G' NOT `-shared' on this
 	        # platform.
@@ -6227,7 +6769,7 @@
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
-	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      fi
 
 	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $wl$libdir'
@@ -6281,6 +6823,10 @@
           CC*)
 	    _LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    _LT_TAGVAR(old_archive_cmds, $1)='$CC -Tprelink_objects $oldobjs~
+	      '"$_LT_TAGVAR(old_archive_cmds, $1)"
+	    _LT_TAGVAR(reload_cmds, $1)='$CC -Tprelink_objects $reload_objs~
+	      '"$_LT_TAGVAR(reload_cmds, $1)"
 	    ;;
 	  *)
 	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
@@ -6336,6 +6882,7 @@
   fi # test -n "$compiler"
 
   CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
   LDCXX=$LD
   LD=$lt_save_LD
   GCC=$lt_save_GCC
@@ -6350,6 +6897,29 @@
 ])# _LT_LANG_CXX_CONFIG
 
 
+# _LT_FUNC_STRIPNAME_CNF
+# ----------------------
+# func_stripname_cnf prefix suffix name
+# strip PREFIX and SUFFIX off of NAME.
+# PREFIX and SUFFIX must not contain globbing or regex special
+# characters, hashes, percent signs, but SUFFIX may contain a leading
+# dot (in which case that matches only a dot).
+#
+# This function is identical to the (non-XSI) version of func_stripname,
+# except this one can be used by m4 code that may be executed by configure,
+# rather than the libtool script.
+m4_defun([_LT_FUNC_STRIPNAME_CNF],[dnl
+AC_REQUIRE([_LT_DECL_SED])
+AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])
+func_stripname_cnf ()
+{
+  case ${2} in
+  .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
+  *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+  esac
+} # func_stripname_cnf
+])# _LT_FUNC_STRIPNAME_CNF
+
 # _LT_SYS_HIDDEN_LIBDEPS([TAGNAME])
 # ---------------------------------
 # Figure out "hidden" library dependencies from verbose
@@ -6358,6 +6928,7 @@
 # objects, libraries and library flags.
 m4_defun([_LT_SYS_HIDDEN_LIBDEPS],
 [m4_require([_LT_FILEUTILS_DEFAULTS])dnl
+AC_REQUIRE([_LT_FUNC_STRIPNAME_CNF])dnl
 # Dependencies to place before and after the object being linked:
 _LT_TAGVAR(predep_objects, $1)=
 _LT_TAGVAR(postdep_objects, $1)=
@@ -6407,7 +6978,20 @@
   }
 };
 _LT_EOF
+], [$1], [GO], [cat > conftest.$ac_ext <<_LT_EOF
+package foo
+func foo() {
+}
+_LT_EOF
 ])
+
+_lt_libdeps_save_CFLAGS=$CFLAGS
+case "$CC $CFLAGS " in #(
+*\ -flto*\ *) CFLAGS="$CFLAGS -fno-lto" ;;
+*\ -fwhopr*\ *) CFLAGS="$CFLAGS -fno-whopr" ;;
+*\ -fuse-linker-plugin*\ *) CFLAGS="$CFLAGS -fno-use-linker-plugin" ;;
+esac
+
 dnl Parse the compiler output and extract the necessary
 dnl objects, libraries and library flags.
 if AC_TRY_EVAL(ac_compile); then
@@ -6419,7 +7003,7 @@
   pre_test_object_deps_done=no
 
   for p in `eval "$output_verbose_link_cmd"`; do
-    case $p in
+    case ${prev}${p} in
 
     -L* | -R* | -l*)
        # Some compilers place space between "-{L,R}" and the path.
@@ -6428,13 +7012,22 @@
           test $p = "-R"; then
 	 prev=$p
 	 continue
-       else
-	 prev=
        fi
 
+       # Expand the sysroot to ease extracting the directories later.
+       if test -z "$prev"; then
+         case $p in
+         -L*) func_stripname_cnf '-L' '' "$p"; prev=-L; p=$func_stripname_result ;;
+         -R*) func_stripname_cnf '-R' '' "$p"; prev=-R; p=$func_stripname_result ;;
+         -l*) func_stripname_cnf '-l' '' "$p"; prev=-l; p=$func_stripname_result ;;
+         esac
+       fi
+       case $p in
+       =*) func_stripname_cnf '=' '' "$p"; p=$lt_sysroot$func_stripname_result ;;
+       esac
        if test "$pre_test_object_deps_done" = no; then
-	 case $p in
-	 -L* | -R*)
+	 case ${prev} in
+	 -L | -R)
 	   # Internal compiler library paths should come after those
 	   # provided the user.  The postdeps already come after the
 	   # user supplied libs so there is no need to process them.
@@ -6454,8 +7047,10 @@
 	   _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
 	 fi
        fi
+       prev=
        ;;
 
+    *.lto.$objext) ;; # Ignore GCC LTO objects
     *.$objext)
        # This assumes that the test object file only shows up
        # once in the compiler output.
@@ -6491,6 +7086,7 @@
 fi
 
 $RM -f confest.$objext
+CFLAGS=$_lt_libdeps_save_CFLAGS
 
 # PORTME: override above test on systems where it is broken
 m4_if([$1], [CXX],
@@ -6527,7 +7123,7 @@
 
 solaris*)
   case $cc_basename in
-  CC*)
+  CC* | sunCC*)
     # The more standards-conforming stlport4 library is
     # incompatible with the Cstd library. Avoid specifying
     # it if it's in CXXFLAGS. Ignore libCrun as
@@ -6571,32 +7167,16 @@
 ])# _LT_SYS_HIDDEN_LIBDEPS
 
 
-# _LT_PROG_F77
-# ------------
-# Since AC_PROG_F77 is broken, in that it returns the empty string
-# if there is no fortran compiler, we have our own version here.
-m4_defun([_LT_PROG_F77],
-[
-pushdef([AC_MSG_ERROR], [_lt_disable_F77=yes])
-AC_PROG_F77
-if test -z "$F77" || test "X$F77" = "Xno"; then
-  _lt_disable_F77=yes
-fi
-popdef([AC_MSG_ERROR])
-])# _LT_PROG_F77
-
-dnl aclocal-1.4 backwards compatibility:
-dnl AC_DEFUN([_LT_PROG_F77], [])
-
-
 # _LT_LANG_F77_CONFIG([TAG])
 # --------------------------
 # Ensure that the configuration variables for a Fortran 77 compiler are
 # suitably defined.  These variables are subsequently used by _LT_CONFIG
 # to write the compiler configuration to `libtool'.
 m4_defun([_LT_LANG_F77_CONFIG],
-[AC_REQUIRE([_LT_PROG_F77])dnl
-AC_LANG_PUSH(Fortran 77)
+[AC_LANG_PUSH(Fortran 77)
+if test -z "$F77" || test "X$F77" = "Xno"; then
+  _lt_disable_F77=yes
+fi
 
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
 _LT_TAGVAR(allow_undefined_flag, $1)=
@@ -6606,7 +7186,6 @@
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_automatic, $1)=no
@@ -6615,6 +7194,8 @@
 _LT_TAGVAR(module_expsym_cmds, $1)=
 _LT_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 _LT_TAGVAR(no_undefined_flag, $1)=
 _LT_TAGVAR(whole_archive_flag_spec, $1)=
 _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=no
@@ -6654,7 +7235,9 @@
   # Allow CC to be a program name with arguments.
   lt_save_CC="$CC"
   lt_save_GCC=$GCC
+  lt_save_CFLAGS=$CFLAGS
   CC=${F77-"f77"}
+  CFLAGS=$FFLAGS
   compiler=$CC
   _LT_TAGVAR(compiler, $1)=$CC
   _LT_CC_BASENAME([$compiler])
@@ -6708,38 +7291,24 @@
 
   GCC=$lt_save_GCC
   CC="$lt_save_CC"
+  CFLAGS="$lt_save_CFLAGS"
 fi # test "$_lt_disable_F77" != yes
 
 AC_LANG_POP
 ])# _LT_LANG_F77_CONFIG
 
 
-# _LT_PROG_FC
-# -----------
-# Since AC_PROG_FC is broken, in that it returns the empty string
-# if there is no fortran compiler, we have our own version here.
-m4_defun([_LT_PROG_FC],
-[
-pushdef([AC_MSG_ERROR], [_lt_disable_FC=yes])
-AC_PROG_FC
-if test -z "$FC" || test "X$FC" = "Xno"; then
-  _lt_disable_FC=yes
-fi
-popdef([AC_MSG_ERROR])
-])# _LT_PROG_FC
-
-dnl aclocal-1.4 backwards compatibility:
-dnl AC_DEFUN([_LT_PROG_FC], [])
-
-
 # _LT_LANG_FC_CONFIG([TAG])
 # -------------------------
 # Ensure that the configuration variables for a Fortran compiler are
 # suitably defined.  These variables are subsequently used by _LT_CONFIG
 # to write the compiler configuration to `libtool'.
 m4_defun([_LT_LANG_FC_CONFIG],
-[AC_REQUIRE([_LT_PROG_FC])dnl
-AC_LANG_PUSH(Fortran)
+[AC_LANG_PUSH(Fortran)
+
+if test -z "$FC" || test "X$FC" = "Xno"; then
+  _lt_disable_FC=yes
+fi
 
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
 _LT_TAGVAR(allow_undefined_flag, $1)=
@@ -6749,7 +7318,6 @@
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_automatic, $1)=no
@@ -6758,6 +7326,8 @@
 _LT_TAGVAR(module_expsym_cmds, $1)=
 _LT_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 _LT_TAGVAR(no_undefined_flag, $1)=
 _LT_TAGVAR(whole_archive_flag_spec, $1)=
 _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=no
@@ -6797,7 +7367,9 @@
   # Allow CC to be a program name with arguments.
   lt_save_CC="$CC"
   lt_save_GCC=$GCC
+  lt_save_CFLAGS=$CFLAGS
   CC=${FC-"f95"}
+  CFLAGS=$FCFLAGS
   compiler=$CC
   GCC=$ac_cv_fc_compiler_gnu
 
@@ -6853,7 +7425,8 @@
   fi # test -n "$compiler"
 
   GCC=$lt_save_GCC
-  CC="$lt_save_CC"
+  CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
 fi # test "$_lt_disable_FC" != yes
 
 AC_LANG_POP
@@ -6890,10 +7463,12 @@
 _LT_LINKER_BOILERPLATE
 
 # Allow CC to be a program name with arguments.
-lt_save_CC="$CC"
+lt_save_CC=$CC
+lt_save_CFLAGS=$CFLAGS
 lt_save_GCC=$GCC
 GCC=yes
 CC=${GCJ-"gcj"}
+CFLAGS=$GCJFLAGS
 compiler=$CC
 _LT_TAGVAR(compiler, $1)=$CC
 _LT_TAGVAR(LD, $1)="$LD"
@@ -6903,6 +7478,8 @@
 _LT_TAGVAR(archive_cmds_need_lc, $1)=no
 
 _LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
 
 if test -n "$compiler"; then
   _LT_COMPILER_NO_RTTI($1)
@@ -6918,10 +7495,78 @@
 AC_LANG_RESTORE
 
 GCC=$lt_save_GCC
-CC="$lt_save_CC"
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
 ])# _LT_LANG_GCJ_CONFIG
 
 
+# _LT_LANG_GO_CONFIG([TAG])
+# --------------------------
+# Ensure that the configuration variables for the GNU Go compiler
+# are suitably defined.  These variables are subsequently used by _LT_CONFIG
+# to write the compiler configuration to `libtool'.
+m4_defun([_LT_LANG_GO_CONFIG],
+[AC_REQUIRE([LT_PROG_GO])dnl
+AC_LANG_SAVE
+
+# Source file extension for Go test sources.
+ac_ext=go
+
+# Object file extension for compiled Go test sources.
+objext=o
+_LT_TAGVAR(objext, $1)=$objext
+
+# Code to be used in simple compile tests
+lt_simple_compile_test_code="package main; func main() { }"
+
+# Code to be used in simple link tests
+lt_simple_link_test_code='package main; func main() { }'
+
+# ltmain only uses $CC for tagged configurations so make sure $CC is set.
+_LT_TAG_COMPILER
+
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
+# Allow CC to be a program name with arguments.
+lt_save_CC=$CC
+lt_save_CFLAGS=$CFLAGS
+lt_save_GCC=$GCC
+GCC=yes
+CC=${GOC-"gccgo"}
+CFLAGS=$GOFLAGS
+compiler=$CC
+_LT_TAGVAR(compiler, $1)=$CC
+_LT_TAGVAR(LD, $1)="$LD"
+_LT_CC_BASENAME([$compiler])
+
+# Go did not exist at the time GCC didn't implicitly link libc in.
+_LT_TAGVAR(archive_cmds_need_lc, $1)=no
+
+_LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
+
+if test -n "$compiler"; then
+  _LT_COMPILER_NO_RTTI($1)
+  _LT_COMPILER_PIC($1)
+  _LT_COMPILER_C_O($1)
+  _LT_COMPILER_FILE_LOCKS($1)
+  _LT_LINKER_SHLIBS($1)
+  _LT_LINKER_HARDCODE_LIBPATH($1)
+
+  _LT_CONFIG($1)
+fi
+
+AC_LANG_RESTORE
+
+GCC=$lt_save_GCC
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
+])# _LT_LANG_GO_CONFIG
+
+
 # _LT_LANG_RC_CONFIG([TAG])
 # -------------------------
 # Ensure that the configuration variables for the Windows resource compiler
@@ -6953,9 +7598,11 @@
 
 # Allow CC to be a program name with arguments.
 lt_save_CC="$CC"
+lt_save_CFLAGS=$CFLAGS
 lt_save_GCC=$GCC
 GCC=
 CC=${RC-"windres"}
+CFLAGS=
 compiler=$CC
 _LT_TAGVAR(compiler, $1)=$CC
 _LT_CC_BASENAME([$compiler])
@@ -6968,7 +7615,8 @@
 
 GCC=$lt_save_GCC
 AC_LANG_RESTORE
-CC="$lt_save_CC"
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
 ])# _LT_LANG_RC_CONFIG
 
 
@@ -6988,6 +7636,13 @@
 dnl AC_DEFUN([LT_AC_PROG_GCJ], [])
 
 
+# LT_PROG_GO
+# ----------
+AC_DEFUN([LT_PROG_GO],
+[AC_CHECK_TOOL(GOC, gccgo,)
+])
+
+
 # LT_PROG_RC
 # ----------
 AC_DEFUN([LT_PROG_RC],
@@ -7027,6 +7682,15 @@
 AC_SUBST([OBJDUMP])
 ])
 
+# _LT_DECL_DLLTOOL
+# ----------------
+# Ensure DLLTOOL variable is set.
+m4_defun([_LT_DECL_DLLTOOL],
+[AC_CHECK_TOOL(DLLTOOL, dlltool, false)
+test -z "$DLLTOOL" && DLLTOOL=dlltool
+_LT_DECL([], [DLLTOOL], [1], [DLL creation program])
+AC_SUBST([DLLTOOL])
+])
 
 # _LT_DECL_SED
 # ------------
@@ -7118,8 +7782,8 @@
 # Try some XSI features
 xsi_shell=no
 ( _lt_dummy="a/b/c"
-  test "${_lt_dummy##*/},${_lt_dummy%/*},"${_lt_dummy%"$_lt_dummy"}, \
-      = c,a/b,, \
+  test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
+      = c,a/b,b/c, \
     && eval 'test $(( 1 + 1 )) -eq 2 \
     && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
   && xsi_shell=yes
@@ -7158,222 +7822,177 @@
 ])# _LT_CHECK_SHELL_FEATURES
 
 
-# _LT_PROG_XSI_SHELLFNS
-# ---------------------
-# Bourne and XSI compatible variants of some useful shell functions.
-m4_defun([_LT_PROG_XSI_SHELLFNS],
-[case $xsi_shell in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result="${1##*/}"
-}
-
-# func_dirname_and_basename file append nondir_replacement
-# perform func_basename and func_dirname in a single function
-# call:
-#   dirname:  Compute the dirname of FILE.  If nonempty,
-#             add APPEND to the result, otherwise set result
-#             to NONDIR_REPLACEMENT.
-#             value returned in "$func_dirname_result"
-#   basename: Compute filename of FILE.
-#             value retuned in "$func_basename_result"
-# Implementation must be kept synchronized with func_dirname
-# and func_basename. For efficiency, we do not delegate to
-# those functions but instead duplicate the functionality here.
-func_dirname_and_basename ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-  func_basename_result="${1##*/}"
-}
-
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-func_stripname ()
-{
-  # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
-  # positional parameters, so assign one to ordinary parameter first.
-  func_stripname_result=${3}
-  func_stripname_result=${func_stripname_result#"${1}"}
-  func_stripname_result=${func_stripname_result%"${2}"}
-}
-
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=${1%%=*}
-  func_opt_split_arg=${1#*=}
-}
-
-# func_lo2o object
-func_lo2o ()
-{
-  case ${1} in
-    *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
-    *)    func_lo2o_result=${1} ;;
-  esac
-}
-
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=${1%.*}.lo
-}
-
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=$(( $[*] ))
-}
+# _LT_PROG_FUNCTION_REPLACE (FUNCNAME, REPLACEMENT-BODY)
+# ------------------------------------------------------
+# In `$cfgfile', look for function FUNCNAME delimited by `^FUNCNAME ()$' and
+# '^} FUNCNAME ', and replace its body with REPLACEMENT-BODY.
+m4_defun([_LT_PROG_FUNCTION_REPLACE],
+[dnl {
+sed -e '/^$1 ()$/,/^} # $1 /c\
+$1 ()\
+{\
+m4_bpatsubsts([$2], [$], [\\], [^\([	 ]\)], [\\\1])
+} # Extended-shell $1 implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+])
 
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=${#1}
-}
 
-_LT_EOF
-    ;;
-  *) # Bourne compatible functions.
-    cat << \_LT_EOF >> "$cfgfile"
+# _LT_PROG_REPLACE_SHELLFNS
+# -------------------------
+# Replace existing portable implementations of several shell functions with
+# equivalent extended shell implementations where those features are available..
+m4_defun([_LT_PROG_REPLACE_SHELLFNS],
+[if test x"$xsi_shell" = xyes; then
+  _LT_PROG_FUNCTION_REPLACE([func_dirname], [dnl
+    case ${1} in
+      */*) func_dirname_result="${1%/*}${2}" ;;
+      *  ) func_dirname_result="${3}" ;;
+    esac])
+
+  _LT_PROG_FUNCTION_REPLACE([func_basename], [dnl
+    func_basename_result="${1##*/}"])
+
+  _LT_PROG_FUNCTION_REPLACE([func_dirname_and_basename], [dnl
+    case ${1} in
+      */*) func_dirname_result="${1%/*}${2}" ;;
+      *  ) func_dirname_result="${3}" ;;
+    esac
+    func_basename_result="${1##*/}"])
 
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO "X${1}" | $Xsed -e "$dirname"`
-  if test "X$func_dirname_result" = "X${1}"; then
-    func_dirname_result="${3}"
-  else
-    func_dirname_result="$func_dirname_result${2}"
-  fi
-}
+  _LT_PROG_FUNCTION_REPLACE([func_stripname], [dnl
+    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
+    # positional parameters, so assign one to ordinary parameter first.
+    func_stripname_result=${3}
+    func_stripname_result=${func_stripname_result#"${1}"}
+    func_stripname_result=${func_stripname_result%"${2}"}])
 
-# func_basename file
-func_basename ()
-{
-  func_basename_result=`$ECHO "X${1}" | $Xsed -e "$basename"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_split_long_opt], [dnl
+    func_split_long_opt_name=${1%%=*}
+    func_split_long_opt_arg=${1#*=}])
 
-dnl func_dirname_and_basename
-dnl A portable version of this function is already defined in general.m4sh
-dnl so there is no need for it here.
+  _LT_PROG_FUNCTION_REPLACE([func_split_short_opt], [dnl
+    func_split_short_opt_arg=${1#??}
+    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}])
 
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-# func_strip_suffix prefix name
-func_stripname ()
-{
-  case ${2} in
-    .*) func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%\\\\${2}\$%%"`;;
-    *)  func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%${2}\$%%"`;;
-  esac
-}
+  _LT_PROG_FUNCTION_REPLACE([func_lo2o], [dnl
+    case ${1} in
+      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
+      *)    func_lo2o_result=${1} ;;
+    esac])
 
-# sed scripts:
-my_sed_long_opt='1s/^\(-[[^=]]*\)=.*/\1/;q'
-my_sed_long_arg='1s/^-[[^=]]*=//'
+  _LT_PROG_FUNCTION_REPLACE([func_xform], [    func_xform_result=${1%.*}.lo])
 
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_opt"`
-  func_opt_split_arg=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_arg"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_arith], [    func_arith_result=$(( $[*] ))])
 
-# func_lo2o object
-func_lo2o ()
-{
-  func_lo2o_result=`$ECHO "X${1}" | $Xsed -e "$lo2o"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_len], [    func_len_result=${#1}])
+fi
 
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=`$ECHO "X${1}" | $Xsed -e 's/\.[[^.]]*$/.lo/'`
-}
+if test x"$lt_shell_append" = xyes; then
+  _LT_PROG_FUNCTION_REPLACE([func_append], [    eval "${1}+=\\${2}"])
 
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=`expr "$[@]"`
-}
+  _LT_PROG_FUNCTION_REPLACE([func_append_quoted], [dnl
+    func_quote_for_eval "${2}"
+dnl m4 expansion turns \\\\ into \\, and then the shell eval turns that into \
+    eval "${1}+=\\\\ \\$func_quote_for_eval_result"])
 
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=`expr "$[1]" : ".*" 2>/dev/null || echo $max_cmd_len`
-}
+  # Save a `func_append' function call where possible by direct use of '+='
+  sed -e 's%func_append \([[a-zA-Z_]]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+else
+  # Save a `func_append' function call even when '+=' is not available
+  sed -e 's%func_append \([[a-zA-Z_]]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+fi
 
-_LT_EOF
-esac
+if test x"$_lt_function_replace_fail" = x":"; then
+  AC_MSG_WARN([Unable to substitute extended shell functions in $ofile])
+fi
+])
 
-case $lt_shell_append in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$[1]+=\$[2]"
-}
-_LT_EOF
+# _LT_PATH_CONVERSION_FUNCTIONS
+# -----------------------------
+# Determine which file name conversion functions should be used by
+# func_to_host_file (and, implicitly, by func_to_host_path).  These are needed
+# for certain cross-compile configurations and native mingw.
+m4_defun([_LT_PATH_CONVERSION_FUNCTIONS],
+[AC_REQUIRE([AC_CANONICAL_HOST])dnl
+AC_REQUIRE([AC_CANONICAL_BUILD])dnl
+AC_MSG_CHECKING([how to convert $build file names to $host format])
+AC_CACHE_VAL(lt_cv_to_host_file_cmd,
+[case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_w32
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_cygwin_to_w32
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_w32
+        ;;
+    esac
     ;;
-  *)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$[1]=\$$[1]\$[2]"
-}
-
-_LT_EOF
+  *-*-cygwin* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_cygwin
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_noop
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_cygwin
+        ;;
+    esac
     ;;
-  esac
+  * ) # unhandled hosts (and "normal" native builds)
+    lt_cv_to_host_file_cmd=func_convert_file_noop
+    ;;
+esac
+])
+to_host_file_cmd=$lt_cv_to_host_file_cmd
+AC_MSG_RESULT([$lt_cv_to_host_file_cmd])
+_LT_DECL([to_host_file_cmd], [lt_cv_to_host_file_cmd],
+         [0], [convert $build file names to $host format])dnl
+
+AC_MSG_CHECKING([how to convert $build file names to toolchain format])
+AC_CACHE_VAL(lt_cv_to_tool_file_cmd,
+[#assume ordinary cross tools, or native build.
+lt_cv_to_tool_file_cmd=func_convert_file_noop
+case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_tool_file_cmd=func_convert_file_msys_to_w32
+        ;;
+    esac
+    ;;
+esac
 ])
+to_tool_file_cmd=$lt_cv_to_tool_file_cmd
+AC_MSG_RESULT([$lt_cv_to_tool_file_cmd])
+_LT_DECL([to_tool_file_cmd], [lt_cv_to_tool_file_cmd],
+         [0], [convert $build files to toolchain format])dnl
+])# _LT_PATH_CONVERSION_FUNCTIONS
 
 # Helper functions for option handling.                    -*- Autoconf -*-
 #
-#   Copyright (C) 2004, 2005, 2007, 2008 Free Software Foundation, Inc.
+#   Copyright (C) 2004, 2005, 2007, 2008, 2009 Free Software Foundation,
+#   Inc.
 #   Written by Gary V. Vaughan, 2004
 #
 # This file is free software; the Free Software Foundation gives
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# serial 6 ltoptions.m4
+# serial 7 ltoptions.m4
 
 # This is to help aclocal find these macros, as it can't see m4_define.
 AC_DEFUN([LTOPTIONS_VERSION], [m4_if([1])])
@@ -7488,7 +8107,7 @@
 [enable_win32_dll=yes
 
 case $host in
-*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-cegcc*)
+*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-cegcc*)
   AC_CHECK_TOOL(AS, as, false)
   AC_CHECK_TOOL(DLLTOOL, dlltool, false)
   AC_CHECK_TOOL(OBJDUMP, objdump, false)
@@ -7496,13 +8115,13 @@
 esac
 
 test -z "$AS" && AS=as
-_LT_DECL([], [AS],      [0], [Assembler program])dnl
+_LT_DECL([], [AS],      [1], [Assembler program])dnl
 
 test -z "$DLLTOOL" && DLLTOOL=dlltool
-_LT_DECL([], [DLLTOOL], [0], [DLL creation program])dnl
+_LT_DECL([], [DLLTOOL], [1], [DLL creation program])dnl
 
 test -z "$OBJDUMP" && OBJDUMP=objdump
-_LT_DECL([], [OBJDUMP], [0], [Object dumper program])dnl
+_LT_DECL([], [OBJDUMP], [1], [Object dumper program])dnl
 ])# win32-dll
 
 AU_DEFUN([AC_LIBTOOL_WIN32_DLL],
@@ -7688,9 +8307,24 @@
 # MODE is either `yes' or `no'.  If omitted, it defaults to `both'.
 m4_define([_LT_WITH_PIC],
 [AC_ARG_WITH([pic],
-    [AS_HELP_STRING([--with-pic],
+    [AS_HELP_STRING([--with-pic@<:@=PKGS@:>@],
 	[try to use only PIC/non-PIC objects @<:@default=use both@:>@])],
-    [pic_mode="$withval"],
+    [lt_p=${PACKAGE-default}
+    case $withval in
+    yes|no) pic_mode=$withval ;;
+    *)
+      pic_mode=default
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for lt_pkg in $withval; do
+	IFS="$lt_save_ifs"
+	if test "X$lt_pkg" = "X$lt_p"; then
+	  pic_mode=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac],
     [pic_mode=default])
 
 test -z "$pic_mode" && pic_mode=m4_default([$1], [default])
@@ -7860,31 +8494,31 @@
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# Generated from ltversion.in.
+# @configure_input@
 
-# serial 3017 ltversion.m4
+# serial 3337 ltversion.m4
 # This file is part of GNU Libtool
 
-m4_define([LT_PACKAGE_VERSION], [2.2.6b])
-m4_define([LT_PACKAGE_REVISION], [1.3017])
+m4_define([LT_PACKAGE_VERSION], [2.4.2])
+m4_define([LT_PACKAGE_REVISION], [1.3337])
 
 AC_DEFUN([LTVERSION_VERSION],
-[macro_version='2.2.6b'
-macro_revision='1.3017'
+[macro_version='2.4.2'
+macro_revision='1.3337'
 _LT_DECL(, macro_version, 0, [Which release of libtool.m4 was used?])
 _LT_DECL(, macro_revision, 0)
 ])
 
 # lt~obsolete.m4 -- aclocal satisfying obsolete definitions.    -*-Autoconf-*-
 #
-#   Copyright (C) 2004, 2005, 2007 Free Software Foundation, Inc.
+#   Copyright (C) 2004, 2005, 2007, 2009 Free Software Foundation, Inc.
 #   Written by Scott James Remnant, 2004.
 #
 # This file is free software; the Free Software Foundation gives
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# serial 4 lt~obsolete.m4
+# serial 5 lt~obsolete.m4
 
 # These exist entirely to fool aclocal when bootstrapping libtool.
 #
@@ -7954,7 +8588,6 @@
 m4_ifndef([_LT_AC_LANG_CXX],		[AC_DEFUN([_LT_AC_LANG_CXX])])
 m4_ifndef([_LT_AC_LANG_F77],		[AC_DEFUN([_LT_AC_LANG_F77])])
 m4_ifndef([_LT_AC_LANG_GCJ],		[AC_DEFUN([_LT_AC_LANG_GCJ])])
-m4_ifndef([AC_LIBTOOL_RC],		[AC_DEFUN([AC_LIBTOOL_RC])])
 m4_ifndef([AC_LIBTOOL_LANG_C_CONFIG],	[AC_DEFUN([AC_LIBTOOL_LANG_C_CONFIG])])
 m4_ifndef([_LT_AC_LANG_C_CONFIG],	[AC_DEFUN([_LT_AC_LANG_C_CONFIG])])
 m4_ifndef([AC_LIBTOOL_LANG_CXX_CONFIG],	[AC_DEFUN([AC_LIBTOOL_LANG_CXX_CONFIG])])
@@ -7967,13 +8600,23 @@
 m4_ifndef([_LT_AC_LANG_RC_CONFIG],	[AC_DEFUN([_LT_AC_LANG_RC_CONFIG])])
 m4_ifndef([AC_LIBTOOL_CONFIG],		[AC_DEFUN([AC_LIBTOOL_CONFIG])])
 m4_ifndef([_LT_AC_FILE_LTDLL_C],	[AC_DEFUN([_LT_AC_FILE_LTDLL_C])])
+m4_ifndef([_LT_REQUIRED_DARWIN_CHECKS],	[AC_DEFUN([_LT_REQUIRED_DARWIN_CHECKS])])
+m4_ifndef([_LT_AC_PROG_CXXCPP],		[AC_DEFUN([_LT_AC_PROG_CXXCPP])])
+m4_ifndef([_LT_PREPARE_SED_QUOTE_VARS],	[AC_DEFUN([_LT_PREPARE_SED_QUOTE_VARS])])
+m4_ifndef([_LT_PROG_ECHO_BACKSLASH],	[AC_DEFUN([_LT_PROG_ECHO_BACKSLASH])])
+m4_ifndef([_LT_PROG_F77],		[AC_DEFUN([_LT_PROG_F77])])
+m4_ifndef([_LT_PROG_FC],		[AC_DEFUN([_LT_PROG_FC])])
+m4_ifndef([_LT_PROG_CXX],		[AC_DEFUN([_LT_PROG_CXX])])
 
-# Copyright (C) 2002, 2003, 2005, 2006, 2007, 2008  Free Software Foundation, Inc.
+# Copyright (C) 2002, 2003, 2005, 2006, 2007, 2008, 2011 Free Software
+# Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
+# serial 1
+
 # AM_AUTOMAKE_VERSION(VERSION)
 # ----------------------------
 # Automake X.Y traces this macro to ensure aclocal.m4 has been
@@ -7983,7 +8626,7 @@
 [am__api_version='1.11'
 dnl Some users find AM_AUTOMAKE_VERSION and mistake it for a way to
 dnl require some minimum version.  Point them to the right macro.
-m4_if([$1], [1.11.1], [],
+m4_if([$1], [1.11.6], [],
       [AC_FATAL([Do not call $0, use AM_INIT_AUTOMAKE([$1]).])])dnl
 ])
 
@@ -7999,19 +8642,21 @@
 # Call AM_AUTOMAKE_VERSION and AM_AUTOMAKE_VERSION so they can be traced.
 # This function is AC_REQUIREd by AM_INIT_AUTOMAKE.
 AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],
-[AM_AUTOMAKE_VERSION([1.11.1])dnl
+[AM_AUTOMAKE_VERSION([1.11.6])dnl
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
 _AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
 
 # AM_AUX_DIR_EXPAND                                         -*- Autoconf -*-
 
-# Copyright (C) 2001, 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2003, 2005, 2011 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
+# serial 1
+
 # For projects using AC_CONFIG_AUX_DIR([foo]), Autoconf sets
 # $ac_aux_dir to `$srcdir/foo'.  In other projects, it is set to
 # `$srcdir', `$srcdir/..', or `$srcdir/../..'.
@@ -8093,14 +8738,14 @@
 Usually this means the macro was only invoked conditionally.]])
 fi])])
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2009
-# Free Software Foundation, Inc.
+# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2009,
+# 2010, 2011 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 10
+# serial 12
 
 # There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
 # written in clear, in which case automake, when reading aclocal.m4,
@@ -8140,6 +8785,7 @@
   # instance it was reported that on HP-UX the gcc test will end up
   # making a dummy file named `D' -- because `-MD' means `put the output
   # in D'.
+  rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
   # using a relative directory.
@@ -8204,7 +8850,7 @@
 	break
       fi
       ;;
-    msvisualcpp | msvcmsys)
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
       # This compiler won't grok `-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
@@ -8269,10 +8915,13 @@
 if test "x$enable_dependency_tracking" != xno; then
   am_depcomp="$ac_aux_dir/depcomp"
   AMDEPBACKSLASH='\'
+  am__nodep='_no'
 fi
 AM_CONDITIONAL([AMDEP], [test "x$enable_dependency_tracking" != xno])
 AC_SUBST([AMDEPBACKSLASH])dnl
 _AM_SUBST_NOTMAKE([AMDEPBACKSLASH])dnl
+AC_SUBST([am__nodep])dnl
+_AM_SUBST_NOTMAKE([am__nodep])dnl
 ])
 
 # Generate code to set up dependency tracking.              -*- Autoconf -*-
@@ -8494,12 +9143,15 @@
 done
 echo "timestamp for $_am_arg" >`AS_DIRNAME(["$_am_arg"])`/stamp-h[]$_am_stamp_count])
 
-# Copyright (C) 2001, 2003, 2005, 2008  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2003, 2005, 2008, 2011 Free Software Foundation,
+# Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
+# serial 1
+
 # AM_PROG_INSTALL_SH
 # ------------------
 # Define $install_sh.
@@ -8536,6 +9188,46 @@
 rmdir .tst 2>/dev/null
 AC_SUBST([am__leading_dot])])
 
+# Add --enable-maintainer-mode option to configure.         -*- Autoconf -*-
+# From Jim Meyering
+
+# Copyright (C) 1996, 1998, 2000, 2001, 2002, 2003, 2004, 2005, 2008,
+# 2011 Free Software Foundation, Inc.
+#
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# serial 5
+
+# AM_MAINTAINER_MODE([DEFAULT-MODE])
+# ----------------------------------
+# Control maintainer-specific portions of Makefiles.
+# Default is to disable them, unless `enable' is passed literally.
+# For symmetry, `disable' may be passed as well.  Anyway, the user
+# can override the default with the --enable/--disable switch.
+AC_DEFUN([AM_MAINTAINER_MODE],
+[m4_case(m4_default([$1], [disable]),
+       [enable], [m4_define([am_maintainer_other], [disable])],
+       [disable], [m4_define([am_maintainer_other], [enable])],
+       [m4_define([am_maintainer_other], [enable])
+        m4_warn([syntax], [unexpected argument to AM@&t@_MAINTAINER_MODE: $1])])
+AC_MSG_CHECKING([whether to enable maintainer-specific portions of Makefiles])
+  dnl maintainer-mode's default is 'disable' unless 'enable' is passed
+  AC_ARG_ENABLE([maintainer-mode],
+[  --][am_maintainer_other][-maintainer-mode  am_maintainer_other make rules and dependencies not useful
+			  (and sometimes confusing) to the casual installer],
+      [USE_MAINTAINER_MODE=$enableval],
+      [USE_MAINTAINER_MODE=]m4_if(am_maintainer_other, [enable], [no], [yes]))
+  AC_MSG_RESULT([$USE_MAINTAINER_MODE])
+  AM_CONDITIONAL([MAINTAINER_MODE], [test $USE_MAINTAINER_MODE = yes])
+  MAINT=$MAINTAINER_MODE_TRUE
+  AC_SUBST([MAINT])dnl
+]
+)
+
+AU_DEFUN([jm_MAINTAINER_MODE], [AM_MAINTAINER_MODE])
+
 # Check to see how 'make' treats includes.	            -*- Autoconf -*-
 
 # Copyright (C) 2001, 2002, 2003, 2005, 2009  Free Software Foundation, Inc.
@@ -8631,12 +9323,15 @@
 fi
 ])
 
-# Copyright (C) 2003, 2004, 2005, 2006  Free Software Foundation, Inc.
+# Copyright (C) 2003, 2004, 2005, 2006, 2011 Free Software Foundation,
+# Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
+# serial 1
+
 # AM_PROG_MKDIR_P
 # ---------------
 # Check for `mkdir -p'.
@@ -8659,13 +9354,14 @@
 
 # Helper functions for option handling.                     -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005, 2008  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2002, 2003, 2005, 2008, 2010 Free Software
+# Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 4
+# serial 5
 
 # _AM_MANGLE_OPTION(NAME)
 # -----------------------
@@ -8673,13 +9369,13 @@
 [[_AM_OPTION_]m4_bpatsubst($1, [[^a-zA-Z0-9_]], [_])])
 
 # _AM_SET_OPTION(NAME)
-# ------------------------------
+# --------------------
 # Set option NAME.  Presently that only means defining a flag for this option.
 AC_DEFUN([_AM_SET_OPTION],
 [m4_define(_AM_MANGLE_OPTION([$1]), 1)])
 
 # _AM_SET_OPTIONS(OPTIONS)
-# ----------------------------------
+# ------------------------
 # OPTIONS is a space-separated list of Automake options.
 AC_DEFUN([_AM_SET_OPTIONS],
 [m4_foreach_w([_AM_Option], [$1], [_AM_SET_OPTION(_AM_Option)])])
@@ -8755,12 +9451,14 @@
 fi
 AC_MSG_RESULT(yes)])
 
-# Copyright (C) 2001, 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2001, 2003, 2005, 2011 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
+# serial 1
+
 # AM_PROG_INSTALL_STRIP
 # ---------------------
 # One issue with vendor `install' (even GNU) is that you can't
@@ -8783,13 +9481,13 @@
 INSTALL_STRIP_PROGRAM="\$(install_sh) -c -s"
 AC_SUBST([INSTALL_STRIP_PROGRAM])])
 
-# Copyright (C) 2006, 2008  Free Software Foundation, Inc.
+# Copyright (C) 2006, 2008, 2010 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
+# serial 3
 
 # _AM_SUBST_NOTMAKE(VARIABLE)
 # ---------------------------
@@ -8798,13 +9496,13 @@
 AC_DEFUN([_AM_SUBST_NOTMAKE])
 
 # AM_SUBST_NOTMAKE(VARIABLE)
-# ---------------------------
+# --------------------------
 # Public sister of _AM_SUBST_NOTMAKE.
 AC_DEFUN([AM_SUBST_NOTMAKE], [_AM_SUBST_NOTMAKE($@)])
 
 # Check how to create a tarball.                            -*- Autoconf -*-
 
-# Copyright (C) 2004, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2004, 2005, 2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
@@ -8826,10 +9524,11 @@
 # a tarball read from stdin.
 #     $(am__untar) < result.tar
 AC_DEFUN([_AM_PROG_TAR],
-[# Always define AMTAR for backward compatibility.
-AM_MISSING_PROG([AMTAR], [tar])
+[# Always define AMTAR for backward compatibility.  Yes, it's still used
+# in the wild :-(  We should find a proper way to deprecate it ...
+AC_SUBST([AMTAR], ['$${TAR-tar}'])
 m4_if([$1], [v7],
-     [am__tar='${AMTAR} chof - "$$tardir"'; am__untar='${AMTAR} xf -'],
+     [am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'],
      [m4_case([$1], [ustar],, [pax],,
               [m4_fatal([Unknown tar format])])
 AC_MSG_CHECKING([how to create a $1 tar archive])
Index: blcr-0.8.5/blcr_config.h.in
===================================================================
--- blcr-0.8.5.orig/blcr_config.h.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/blcr_config.h.in	2013-03-26 22:50:48.000000000 +0000
@@ -252,6 +252,14 @@
    exported */
 #undef CR_KCODE_set_fs_pwd
 
+/* Define to address of non-exported kernel symbol signal_wake_up, or 0 if
+   exported */
+#undef CR_KCODE_signal_wake_up
+
+/* Define to address of non-exported kernel symbol signal_wake_up_state, or 0
+   if exported */
+#undef CR_KCODE_signal_wake_up_state
+
 /* Define to address of non-exported kernel symbol supplemental_group_member,
    or 0 if exported */
 #undef CR_KCODE_supplemental_group_member
@@ -1099,6 +1107,9 @@
 /* Define to the one symbol short name of this package. */
 #undef PACKAGE_TARNAME
 
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
 /* Define to the version of this package. */
 #undef PACKAGE_VERSION
 
Index: blcr-0.8.5/blcr_imports/Makefile.in
===================================================================
--- blcr-0.8.5.orig/blcr_imports/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/blcr_imports/Makefile.in	2013-03-26 22:50:49.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -53,6 +70,11 @@
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -129,6 +151,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -172,8 +195,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -186,6 +211,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -203,6 +229,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -236,7 +263,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -265,7 +291,7 @@
 all: all-recursive
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -290,9 +316,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 imports.c: $(top_builddir)/config.status $(srcdir)/imports.c.in
@@ -471,13 +497,10 @@
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -515,10 +538,15 @@
 
 installcheck: installcheck-recursive
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/config/config.guess
===================================================================
--- blcr-0.8.5.orig/config/config.guess	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/config/config.guess	2013-03-26 22:50:49.000000000 +0000
@@ -1,10 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009
-#   Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
+#   2011, 2012 Free Software Foundation, Inc.
 
-timestamp='2009-11-20'
+timestamp='2012-02-10'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -17,9 +17,7 @@
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -56,8 +54,9 @@
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012
+Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -144,7 +143,7 @@
 case "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" in
     *:NetBSD:*:*)
 	# NetBSD (nbsd) targets should (where applicable) match one or
-	# more of the tupples: *-*-netbsdelf*, *-*-netbsdaout*,
+	# more of the tuples: *-*-netbsdelf*, *-*-netbsdaout*,
 	# *-*-netbsdecoff* and *-*-netbsd*.  For targets that recently
 	# switched to ELF, *-*-netbsd* would select the old
 	# object file format.  This provides both forward
@@ -180,7 +179,7 @@
 		fi
 		;;
 	    *)
-	        os=netbsd
+		os=netbsd
 		;;
 	esac
 	# The OS release
@@ -223,7 +222,7 @@
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
 		;;
 	*5.*)
-	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
 		;;
 	esac
 	# According to Compaq, /usr/sbin/psrinfo has been available on
@@ -269,7 +268,10 @@
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit ;;
+	# Reset EXIT trap before exiting to avoid spurious non-zero exit code.
+	exitcode=$?
+	trap '' 0
+	exit $exitcode ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
@@ -295,7 +297,7 @@
 	echo s390-ibm-zvmoe
 	exit ;;
     *:OS400:*:*)
-        echo powerpc-ibm-os400
+	echo powerpc-ibm-os400
 	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
@@ -394,23 +396,23 @@
     # MiNT.  But MiNT is downward compatible to TOS, so this should
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint${UNAME_RELEASE}
 	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit ;;
+	exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint${UNAME_RELEASE}
 	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
-        echo m68k-milan-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-milan-mint${UNAME_RELEASE}
+	exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
-        echo m68k-hades-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-hades-mint${UNAME_RELEASE}
+	exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
-        echo m68k-unknown-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-unknown-mint${UNAME_RELEASE}
+	exit ;;
     m68k:machten:*:*)
 	echo m68k-apple-machten${UNAME_RELEASE}
 	exit ;;
@@ -480,8 +482,8 @@
 	echo m88k-motorola-sysv3
 	exit ;;
     AViiON:dgux:*:*)
-        # DG/UX returns AViiON for all architectures
-        UNAME_PROCESSOR=`/usr/bin/uname -p`
+	# DG/UX returns AViiON for all architectures
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
 	if [ $UNAME_PROCESSOR = mc88100 ] || [ $UNAME_PROCESSOR = mc88110 ]
 	then
 	    if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx ] || \
@@ -494,7 +496,7 @@
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit ;;
+	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
 	exit ;;
@@ -551,7 +553,7 @@
 		echo rs6000-ibm-aix3.2
 	fi
 	exit ;;
-    *:AIX:*:[456])
+    *:AIX:*:[4567])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' >/dev/null 2>&1; then
 		IBM_ARCH=rs6000
@@ -594,52 +596,52 @@
 	    9000/[678][0-9][0-9])
 		if [ -x /usr/bin/getconf ]; then
 		    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`
-                    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
-                    case "${sc_cpu_version}" in
-                      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
-                      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
-                      532)                      # CPU_PA_RISC2_0
-                        case "${sc_kernel_bits}" in
-                          32) HP_ARCH="hppa2.0n" ;;
-                          64) HP_ARCH="hppa2.0w" ;;
+		    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
+		    case "${sc_cpu_version}" in
+		      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
+		      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
+		      532)                      # CPU_PA_RISC2_0
+			case "${sc_kernel_bits}" in
+			  32) HP_ARCH="hppa2.0n" ;;
+			  64) HP_ARCH="hppa2.0w" ;;
 			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
-                        esac ;;
-                    esac
+			esac ;;
+		    esac
 		fi
 		if [ "${HP_ARCH}" = "" ]; then
 		    eval $set_cc_for_build
-		    sed 's/^              //' << EOF >$dummy.c
+		    sed 's/^		//' << EOF >$dummy.c
+
+		#define _HPUX_SOURCE
+		#include <stdlib.h>
+		#include <unistd.h>
 
-              #define _HPUX_SOURCE
-              #include <stdlib.h>
-              #include <unistd.h>
-
-              int main ()
-              {
-              #if defined(_SC_KERNEL_BITS)
-                  long bits = sysconf(_SC_KERNEL_BITS);
-              #endif
-                  long cpu  = sysconf (_SC_CPU_VERSION);
-
-                  switch (cpu)
-              	{
-              	case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
-              	case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
-              	case CPU_PA_RISC2_0:
-              #if defined(_SC_KERNEL_BITS)
-              	    switch (bits)
-              		{
-              		case 64: puts ("hppa2.0w"); break;
-              		case 32: puts ("hppa2.0n"); break;
-              		default: puts ("hppa2.0"); break;
-              		} break;
-              #else  /* !defined(_SC_KERNEL_BITS) */
-              	    puts ("hppa2.0"); break;
-              #endif
-              	default: puts ("hppa1.0"); break;
-              	}
-                  exit (0);
-              }
+		int main ()
+		{
+		#if defined(_SC_KERNEL_BITS)
+		    long bits = sysconf(_SC_KERNEL_BITS);
+		#endif
+		    long cpu  = sysconf (_SC_CPU_VERSION);
+
+		    switch (cpu)
+			{
+			case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
+			case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
+			case CPU_PA_RISC2_0:
+		#if defined(_SC_KERNEL_BITS)
+			    switch (bits)
+				{
+				case 64: puts ("hppa2.0w"); break;
+				case 32: puts ("hppa2.0n"); break;
+				default: puts ("hppa2.0"); break;
+				} break;
+		#else  /* !defined(_SC_KERNEL_BITS) */
+			    puts ("hppa2.0"); break;
+		#endif
+			default: puts ("hppa1.0"); break;
+			}
+		    exit (0);
+		}
 EOF
 		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
 		    test -z "$HP_ARCH" && HP_ARCH=hppa
@@ -730,22 +732,22 @@
 	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit ;;
+	exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit ;;
+	exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit ;;
+	exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit ;;
+	exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit ;;
+	exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
@@ -769,14 +771,14 @@
 	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
-        echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
-        exit ;;
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
+	echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit ;;
     5000:UNIX_System_V:4.*:*)
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
-        echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+	echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
 	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
@@ -788,13 +790,12 @@
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit ;;
     *:FreeBSD:*:*)
-	case ${UNAME_MACHINE} in
-	    pc98)
-		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	case ${UNAME_PROCESSOR} in
 	    amd64)
 		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
 	    *)
-		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+		echo ${UNAME_PROCESSOR}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
 	esac
 	exit ;;
     i*:CYGWIN*:*)
@@ -803,15 +804,18 @@
     *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
 	exit ;;
+    i*:MSYS*:*)
+	echo ${UNAME_MACHINE}-pc-msys
+	exit ;;
     i*:windows32*:*)
-    	# uname -m includes "-pc" on this system.
-    	echo ${UNAME_MACHINE}-mingw32
+	# uname -m includes "-pc" on this system.
+	echo ${UNAME_MACHINE}-mingw32
 	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit ;;
     *:Interix*:*)
-    	case ${UNAME_MACHINE} in
+	case ${UNAME_MACHINE} in
 	    x86)
 		echo i586-pc-interix${UNAME_RELEASE}
 		exit ;;
@@ -857,6 +861,13 @@
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
 	exit ;;
+    aarch64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    aarch64_be:Linux:*:*)
+	UNAME_MACHINE=aarch64_be
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     alpha:Linux:*:*)
 	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
 	  EV5)   UNAME_MACHINE=alphaev5 ;;
@@ -866,7 +877,7 @@
 	  EV6)   UNAME_MACHINE=alphaev6 ;;
 	  EV67)  UNAME_MACHINE=alphaev67 ;;
 	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
+	esac
 	objdump --private-headers /bin/sh | grep -q ld.so.1
 	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
 	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
@@ -878,20 +889,29 @@
 	then
 	    echo ${UNAME_MACHINE}-unknown-linux-gnu
 	else
-	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    if echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \
+		| grep -q __ARM_PCS_VFP
+	    then
+		echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    else
+		echo ${UNAME_MACHINE}-unknown-linux-gnueabihf
+	    fi
 	fi
 	exit ;;
     avr32*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     cris:Linux:*:*)
-	echo cris-axis-linux-gnu
+	echo ${UNAME_MACHINE}-axis-linux-gnu
 	exit ;;
     crisv32:Linux:*:*)
-	echo crisv32-axis-linux-gnu
+	echo ${UNAME_MACHINE}-axis-linux-gnu
 	exit ;;
     frv:Linux:*:*)
-    	echo frv-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    hexagon:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     i*86:Linux:*:*)
 	LIBC=gnu
@@ -933,7 +953,7 @@
 	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-gnu"; exit; }
 	;;
     or32:Linux:*:*)
-	echo or32-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     padre:Linux:*:*)
 	echo sparc-unknown-linux-gnu
@@ -959,7 +979,7 @@
 	echo ${UNAME_MACHINE}-ibm-linux
 	exit ;;
     sh64*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     sh*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
@@ -967,14 +987,17 @@
     sparc:Linux:*:* | sparc64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
+    tile*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     vax:Linux:*:*)
 	echo ${UNAME_MACHINE}-dec-linux-gnu
 	exit ;;
     x86_64:Linux:*:*)
-	echo x86_64-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     xtensa*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
@@ -983,11 +1006,11 @@
 	echo i386-sequent-sysv4
 	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
-        # Unixware is an offshoot of SVR4, but it has its own version
-        # number series starting with 2...
-        # I am not positive that other SVR4 systems won't match this,
+	# Unixware is an offshoot of SVR4, but it has its own version
+	# number series starting with 2...
+	# I am not positive that other SVR4 systems won't match this,
 	# I just have to hope.  -- rms.
-        # Use sysv4.2uw... so that sysv4* matches it.
+	# Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
 	exit ;;
     i*86:OS/2:*:*)
@@ -1019,7 +1042,7 @@
 	fi
 	exit ;;
     i*86:*:5:[678]*)
-    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
+	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep "^Machine"` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
@@ -1047,13 +1070,13 @@
 	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
-        # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i586.
+	# uname -m prints for DJGPP always 'pc', but it prints nothing about
+	# the processor, so we play safe by assuming i586.
 	# Note: whatever this is, it MUST be the same as what config.sub
 	# prints for the "djgpp" host, or else GDB configury will decide that
 	# this is a cross-build.
 	echo i586-pc-msdosdjgpp
-        exit ;;
+	exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
 	exit ;;
@@ -1088,8 +1111,8 @@
 	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
 	  && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
-        /bin/uname -p 2>/dev/null | grep 86 >/dev/null \
-          && { echo i486-ncr-sysv4; exit; } ;;
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && { echo i486-ncr-sysv4; exit; } ;;
     NCR*:*:4.2:* | MPRAS*:*:4.2:*)
 	OS_REL='.3'
 	test -r /etc/.relid \
@@ -1132,10 +1155,10 @@
 		echo ns32k-sni-sysv
 	fi
 	exit ;;
-    PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
-                      # says <Richard.M.Bartel@ccMail.Census.GOV>
-        echo i586-unisys-sysv4
-        exit ;;
+    PENTIUM:*:4.0*:*)	# Unisys `ClearPath HMP IX 4000' SVR4/MP effort
+			# says <Richard.M.Bartel@ccMail.Census.GOV>
+	echo i586-unisys-sysv4
+	exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes <hewes@openmarket.com>.
 	# How about differentiating between stratus architectures? -djm
@@ -1161,11 +1184,11 @@
 	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
-	        echo mips-nec-sysv${UNAME_RELEASE}
+		echo mips-nec-sysv${UNAME_RELEASE}
 	else
-	        echo mips-unknown-sysv${UNAME_RELEASE}
+		echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit ;;
+	exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
 	exit ;;
@@ -1230,6 +1253,9 @@
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit ;;
+    NEO-?:NONSTOP_KERNEL:*:*)
+	echo neo-tandem-nsk${UNAME_RELEASE}
+	exit ;;
     NSE-?:NONSTOP_KERNEL:*:*)
 	echo nse-tandem-nsk${UNAME_RELEASE}
 	exit ;;
@@ -1275,13 +1301,13 @@
 	echo pdp10-unknown-its
 	exit ;;
     SEI:*:*:SEIUX)
-        echo mips-sei-seiux${UNAME_RELEASE}
+	echo mips-sei-seiux${UNAME_RELEASE}
 	exit ;;
     *:DragonFly:*:*)
 	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
 	exit ;;
     *:*VMS:*:*)
-    	UNAME_MACHINE=`(uname -p) 2>/dev/null`
+	UNAME_MACHINE=`(uname -p) 2>/dev/null`
 	case "${UNAME_MACHINE}" in
 	    A*) echo alpha-dec-vms ; exit ;;
 	    I*) echo ia64-dec-vms ; exit ;;
@@ -1299,6 +1325,9 @@
     i*86:AROS:*:*)
 	echo ${UNAME_MACHINE}-pc-aros
 	exit ;;
+    x86_64:VMkernel:*:*)
+	echo ${UNAME_MACHINE}-unknown-esx
+	exit ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1>&2
@@ -1321,11 +1350,11 @@
 #include <sys/param.h>
   printf ("m68k-sony-newsos%s\n",
 #ifdef NEWSOS4
-          "4"
+	"4"
 #else
-	  ""
+	""
 #endif
-         ); exit (0);
+	); exit (0);
 #endif
 #endif
 
Index: blcr-0.8.5/config/config.sub
===================================================================
--- blcr-0.8.5.orig/config/config.sub	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/config/config.sub	2013-03-26 22:50:49.000000000 +0000
@@ -1,10 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009
-#   Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
+#   2011, 2012 Free Software Foundation, Inc.
 
-timestamp='2009-11-20'
+timestamp='2012-04-18'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -21,9 +21,7 @@
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -75,8 +73,9 @@
 version="\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012
+Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -123,13 +122,18 @@
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
-  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  nto-qnx* | linux-gnu* | linux-android* | linux-dietlibc | linux-newlib* | \
+  linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | \
+  knetbsd*-gnu* | netbsd*-gnu* | \
   kopensolaris*-gnu* | \
   storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
+  android-linux)
+    os=-linux-android
+    basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`-unknown
+    ;;
   *)
     basic_machine=`echo $1 | sed 's/-[^-]*$//'`
     if [ $basic_machine != $1 ]
@@ -156,8 +160,8 @@
 		os=
 		basic_machine=$1
 		;;
-        -bluegene*)
-	        os=-cnk
+	-bluegene*)
+		os=-cnk
 		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
@@ -173,10 +177,10 @@
 		os=-chorusos
 		basic_machine=$1
 		;;
- 	-chorusrdb)
- 		os=-chorusrdb
+	-chorusrdb)
+		os=-chorusrdb
 		basic_machine=$1
- 		;;
+		;;
 	-hiux*)
 		os=-hiuxwe2
 		;;
@@ -221,6 +225,12 @@
 	-isc*)
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-lynx*178)
+		os=-lynxos178
+		;;
+	-lynx*5)
+		os=-lynxos5
+		;;
 	-lynx*)
 		os=-lynxos
 		;;
@@ -245,17 +255,22 @@
 	# Some are omitted here because they have special meanings below.
 	1750a | 580 \
 	| a29k \
+	| aarch64 | aarch64_be \
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
 	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+        | be32 | be64 \
 	| bfin \
 	| c4x | clipper \
 	| d10v | d30v | dlx | dsp16xx \
+	| epiphany \
 	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
+	| hexagon \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
+	| le32 | le64 \
 	| lm32 \
 	| m32c | m32r | m32rle | m68000 | m68k | m88k \
 	| maxq | mb | microblaze | mcore | mep | metag \
@@ -281,29 +296,39 @@
 	| moxie \
 	| mt \
 	| msp430 \
+	| nds32 | nds32le | nds32be \
 	| nios | nios2 \
 	| ns16k | ns32k \
+	| open8 \
 	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
-	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
+	| powerpc | powerpc64 | powerpc64le | powerpcle \
 	| pyramid \
-	| rx \
+	| rl78 | rx \
 	| score \
 	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
 	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
 	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
-	| spu | strongarm \
-	| tahoe | thumb | tic4x | tic80 | tron \
+	| spu \
+	| tahoe | tic4x | tic54x | tic55x | tic6x | tic80 | tron \
 	| ubicom32 \
-	| v850 | v850e \
+	| v850 | v850e | v850e1 | v850e2 | v850es | v850e2v3 \
 	| we32k \
-	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| x86 | xc16x | xstormy16 | xtensa \
 	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
-		# Motorola 68HC11/12.
+	c54x)
+		basic_machine=tic54x-unknown
+		;;
+	c55x)
+		basic_machine=tic55x-unknown
+		;;
+	c6x)
+		basic_machine=tic6x-unknown
+		;;
+	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | picochip)
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
@@ -313,6 +338,21 @@
 		basic_machine=mt-unknown
 		;;
 
+	strongarm | thumb | xscale)
+		basic_machine=arm-unknown
+		;;
+	xgate)
+		basic_machine=$basic_machine-unknown
+		os=-none
+		;;
+	xscaleeb)
+		basic_machine=armeb-unknown
+		;;
+
+	xscaleel)
+		basic_machine=armel-unknown
+		;;
+
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
 	# (2) the word "unknown" tends to confuse beginning users.
@@ -327,21 +367,25 @@
 	# Recognize the basic CPU types with company name.
 	580-* \
 	| a29k-* \
+	| aarch64-* | aarch64_be-* \
 	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* | avr32-* \
+	| be32-* | be64-* \
 	| bfin-* | bs2000-* \
-	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* \
 	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
 	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
+	| hexagon-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
 	| ip2k-* | iq2000-* \
+	| le32-* | le64-* \
 	| lm32-* \
 	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
@@ -367,25 +411,29 @@
 	| mmix-* \
 	| mt-* \
 	| msp430-* \
+	| nds32-* | nds32le-* | nds32be-* \
 	| nios-* | nios2-* \
 	| none-* | np1-* | ns16k-* | ns32k-* \
+	| open8-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
-	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
+	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* \
 	| pyramid-* \
-	| romp-* | rs6000-* | rx-* \
+	| rl78-* | romp-* | rs6000-* | rx-* \
 	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
 	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
 	| sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
-	| tahoe-* | thumb-* \
-	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* | tile-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx?-* \
+	| tahoe-* \
+	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile*-* \
 	| tron-* \
 	| ubicom32-* \
-	| v850-* | v850e-* | vax-* \
+	| v850-* | v850e-* | v850e1-* | v850es-* | v850e2-* | v850e2v3-* \
+	| vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* \
 	| xstormy16-* | xtensa*-* \
 	| ymp-* \
 	| z8k-* | z80-*)
@@ -410,7 +458,7 @@
 		basic_machine=a29k-amd
 		os=-udi
 		;;
-    	abacus)
+	abacus)
 		basic_machine=abacus-unknown
 		;;
 	adobe68k)
@@ -480,11 +528,20 @@
 		basic_machine=powerpc-ibm
 		os=-cnk
 		;;
+	c54x-*)
+		basic_machine=tic54x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c55x-*)
+		basic_machine=tic55x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c6x-*)
+		basic_machine=tic6x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
-        cegcc)
+	cegcc)
 		basic_machine=arm-unknown
 		os=-cegcc
 		;;
@@ -516,7 +573,7 @@
 		basic_machine=craynv-cray
 		os=-unicosmp
 		;;
-	cr16)
+	cr16 | cr16-*)
 		basic_machine=cr16-unknown
 		os=-elf
 		;;
@@ -674,7 +731,6 @@
 	i370-ibm* | ibm*)
 		basic_machine=i370-ibm
 		;;
-# I'm not sure what "Sysv32" means.  Should this be sysv3.2?
 	i*86v32)
 		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
 		os=-sysv32
@@ -732,7 +788,7 @@
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
-        microblaze)
+	microblaze)
 		basic_machine=microblaze-xilinx
 		;;
 	mingw32)
@@ -771,10 +827,18 @@
 	ms1-*)
 		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
 		;;
+	msys)
+		basic_machine=i386-pc
+		os=-msys
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
 		;;
+	nacl)
+		basic_machine=le32-unknown
+		os=-nacl
+		;;
 	ncr3000)
 		basic_machine=i486-ncr
 		os=-sysv4
@@ -839,6 +903,12 @@
 	np1)
 		basic_machine=np1-gould
 		;;
+	neo-tandem)
+		basic_machine=neo-tandem
+		;;
+	nse-tandem)
+		basic_machine=nse-tandem
+		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -921,9 +991,10 @@
 		;;
 	power)	basic_machine=power-ibm
 		;;
-	ppc)	basic_machine=powerpc-unknown
+	ppc | ppcbe)	basic_machine=powerpc-unknown
 		;;
-	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
+	ppc-* | ppcbe-*)
+		basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
@@ -1017,6 +1088,9 @@
 		basic_machine=i860-stratus
 		os=-sysv4
 		;;
+	strongarm-* | thumb-*)
+		basic_machine=arm-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	sun2)
 		basic_machine=m68000-sun
 		;;
@@ -1073,20 +1147,8 @@
 		basic_machine=t90-cray
 		os=-unicos
 		;;
-	tic54x | c54x*)
-		basic_machine=tic54x-unknown
-		os=-coff
-		;;
-	tic55x | c55x*)
-		basic_machine=tic55x-unknown
-		os=-coff
-		;;
-	tic6x | c6x*)
-		basic_machine=tic6x-unknown
-		os=-coff
-		;;
 	tile*)
-		basic_machine=tile-unknown
+		basic_machine=$basic_machine-unknown
 		os=-linux-gnu
 		;;
 	tx39)
@@ -1156,6 +1218,9 @@
 	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
+	xscale-* | xscalee[bl]-*)
+		basic_machine=`echo $basic_machine | sed 's/^xscale/arm/'`
+		;;
 	ymp)
 		basic_machine=ymp-cray
 		os=-unicos
@@ -1253,11 +1318,11 @@
 if [ x"$os" != x"" ]
 then
 case $os in
-        # First match some system type aliases
-        # that might get confused with valid system types.
+	# First match some system type aliases
+	# that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
-        -auroraux)
-	        os=-auroraux
+	-auroraux)
+		os=-auroraux
 		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
@@ -1293,8 +1358,9 @@
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
 	      | -chorusos* | -chorusrdb* | -cegcc* \
-	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -cygwin* | -msys* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
+	      | -mingw32* | -linux-gnu* | -linux-android* \
+	      | -linux-newlib* | -linux-uclibc* \
 	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
@@ -1341,7 +1407,7 @@
 	-opened*)
 		os=-openedition
 		;;
-        -os400*)
+	-os400*)
 		os=-os400
 		;;
 	-wince*)
@@ -1390,7 +1456,7 @@
 	-sinix*)
 		os=-sysv4
 		;;
-        -tpf*)
+	-tpf*)
 		os=-tpf
 		;;
 	-triton*)
@@ -1435,6 +1501,8 @@
 	-dicos*)
 		os=-dicos
 		;;
+	-nacl*)
+		;;
 	-none)
 		;;
 	*)
@@ -1457,10 +1525,10 @@
 # system, and we'll never get to this point.
 
 case $basic_machine in
-        score-*)
+	score-*)
 		os=-elf
 		;;
-        spu-*)
+	spu-*)
 		os=-elf
 		;;
 	*-acorn)
@@ -1472,8 +1540,20 @@
 	arm*-semi)
 		os=-aout
 		;;
-        c4x-* | tic4x-*)
-        	os=-coff
+	c4x-* | tic4x-*)
+		os=-coff
+		;;
+	hexagon-*)
+		os=-elf
+		;;
+	tic54x-*)
+		os=-coff
+		;;
+	tic55x-*)
+		os=-coff
+		;;
+	tic6x-*)
+		os=-coff
 		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
@@ -1493,14 +1573,11 @@
 		;;
 	m68000-sun)
 		os=-sunos3
-		# This also exists in the configure program, but was not the
-		# default.
-		# os=-sunos4
 		;;
 	m68*-cisco)
 		os=-aout
 		;;
-        mep-*)
+	mep-*)
 		os=-elf
 		;;
 	mips*-cisco)
@@ -1527,7 +1604,7 @@
 	*-ibm)
 		os=-aix
 		;;
-    	*-knuth)
+	*-knuth)
 		os=-mmixware
 		;;
 	*-wec)
Index: blcr-0.8.5/config/depcomp
===================================================================
--- blcr-0.8.5.orig/config/depcomp	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/config/depcomp	2013-03-26 22:50:51.000000000 +0000
@@ -1,10 +1,10 @@
 #! /bin/sh
 # depcomp - compile a program generating dependencies as side-effects
 
-scriptversion=2009-04-28.21; # UTC
+scriptversion=2012-03-27.16; # UTC
 
-# Copyright (C) 1999, 2000, 2003, 2004, 2005, 2006, 2007, 2009 Free
-# Software Foundation, Inc.
+# Copyright (C) 1999, 2000, 2003, 2004, 2005, 2006, 2007, 2009, 2010,
+# 2011, 2012 Free Software Foundation, Inc.
 
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -28,7 +28,7 @@
 
 case $1 in
   '')
-     echo "$0: No command.  Try \`$0 --help' for more information." 1>&2
+     echo "$0: No command.  Try '$0 --help' for more information." 1>&2
      exit 1;
      ;;
   -h | --h*)
@@ -40,11 +40,11 @@
 
 Environment variables:
   depmode     Dependency tracking mode.
-  source      Source file read by `PROGRAMS ARGS'.
-  object      Object file output by `PROGRAMS ARGS'.
+  source      Source file read by 'PROGRAMS ARGS'.
+  object      Object file output by 'PROGRAMS ARGS'.
   DEPDIR      directory where to store dependencies.
   depfile     Dependency file to output.
-  tmpdepfile  Temporary file to use when outputing dependencies.
+  tmpdepfile  Temporary file to use when outputting dependencies.
   libtool     Whether libtool is used (yes/no).
 
 Report bugs to <bug-automake@gnu.org>.
@@ -57,6 +57,12 @@
     ;;
 esac
 
+# A tabulation character.
+tab='	'
+# A newline character.
+nl='
+'
+
 if test -z "$depmode" || test -z "$source" || test -z "$object"; then
   echo "depcomp: Variables source, object and depmode must be set" 1>&2
   exit 1
@@ -90,10 +96,24 @@
    # This is just like msvisualcpp but w/o cygpath translation.
    # Just convert the backslash-escaped backslashes to single forward
    # slashes to satisfy depend.m4
-   cygpath_u="sed s,\\\\\\\\,/,g"
+   cygpath_u='sed s,\\\\,/,g'
    depmode=msvisualcpp
 fi
 
+if test "$depmode" = msvc7msys; then
+   # This is just like msvc7 but w/o cygpath translation.
+   # Just convert the backslash-escaped backslashes to single forward
+   # slashes to satisfy depend.m4
+   cygpath_u='sed s,\\\\,/,g'
+   depmode=msvc7
+fi
+
+if test "$depmode" = xlc; then
+   # IBM C/C++ Compilers xlc/xlC can output gcc-like dependency informations.
+   gccflag=-qmakedep=gcc,-MF
+   depmode=gcc
+fi
+
 case "$depmode" in
 gcc3)
 ## gcc 3 implements dependency tracking that does exactly what
@@ -148,20 +168,21 @@
 ## The second -e expression handles DOS-style file names with drive letters.
   sed -e 's/^[^:]*: / /' \
       -e 's/^['$alpha']:\/[^:]*: / /' < "$tmpdepfile" >> "$depfile"
-## This next piece of magic avoids the `deleted header file' problem.
+## This next piece of magic avoids the "deleted header file" problem.
 ## The problem is that when a header file which appears in a .P file
 ## is deleted, the dependency causes make to die (because there is
 ## typically no way to rebuild the header).  We avoid this by adding
 ## dummy dependencies for each header file.  Too bad gcc doesn't do
 ## this for us directly.
-  tr ' ' '
-' < "$tmpdepfile" |
-## Some versions of gcc put a space before the `:'.  On the theory
+  tr ' ' "$nl" < "$tmpdepfile" |
+## Some versions of gcc put a space before the ':'.  On the theory
 ## that the space means something, we add a space to the output as
-## well.
+## well.  hp depmode also adds that space, but also prefixes the VPATH
+## to the object.  Take care to not repeat it in the output.
 ## Some versions of the HPUX 10.20 sed can't process this invocation
 ## correctly.  Breaking it into two sed invocations is a workaround.
-    sed -e 's/^\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> "$depfile"
+    sed -e 's/^\\$//' -e '/^$/d' -e "s|.*$object$||" -e '/:$/d' \
+      | sed -e 's/$/ :/' >> "$depfile"
   rm -f "$tmpdepfile"
   ;;
 
@@ -193,18 +214,15 @@
     # clever and replace this with sed code, as IRIX sed won't handle
     # lines with more than a fixed number of characters (4096 in
     # IRIX 6.2 sed, 8192 in IRIX 6.5).  We also remove comment lines;
-    # the IRIX cc adds comments like `#:fec' to the end of the
+    # the IRIX cc adds comments like '#:fec' to the end of the
     # dependency line.
-    tr ' ' '
-' < "$tmpdepfile" \
+    tr ' ' "$nl" < "$tmpdepfile" \
     | sed -e 's/^.*\.o://' -e 's/#.*$//' -e '/^$/ d' | \
-    tr '
-' ' ' >> "$depfile"
+    tr "$nl" ' ' >> "$depfile"
     echo >> "$depfile"
 
     # The second pass generates a dummy entry for each header file.
-    tr ' ' '
-' < "$tmpdepfile" \
+    tr ' ' "$nl" < "$tmpdepfile" \
    | sed -e 's/^.*\.o://' -e 's/#.*$//' -e '/^$/ d' -e 's/$/:/' \
    >> "$depfile"
   else
@@ -216,10 +234,17 @@
   rm -f "$tmpdepfile"
   ;;
 
+xlc)
+  # This case exists only to let depend.m4 do its work.  It works by
+  # looking at the text of this script.  This case will never be run,
+  # since it is checked for above.
+  exit 1
+  ;;
+
 aix)
   # The C for AIX Compiler uses -M and outputs the dependencies
   # in a .u file.  In older versions, this file always lives in the
-  # current directory.  Also, the AIX compiler puts `$object:' at the
+  # current directory.  Also, the AIX compiler puts '$object:' at the
   # start of each line; $object doesn't have directory information.
   # Version 6 uses the directory in both cases.
   dir=`echo "$object" | sed -e 's|/[^/]*$|/|'`
@@ -249,12 +274,11 @@
     test -f "$tmpdepfile" && break
   done
   if test -f "$tmpdepfile"; then
-    # Each line is of the form `foo.o: dependent.h'.
+    # Each line is of the form 'foo.o: dependent.h'.
     # Do two passes, one to just change these to
-    # `$object: dependent.h' and one to simply `dependent.h:'.
+    # '$object: dependent.h' and one to simply 'dependent.h:'.
     sed -e "s,^.*\.[a-z]*:,$object:," < "$tmpdepfile" > "$depfile"
-    # That's a tab and a space in the [].
-    sed -e 's,^.*\.[a-z]*:[	 ]*,,' -e 's,$,:,' < "$tmpdepfile" >> "$depfile"
+    sed -e 's,^.*\.[a-z]*:['"$tab"' ]*,,' -e 's,$,:,' < "$tmpdepfile" >> "$depfile"
   else
     # The sourcefile does not contain any dependencies, so just
     # store a dummy comment line, to avoid errors with the Makefile
@@ -265,23 +289,26 @@
   ;;
 
 icc)
-  # Intel's C compiler understands `-MD -MF file'.  However on
-  #    icc -MD -MF foo.d -c -o sub/foo.o sub/foo.c
+  # Intel's C compiler anf tcc (Tiny C Compiler) understand '-MD -MF file'.
+  # However on
+  #    $CC -MD -MF foo.d -c -o sub/foo.o sub/foo.c
   # ICC 7.0 will fill foo.d with something like
   #    foo.o: sub/foo.c
   #    foo.o: sub/foo.h
-  # which is wrong.  We want:
+  # which is wrong.  We want
   #    sub/foo.o: sub/foo.c
   #    sub/foo.o: sub/foo.h
   #    sub/foo.c:
   #    sub/foo.h:
   # ICC 7.1 will output
   #    foo.o: sub/foo.c sub/foo.h
-  # and will wrap long lines using \ :
+  # and will wrap long lines using '\':
   #    foo.o: sub/foo.c ... \
   #     sub/foo.h ... \
   #     ...
-
+  # tcc 0.9.26 (FIXME still under development at the moment of writing)
+  # will emit a similar output, but also prepend the continuation lines
+  # with horizontal tabulation characters.
   "$@" -MD -MF "$tmpdepfile"
   stat=$?
   if test $stat -eq 0; then :
@@ -290,15 +317,21 @@
     exit $stat
   fi
   rm -f "$depfile"
-  # Each line is of the form `foo.o: dependent.h',
-  # or `foo.o: dep1.h dep2.h \', or ` dep3.h dep4.h \'.
+  # Each line is of the form 'foo.o: dependent.h',
+  # or 'foo.o: dep1.h dep2.h \', or ' dep3.h dep4.h \'.
   # Do two passes, one to just change these to
-  # `$object: dependent.h' and one to simply `dependent.h:'.
-  sed "s,^[^:]*:,$object :," < "$tmpdepfile" > "$depfile"
-  # Some versions of the HPUX 10.20 sed can't process this invocation
-  # correctly.  Breaking it into two sed invocations is a workaround.
-  sed 's,^[^:]*: \(.*\)$,\1,;s/^\\$//;/^$/d;/:$/d' < "$tmpdepfile" |
-    sed -e 's/$/ :/' >> "$depfile"
+  # '$object: dependent.h' and one to simply 'dependent.h:'.
+  sed -e "s/^[ $tab][ $tab]*/  /" -e "s,^[^:]*:,$object :," \
+    < "$tmpdepfile" > "$depfile"
+  sed '
+    s/[ '"$tab"'][ '"$tab"']*/ /g
+    s/^ *//
+    s/ *\\*$//
+    s/^[^:]*: *//
+    /^$/d
+    /:$/d
+    s/$/ :/
+  ' < "$tmpdepfile" >> "$depfile"
   rm -f "$tmpdepfile"
   ;;
 
@@ -334,7 +367,7 @@
   done
   if test -f "$tmpdepfile"; then
     sed -e "s,^.*\.[a-z]*:,$object:," "$tmpdepfile" > "$depfile"
-    # Add `dependent.h:' lines.
+    # Add 'dependent.h:' lines.
     sed -ne '2,${
 	       s/^ *//
 	       s/ \\*$//
@@ -349,9 +382,9 @@
 
 tru64)
    # The Tru64 compiler uses -MD to generate dependencies as a side
-   # effect.  `cc -MD -o foo.o ...' puts the dependencies into `foo.o.d'.
+   # effect.  'cc -MD -o foo.o ...' puts the dependencies into 'foo.o.d'.
    # At least on Alpha/Redhat 6.1, Compaq CCC V6.2-504 seems to put
-   # dependencies in `foo.d' instead, so we check for that too.
+   # dependencies in 'foo.d' instead, so we check for that too.
    # Subdirectories are respected.
    dir=`echo "$object" | sed -e 's|/[^/]*$|/|'`
    test "x$dir" = "x$object" && dir=
@@ -397,14 +430,59 @@
    done
    if test -f "$tmpdepfile"; then
       sed -e "s,^.*\.[a-z]*:,$object:," < "$tmpdepfile" > "$depfile"
-      # That's a tab and a space in the [].
-      sed -e 's,^.*\.[a-z]*:[	 ]*,,' -e 's,$,:,' < "$tmpdepfile" >> "$depfile"
+      sed -e 's,^.*\.[a-z]*:['"$tab"' ]*,,' -e 's,$,:,' < "$tmpdepfile" >> "$depfile"
    else
       echo "#dummy" > "$depfile"
    fi
    rm -f "$tmpdepfile"
    ;;
 
+msvc7)
+  if test "$libtool" = yes; then
+    showIncludes=-Wc,-showIncludes
+  else
+    showIncludes=-showIncludes
+  fi
+  "$@" $showIncludes > "$tmpdepfile"
+  stat=$?
+  grep -v '^Note: including file: ' "$tmpdepfile"
+  if test "$stat" = 0; then :
+  else
+    rm -f "$tmpdepfile"
+    exit $stat
+  fi
+  rm -f "$depfile"
+  echo "$object : \\" > "$depfile"
+  # The first sed program below extracts the file names and escapes
+  # backslashes for cygpath.  The second sed program outputs the file
+  # name when reading, but also accumulates all include files in the
+  # hold buffer in order to output them again at the end.  This only
+  # works with sed implementations that can handle large buffers.
+  sed < "$tmpdepfile" -n '
+/^Note: including file:  *\(.*\)/ {
+  s//\1/
+  s/\\/\\\\/g
+  p
+}' | $cygpath_u | sort -u | sed -n '
+s/ /\\ /g
+s/\(.*\)/'"$tab"'\1 \\/p
+s/.\(.*\) \\/\1:/
+H
+$ {
+  s/.*/'"$tab"'/
+  G
+  p
+}' >> "$depfile"
+  rm -f "$tmpdepfile"
+  ;;
+
+msvc7msys)
+  # This case exists only to let depend.m4 do its work.  It works by
+  # looking at the text of this script.  This case will never be run,
+  # since it is checked for above.
+  exit 1
+  ;;
+
 #nosideeffect)
   # This comment above is used by automake to tell side-effect
   # dependency tracking mechanisms from slower ones.
@@ -422,7 +500,7 @@
     shift
   fi
 
-  # Remove `-o $object'.
+  # Remove '-o $object'.
   IFS=" "
   for arg
   do
@@ -442,15 +520,14 @@
   done
 
   test -z "$dashmflag" && dashmflag=-M
-  # Require at least two characters before searching for `:'
+  # Require at least two characters before searching for ':'
   # in the target name.  This is to cope with DOS-style filenames:
-  # a dependency such as `c:/foo/bar' could be seen as target `c' otherwise.
+  # a dependency such as 'c:/foo/bar' could be seen as target 'c' otherwise.
   "$@" $dashmflag |
-    sed 's:^[  ]*[^: ][^:][^:]*\:[    ]*:'"$object"'\: :' > "$tmpdepfile"
+    sed 's:^['"$tab"' ]*[^:'"$tab"' ][^:][^:]*\:['"$tab"' ]*:'"$object"'\: :' > "$tmpdepfile"
   rm -f "$depfile"
   cat < "$tmpdepfile" > "$depfile"
-  tr ' ' '
-' < "$tmpdepfile" | \
+  tr ' ' "$nl" < "$tmpdepfile" | \
 ## Some versions of the HPUX 10.20 sed can't process this invocation
 ## correctly.  Breaking it into two sed invocations is a workaround.
     sed -e 's/^\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> "$depfile"
@@ -503,9 +580,10 @@
   touch "$tmpdepfile"
   ${MAKEDEPEND-makedepend} -o"$obj_suffix" -f"$tmpdepfile" "$@"
   rm -f "$depfile"
-  cat < "$tmpdepfile" > "$depfile"
-  sed '1,2d' "$tmpdepfile" | tr ' ' '
-' | \
+  # makedepend may prepend the VPATH from the source file name to the object.
+  # No need to regex-escape $object, excess matching of '.' is harmless.
+  sed "s|^.*\($object *:\)|\1|" "$tmpdepfile" > "$depfile"
+  sed '1,2d' "$tmpdepfile" | tr ' ' "$nl" | \
 ## Some versions of the HPUX 10.20 sed can't process this invocation
 ## correctly.  Breaking it into two sed invocations is a workaround.
     sed -e 's/^\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> "$depfile"
@@ -525,7 +603,7 @@
     shift
   fi
 
-  # Remove `-o $object'.
+  # Remove '-o $object'.
   IFS=" "
   for arg
   do
@@ -594,8 +672,8 @@
   sed -n '/^#line [0-9][0-9]* "\([^"]*\)"/ s::\1:p' | $cygpath_u | sort -u > "$tmpdepfile"
   rm -f "$depfile"
   echo "$object : \\" > "$depfile"
-  sed < "$tmpdepfile" -n -e 's% %\\ %g' -e '/^\(.*\)$/ s::	\1 \\:p' >> "$depfile"
-  echo "	" >> "$depfile"
+  sed < "$tmpdepfile" -n -e 's% %\\ %g' -e '/^\(.*\)$/ s::'"$tab"'\1 \\:p' >> "$depfile"
+  echo "$tab" >> "$depfile"
   sed < "$tmpdepfile" -n -e 's% %\\ %g' -e '/^\(.*\)$/ s::\1\::p' >> "$depfile"
   rm -f "$tmpdepfile"
   ;;
Index: blcr-0.8.5/config/install-sh
===================================================================
--- blcr-0.8.5.orig/config/install-sh	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/config/install-sh	2013-03-26 22:50:49.000000000 +0000
@@ -1,7 +1,7 @@
 #!/bin/sh
 # install - install a program, script, or datafile
 
-scriptversion=2009-04-28.21; # UTC
+scriptversion=2011-01-19.21; # UTC
 
 # This originates from X11R5 (mit/util/scripts/install.sh), which was
 # later released in X11R6 (xc/config/util/install.sh) with the
@@ -156,6 +156,10 @@
     -s) stripcmd=$stripprog;;
 
     -t) dst_arg=$2
+	# Protect names problematic for `test' and other utilities.
+	case $dst_arg in
+	  -* | [=\(\)!]) dst_arg=./$dst_arg;;
+	esac
 	shift;;
 
     -T) no_target_directory=true;;
@@ -186,6 +190,10 @@
     fi
     shift # arg
     dst_arg=$arg
+    # Protect names problematic for `test' and other utilities.
+    case $dst_arg in
+      -* | [=\(\)!]) dst_arg=./$dst_arg;;
+    esac
   done
 fi
 
@@ -200,7 +208,11 @@
 fi
 
 if test -z "$dir_arg"; then
-  trap '(exit $?); exit' 1 2 13 15
+  do_exit='(exit $ret); exit $ret'
+  trap "ret=129; $do_exit" 1
+  trap "ret=130; $do_exit" 2
+  trap "ret=141; $do_exit" 13
+  trap "ret=143; $do_exit" 15
 
   # Set umask so as not to create temps with too-generous modes.
   # However, 'strip' requires both read and write access to temps.
@@ -228,9 +240,9 @@
 
 for src
 do
-  # Protect names starting with `-'.
+  # Protect names problematic for `test' and other utilities.
   case $src in
-    -*) src=./$src;;
+    -* | [=\(\)!]) src=./$src;;
   esac
 
   if test -n "$dir_arg"; then
@@ -252,12 +264,7 @@
       echo "$0: no destination specified." >&2
       exit 1
     fi
-
     dst=$dst_arg
-    # Protect names starting with `-'.
-    case $dst in
-      -*) dst=./$dst;;
-    esac
 
     # If destination is a directory, append the input filename; won't work
     # if double slashes aren't ignored.
@@ -385,7 +392,7 @@
 
       case $dstdir in
 	/*) prefix='/';;
-	-*) prefix='./';;
+	[-=\(\)!]*) prefix='./';;
 	*)  prefix='';;
       esac
 
@@ -403,7 +410,7 @@
 
       for d
       do
-	test -z "$d" && continue
+	test X"$d" = X && continue
 
 	prefix=$prefix$d
 	if test -d "$prefix"; then
Index: blcr-0.8.5/config/ltmain.sh
===================================================================
--- blcr-0.8.5.orig/config/ltmain.sh	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/config/ltmain.sh	2013-03-26 22:50:43.000000000 +0000
@@ -1,9 +1,9 @@
-# Generated from ltmain.m4sh.
 
-# ltmain.sh (GNU libtool) 2.2.6b
+# libtool (GNU libtool) 2.4.2
 # Written by Gordon Matzigkeit <gord@gnu.ai.mit.edu>, 1996
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006, 2007 2008 Free Software Foundation, Inc.
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
+# 2007, 2008, 2009, 2010, 2011 Free Software Foundation, Inc.
 # This is free software; see the source for copying conditions.  There is NO
 # warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 
@@ -32,50 +32,57 @@
 #
 # Provide generalized library-building support services.
 #
-#     --config             show all configuration variables
-#     --debug              enable verbose shell tracing
-# -n, --dry-run            display commands without modifying any files
-#     --features           display basic configuration information and exit
-#     --mode=MODE          use operation mode MODE
-#     --preserve-dup-deps  don't remove duplicate dependency libraries
-#     --quiet, --silent    don't print informational messages
-#     --tag=TAG            use configuration variables from tag TAG
-# -v, --verbose            print informational messages (default)
-#     --version            print version information
-# -h, --help               print short or long help message
+#       --config             show all configuration variables
+#       --debug              enable verbose shell tracing
+#   -n, --dry-run            display commands without modifying any files
+#       --features           display basic configuration information and exit
+#       --mode=MODE          use operation mode MODE
+#       --preserve-dup-deps  don't remove duplicate dependency libraries
+#       --quiet, --silent    don't print informational messages
+#       --no-quiet, --no-silent
+#                            print informational messages (default)
+#       --no-warn            don't display warning messages
+#       --tag=TAG            use configuration variables from tag TAG
+#   -v, --verbose            print more informational messages than default
+#       --no-verbose         don't print the extra informational messages
+#       --version            print version information
+#   -h, --help, --help-all   print short, long, or detailed help message
 #
 # MODE must be one of the following:
 #
-#       clean              remove files from the build directory
-#       compile            compile a source file into a libtool object
-#       execute            automatically set library path, then run a program
-#       finish             complete the installation of libtool libraries
-#       install            install libraries or executables
-#       link               create a library or an executable
-#       uninstall          remove libraries from an installed directory
+#         clean              remove files from the build directory
+#         compile            compile a source file into a libtool object
+#         execute            automatically set library path, then run a program
+#         finish             complete the installation of libtool libraries
+#         install            install libraries or executables
+#         link               create a library or an executable
+#         uninstall          remove libraries from an installed directory
 #
-# MODE-ARGS vary depending on the MODE.
+# MODE-ARGS vary depending on the MODE.  When passed as first option,
+# `--mode=MODE' may be abbreviated as `MODE' or a unique abbreviation of that.
 # Try `$progname --help --mode=MODE' for a more detailed description of MODE.
 #
 # When reporting a bug, please describe a test case to reproduce it and
 # include the following information:
 #
-#       host-triplet:	$host
-#       shell:		$SHELL
-#       compiler:		$LTCC
-#       compiler flags:		$LTCFLAGS
-#       linker:		$LD (gnu? $with_gnu_ld)
-#       $progname:		(GNU libtool) 2.2.6b
-#       automake:		$automake_version
-#       autoconf:		$autoconf_version
+#         host-triplet:	$host
+#         shell:		$SHELL
+#         compiler:		$LTCC
+#         compiler flags:		$LTCFLAGS
+#         linker:		$LD (gnu? $with_gnu_ld)
+#         $progname:	(GNU libtool) 2.4.2 Debian-2.4.2-1.1
+#         automake:	$automake_version
+#         autoconf:	$autoconf_version
 #
 # Report bugs to <bug-libtool@gnu.org>.
+# GNU libtool home page: <http://www.gnu.org/software/libtool/>.
+# General help using GNU software: <http://www.gnu.org/gethelp/>.
 
-PROGRAM=ltmain.sh
+PROGRAM=libtool
 PACKAGE=libtool
-VERSION=2.2.6b
+VERSION="2.4.2 Debian-2.4.2-1.1"
 TIMESTAMP=""
-package_revision=1.3017
+package_revision=1.3337
 
 # Be Bourne compatible
 if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
@@ -91,10 +98,15 @@
 BIN_SH=xpg4; export BIN_SH # for Tru64
 DUALCASE=1; export DUALCASE # for MKS sh
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+$1
+_LTECHO_EOF'
+}
+
 # NLS nuisances: We save the old values to restore during execute mode.
-# Only set LANG and LC_ALL to C if already set.
-# These must not be set unconditionally because not all systems understand
-# e.g. LANG=C (notably SCO).
 lt_user_locale=
 lt_safe_locale=
 for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
@@ -107,24 +119,28 @@
 	  lt_safe_locale=\"$lt_var=C; \$lt_safe_locale\"
 	fi"
 done
+LC_ALL=C
+LANGUAGE=C
+export LANGUAGE LC_ALL
 
 $lt_unset CDPATH
 
 
+# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
+# is ksh but when the shell is invoked as "sh" and the current value of
+# the _XPG environment variable is not equal to 1 (one), the special
+# positional parameter $0, within a function call, is the name of the
+# function.
+progpath="$0"
 
 
 
 : ${CP="cp -f"}
-: ${ECHO="echo"}
-: ${EGREP="/bin/grep -E"}
-: ${FGREP="/bin/grep -F"}
-: ${GREP="/bin/grep"}
-: ${LN_S="ln -s"}
+test "${ECHO+set}" = set || ECHO=${as_echo-'printf %s\n'}
 : ${MAKE="make"}
 : ${MKDIR="mkdir"}
 : ${MV="mv -f"}
 : ${RM="rm -f"}
-: ${SED="/bin/sed"}
 : ${SHELL="${CONFIG_SHELL-/bin/sh}"}
 : ${Xsed="$SED -e 1s/^X//"}
 
@@ -144,6 +160,27 @@
 dirname="s,/[^/]*$,,"
 basename="s,^.*/,,"
 
+# func_dirname file append nondir_replacement
+# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
+# otherwise set result to NONDIR_REPLACEMENT.
+func_dirname ()
+{
+    func_dirname_result=`$ECHO "${1}" | $SED "$dirname"`
+    if test "X$func_dirname_result" = "X${1}"; then
+      func_dirname_result="${3}"
+    else
+      func_dirname_result="$func_dirname_result${2}"
+    fi
+} # func_dirname may be replaced by extended shell implementation
+
+
+# func_basename file
+func_basename ()
+{
+    func_basename_result=`$ECHO "${1}" | $SED "$basename"`
+} # func_basename may be replaced by extended shell implementation
+
+
 # func_dirname_and_basename file append nondir_replacement
 # perform func_basename and func_dirname in a single function
 # call:
@@ -158,33 +195,183 @@
 # those functions but instead duplicate the functionality here.
 func_dirname_and_basename ()
 {
-  # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO "X${1}" | $Xsed -e "$dirname"`
-  if test "X$func_dirname_result" = "X${1}"; then
-    func_dirname_result="${3}"
-  else
-    func_dirname_result="$func_dirname_result${2}"
-  fi
-  func_basename_result=`$ECHO "X${1}" | $Xsed -e "$basename"`
+    # Extract subdirectory from the argument.
+    func_dirname_result=`$ECHO "${1}" | $SED -e "$dirname"`
+    if test "X$func_dirname_result" = "X${1}"; then
+      func_dirname_result="${3}"
+    else
+      func_dirname_result="$func_dirname_result${2}"
+    fi
+    func_basename_result=`$ECHO "${1}" | $SED -e "$basename"`
+} # func_dirname_and_basename may be replaced by extended shell implementation
+
+
+# func_stripname prefix suffix name
+# strip PREFIX and SUFFIX off of NAME.
+# PREFIX and SUFFIX must not contain globbing or regex special
+# characters, hashes, percent signs, but SUFFIX may contain a leading
+# dot (in which case that matches only a dot).
+# func_strip_suffix prefix name
+func_stripname ()
+{
+    case ${2} in
+      .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
+      *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+    esac
+} # func_stripname may be replaced by extended shell implementation
+
+
+# These SED scripts presuppose an absolute path with a trailing slash.
+pathcar='s,^/\([^/]*\).*$,\1,'
+pathcdr='s,^/[^/]*,,'
+removedotparts=':dotsl
+		s@/\./@/@g
+		t dotsl
+		s,/\.$,/,'
+collapseslashes='s@/\{1,\}@/@g'
+finalslash='s,/*$,/,'
+
+# func_normal_abspath PATH
+# Remove doubled-up and trailing slashes, "." path components,
+# and cancel out any ".." path components in PATH after making
+# it an absolute path.
+#             value returned in "$func_normal_abspath_result"
+func_normal_abspath ()
+{
+  # Start from root dir and reassemble the path.
+  func_normal_abspath_result=
+  func_normal_abspath_tpath=$1
+  func_normal_abspath_altnamespace=
+  case $func_normal_abspath_tpath in
+    "")
+      # Empty path, that just means $cwd.
+      func_stripname '' '/' "`pwd`"
+      func_normal_abspath_result=$func_stripname_result
+      return
+    ;;
+    # The next three entries are used to spot a run of precisely
+    # two leading slashes without using negated character classes;
+    # we take advantage of case's first-match behaviour.
+    ///*)
+      # Unusual form of absolute path, do nothing.
+    ;;
+    //*)
+      # Not necessarily an ordinary path; POSIX reserves leading '//'
+      # and for example Cygwin uses it to access remote file shares
+      # over CIFS/SMB, so we conserve a leading double slash if found.
+      func_normal_abspath_altnamespace=/
+    ;;
+    /*)
+      # Absolute path, do nothing.
+    ;;
+    *)
+      # Relative path, prepend $cwd.
+      func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
+    ;;
+  esac
+  # Cancel out all the simple stuff to save iterations.  We also want
+  # the path to end with a slash for ease of parsing, so make sure
+  # there is one (and only one) here.
+  func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
+        -e "$removedotparts" -e "$collapseslashes" -e "$finalslash"`
+  while :; do
+    # Processed it all yet?
+    if test "$func_normal_abspath_tpath" = / ; then
+      # If we ascended to the root using ".." the result may be empty now.
+      if test -z "$func_normal_abspath_result" ; then
+        func_normal_abspath_result=/
+      fi
+      break
+    fi
+    func_normal_abspath_tcomponent=`$ECHO "$func_normal_abspath_tpath" | $SED \
+        -e "$pathcar"`
+    func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
+        -e "$pathcdr"`
+    # Figure out what to do with it
+    case $func_normal_abspath_tcomponent in
+      "")
+        # Trailing empty path component, ignore it.
+      ;;
+      ..)
+        # Parent dir; strip last assembled component from result.
+        func_dirname "$func_normal_abspath_result"
+        func_normal_abspath_result=$func_dirname_result
+      ;;
+      *)
+        # Actual path component, append it.
+        func_normal_abspath_result=$func_normal_abspath_result/$func_normal_abspath_tcomponent
+      ;;
+    esac
+  done
+  # Restore leading double-slash if one was found on entry.
+  func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
 }
 
-# Generated shell functions inserted here.
+# func_relative_path SRCDIR DSTDIR
+# generates a relative path from SRCDIR to DSTDIR, with a trailing
+# slash if non-empty, suitable for immediately appending a filename
+# without needing to append a separator.
+#             value returned in "$func_relative_path_result"
+func_relative_path ()
+{
+  func_relative_path_result=
+  func_normal_abspath "$1"
+  func_relative_path_tlibdir=$func_normal_abspath_result
+  func_normal_abspath "$2"
+  func_relative_path_tbindir=$func_normal_abspath_result
+
+  # Ascend the tree starting from libdir
+  while :; do
+    # check if we have found a prefix of bindir
+    case $func_relative_path_tbindir in
+      $func_relative_path_tlibdir)
+        # found an exact match
+        func_relative_path_tcancelled=
+        break
+        ;;
+      $func_relative_path_tlibdir*)
+        # found a matching prefix
+        func_stripname "$func_relative_path_tlibdir" '' "$func_relative_path_tbindir"
+        func_relative_path_tcancelled=$func_stripname_result
+        if test -z "$func_relative_path_result"; then
+          func_relative_path_result=.
+        fi
+        break
+        ;;
+      *)
+        func_dirname $func_relative_path_tlibdir
+        func_relative_path_tlibdir=${func_dirname_result}
+        if test "x$func_relative_path_tlibdir" = x ; then
+          # Have to descend all the way to the root!
+          func_relative_path_result=../$func_relative_path_result
+          func_relative_path_tcancelled=$func_relative_path_tbindir
+          break
+        fi
+        func_relative_path_result=../$func_relative_path_result
+        ;;
+    esac
+  done
+
+  # Now calculate path; take care to avoid doubling-up slashes.
+  func_stripname '' '/' "$func_relative_path_result"
+  func_relative_path_result=$func_stripname_result
+  func_stripname '/' '/' "$func_relative_path_tcancelled"
+  if test "x$func_stripname_result" != x ; then
+    func_relative_path_result=${func_relative_path_result}/${func_stripname_result}
+  fi
 
-# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
-# is ksh but when the shell is invoked as "sh" and the current value of
-# the _XPG environment variable is not equal to 1 (one), the special
-# positional parameter $0, within a function call, is the name of the
-# function.
-progpath="$0"
+  # Normalisation. If bindir is libdir, return empty string,
+  # else relative path ending with a slash; either way, target
+  # file name can be directly appended.
+  if test ! -z "$func_relative_path_result"; then
+    func_stripname './' '' "$func_relative_path_result/"
+    func_relative_path_result=$func_stripname_result
+  fi
+}
 
 # The name of this program:
-# In the unlikely event $progname began with a '-', it would play havoc with
-# func_echo (imagine progname=-n), so we prepend ./ in that case:
 func_dirname_and_basename "$progpath"
 progname=$func_basename_result
-case $progname in
-  -*) progname=./$progname ;;
-esac
 
 # Make sure we have an absolute path for reexecution:
 case $progpath in
@@ -196,7 +383,7 @@
      ;;
   *)
      save_IFS="$IFS"
-     IFS=:
+     IFS=${PATH_SEPARATOR-:}
      for progdir in $PATH; do
        IFS="$save_IFS"
        test -x "$progdir/$progname" && break
@@ -215,6 +402,15 @@
 # Same as above, but do not quote variable references.
 double_quote_subst='s/\(["`\\]\)/\\\1/g'
 
+# Sed substitution that turns a string into a regex matching for the
+# string literally.
+sed_make_literal_regex='s,[].[^$\\*\/],\\&,g'
+
+# Sed substitution that converts a w32 file name or path
+# which contains forward slashes, into one that contains
+# (escaped) backslashes.  A very naive implementation.
+lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
+
 # Re-`\' parameter expansions in output of double_quote_subst that were
 # `\'-ed in input to the same.  If an odd number of `\' preceded a '$'
 # in input to double_quote_subst, that '$' was protected from expansion.
@@ -243,7 +439,7 @@
 # name if it has been set yet.
 func_echo ()
 {
-    $ECHO "$progname${mode+: }$mode: $*"
+    $ECHO "$progname: ${opt_mode+$opt_mode: }$*"
 }
 
 # func_verbose arg...
@@ -258,18 +454,25 @@
     :
 }
 
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO "$*"
+}
+
 # func_error arg...
 # Echo program name prefixed message to standard error.
 func_error ()
 {
-    $ECHO "$progname${mode+: }$mode: "${1+"$@"} 1>&2
+    $ECHO "$progname: ${opt_mode+$opt_mode: }"${1+"$@"} 1>&2
 }
 
 # func_warning arg...
 # Echo program name prefixed warning message to standard error.
 func_warning ()
 {
-    $opt_warning && $ECHO "$progname${mode+: }$mode: warning: "${1+"$@"} 1>&2
+    $opt_warning && $ECHO "$progname: ${opt_mode+$opt_mode: }warning: "${1+"$@"} 1>&2
 
     # bash bug again:
     :
@@ -326,9 +529,9 @@
         case $my_directory_path in */*) ;; *) break ;; esac
 
         # ...otherwise throw away the child directory and loop
-        my_directory_path=`$ECHO "X$my_directory_path" | $Xsed -e "$dirname"`
+        my_directory_path=`$ECHO "$my_directory_path" | $SED -e "$dirname"`
       done
-      my_dir_list=`$ECHO "X$my_dir_list" | $Xsed -e 's,:*$,,'`
+      my_dir_list=`$ECHO "$my_dir_list" | $SED 's,:*$,,'`
 
       save_mkdir_p_IFS="$IFS"; IFS=':'
       for my_dir in $my_dir_list; do
@@ -378,7 +581,7 @@
         func_fatal_error "cannot create temporary directory \`$my_tmpdir'"
     fi
 
-    $ECHO "X$my_tmpdir" | $Xsed
+    $ECHO "$my_tmpdir"
 }
 
 
@@ -392,7 +595,7 @@
 {
     case $1 in
       *[\\\`\"\$]*)
-	func_quote_for_eval_unquoted_result=`$ECHO "X$1" | $Xsed -e "$sed_quote_subst"` ;;
+	func_quote_for_eval_unquoted_result=`$ECHO "$1" | $SED "$sed_quote_subst"` ;;
       *)
         func_quote_for_eval_unquoted_result="$1" ;;
     esac
@@ -419,7 +622,7 @@
 {
     case $1 in
       *[\\\`\"]*)
-	my_arg=`$ECHO "X$1" | $Xsed \
+	my_arg=`$ECHO "$1" | $SED \
 	    -e "$double_quote_subst" -e "$sed_double_backslash"` ;;
       *)
         my_arg="$1" ;;
@@ -488,15 +691,39 @@
     fi
 }
 
-
-
+# func_tr_sh
+# Turn $1 into a string suitable for a shell variable name.
+# Result is stored in $func_tr_sh_result.  All characters
+# not in the set a-zA-Z0-9_ are replaced with '_'. Further,
+# if $1 begins with a digit, a '_' is prepended as well.
+func_tr_sh ()
+{
+  case $1 in
+  [0-9]* | *[!a-zA-Z0-9_]*)
+    func_tr_sh_result=`$ECHO "$1" | $SED 's/^\([0-9]\)/_\1/; s/[^a-zA-Z0-9_]/_/g'`
+    ;;
+  * )
+    func_tr_sh_result=$1
+    ;;
+  esac
+}
 
 
 # func_version
 # Echo version message to standard output and exit.
 func_version ()
 {
-    $SED -n '/^# '$PROGRAM' (GNU /,/# warranty; / {
+    $opt_debug
+
+    $SED -n '/(C)/!b go
+	:more
+	/\./!{
+	  N
+	  s/\n# / /
+	  b more
+	}
+	:go
+	/^# '$PROGRAM' (GNU /,/# warranty; / {
         s/^# //
 	s/^# *$//
         s/\((C)\)[ 0-9,-]*\( [1-9][0-9]*\)/\1\2/
@@ -509,22 +736,28 @@
 # Echo short help message to standard output and exit.
 func_usage ()
 {
-    $SED -n '/^# Usage:/,/# -h/ {
+    $opt_debug
+
+    $SED -n '/^# Usage:/,/^#  *.*--help/ {
         s/^# //
 	s/^# *$//
 	s/\$progname/'$progname'/
 	p
     }' < "$progpath"
-    $ECHO
+    echo
     $ECHO "run \`$progname --help | more' for full usage"
     exit $?
 }
 
-# func_help
-# Echo long help message to standard output and exit.
+# func_help [NOEXIT]
+# Echo long help message to standard output and exit,
+# unless 'noexit' is passed as argument.
 func_help ()
 {
+    $opt_debug
+
     $SED -n '/^# Usage:/,/# Report bugs to/ {
+	:print
         s/^# //
 	s/^# *$//
 	s*\$progname*'$progname'*
@@ -534,11 +767,18 @@
 	s*\$LTCFLAGS*'"$LTCFLAGS"'*
 	s*\$LD*'"$LD"'*
 	s/\$with_gnu_ld/'"$with_gnu_ld"'/
-	s/\$automake_version/'"`(automake --version) 2>/dev/null |$SED 1q`"'/
-	s/\$autoconf_version/'"`(autoconf --version) 2>/dev/null |$SED 1q`"'/
+	s/\$automake_version/'"`(${AUTOMAKE-automake} --version) 2>/dev/null |$SED 1q`"'/
+	s/\$autoconf_version/'"`(${AUTOCONF-autoconf} --version) 2>/dev/null |$SED 1q`"'/
 	p
-     }' < "$progpath"
-    exit $?
+	d
+     }
+     /^# .* home page:/b print
+     /^# General help using/b print
+     ' < "$progpath"
+    ret=$?
+    if test -z "$1"; then
+      exit $ret
+    fi
 }
 
 # func_missing_arg argname
@@ -546,63 +786,106 @@
 # exit_cmd.
 func_missing_arg ()
 {
-    func_error "missing argument for $1"
+    $opt_debug
+
+    func_error "missing argument for $1."
     exit_cmd=exit
 }
 
-exit_cmd=:
 
+# func_split_short_opt shortopt
+# Set func_split_short_opt_name and func_split_short_opt_arg shell
+# variables after splitting SHORTOPT after the 2nd character.
+func_split_short_opt ()
+{
+    my_sed_short_opt='1s/^\(..\).*$/\1/;q'
+    my_sed_short_rest='1s/^..\(.*\)$/\1/;q'
+
+    func_split_short_opt_name=`$ECHO "$1" | $SED "$my_sed_short_opt"`
+    func_split_short_opt_arg=`$ECHO "$1" | $SED "$my_sed_short_rest"`
+} # func_split_short_opt may be replaced by extended shell implementation
+
+
+# func_split_long_opt longopt
+# Set func_split_long_opt_name and func_split_long_opt_arg shell
+# variables after splitting LONGOPT at the `=' sign.
+func_split_long_opt ()
+{
+    my_sed_long_opt='1s/^\(--[^=]*\)=.*/\1/;q'
+    my_sed_long_arg='1s/^--[^=]*=//'
+
+    func_split_long_opt_name=`$ECHO "$1" | $SED "$my_sed_long_opt"`
+    func_split_long_opt_arg=`$ECHO "$1" | $SED "$my_sed_long_arg"`
+} # func_split_long_opt may be replaced by extended shell implementation
 
+exit_cmd=:
 
 
 
-# Check that we have a working $ECHO.
-if test "X$1" = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test "X$1" = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t'; then
-  # Yippee, $ECHO works!
-  :
-else
-  # Restart under the correct shell, and then maybe $ECHO will work.
-  exec $SHELL "$progpath" --no-reexec ${1+"$@"}
-fi
 
-if test "X$1" = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat <<EOF
-$*
-EOF
-  exit $EXIT_SUCCESS
-fi
 
 magic="%%%MAGIC variable%%%"
 magic_exe="%%%MAGIC EXE variable%%%"
 
 # Global variables.
-# $mode is unset
 nonopt=
-execute_dlfiles=
 preserve_args=
 lo2o="s/\\.lo\$/.${objext}/"
 o2lo="s/\\.${objext}\$/.lo/"
 extracted_archives=
 extracted_serial=0
 
-opt_dry_run=false
-opt_duplicate_deps=false
-opt_silent=false
-opt_debug=:
-
 # If this variable is set in any of the actions, the command in it
 # will be execed at the end.  This prevents here-documents from being
 # left over by shells.
 exec_cmd=
 
+# func_append var value
+# Append VALUE to the end of shell variable VAR.
+func_append ()
+{
+    eval "${1}=\$${1}\${2}"
+} # func_append may be replaced by extended shell implementation
+
+# func_append_quoted var value
+# Quote VALUE and append to the end of shell variable VAR, separated
+# by a space.
+func_append_quoted ()
+{
+    func_quote_for_eval "${2}"
+    eval "${1}=\$${1}\\ \$func_quote_for_eval_result"
+} # func_append_quoted may be replaced by extended shell implementation
+
+
+# func_arith arithmetic-term...
+func_arith ()
+{
+    func_arith_result=`expr "${@}"`
+} # func_arith may be replaced by extended shell implementation
+
+
+# func_len string
+# STRING may not start with a hyphen.
+func_len ()
+{
+    func_len_result=`expr "${1}" : ".*" 2>/dev/null || echo $max_cmd_len`
+} # func_len may be replaced by extended shell implementation
+
+
+# func_lo2o object
+func_lo2o ()
+{
+    func_lo2o_result=`$ECHO "${1}" | $SED "$lo2o"`
+} # func_lo2o may be replaced by extended shell implementation
+
+
+# func_xform libobj-or-source
+func_xform ()
+{
+    func_xform_result=`$ECHO "${1}" | $SED 's/\.[^.]*$/.lo/'`
+} # func_xform may be replaced by extended shell implementation
+
+
 # func_fatal_configuration arg...
 # Echo program name prefixed message to standard error, followed by
 # a configuration failure hint, and exit.
@@ -636,16 +919,16 @@
 # Display the features supported by this script.
 func_features ()
 {
-    $ECHO "host: $host"
+    echo "host: $host"
     if test "$build_libtool_libs" = yes; then
-      $ECHO "enable shared libraries"
+      echo "enable shared libraries"
     else
-      $ECHO "disable shared libraries"
+      echo "disable shared libraries"
     fi
     if test "$build_old_libs" = yes; then
-      $ECHO "enable static libraries"
+      echo "enable static libraries"
     else
-      $ECHO "disable static libraries"
+      echo "disable static libraries"
     fi
 
     exit $?
@@ -692,117 +975,209 @@
   esac
 }
 
-# Parse options once, thoroughly.  This comes as soon as possible in
-# the script to make things like `libtool --version' happen quickly.
+# func_check_version_match
+# Ensure that we are using m4 macros, and libtool script from the same
+# release of libtool.
+func_check_version_match ()
 {
+  if test "$package_revision" != "$macro_revision"; then
+    if test "$VERSION" != "$macro_version"; then
+      if test -z "$macro_version"; then
+        cat >&2 <<_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
+$progname: definition of this LT_INIT comes from an older release.
+$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
+$progname: and run autoconf again.
+_LT_EOF
+      else
+        cat >&2 <<_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
+$progname: definition of this LT_INIT comes from $PACKAGE $macro_version.
+$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
+$progname: and run autoconf again.
+_LT_EOF
+      fi
+    else
+      cat >&2 <<_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, revision $package_revision,
+$progname: but the definition of this LT_INIT comes from revision $macro_revision.
+$progname: You should recreate aclocal.m4 with macros from revision $package_revision
+$progname: of $PACKAGE $VERSION and run autoconf again.
+_LT_EOF
+    fi
+
+    exit $EXIT_MISMATCH
+  fi
+}
+
+
+# Shorthand for --mode=foo, only valid as the first argument
+case $1 in
+clean|clea|cle|cl)
+  shift; set dummy --mode clean ${1+"$@"}; shift
+  ;;
+compile|compil|compi|comp|com|co|c)
+  shift; set dummy --mode compile ${1+"$@"}; shift
+  ;;
+execute|execut|execu|exec|exe|ex|e)
+  shift; set dummy --mode execute ${1+"$@"}; shift
+  ;;
+finish|finis|fini|fin|fi|f)
+  shift; set dummy --mode finish ${1+"$@"}; shift
+  ;;
+install|instal|insta|inst|ins|in|i)
+  shift; set dummy --mode install ${1+"$@"}; shift
+  ;;
+link|lin|li|l)
+  shift; set dummy --mode link ${1+"$@"}; shift
+  ;;
+uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
+  shift; set dummy --mode uninstall ${1+"$@"}; shift
+  ;;
+esac
 
-  # Shorthand for --mode=foo, only valid as the first argument
-  case $1 in
-  clean|clea|cle|cl)
-    shift; set dummy --mode clean ${1+"$@"}; shift
-    ;;
-  compile|compil|compi|comp|com|co|c)
-    shift; set dummy --mode compile ${1+"$@"}; shift
-    ;;
-  execute|execut|execu|exec|exe|ex|e)
-    shift; set dummy --mode execute ${1+"$@"}; shift
-    ;;
-  finish|finis|fini|fin|fi|f)
-    shift; set dummy --mode finish ${1+"$@"}; shift
-    ;;
-  install|instal|insta|inst|ins|in|i)
-    shift; set dummy --mode install ${1+"$@"}; shift
-    ;;
-  link|lin|li|l)
-    shift; set dummy --mode link ${1+"$@"}; shift
-    ;;
-  uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
-    shift; set dummy --mode uninstall ${1+"$@"}; shift
-    ;;
-  esac
 
-  # Parse non-mode specific arguments:
-  while test "$#" -gt 0; do
+
+# Option defaults:
+opt_debug=:
+opt_dry_run=false
+opt_config=false
+opt_preserve_dup_deps=false
+opt_features=false
+opt_finish=false
+opt_help=false
+opt_help_all=false
+opt_silent=:
+opt_warning=:
+opt_verbose=:
+opt_silent=false
+opt_verbose=false
+
+
+# Parse options once, thoroughly.  This comes as soon as possible in the
+# script to make things like `--version' happen as quickly as we can.
+{
+  # this just eases exit handling
+  while test $# -gt 0; do
     opt="$1"
     shift
-
     case $opt in
-      --config)		func_config					;;
-
-      --debug)		preserve_args="$preserve_args $opt"
+      --debug|-x)	opt_debug='set -x'
 			func_echo "enabling shell trace mode"
-			opt_debug='set -x'
 			$opt_debug
 			;;
-
-      -dlopen)		test "$#" -eq 0 && func_missing_arg "$opt" && break
-			execute_dlfiles="$execute_dlfiles $1"
-			shift
+      --dry-run|--dryrun|-n)
+			opt_dry_run=:
 			;;
-
-      --dry-run | -n)	opt_dry_run=:					;;
-      --features)       func_features					;;
-      --finish)		mode="finish"					;;
-
-      --mode)		test "$#" -eq 0 && func_missing_arg "$opt" && break
-			case $1 in
-			  # Valid mode arguments:
-			  clean)	;;
-			  compile)	;;
-			  execute)	;;
-			  finish)	;;
-			  install)	;;
-			  link)		;;
-			  relink)	;;
-			  uninstall)	;;
-
-			  # Catch anything else as an error
-			  *) func_error "invalid argument for $opt"
-			     exit_cmd=exit
-			     break
-			     ;;
-		        esac
-
-			mode="$1"
+      --config)
+			opt_config=:
+func_config
+			;;
+      --dlopen|-dlopen)
+			optarg="$1"
+			opt_dlopen="${opt_dlopen+$opt_dlopen
+}$optarg"
 			shift
 			;;
-
       --preserve-dup-deps)
-			opt_duplicate_deps=:				;;
-
-      --quiet|--silent)	preserve_args="$preserve_args $opt"
-			opt_silent=:
+			opt_preserve_dup_deps=:
 			;;
-
-      --verbose| -v)	preserve_args="$preserve_args $opt"
+      --features)
+			opt_features=:
+func_features
+			;;
+      --finish)
+			opt_finish=:
+set dummy --mode finish ${1+"$@"}; shift
+			;;
+      --help)
+			opt_help=:
+			;;
+      --help-all)
+			opt_help_all=:
+opt_help=': help-all'
+			;;
+      --mode)
+			test $# = 0 && func_missing_arg $opt && break
+			optarg="$1"
+			opt_mode="$optarg"
+case $optarg in
+  # Valid mode arguments:
+  clean|compile|execute|finish|install|link|relink|uninstall) ;;
+
+  # Catch anything else as an error
+  *) func_error "invalid argument for $opt"
+     exit_cmd=exit
+     break
+     ;;
+esac
+			shift
+			;;
+      --no-silent|--no-quiet)
 			opt_silent=false
+func_append preserve_args " $opt"
 			;;
-
-      --tag)		test "$#" -eq 0 && func_missing_arg "$opt" && break
-			preserve_args="$preserve_args $opt $1"
-			func_enable_tag "$1"	# tagname is set here
+      --no-warning|--no-warn)
+			opt_warning=false
+func_append preserve_args " $opt"
+			;;
+      --no-verbose)
+			opt_verbose=false
+func_append preserve_args " $opt"
+			;;
+      --silent|--quiet)
+			opt_silent=:
+func_append preserve_args " $opt"
+        opt_verbose=false
+			;;
+      --verbose|-v)
+			opt_verbose=:
+func_append preserve_args " $opt"
+opt_silent=false
+			;;
+      --tag)
+			test $# = 0 && func_missing_arg $opt && break
+			optarg="$1"
+			opt_tag="$optarg"
+func_append preserve_args " $opt $optarg"
+func_enable_tag "$optarg"
 			shift
 			;;
 
+      -\?|-h)		func_usage				;;
+      --help)		func_help				;;
+      --version)	func_version				;;
+
       # Separate optargs to long options:
-      -dlopen=*|--mode=*|--tag=*)
-			func_opt_split "$opt"
-			set dummy "$func_opt_split_opt" "$func_opt_split_arg" ${1+"$@"}
+      --*=*)
+			func_split_long_opt "$opt"
+			set dummy "$func_split_long_opt_name" "$func_split_long_opt_arg" ${1+"$@"}
 			shift
 			;;
 
-      -\?|-h)		func_usage					;;
-      --help)		opt_help=:					;;
-      --version)	func_version					;;
-
-      -*)		func_fatal_help "unrecognized option \`$opt'"	;;
-
-      *)		nonopt="$opt"
-			break
+      # Separate non-argument short options:
+      -\?*|-h*|-n*|-v*)
+			func_split_short_opt "$opt"
+			set dummy "$func_split_short_opt_name" "-$func_split_short_opt_arg" ${1+"$@"}
+			shift
 			;;
+
+      --)		break					;;
+      -*)		func_fatal_help "unrecognized option \`$opt'" ;;
+      *)		set dummy "$opt" ${1+"$@"};	shift; break  ;;
     esac
   done
 
+  # Validate options:
+
+  # save first non-option argument
+  if test "$#" -gt 0; then
+    nonopt="$opt"
+    shift
+  fi
+
+  # preserve --debug
+  test "$opt_debug" = : || func_append preserve_args " --debug"
 
   case $host in
     *cygwin* | *mingw* | *pw32* | *cegcc*)
@@ -810,82 +1185,44 @@
       opt_duplicate_compiler_generated_deps=:
       ;;
     *)
-      opt_duplicate_compiler_generated_deps=$opt_duplicate_deps
+      opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
       ;;
   esac
 
-  # Having warned about all mis-specified options, bail out if
-  # anything was wrong.
-  $exit_cmd $EXIT_FAILURE
-}
+  $opt_help || {
+    # Sanity checks first:
+    func_check_version_match
 
-# func_check_version_match
-# Ensure that we are using m4 macros, and libtool script from the same
-# release of libtool.
-func_check_version_match ()
-{
-  if test "$package_revision" != "$macro_revision"; then
-    if test "$VERSION" != "$macro_version"; then
-      if test -z "$macro_version"; then
-        cat >&2 <<_LT_EOF
-$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
-$progname: definition of this LT_INIT comes from an older release.
-$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
-$progname: and run autoconf again.
-_LT_EOF
-      else
-        cat >&2 <<_LT_EOF
-$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
-$progname: definition of this LT_INIT comes from $PACKAGE $macro_version.
-$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
-$progname: and run autoconf again.
-_LT_EOF
-      fi
-    else
-      cat >&2 <<_LT_EOF
-$progname: Version mismatch error.  This is $PACKAGE $VERSION, revision $package_revision,
-$progname: but the definition of this LT_INIT comes from revision $macro_revision.
-$progname: You should recreate aclocal.m4 with macros from revision $package_revision
-$progname: of $PACKAGE $VERSION and run autoconf again.
-_LT_EOF
+    if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
+      func_fatal_configuration "not configured to build any kind of library"
     fi
 
-    exit $EXIT_MISMATCH
-  fi
-}
-
+    # Darwin sucks
+    eval std_shrext=\"$shrext_cmds\"
 
-## ----------- ##
-##    Main.    ##
-## ----------- ##
-
-$opt_help || {
-  # Sanity checks first:
-  func_check_version_match
-
-  if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
-    func_fatal_configuration "not configured to build any kind of library"
-  fi
+    # Only execute mode is allowed to have -dlopen flags.
+    if test -n "$opt_dlopen" && test "$opt_mode" != execute; then
+      func_error "unrecognized option \`-dlopen'"
+      $ECHO "$help" 1>&2
+      exit $EXIT_FAILURE
+    fi
 
-  test -z "$mode" && func_fatal_error "error: you must specify a MODE."
+    # Change the help message to a mode-specific one.
+    generic_help="$help"
+    help="Try \`$progname --help --mode=$opt_mode' for more information."
+  }
 
 
-  # Darwin sucks
-  eval std_shrext=\"$shrext_cmds\"
+  # Bail if the options were screwed
+  $exit_cmd $EXIT_FAILURE
+}
 
 
-  # Only execute mode is allowed to have -dlopen flags.
-  if test -n "$execute_dlfiles" && test "$mode" != execute; then
-    func_error "unrecognized option \`-dlopen'"
-    $ECHO "$help" 1>&2
-    exit $EXIT_FAILURE
-  fi
 
-  # Change the help message to a mode-specific one.
-  generic_help="$help"
-  help="Try \`$progname --help --mode=$mode' for more information."
-}
 
+## ----------- ##
+##    Main.    ##
+## ----------- ##
 
 # func_lalib_p file
 # True iff FILE is a libtool `.la' library or `.lo' object file.
@@ -950,12 +1287,9 @@
 # temporary ltwrapper_script.
 func_ltwrapper_scriptname ()
 {
-    func_ltwrapper_scriptname_result=""
-    if func_ltwrapper_executable_p "$1"; then
-	func_dirname_and_basename "$1" "" "."
-	func_stripname '' '.exe' "$func_basename_result"
-	func_ltwrapper_scriptname_result="$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper"
-    fi
+    func_dirname_and_basename "$1" "" "."
+    func_stripname '' '.exe' "$func_basename_result"
+    func_ltwrapper_scriptname_result="$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper"
 }
 
 # func_ltwrapper_p file
@@ -1001,6 +1335,37 @@
 }
 
 
+# func_resolve_sysroot PATH
+# Replace a leading = in PATH with a sysroot.  Store the result into
+# func_resolve_sysroot_result
+func_resolve_sysroot ()
+{
+  func_resolve_sysroot_result=$1
+  case $func_resolve_sysroot_result in
+  =*)
+    func_stripname '=' '' "$func_resolve_sysroot_result"
+    func_resolve_sysroot_result=$lt_sysroot$func_stripname_result
+    ;;
+  esac
+}
+
+# func_replace_sysroot PATH
+# If PATH begins with the sysroot, replace it with = and
+# store the result into func_replace_sysroot_result.
+func_replace_sysroot ()
+{
+  case "$lt_sysroot:$1" in
+  ?*:"$lt_sysroot"*)
+    func_stripname "$lt_sysroot" '' "$1"
+    func_replace_sysroot_result="=$func_stripname_result"
+    ;;
+  *)
+    # Including no sysroot.
+    func_replace_sysroot_result=$1
+    ;;
+  esac
+}
+
 # func_infer_tag arg
 # Infer tagged configuration to use if any are available and
 # if one wasn't chosen via the "--tag" command line option.
@@ -1013,13 +1378,15 @@
     if test -n "$available_tags" && test -z "$tagname"; then
       CC_quoted=
       for arg in $CC; do
-        func_quote_for_eval "$arg"
-	CC_quoted="$CC_quoted $func_quote_for_eval_result"
+	func_append_quoted CC_quoted "$arg"
       done
+      CC_expanded=`func_echo_all $CC`
+      CC_quoted_expanded=`func_echo_all $CC_quoted`
       case $@ in
       # Blanks in the command may have been stripped by the calling shell,
       # but not from the CC environment variable when configure was run.
-      " $CC "* | "$CC "* | " `$ECHO $CC` "* | "`$ECHO $CC` "* | " $CC_quoted"* | "$CC_quoted "* | " `$ECHO $CC_quoted` "* | "`$ECHO $CC_quoted` "*) ;;
+      " $CC "* | "$CC "* | " $CC_expanded "* | "$CC_expanded "* | \
+      " $CC_quoted"* | "$CC_quoted "* | " $CC_quoted_expanded "* | "$CC_quoted_expanded "*) ;;
       # Blanks at the start of $base_compile will cause this to fail
       # if we don't check for them as well.
       *)
@@ -1030,11 +1397,13 @@
 	    CC_quoted=
 	    for arg in $CC; do
 	      # Double-quote args containing other shell metacharacters.
-	      func_quote_for_eval "$arg"
-	      CC_quoted="$CC_quoted $func_quote_for_eval_result"
+	      func_append_quoted CC_quoted "$arg"
 	    done
+	    CC_expanded=`func_echo_all $CC`
+	    CC_quoted_expanded=`func_echo_all $CC_quoted`
 	    case "$@ " in
-	      " $CC "* | "$CC "* | " `$ECHO $CC` "* | "`$ECHO $CC` "* | " $CC_quoted"* | "$CC_quoted "* | " `$ECHO $CC_quoted` "* | "`$ECHO $CC_quoted` "*)
+	    " $CC "* | "$CC "* | " $CC_expanded "* | "$CC_expanded "* | \
+	    " $CC_quoted"* | "$CC_quoted "* | " $CC_quoted_expanded "* | "$CC_quoted_expanded "*)
 	      # The compiler in the base compile command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
@@ -1097,6 +1466,486 @@
     }
 }
 
+
+##################################################
+# FILE NAME AND PATH CONVERSION HELPER FUNCTIONS #
+##################################################
+
+# func_convert_core_file_wine_to_w32 ARG
+# Helper function used by file name conversion functions when $build is *nix,
+# and $host is mingw, cygwin, or some other w32 environment. Relies on a
+# correctly configured wine environment available, with the winepath program
+# in $build's $PATH.
+#
+# ARG is the $build file name to be converted to w32 format.
+# Result is available in $func_convert_core_file_wine_to_w32_result, and will
+# be empty on error (or when ARG is empty)
+func_convert_core_file_wine_to_w32 ()
+{
+  $opt_debug
+  func_convert_core_file_wine_to_w32_result="$1"
+  if test -n "$1"; then
+    # Unfortunately, winepath does not exit with a non-zero error code, so we
+    # are forced to check the contents of stdout. On the other hand, if the
+    # command is not found, the shell will set an exit code of 127 and print
+    # *an error message* to stdout. So we must check for both error code of
+    # zero AND non-empty stdout, which explains the odd construction:
+    func_convert_core_file_wine_to_w32_tmp=`winepath -w "$1" 2>/dev/null`
+    if test "$?" -eq 0 && test -n "${func_convert_core_file_wine_to_w32_tmp}"; then
+      func_convert_core_file_wine_to_w32_result=`$ECHO "$func_convert_core_file_wine_to_w32_tmp" |
+        $SED -e "$lt_sed_naive_backslashify"`
+    else
+      func_convert_core_file_wine_to_w32_result=
+    fi
+  fi
+}
+# end: func_convert_core_file_wine_to_w32
+
+
+# func_convert_core_path_wine_to_w32 ARG
+# Helper function used by path conversion functions when $build is *nix, and
+# $host is mingw, cygwin, or some other w32 environment. Relies on a correctly
+# configured wine environment available, with the winepath program in $build's
+# $PATH. Assumes ARG has no leading or trailing path separator characters.
+#
+# ARG is path to be converted from $build format to win32.
+# Result is available in $func_convert_core_path_wine_to_w32_result.
+# Unconvertible file (directory) names in ARG are skipped; if no directory names
+# are convertible, then the result may be empty.
+func_convert_core_path_wine_to_w32 ()
+{
+  $opt_debug
+  # unfortunately, winepath doesn't convert paths, only file names
+  func_convert_core_path_wine_to_w32_result=""
+  if test -n "$1"; then
+    oldIFS=$IFS
+    IFS=:
+    for func_convert_core_path_wine_to_w32_f in $1; do
+      IFS=$oldIFS
+      func_convert_core_file_wine_to_w32 "$func_convert_core_path_wine_to_w32_f"
+      if test -n "$func_convert_core_file_wine_to_w32_result" ; then
+        if test -z "$func_convert_core_path_wine_to_w32_result"; then
+          func_convert_core_path_wine_to_w32_result="$func_convert_core_file_wine_to_w32_result"
+        else
+          func_append func_convert_core_path_wine_to_w32_result ";$func_convert_core_file_wine_to_w32_result"
+        fi
+      fi
+    done
+    IFS=$oldIFS
+  fi
+}
+# end: func_convert_core_path_wine_to_w32
+
+
+# func_cygpath ARGS...
+# Wrapper around calling the cygpath program via LT_CYGPATH. This is used when
+# when (1) $build is *nix and Cygwin is hosted via a wine environment; or (2)
+# $build is MSYS and $host is Cygwin, or (3) $build is Cygwin. In case (1) or
+# (2), returns the Cygwin file name or path in func_cygpath_result (input
+# file name or path is assumed to be in w32 format, as previously converted
+# from $build's *nix or MSYS format). In case (3), returns the w32 file name
+# or path in func_cygpath_result (input file name or path is assumed to be in
+# Cygwin format). Returns an empty string on error.
+#
+# ARGS are passed to cygpath, with the last one being the file name or path to
+# be converted.
+#
+# Specify the absolute *nix (or w32) name to cygpath in the LT_CYGPATH
+# environment variable; do not put it in $PATH.
+func_cygpath ()
+{
+  $opt_debug
+  if test -n "$LT_CYGPATH" && test -f "$LT_CYGPATH"; then
+    func_cygpath_result=`$LT_CYGPATH "$@" 2>/dev/null`
+    if test "$?" -ne 0; then
+      # on failure, ensure result is empty
+      func_cygpath_result=
+    fi
+  else
+    func_cygpath_result=
+    func_error "LT_CYGPATH is empty or specifies non-existent file: \`$LT_CYGPATH'"
+  fi
+}
+#end: func_cygpath
+
+
+# func_convert_core_msys_to_w32 ARG
+# Convert file name or path ARG from MSYS format to w32 format.  Return
+# result in func_convert_core_msys_to_w32_result.
+func_convert_core_msys_to_w32 ()
+{
+  $opt_debug
+  # awkward: cmd appends spaces to result
+  func_convert_core_msys_to_w32_result=`( cmd //c echo "$1" ) 2>/dev/null |
+    $SED -e 's/[ ]*$//' -e "$lt_sed_naive_backslashify"`
+}
+#end: func_convert_core_msys_to_w32
+
+
+# func_convert_file_check ARG1 ARG2
+# Verify that ARG1 (a file name in $build format) was converted to $host
+# format in ARG2. Otherwise, emit an error message, but continue (resetting
+# func_to_host_file_result to ARG1).
+func_convert_file_check ()
+{
+  $opt_debug
+  if test -z "$2" && test -n "$1" ; then
+    func_error "Could not determine host file name corresponding to"
+    func_error "  \`$1'"
+    func_error "Continuing, but uninstalled executables may not work."
+    # Fallback:
+    func_to_host_file_result="$1"
+  fi
+}
+# end func_convert_file_check
+
+
+# func_convert_path_check FROM_PATHSEP TO_PATHSEP FROM_PATH TO_PATH
+# Verify that FROM_PATH (a path in $build format) was converted to $host
+# format in TO_PATH. Otherwise, emit an error message, but continue, resetting
+# func_to_host_file_result to a simplistic fallback value (see below).
+func_convert_path_check ()
+{
+  $opt_debug
+  if test -z "$4" && test -n "$3"; then
+    func_error "Could not determine the host path corresponding to"
+    func_error "  \`$3'"
+    func_error "Continuing, but uninstalled executables may not work."
+    # Fallback.  This is a deliberately simplistic "conversion" and
+    # should not be "improved".  See libtool.info.
+    if test "x$1" != "x$2"; then
+      lt_replace_pathsep_chars="s|$1|$2|g"
+      func_to_host_path_result=`echo "$3" |
+        $SED -e "$lt_replace_pathsep_chars"`
+    else
+      func_to_host_path_result="$3"
+    fi
+  fi
+}
+# end func_convert_path_check
+
+
+# func_convert_path_front_back_pathsep FRONTPAT BACKPAT REPL ORIG
+# Modifies func_to_host_path_result by prepending REPL if ORIG matches FRONTPAT
+# and appending REPL if ORIG matches BACKPAT.
+func_convert_path_front_back_pathsep ()
+{
+  $opt_debug
+  case $4 in
+  $1 ) func_to_host_path_result="$3$func_to_host_path_result"
+    ;;
+  esac
+  case $4 in
+  $2 ) func_append func_to_host_path_result "$3"
+    ;;
+  esac
+}
+# end func_convert_path_front_back_pathsep
+
+
+##################################################
+# $build to $host FILE NAME CONVERSION FUNCTIONS #
+##################################################
+# invoked via `$to_host_file_cmd ARG'
+#
+# In each case, ARG is the path to be converted from $build to $host format.
+# Result will be available in $func_to_host_file_result.
+
+
+# func_to_host_file ARG
+# Converts the file name ARG from $build format to $host format. Return result
+# in func_to_host_file_result.
+func_to_host_file ()
+{
+  $opt_debug
+  $to_host_file_cmd "$1"
+}
+# end func_to_host_file
+
+
+# func_to_tool_file ARG LAZY
+# converts the file name ARG from $build format to toolchain format. Return
+# result in func_to_tool_file_result.  If the conversion in use is listed
+# in (the comma separated) LAZY, no conversion takes place.
+func_to_tool_file ()
+{
+  $opt_debug
+  case ,$2, in
+    *,"$to_tool_file_cmd",*)
+      func_to_tool_file_result=$1
+      ;;
+    *)
+      $to_tool_file_cmd "$1"
+      func_to_tool_file_result=$func_to_host_file_result
+      ;;
+  esac
+}
+# end func_to_tool_file
+
+
+# func_convert_file_noop ARG
+# Copy ARG to func_to_host_file_result.
+func_convert_file_noop ()
+{
+  func_to_host_file_result="$1"
+}
+# end func_convert_file_noop
+
+
+# func_convert_file_msys_to_w32 ARG
+# Convert file name ARG from (mingw) MSYS to (mingw) w32 format; automatic
+# conversion to w32 is not available inside the cwrapper.  Returns result in
+# func_to_host_file_result.
+func_convert_file_msys_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    func_convert_core_msys_to_w32 "$1"
+    func_to_host_file_result="$func_convert_core_msys_to_w32_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_msys_to_w32
+
+
+# func_convert_file_cygwin_to_w32 ARG
+# Convert file name ARG from Cygwin to w32 format.  Returns result in
+# func_to_host_file_result.
+func_convert_file_cygwin_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    # because $build is cygwin, we call "the" cygpath in $PATH; no need to use
+    # LT_CYGPATH in this case.
+    func_to_host_file_result=`cygpath -m "$1"`
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_cygwin_to_w32
+
+
+# func_convert_file_nix_to_w32 ARG
+# Convert file name ARG from *nix to w32 format.  Requires a wine environment
+# and a working winepath. Returns result in func_to_host_file_result.
+func_convert_file_nix_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    func_convert_core_file_wine_to_w32 "$1"
+    func_to_host_file_result="$func_convert_core_file_wine_to_w32_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_nix_to_w32
+
+
+# func_convert_file_msys_to_cygwin ARG
+# Convert file name ARG from MSYS to Cygwin format.  Requires LT_CYGPATH set.
+# Returns result in func_to_host_file_result.
+func_convert_file_msys_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    func_convert_core_msys_to_w32 "$1"
+    func_cygpath -u "$func_convert_core_msys_to_w32_result"
+    func_to_host_file_result="$func_cygpath_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_msys_to_cygwin
+
+
+# func_convert_file_nix_to_cygwin ARG
+# Convert file name ARG from *nix to Cygwin format.  Requires Cygwin installed
+# in a wine environment, working winepath, and LT_CYGPATH set.  Returns result
+# in func_to_host_file_result.
+func_convert_file_nix_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_file_result="$1"
+  if test -n "$1"; then
+    # convert from *nix to w32, then use cygpath to convert from w32 to cygwin.
+    func_convert_core_file_wine_to_w32 "$1"
+    func_cygpath -u "$func_convert_core_file_wine_to_w32_result"
+    func_to_host_file_result="$func_cygpath_result"
+  fi
+  func_convert_file_check "$1" "$func_to_host_file_result"
+}
+# end func_convert_file_nix_to_cygwin
+
+
+#############################################
+# $build to $host PATH CONVERSION FUNCTIONS #
+#############################################
+# invoked via `$to_host_path_cmd ARG'
+#
+# In each case, ARG is the path to be converted from $build to $host format.
+# The result will be available in $func_to_host_path_result.
+#
+# Path separators are also converted from $build format to $host format.  If
+# ARG begins or ends with a path separator character, it is preserved (but
+# converted to $host format) on output.
+#
+# All path conversion functions are named using the following convention:
+#   file name conversion function    : func_convert_file_X_to_Y ()
+#   path conversion function         : func_convert_path_X_to_Y ()
+# where, for any given $build/$host combination the 'X_to_Y' value is the
+# same.  If conversion functions are added for new $build/$host combinations,
+# the two new functions must follow this pattern, or func_init_to_host_path_cmd
+# will break.
+
+
+# func_init_to_host_path_cmd
+# Ensures that function "pointer" variable $to_host_path_cmd is set to the
+# appropriate value, based on the value of $to_host_file_cmd.
+to_host_path_cmd=
+func_init_to_host_path_cmd ()
+{
+  $opt_debug
+  if test -z "$to_host_path_cmd"; then
+    func_stripname 'func_convert_file_' '' "$to_host_file_cmd"
+    to_host_path_cmd="func_convert_path_${func_stripname_result}"
+  fi
+}
+
+
+# func_to_host_path ARG
+# Converts the path ARG from $build format to $host format. Return result
+# in func_to_host_path_result.
+func_to_host_path ()
+{
+  $opt_debug
+  func_init_to_host_path_cmd
+  $to_host_path_cmd "$1"
+}
+# end func_to_host_path
+
+
+# func_convert_path_noop ARG
+# Copy ARG to func_to_host_path_result.
+func_convert_path_noop ()
+{
+  func_to_host_path_result="$1"
+}
+# end func_convert_path_noop
+
+
+# func_convert_path_msys_to_w32 ARG
+# Convert path ARG from (mingw) MSYS to (mingw) w32 format; automatic
+# conversion to w32 is not available inside the cwrapper.  Returns result in
+# func_to_host_path_result.
+func_convert_path_msys_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # Remove leading and trailing path separator characters from ARG.  MSYS
+    # behavior is inconsistent here; cygpath turns them into '.;' and ';.';
+    # and winepath ignores them completely.
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_msys_to_w32 "$func_to_host_path_tmp1"
+    func_to_host_path_result="$func_convert_core_msys_to_w32_result"
+    func_convert_path_check : ";" \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
+  fi
+}
+# end func_convert_path_msys_to_w32
+
+
+# func_convert_path_cygwin_to_w32 ARG
+# Convert path ARG from Cygwin to w32 format.  Returns result in
+# func_to_host_file_result.
+func_convert_path_cygwin_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_to_host_path_result=`cygpath -m -p "$func_to_host_path_tmp1"`
+    func_convert_path_check : ";" \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
+  fi
+}
+# end func_convert_path_cygwin_to_w32
+
+
+# func_convert_path_nix_to_w32 ARG
+# Convert path ARG from *nix to w32 format.  Requires a wine environment and
+# a working winepath.  Returns result in func_to_host_file_result.
+func_convert_path_nix_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_path_wine_to_w32 "$func_to_host_path_tmp1"
+    func_to_host_path_result="$func_convert_core_path_wine_to_w32_result"
+    func_convert_path_check : ";" \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
+  fi
+}
+# end func_convert_path_nix_to_w32
+
+
+# func_convert_path_msys_to_cygwin ARG
+# Convert path ARG from MSYS to Cygwin format.  Requires LT_CYGPATH set.
+# Returns result in func_to_host_file_result.
+func_convert_path_msys_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_msys_to_w32 "$func_to_host_path_tmp1"
+    func_cygpath -u -p "$func_convert_core_msys_to_w32_result"
+    func_to_host_path_result="$func_cygpath_result"
+    func_convert_path_check : : \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" : "$1"
+  fi
+}
+# end func_convert_path_msys_to_cygwin
+
+
+# func_convert_path_nix_to_cygwin ARG
+# Convert path ARG from *nix to Cygwin format.  Requires Cygwin installed in a
+# a wine environment, working winepath, and LT_CYGPATH set.  Returns result in
+# func_to_host_file_result.
+func_convert_path_nix_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_path_result="$1"
+  if test -n "$1"; then
+    # Remove leading and trailing path separator characters from
+    # ARG. msys behavior is inconsistent here, cygpath turns them
+    # into '.;' and ';.', and winepath ignores them completely.
+    func_stripname : : "$1"
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_path_wine_to_w32 "$func_to_host_path_tmp1"
+    func_cygpath -u -p "$func_convert_core_path_wine_to_w32_result"
+    func_to_host_path_result="$func_cygpath_result"
+    func_convert_path_check : : \
+      "$func_to_host_path_tmp1" "$func_to_host_path_result"
+    func_convert_path_front_back_pathsep ":*" "*:" : "$1"
+  fi
+}
+# end func_convert_path_nix_to_cygwin
+
+
 # func_mode_compile arg...
 func_mode_compile ()
 {
@@ -1137,12 +1986,12 @@
 	  ;;
 
 	-pie | -fpie | -fPIE)
-          pie_flag="$pie_flag $arg"
+          func_append pie_flag " $arg"
 	  continue
 	  ;;
 
 	-shared | -static | -prefer-pic | -prefer-non-pic)
-	  later="$later $arg"
+	  func_append later " $arg"
 	  continue
 	  ;;
 
@@ -1163,15 +2012,14 @@
 	  save_ifs="$IFS"; IFS=','
 	  for arg in $args; do
 	    IFS="$save_ifs"
-	    func_quote_for_eval "$arg"
-	    lastarg="$lastarg $func_quote_for_eval_result"
+	    func_append_quoted lastarg "$arg"
 	  done
 	  IFS="$save_ifs"
 	  func_stripname ' ' '' "$lastarg"
 	  lastarg=$func_stripname_result
 
 	  # Add the arguments to base_compile.
-	  base_compile="$base_compile $lastarg"
+	  func_append base_compile " $lastarg"
 	  continue
 	  ;;
 
@@ -1187,8 +2035,7 @@
       esac    #  case $arg_mode
 
       # Aesthetically quote the previous argument.
-      func_quote_for_eval "$lastarg"
-      base_compile="$base_compile $func_quote_for_eval_result"
+      func_append_quoted base_compile "$lastarg"
     done # for arg
 
     case $arg_mode in
@@ -1213,7 +2060,7 @@
     *.[cCFSifmso] | \
     *.ada | *.adb | *.ads | *.asm | \
     *.c++ | *.cc | *.ii | *.class | *.cpp | *.cxx | \
-    *.[fF][09]? | *.for | *.java | *.obj | *.sx)
+    *.[fF][09]? | *.for | *.java | *.go | *.obj | *.sx | *.cu | *.cup)
       func_xform "$libobj"
       libobj=$func_xform_result
       ;;
@@ -1288,7 +2135,7 @@
     # Calculate the filename of the output object if compiler does
     # not support -o with -c
     if test "$compiler_c_o" = no; then
-      output_obj=`$ECHO "X$srcfile" | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
+      output_obj=`$ECHO "$srcfile" | $SED 's%^.*/%%; s%\.[^.]*$%%'`.${objext}
       lockfile="$output_obj.lock"
     else
       output_obj=
@@ -1319,17 +2166,16 @@
 	$opt_dry_run || $RM $removelist
 	exit $EXIT_FAILURE
       fi
-      removelist="$removelist $output_obj"
+      func_append removelist " $output_obj"
       $ECHO "$srcfile" > "$lockfile"
     fi
 
     $opt_dry_run || $RM $removelist
-    removelist="$removelist $lockfile"
+    func_append removelist " $lockfile"
     trap '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE' 1 2 15
 
-    if test -n "$fix_srcfile_path"; then
-      eval srcfile=\"$fix_srcfile_path\"
-    fi
+    func_to_tool_file "$srcfile" func_convert_file_msys_to_w32
+    srcfile=$func_to_tool_file_result
     func_quote_for_eval "$srcfile"
     qsrcfile=$func_quote_for_eval_result
 
@@ -1349,7 +2195,7 @@
 
       if test -z "$output_obj"; then
 	# Place PIC objects in $objdir
-	command="$command -o $lobj"
+	func_append command " -o $lobj"
       fi
 
       func_show_eval_locale "$command"	\
@@ -1396,11 +2242,11 @@
 	command="$base_compile $qsrcfile $pic_flag"
       fi
       if test "$compiler_c_o" = yes; then
-	command="$command -o $obj"
+	func_append command " -o $obj"
       fi
 
       # Suppress compiler output if we already did a PIC compilation.
-      command="$command$suppress_output"
+      func_append command "$suppress_output"
       func_show_eval_locale "$command" \
         '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE'
 
@@ -1445,13 +2291,13 @@
 }
 
 $opt_help || {
-test "$mode" = compile && func_mode_compile ${1+"$@"}
+  test "$opt_mode" = compile && func_mode_compile ${1+"$@"}
 }
 
 func_mode_help ()
 {
     # We need to display help for each of the modes.
-    case $mode in
+    case $opt_mode in
       "")
         # Generic help is extracted from the usage comments
         # at the start of this file.
@@ -1482,10 +2328,11 @@
 
   -o OUTPUT-FILE    set the output file name to OUTPUT-FILE
   -no-suppress      do not suppress compiler output for multiple passes
-  -prefer-pic       try to building PIC objects only
-  -prefer-non-pic   try to building non-PIC objects only
+  -prefer-pic       try to build PIC objects only
+  -prefer-non-pic   try to build non-PIC objects only
   -shared           do not build a \`.o' file suitable for static linking
   -static           only build a \`.o' file suitable for static linking
+  -Wc,FLAG          pass FLAG directly to the compiler
 
 COMPILE-COMMAND is a command to be used in creating a \`standard' object file
 from the given SOURCEFILE.
@@ -1538,7 +2385,7 @@
 
 The following components of INSTALL-COMMAND are treated specially:
 
-  -inst-prefix PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
+  -inst-prefix-dir PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
 
 The rest of the components are interpreted as arguments to that command (only
 BSD-compatible install options are recognized)."
@@ -1558,6 +2405,8 @@
 
   -all-static       do not do any dynamic linking at all
   -avoid-version    do not add a version suffix if possible
+  -bindir BINDIR    specify path to binaries directory (for systems where
+                    libraries must be found in the PATH setting at runtime)
   -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
   -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
   -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
@@ -1586,6 +2435,11 @@
   -version-info CURRENT[:REVISION[:AGE]]
                     specify library version info [each variable defaults to 0]
   -weak LIBNAME     declare that the target provides the LIBNAME interface
+  -Wc,FLAG
+  -Xcompiler FLAG   pass linker-specific FLAG directly to the compiler
+  -Wl,FLAG
+  -Xlinker FLAG     pass linker-specific FLAG directly to the linker
+  -XCClinker FLAG   pass link-specific FLAG to the compiler driver (CC)
 
 All other options (arguments beginning with \`-') are ignored.
 
@@ -1619,18 +2473,44 @@
         ;;
 
       *)
-        func_fatal_help "invalid operation mode \`$mode'"
+        func_fatal_help "invalid operation mode \`$opt_mode'"
         ;;
     esac
 
-    $ECHO
+    echo
     $ECHO "Try \`$progname --help' for more information about other modes."
-
-    exit $?
 }
 
-  # Now that we've collected a possible --mode arg, show help if necessary
-  $opt_help && func_mode_help
+# Now that we've collected a possible --mode arg, show help if necessary
+if $opt_help; then
+  if test "$opt_help" = :; then
+    func_mode_help
+  else
+    {
+      func_help noexit
+      for opt_mode in compile link execute install finish uninstall clean; do
+	func_mode_help
+      done
+    } | sed -n '1p; 2,$s/^Usage:/  or: /p'
+    {
+      func_help noexit
+      for opt_mode in compile link execute install finish uninstall clean; do
+	echo
+	func_mode_help
+      done
+    } |
+    sed '1d
+      /^When reporting/,/^Report/{
+	H
+	d
+      }
+      $x
+      /information about other modes/d
+      /more detailed .*MODE/d
+      s/^Usage:.*--mode=\([^ ]*\) .*/Description of \1 mode:/'
+  fi
+  exit $?
+fi
 
 
 # func_mode_execute arg...
@@ -1643,13 +2523,16 @@
       func_fatal_help "you must specify a COMMAND"
 
     # Handle -dlopen flags immediately.
-    for file in $execute_dlfiles; do
+    for file in $opt_dlopen; do
       test -f "$file" \
 	|| func_fatal_help "\`$file' is not a file"
 
       dir=
       case $file in
       *.la)
+	func_resolve_sysroot "$file"
+	file=$func_resolve_sysroot_result
+
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$file" \
 	  || func_fatal_help "\`$lib' is not a valid libtool archive"
@@ -1671,7 +2554,7 @@
 	dir="$func_dirname_result"
 
 	if test -f "$dir/$objdir/$dlname"; then
-	  dir="$dir/$objdir"
+	  func_append dir "/$objdir"
 	else
 	  if test ! -f "$dir/$dlname"; then
 	    func_fatal_error "cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'"
@@ -1712,7 +2595,7 @@
     for file
     do
       case $file in
-      -*) ;;
+      -* | *.la | *.lo ) ;;
       *)
 	# Do a test to see if this is really a libtool program.
 	if func_ltwrapper_script_p "$file"; then
@@ -1728,8 +2611,7 @@
 	;;
       esac
       # Quote arguments (to preserve shell metacharacters).
-      func_quote_for_eval "$file"
-      args="$args $func_quote_for_eval_result"
+      func_append_quoted args "$file"
     done
 
     if test "X$opt_dry_run" = Xfalse; then
@@ -1754,29 +2636,66 @@
       # Display what would be done.
       if test -n "$shlibpath_var"; then
 	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
-	$ECHO "export $shlibpath_var"
+	echo "export $shlibpath_var"
       fi
       $ECHO "$cmd$args"
       exit $EXIT_SUCCESS
     fi
 }
 
-test "$mode" = execute && func_mode_execute ${1+"$@"}
+test "$opt_mode" = execute && func_mode_execute ${1+"$@"}
 
 
 # func_mode_finish arg...
 func_mode_finish ()
 {
     $opt_debug
-    libdirs="$nonopt"
+    libs=
+    libdirs=
     admincmds=
 
-    if test -n "$finish_cmds$finish_eval" && test -n "$libdirs"; then
-      for dir
-      do
-	libdirs="$libdirs $dir"
-      done
+    for opt in "$nonopt" ${1+"$@"}
+    do
+      if test -d "$opt"; then
+	func_append libdirs " $opt"
 
+      elif test -f "$opt"; then
+	if func_lalib_unsafe_p "$opt"; then
+	  func_append libs " $opt"
+	else
+	  func_warning "\`$opt' is not a valid libtool archive"
+	fi
+
+      else
+	func_fatal_error "invalid argument \`$opt'"
+      fi
+    done
+
+    if test -n "$libs"; then
+      if test -n "$lt_sysroot"; then
+        sysroot_regex=`$ECHO "$lt_sysroot" | $SED "$sed_make_literal_regex"`
+        sysroot_cmd="s/\([ ']\)$sysroot_regex/\1/g;"
+      else
+        sysroot_cmd=
+      fi
+
+      # Remove sysroot references
+      if $opt_dry_run; then
+        for lib in $libs; do
+          echo "removing references to $lt_sysroot and \`=' prefixes from $lib"
+        done
+      else
+        tmpdir=`func_mktempdir`
+        for lib in $libs; do
+	  sed -e "${sysroot_cmd} s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g" $lib \
+	    > $tmpdir/tmp-la
+	  mv -f $tmpdir/tmp-la $lib
+	done
+        ${RM}r "$tmpdir"
+      fi
+    fi
+
+    if test -n "$finish_cmds$finish_eval" && test -n "$libdirs"; then
       for libdir in $libdirs; do
 	if test -n "$finish_cmds"; then
 	  # Do each command in the finish commands.
@@ -1786,7 +2705,7 @@
 	if test -n "$finish_eval"; then
 	  # Do the single finish_eval.
 	  eval cmds=\"$finish_eval\"
-	  $opt_dry_run || eval "$cmds" || admincmds="$admincmds
+	  $opt_dry_run || eval "$cmds" || func_append admincmds "
        $cmds"
 	fi
       done
@@ -1795,53 +2714,55 @@
     # Exit here if they wanted silent mode.
     $opt_silent && exit $EXIT_SUCCESS
 
-    $ECHO "X----------------------------------------------------------------------" | $Xsed
-    $ECHO "Libraries have been installed in:"
-    for libdir in $libdirs; do
-      $ECHO "   $libdir"
-    done
-    $ECHO
-    $ECHO "If you ever happen to want to link against installed libraries"
-    $ECHO "in a given directory, LIBDIR, you must either use libtool, and"
-    $ECHO "specify the full pathname of the library, or use the \`-LLIBDIR'"
-    $ECHO "flag during linking and do at least one of the following:"
-    if test -n "$shlibpath_var"; then
-      $ECHO "   - add LIBDIR to the \`$shlibpath_var' environment variable"
-      $ECHO "     during execution"
-    fi
-    if test -n "$runpath_var"; then
-      $ECHO "   - add LIBDIR to the \`$runpath_var' environment variable"
-      $ECHO "     during linking"
-    fi
-    if test -n "$hardcode_libdir_flag_spec"; then
-      libdir=LIBDIR
-      eval flag=\"$hardcode_libdir_flag_spec\"
+    if test -n "$finish_cmds$finish_eval" && test -n "$libdirs"; then
+      echo "----------------------------------------------------------------------"
+      echo "Libraries have been installed in:"
+      for libdir in $libdirs; do
+	$ECHO "   $libdir"
+      done
+      echo
+      echo "If you ever happen to want to link against installed libraries"
+      echo "in a given directory, LIBDIR, you must either use libtool, and"
+      echo "specify the full pathname of the library, or use the \`-LLIBDIR'"
+      echo "flag during linking and do at least one of the following:"
+      if test -n "$shlibpath_var"; then
+	echo "   - add LIBDIR to the \`$shlibpath_var' environment variable"
+	echo "     during execution"
+      fi
+      if test -n "$runpath_var"; then
+	echo "   - add LIBDIR to the \`$runpath_var' environment variable"
+	echo "     during linking"
+      fi
+      if test -n "$hardcode_libdir_flag_spec"; then
+	libdir=LIBDIR
+	eval flag=\"$hardcode_libdir_flag_spec\"
 
-      $ECHO "   - use the \`$flag' linker flag"
-    fi
-    if test -n "$admincmds"; then
-      $ECHO "   - have your system administrator run these commands:$admincmds"
-    fi
-    if test -f /etc/ld.so.conf; then
-      $ECHO "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
-    fi
-    $ECHO
+	$ECHO "   - use the \`$flag' linker flag"
+      fi
+      if test -n "$admincmds"; then
+	$ECHO "   - have your system administrator run these commands:$admincmds"
+      fi
+      if test -f /etc/ld.so.conf; then
+	echo "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
+      fi
+      echo
 
-    $ECHO "See any operating system documentation about shared libraries for"
-    case $host in
-      solaris2.[6789]|solaris2.1[0-9])
-        $ECHO "more information, such as the ld(1), crle(1) and ld.so(8) manual"
-	$ECHO "pages."
-	;;
-      *)
-        $ECHO "more information, such as the ld(1) and ld.so(8) manual pages."
-        ;;
-    esac
-    $ECHO "X----------------------------------------------------------------------" | $Xsed
+      echo "See any operating system documentation about shared libraries for"
+      case $host in
+	solaris2.[6789]|solaris2.1[0-9])
+	  echo "more information, such as the ld(1), crle(1) and ld.so(8) manual"
+	  echo "pages."
+	  ;;
+	*)
+	  echo "more information, such as the ld(1) and ld.so(8) manual pages."
+	  ;;
+      esac
+      echo "----------------------------------------------------------------------"
+    fi
     exit $EXIT_SUCCESS
 }
 
-test "$mode" = finish && func_mode_finish ${1+"$@"}
+test "$opt_mode" = finish && func_mode_finish ${1+"$@"}
 
 
 # func_mode_install arg...
@@ -1852,7 +2773,7 @@
     # install_prog (especially on Windows NT).
     if test "$nonopt" = "$SHELL" || test "$nonopt" = /bin/sh ||
        # Allow the use of GNU shtool's install command.
-       $ECHO "X$nonopt" | $GREP shtool >/dev/null; then
+       case $nonopt in *shtool*) :;; *) false;; esac; then
       # Aesthetically quote it.
       func_quote_for_eval "$nonopt"
       install_prog="$func_quote_for_eval_result "
@@ -1866,7 +2787,12 @@
     # The real first argument should be the name of the installation program.
     # Aesthetically quote it.
     func_quote_for_eval "$arg"
-    install_prog="$install_prog$func_quote_for_eval_result"
+    func_append install_prog "$func_quote_for_eval_result"
+    install_shared_prog=$install_prog
+    case " $install_prog " in
+      *[\\\ /]cp\ *) install_cp=: ;;
+      *) install_cp=false ;;
+    esac
 
     # We need to accept at least all the BSD install flags.
     dest=
@@ -1876,10 +2802,12 @@
     install_type=
     isdir=no
     stripme=
+    no_mode=:
     for arg
     do
+      arg2=
       if test -n "$dest"; then
-	files="$files $dest"
+	func_append files " $dest"
 	dest=$arg
 	continue
       fi
@@ -1887,10 +2815,9 @@
       case $arg in
       -d) isdir=yes ;;
       -f)
-	case " $install_prog " in
-	*[\\\ /]cp\ *) ;;
-	*) prev=$arg ;;
-	esac
+	if $install_cp; then :; else
+	  prev=$arg
+	fi
 	;;
       -g | -m | -o)
 	prev=$arg
@@ -1904,6 +2831,10 @@
       *)
 	# If the previous option needed an argument, then skip it.
 	if test -n "$prev"; then
+	  if test "x$prev" = x-m && test -n "$install_override_mode"; then
+	    arg2=$install_override_mode
+	    no_mode=false
+	  fi
 	  prev=
 	else
 	  dest=$arg
@@ -1914,7 +2845,11 @@
 
       # Aesthetically quote the argument.
       func_quote_for_eval "$arg"
-      install_prog="$install_prog $func_quote_for_eval_result"
+      func_append install_prog " $func_quote_for_eval_result"
+      if test -n "$arg2"; then
+	func_quote_for_eval "$arg2"
+      fi
+      func_append install_shared_prog " $func_quote_for_eval_result"
     done
 
     test -z "$install_prog" && \
@@ -1923,6 +2858,13 @@
     test -n "$prev" && \
       func_fatal_help "the \`$prev' option requires an argument"
 
+    if test -n "$install_override_mode" && $no_mode; then
+      if $install_cp; then :; else
+	func_quote_for_eval "$install_override_mode"
+	func_append install_shared_prog " -m $func_quote_for_eval_result"
+      fi
+    fi
+
     if test -z "$files"; then
       if test -z "$dest"; then
 	func_fatal_help "no file or destination specified"
@@ -1977,10 +2919,13 @@
       case $file in
       *.$libext)
 	# Do the static libraries later.
-	staticlibs="$staticlibs $file"
+	func_append staticlibs " $file"
 	;;
 
       *.la)
+	func_resolve_sysroot "$file"
+	file=$func_resolve_sysroot_result
+
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$file" \
 	  || func_fatal_help "\`$file' is not a valid libtool archive"
@@ -1994,23 +2939,23 @@
 	if test "X$destdir" = "X$libdir"; then
 	  case "$current_libdirs " in
 	  *" $libdir "*) ;;
-	  *) current_libdirs="$current_libdirs $libdir" ;;
+	  *) func_append current_libdirs " $libdir" ;;
 	  esac
 	else
 	  # Note the libdir as a future libdir.
 	  case "$future_libdirs " in
 	  *" $libdir "*) ;;
-	  *) future_libdirs="$future_libdirs $libdir" ;;
+	  *) func_append future_libdirs " $libdir" ;;
 	  esac
 	fi
 
 	func_dirname "$file" "/" ""
 	dir="$func_dirname_result"
-	dir="$dir$objdir"
+	func_append dir "$objdir"
 
 	if test -n "$relink_command"; then
 	  # Determine the prefix the user has applied to our future dir.
-	  inst_prefix_dir=`$ECHO "X$destdir" | $Xsed -e "s%$libdir\$%%"`
+	  inst_prefix_dir=`$ECHO "$destdir" | $SED -e "s%$libdir\$%%"`
 
 	  # Don't allow the user to place us outside of our expected
 	  # location b/c this prevents finding dependent libraries that
@@ -2023,9 +2968,9 @@
 
 	  if test -n "$inst_prefix_dir"; then
 	    # Stick the inst_prefix_dir data into the link command.
-	    relink_command=`$ECHO "X$relink_command" | $Xsed -e "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`
+	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`
 	  else
-	    relink_command=`$ECHO "X$relink_command" | $Xsed -e "s%@inst_prefix_dir@%%"`
+	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%%"`
 	  fi
 
 	  func_warning "relinking \`$file'"
@@ -2043,7 +2988,7 @@
 	  test -n "$relink_command" && srcname="$realname"T
 
 	  # Install the shared library and build the symlinks.
-	  func_show_eval "$install_prog $dir/$srcname $destdir/$realname" \
+	  func_show_eval "$install_shared_prog $dir/$srcname $destdir/$realname" \
 	      'exit $?'
 	  tstripme="$stripme"
 	  case $host_os in
@@ -2083,7 +3028,7 @@
 	func_show_eval "$install_prog $instname $destdir/$name" 'exit $?'
 
 	# Maybe install the static library, too.
-	test -n "$old_library" && staticlibs="$staticlibs $dir/$old_library"
+	test -n "$old_library" && func_append staticlibs " $dir/$old_library"
 	;;
 
       *.lo)
@@ -2183,7 +3128,7 @@
 	    if test -f "$lib"; then
 	      func_source "$lib"
 	    fi
-	    libfile="$libdir/"`$ECHO "X$lib" | $Xsed -e 's%^.*/%%g'` ### testsuite: skip nested quoting test
+	    libfile="$libdir/"`$ECHO "$lib" | $SED 's%^.*/%%g'` ### testsuite: skip nested quoting test
 	    if test -n "$libdir" && test ! -f "$libfile"; then
 	      func_warning "\`$lib' has not been installed in \`$libdir'"
 	      finalize=no
@@ -2202,7 +3147,7 @@
 		file="$func_basename_result"
 	        outputname="$tmpdir/$file"
 	        # Replace the output file specification.
-	        relink_command=`$ECHO "X$relink_command" | $Xsed -e 's%@OUTPUT@%'"$outputname"'%g'`
+	        relink_command=`$ECHO "$relink_command" | $SED 's%@OUTPUT@%'"$outputname"'%g'`
 
 	        $opt_silent || {
 	          func_quote_for_expand "$relink_command"
@@ -2221,7 +3166,7 @@
 	    }
 	  else
 	    # Install the binary that we compiled earlier.
-	    file=`$ECHO "X$file$stripped_ext" | $Xsed -e "s%\([^/]*\)$%$objdir/\1%"`
+	    file=`$ECHO "$file$stripped_ext" | $SED "s%\([^/]*\)$%$objdir/\1%"`
 	  fi
 	fi
 
@@ -2257,11 +3202,13 @@
 
       # Set up the ranlib parameters.
       oldlib="$destdir/$name"
+      func_to_tool_file "$oldlib" func_convert_file_msys_to_w32
+      tool_oldlib=$func_to_tool_file_result
 
       func_show_eval "$install_prog \$file \$oldlib" 'exit $?'
 
       if test -n "$stripme" && test -n "$old_striplib"; then
-	func_show_eval "$old_striplib $oldlib" 'exit $?'
+	func_show_eval "$old_striplib $tool_oldlib" 'exit $?'
       fi
 
       # Do each command in the postinstall commands.
@@ -2280,7 +3227,7 @@
     fi
 }
 
-test "$mode" = install && func_mode_install ${1+"$@"}
+test "$opt_mode" = install && func_mode_install ${1+"$@"}
 
 
 # func_generate_dlsyms outputname originator pic_p
@@ -2323,6 +3270,22 @@
 extern \"C\" {
 #endif
 
+#if defined(__GNUC__) && (((__GNUC__ == 4) && (__GNUC_MINOR__ >= 4)) || (__GNUC__ > 4))
+#pragma GCC diagnostic ignored \"-Wstrict-prototypes\"
+#endif
+
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT_DLSYM_CONST
+#else
+# define LT_DLSYM_CONST const
+#endif
+
 /* External symbol declarations for the compiler. */\
 "
 
@@ -2332,10 +3295,11 @@
 	  $opt_dry_run || echo ': @PROGRAM@ ' > "$nlist"
 
 	  # Add our own program objects to the symbol list.
-	  progfiles=`$ECHO "X$objs$old_deplibs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	  progfiles=`$ECHO "$objs$old_deplibs" | $SP2NL | $SED "$lo2o" | $NL2SP`
 	  for progfile in $progfiles; do
-	    func_verbose "extracting global C symbols from \`$progfile'"
-	    $opt_dry_run || eval "$NM $progfile | $global_symbol_pipe >> '$nlist'"
+	    func_to_tool_file "$progfile" func_convert_file_msys_to_w32
+	    func_verbose "extracting global C symbols from \`$func_to_tool_file_result'"
+	    $opt_dry_run || eval "$NM $func_to_tool_file_result | $global_symbol_pipe >> '$nlist'"
 	  done
 
 	  if test -n "$exclude_expsyms"; then
@@ -2371,7 +3335,7 @@
 	      eval '$GREP -f "$output_objdir/$outputname.exp" < "$nlist" > "$nlist"T'
 	      eval '$MV "$nlist"T "$nlist"'
 	      case $host in
-	        *cygwin | *mingw* | *cegcc* )
+	        *cygwin* | *mingw* | *cegcc* )
 	          eval "echo EXPORTS "'> "$output_objdir/$outputname.def"'
 	          eval 'cat "$nlist" >> "$output_objdir/$outputname.def"'
 	          ;;
@@ -2384,10 +3348,52 @@
 	  func_verbose "extracting global C symbols from \`$dlprefile'"
 	  func_basename "$dlprefile"
 	  name="$func_basename_result"
-	  $opt_dry_run || {
-	    eval '$ECHO ": $name " >> "$nlist"'
-	    eval "$NM $dlprefile 2>/dev/null | $global_symbol_pipe >> '$nlist'"
-	  }
+          case $host in
+	    *cygwin* | *mingw* | *cegcc* )
+	      # if an import library, we need to obtain dlname
+	      if func_win32_import_lib_p "$dlprefile"; then
+	        func_tr_sh "$dlprefile"
+	        eval "curr_lafile=\$libfile_$func_tr_sh_result"
+	        dlprefile_dlbasename=""
+	        if test -n "$curr_lafile" && func_lalib_p "$curr_lafile"; then
+	          # Use subshell, to avoid clobbering current variable values
+	          dlprefile_dlname=`source "$curr_lafile" && echo "$dlname"`
+	          if test -n "$dlprefile_dlname" ; then
+	            func_basename "$dlprefile_dlname"
+	            dlprefile_dlbasename="$func_basename_result"
+	          else
+	            # no lafile. user explicitly requested -dlpreopen <import library>.
+	            $sharedlib_from_linklib_cmd "$dlprefile"
+	            dlprefile_dlbasename=$sharedlib_from_linklib_result
+	          fi
+	        fi
+	        $opt_dry_run || {
+	          if test -n "$dlprefile_dlbasename" ; then
+	            eval '$ECHO ": $dlprefile_dlbasename" >> "$nlist"'
+	          else
+	            func_warning "Could not compute DLL name from $name"
+	            eval '$ECHO ": $name " >> "$nlist"'
+	          fi
+	          func_to_tool_file "$dlprefile" func_convert_file_msys_to_w32
+	          eval "$NM \"$func_to_tool_file_result\" 2>/dev/null | $global_symbol_pipe |
+	            $SED -e '/I __imp/d' -e 's/I __nm_/D /;s/_nm__//' >> '$nlist'"
+	        }
+	      else # not an import lib
+	        $opt_dry_run || {
+	          eval '$ECHO ": $name " >> "$nlist"'
+	          func_to_tool_file "$dlprefile" func_convert_file_msys_to_w32
+	          eval "$NM \"$func_to_tool_file_result\" 2>/dev/null | $global_symbol_pipe >> '$nlist'"
+	        }
+	      fi
+	    ;;
+	    *)
+	      $opt_dry_run || {
+	        eval '$ECHO ": $name " >> "$nlist"'
+	        func_to_tool_file "$dlprefile" func_convert_file_msys_to_w32
+	        eval "$NM \"$func_to_tool_file_result\" 2>/dev/null | $global_symbol_pipe >> '$nlist'"
+	      }
+	    ;;
+          esac
 	done
 
 	$opt_dry_run || {
@@ -2415,36 +3421,19 @@
 	  if test -f "$nlist"S; then
 	    eval "$global_symbol_to_cdecl"' < "$nlist"S >> "$output_objdir/$my_dlsyms"'
 	  else
-	    $ECHO '/* NONE */' >> "$output_objdir/$my_dlsyms"
+	    echo '/* NONE */' >> "$output_objdir/$my_dlsyms"
 	  fi
 
-	  $ECHO >> "$output_objdir/$my_dlsyms" "\
+	  echo >> "$output_objdir/$my_dlsyms" "\
 
 /* The mapping between symbol names and symbols.  */
 typedef struct {
   const char *name;
   void *address;
 } lt_dlsymlist;
-"
-	  case $host in
-	  *cygwin* | *mingw* | *cegcc* )
-	    $ECHO >> "$output_objdir/$my_dlsyms" "\
-/* DATA imports from DLLs on WIN32 con't be const, because
-   runtime relocations are performed -- see ld's documentation
-   on pseudo-relocs.  */"
-	    lt_dlsym_const= ;;
-	  *osf5*)
-	    echo >> "$output_objdir/$my_dlsyms" "\
-/* This system does not cope well with relocations in const data */"
-	    lt_dlsym_const= ;;
-	  *)
-	    lt_dlsym_const=const ;;
-	  esac
-
-	  $ECHO >> "$output_objdir/$my_dlsyms" "\
-extern $lt_dlsym_const lt_dlsymlist
+extern LT_DLSYM_CONST lt_dlsymlist
 lt_${my_prefix}_LTX_preloaded_symbols[];
-$lt_dlsym_const lt_dlsymlist
+LT_DLSYM_CONST lt_dlsymlist
 lt_${my_prefix}_LTX_preloaded_symbols[] =
 {\
   { \"$my_originator\", (void *) 0 },"
@@ -2457,7 +3446,7 @@
 	    eval "$global_symbol_to_c_name_address_lib_prefix" < "$nlist" >> "$output_objdir/$my_dlsyms"
 	    ;;
 	  esac
-	  $ECHO >> "$output_objdir/$my_dlsyms" "\
+	  echo >> "$output_objdir/$my_dlsyms" "\
   {0, (void *) 0}
 };
 
@@ -2484,7 +3473,7 @@
 	  # linked before any other PIC object.  But we must not use
 	  # pic_flag when linking with -static.  The problem exists in
 	  # FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
-	  *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
+	  *-*-freebsd2.*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
 	    pic_flag_for_symtable=" $pic_flag -DFREEBSD_WORKAROUND" ;;
 	  *-*-hpux*)
 	    pic_flag_for_symtable=" $pic_flag"  ;;
@@ -2500,7 +3489,7 @@
 	for arg in $LTCFLAGS; do
 	  case $arg in
 	  -pie | -fpie | -fPIE) ;;
-	  *) symtab_cflags="$symtab_cflags $arg" ;;
+	  *) func_append symtab_cflags " $arg" ;;
 	  esac
 	done
 
@@ -2515,16 +3504,16 @@
 	case $host in
 	*cygwin* | *mingw* | *cegcc* )
 	  if test -f "$output_objdir/$my_outputname.def"; then
-	    compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
-	    finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
+	    compile_command=`$ECHO "$compile_command" | $SED "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
+	    finalize_command=`$ECHO "$finalize_command" | $SED "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`
 	  else
-	    compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
-	    finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
+	    compile_command=`$ECHO "$compile_command" | $SED "s%@SYMFILE@%$symfileobj%"`
+	    finalize_command=`$ECHO "$finalize_command" | $SED "s%@SYMFILE@%$symfileobj%"`
 	  fi
 	  ;;
 	*)
-	  compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
-	  finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$symfileobj%"`
+	  compile_command=`$ECHO "$compile_command" | $SED "s%@SYMFILE@%$symfileobj%"`
+	  finalize_command=`$ECHO "$finalize_command" | $SED "s%@SYMFILE@%$symfileobj%"`
 	  ;;
 	esac
 	;;
@@ -2538,8 +3527,8 @@
       # really was required.
 
       # Nullify the symbol file.
-      compile_command=`$ECHO "X$compile_command" | $Xsed -e "s% @SYMFILE@%%"`
-      finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s% @SYMFILE@%%"`
+      compile_command=`$ECHO "$compile_command" | $SED "s% @SYMFILE@%%"`
+      finalize_command=`$ECHO "$finalize_command" | $SED "s% @SYMFILE@%%"`
     fi
 }
 
@@ -2549,6 +3538,7 @@
 # Need a lot of goo to handle *both* DLLs and import libs
 # Has to be a shell function in order to 'eat' the argument
 # that is supplied when $file_magic_command is called.
+# Despite the name, also deal with 64 bit binaries.
 func_win32_libid ()
 {
   $opt_debug
@@ -2559,9 +3549,11 @@
     win32_libid_type="x86 archive import"
     ;;
   *ar\ archive*) # could be an import, or static
+    # Keep the egrep pattern in sync with the one in _LT_CHECK_MAGIC_METHOD.
     if eval $OBJDUMP -f $1 | $SED -e '10q' 2>/dev/null |
-       $EGREP 'file format pe-i386(.*architecture: i386)?' >/dev/null ; then
-      win32_nmres=`eval $NM -f posix -A $1 |
+       $EGREP 'file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)' >/dev/null; then
+      func_to_tool_file "$1" func_convert_file_msys_to_w32
+      win32_nmres=`eval $NM -f posix -A \"$func_to_tool_file_result\" |
 	$SED -n -e '
 	    1,100{
 		/ I /{
@@ -2590,6 +3582,131 @@
   $ECHO "$win32_libid_type"
 }
 
+# func_cygming_dll_for_implib ARG
+#
+# Platform-specific function to extract the
+# name of the DLL associated with the specified
+# import library ARG.
+# Invoked by eval'ing the libtool variable
+#    $sharedlib_from_linklib_cmd
+# Result is available in the variable
+#    $sharedlib_from_linklib_result
+func_cygming_dll_for_implib ()
+{
+  $opt_debug
+  sharedlib_from_linklib_result=`$DLLTOOL --identify-strict --identify "$1"`
+}
+
+# func_cygming_dll_for_implib_fallback_core SECTION_NAME LIBNAMEs
+#
+# The is the core of a fallback implementation of a
+# platform-specific function to extract the name of the
+# DLL associated with the specified import library LIBNAME.
+#
+# SECTION_NAME is either .idata$6 or .idata$7, depending
+# on the platform and compiler that created the implib.
+#
+# Echos the name of the DLL associated with the
+# specified import library.
+func_cygming_dll_for_implib_fallback_core ()
+{
+  $opt_debug
+  match_literal=`$ECHO "$1" | $SED "$sed_make_literal_regex"`
+  $OBJDUMP -s --section "$1" "$2" 2>/dev/null |
+    $SED '/^Contents of section '"$match_literal"':/{
+      # Place marker at beginning of archive member dllname section
+      s/.*/====MARK====/
+      p
+      d
+    }
+    # These lines can sometimes be longer than 43 characters, but
+    # are always uninteresting
+    /:[	 ]*file format pe[i]\{,1\}-/d
+    /^In archive [^:]*:/d
+    # Ensure marker is printed
+    /^====MARK====/p
+    # Remove all lines with less than 43 characters
+    /^.\{43\}/!d
+    # From remaining lines, remove first 43 characters
+    s/^.\{43\}//' |
+    $SED -n '
+      # Join marker and all lines until next marker into a single line
+      /^====MARK====/ b para
+      H
+      $ b para
+      b
+      :para
+      x
+      s/\n//g
+      # Remove the marker
+      s/^====MARK====//
+      # Remove trailing dots and whitespace
+      s/[\. \t]*$//
+      # Print
+      /./p' |
+    # we now have a list, one entry per line, of the stringified
+    # contents of the appropriate section of all members of the
+    # archive which possess that section. Heuristic: eliminate
+    # all those which have a first or second character that is
+    # a '.' (that is, objdump's representation of an unprintable
+    # character.) This should work for all archives with less than
+    # 0x302f exports -- but will fail for DLLs whose name actually
+    # begins with a literal '.' or a single character followed by
+    # a '.'.
+    #
+    # Of those that remain, print the first one.
+    $SED -e '/^\./d;/^.\./d;q'
+}
+
+# func_cygming_gnu_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is a GNU/binutils-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_gnu_implib_p ()
+{
+  $opt_debug
+  func_to_tool_file "$1" func_convert_file_msys_to_w32
+  func_cygming_gnu_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
+  test -n "$func_cygming_gnu_implib_tmp"
+}
+
+# func_cygming_ms_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is an MS-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_ms_implib_p ()
+{
+  $opt_debug
+  func_to_tool_file "$1" func_convert_file_msys_to_w32
+  func_cygming_ms_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $GREP '_NULL_IMPORT_DESCRIPTOR'`
+  test -n "$func_cygming_ms_implib_tmp"
+}
+
+# func_cygming_dll_for_implib_fallback ARG
+# Platform-specific function to extract the
+# name of the DLL associated with the specified
+# import library ARG.
+#
+# This fallback implementation is for use when $DLLTOOL
+# does not support the --identify-strict option.
+# Invoked by eval'ing the libtool variable
+#    $sharedlib_from_linklib_cmd
+# Result is available in the variable
+#    $sharedlib_from_linklib_result
+func_cygming_dll_for_implib_fallback ()
+{
+  $opt_debug
+  if func_cygming_gnu_implib_p "$1" ; then
+    # binutils import library
+    sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$7' "$1"`
+  elif func_cygming_ms_implib_p "$1" ; then
+    # ms-generated import library
+    sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$6' "$1"`
+  else
+    # unknown
+    sharedlib_from_linklib_result=""
+  fi
+}
 
 
 # func_extract_an_archive dir oldlib
@@ -2598,7 +3715,18 @@
     $opt_debug
     f_ex_an_ar_dir="$1"; shift
     f_ex_an_ar_oldlib="$1"
-    func_show_eval "(cd \$f_ex_an_ar_dir && $AR x \"\$f_ex_an_ar_oldlib\")" 'exit $?'
+    if test "$lock_old_archive_extraction" = yes; then
+      lockfile=$f_ex_an_ar_oldlib.lock
+      until $opt_dry_run || ln "$progpath" "$lockfile" 2>/dev/null; do
+	func_echo "Waiting for $lockfile to be removed"
+	sleep 2
+      done
+    fi
+    func_show_eval "(cd \$f_ex_an_ar_dir && $AR x \"\$f_ex_an_ar_oldlib\")" \
+		   'stat=$?; rm -f "$lockfile"; exit $stat'
+    if test "$lock_old_archive_extraction" = yes; then
+      $opt_dry_run || rm -f "$lockfile"
+    fi
     if ($AR t "$f_ex_an_ar_oldlib" | sort | sort -uc >/dev/null 2>&1); then
      :
     else
@@ -2669,7 +3797,7 @@
 	    darwin_file=
 	    darwin_files=
 	    for darwin_file in $darwin_filelist; do
-	      darwin_files=`find unfat-$$ -name $darwin_file -print | $NL2SP`
+	      darwin_files=`find unfat-$$ -name $darwin_file -print | sort | $NL2SP`
 	      $LIPO -create -output "$darwin_file" $darwin_files
 	    done # $darwin_filelist
 	    $RM -rf unfat-$$
@@ -2684,25 +3812,30 @@
         func_extract_an_archive "$my_xdir" "$my_xabs"
 	;;
       esac
-      my_oldobjs="$my_oldobjs "`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
+      my_oldobjs="$my_oldobjs "`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | sort | $NL2SP`
     done
 
     func_extract_archives_result="$my_oldobjs"
 }
 
 
-
-# func_emit_wrapper_part1 [arg=no]
+# func_emit_wrapper [arg=no]
 #
-# Emit the first part of a libtool wrapper script on stdout.
-# For more information, see the description associated with
-# func_emit_wrapper(), below.
-func_emit_wrapper_part1 ()
-{
-	func_emit_wrapper_part1_arg1=no
-	if test -n "$1" ; then
-	  func_emit_wrapper_part1_arg1=$1
-	fi
+# Emit a libtool wrapper script on stdout.
+# Don't directly open a file because we may want to
+# incorporate the script contents within a cygwin/mingw
+# wrapper executable.  Must ONLY be called from within
+# func_mode_link because it depends on a number of variables
+# set therein.
+#
+# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
+# variable will take.  If 'yes', then the emitted script
+# will assume that the directory in which it is stored is
+# the $objdir directory.  This is a cygwin/mingw-specific
+# behavior.
+func_emit_wrapper ()
+{
+	func_emit_wrapper_arg1=${1-no}
 
 	$ECHO "\
 #! $SHELL
@@ -2718,7 +3851,6 @@
 
 # Sed substitution that helps us do robust quoting.  It backslashifies
 # metacharacters that are still active within double-quoted strings.
-Xsed='${SED} -e 1s/^X//'
 sed_quote_subst='$sed_quote_subst'
 
 # Be Bourne compatible
@@ -2749,31 +3881,135 @@
 else
   # When we are sourced in execute mode, \$file and \$ECHO are already set.
   if test \"\$libtool_execute_magic\" != \"$magic\"; then
-    ECHO=\"$qecho\"
-    file=\"\$0\"
-    # Make sure echo works.
-    if test \"X\$1\" = X--no-reexec; then
-      # Discard the --no-reexec flag, and continue.
-      shift
-    elif test \"X\`{ \$ECHO '\t'; } 2>/dev/null\`\" = 'X\t'; then
-      # Yippee, \$ECHO works!
-      :
-    else
-      # Restart under the correct shell, and then maybe \$ECHO will work.
-      exec $SHELL \"\$0\" --no-reexec \${1+\"\$@\"}
-    fi
-  fi\
+    file=\"\$0\""
+
+    qECHO=`$ECHO "$ECHO" | $SED "$sed_quote_subst"`
+    $ECHO "\
+
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+\$1
+_LTECHO_EOF'
+}
+    ECHO=\"$qECHO\"
+  fi
+
+# Very basic option parsing. These options are (a) specific to
+# the libtool wrapper, (b) are identical between the wrapper
+# /script/ and the wrapper /executable/ which is used only on
+# windows platforms, and (c) all begin with the string "--lt-"
+# (application programs are unlikely to have options which match
+# this pattern).
+#
+# There are only two supported options: --lt-debug and
+# --lt-dump-script. There is, deliberately, no --lt-help.
+#
+# The first argument to this parsing function should be the
+# script's $0 value, followed by "$@".
+lt_option_debug=
+func_parse_lt_options ()
+{
+  lt_script_arg0=\$0
+  shift
+  for lt_opt
+  do
+    case \"\$lt_opt\" in
+    --lt-debug) lt_option_debug=1 ;;
+    --lt-dump-script)
+        lt_dump_D=\`\$ECHO \"X\$lt_script_arg0\" | $SED -e 's/^X//' -e 's%/[^/]*$%%'\`
+        test \"X\$lt_dump_D\" = \"X\$lt_script_arg0\" && lt_dump_D=.
+        lt_dump_F=\`\$ECHO \"X\$lt_script_arg0\" | $SED -e 's/^X//' -e 's%^.*/%%'\`
+        cat \"\$lt_dump_D/\$lt_dump_F\"
+        exit 0
+      ;;
+    --lt-*)
+        \$ECHO \"Unrecognized --lt- option: '\$lt_opt'\" 1>&2
+        exit 1
+      ;;
+    esac
+  done
+
+  # Print the debug banner immediately:
+  if test -n \"\$lt_option_debug\"; then
+    echo \"${outputname}:${output}:\${LINENO}: libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\" 1>&2
+  fi
+}
+
+# Used when --lt-debug. Prints its arguments to stdout
+# (redirection is the responsibility of the caller)
+func_lt_dump_args ()
+{
+  lt_dump_args_N=1;
+  for lt_arg
+  do
+    \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[\$lt_dump_args_N]: \$lt_arg\"
+    lt_dump_args_N=\`expr \$lt_dump_args_N + 1\`
+  done
+}
+
+# Core function for launching the target application
+func_exec_program_core ()
+{
 "
-	$ECHO "\
+  case $host in
+  # Backslashes separate directories on plain windows
+  *-*-mingw | *-*-os2* | *-cegcc*)
+    $ECHO "\
+      if test -n \"\$lt_option_debug\"; then
+        \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir\\\\\$program\" 1>&2
+        func_lt_dump_args \${1+\"\$@\"} 1>&2
+      fi
+      exec \"\$progdir\\\\\$program\" \${1+\"\$@\"}
+"
+    ;;
+
+  *)
+    $ECHO "\
+      if test -n \"\$lt_option_debug\"; then
+        \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir/\$program\" 1>&2
+        func_lt_dump_args \${1+\"\$@\"} 1>&2
+      fi
+      exec \"\$progdir/\$program\" \${1+\"\$@\"}
+"
+    ;;
+  esac
+  $ECHO "\
+      \$ECHO \"\$0: cannot exec \$program \$*\" 1>&2
+      exit 1
+}
+
+# A function to encapsulate launching the target application
+# Strips options in the --lt-* namespace from \$@ and
+# launches target application with the remaining arguments.
+func_exec_program ()
+{
+  case \" \$* \" in
+  *\\ --lt-*)
+    for lt_wr_arg
+    do
+      case \$lt_wr_arg in
+      --lt-*) ;;
+      *) set x \"\$@\" \"\$lt_wr_arg\"; shift;;
+      esac
+      shift
+    done ;;
+  esac
+  func_exec_program_core \${1+\"\$@\"}
+}
+
+  # Parse options
+  func_parse_lt_options \"\$0\" \${1+\"\$@\"}
 
   # Find the directory that this script lives in.
-  thisdir=\`\$ECHO \"X\$file\" | \$Xsed -e 's%/[^/]*$%%'\`
+  thisdir=\`\$ECHO \"\$file\" | $SED 's%/[^/]*$%%'\`
   test \"x\$thisdir\" = \"x\$file\" && thisdir=.
 
   # Follow symbolic links until we get to the real thisdir.
-  file=\`ls -ld \"\$file\" | ${SED} -n 's/.*-> //p'\`
+  file=\`ls -ld \"\$file\" | $SED -n 's/.*-> //p'\`
   while test -n \"\$file\"; do
-    destdir=\`\$ECHO \"X\$file\" | \$Xsed -e 's%/[^/]*\$%%'\`
+    destdir=\`\$ECHO \"\$file\" | $SED 's%/[^/]*\$%%'\`
 
     # If there was a directory component, then change thisdir.
     if test \"x\$destdir\" != \"x\$file\"; then
@@ -2783,30 +4019,13 @@
       esac
     fi
 
-    file=\`\$ECHO \"X\$file\" | \$Xsed -e 's%^.*/%%'\`
-    file=\`ls -ld \"\$thisdir/\$file\" | ${SED} -n 's/.*-> //p'\`
+    file=\`\$ECHO \"\$file\" | $SED 's%^.*/%%'\`
+    file=\`ls -ld \"\$thisdir/\$file\" | $SED -n 's/.*-> //p'\`
   done
-"
-}
-# end: func_emit_wrapper_part1
-
-# func_emit_wrapper_part2 [arg=no]
-#
-# Emit the second part of a libtool wrapper script on stdout.
-# For more information, see the description associated with
-# func_emit_wrapper(), below.
-func_emit_wrapper_part2 ()
-{
-	func_emit_wrapper_part2_arg1=no
-	if test -n "$1" ; then
-	  func_emit_wrapper_part2_arg1=$1
-	fi
-
-	$ECHO "\
 
   # Usually 'no', except on cygwin/mingw when embedded into
   # the cwrapper.
-  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_part2_arg1
+  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_arg1
   if test \"\$WRAPPER_SCRIPT_BELONGS_IN_OBJDIR\" = \"yes\"; then
     # special case for '.'
     if test \"\$thisdir\" = \".\"; then
@@ -2814,7 +4033,7 @@
     fi
     # remove .libs from thisdir
     case \"\$thisdir\" in
-    *[\\\\/]$objdir ) thisdir=\`\$ECHO \"X\$thisdir\" | \$Xsed -e 's%[\\\\/][^\\\\/]*$%%'\` ;;
+    *[\\\\/]$objdir ) thisdir=\`\$ECHO \"\$thisdir\" | $SED 's%[\\\\/][^\\\\/]*$%%'\` ;;
     $objdir )   thisdir=. ;;
     esac
   fi
@@ -2869,6 +4088,18 @@
 
   if test -f \"\$progdir/\$program\"; then"
 
+	# fixup the dll searchpath if we need to.
+	#
+	# Fix the DLL searchpath if we need to.  Do this before prepending
+	# to shlibpath, because on Windows, both are PATH and uninstalled
+	# libraries must come first.
+	if test -n "$dllsearchpath"; then
+	  $ECHO "\
+    # Add the dll search path components to the executable PATH
+    PATH=$dllsearchpath:\$PATH
+"
+	fi
+
 	# Export our shlibpath_var if we have one.
 	if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
 	  $ECHO "\
@@ -2877,253 +4108,28 @@
 
     # Some systems cannot cope with colon-terminated $shlibpath_var
     # The second colon is a workaround for a bug in BeOS R4 sed
-    $shlibpath_var=\`\$ECHO \"X\$$shlibpath_var\" | \$Xsed -e 's/::*\$//'\`
+    $shlibpath_var=\`\$ECHO \"\$$shlibpath_var\" | $SED 's/::*\$//'\`
 
     export $shlibpath_var
 "
 	fi
 
-	# fixup the dll searchpath if we need to.
-	if test -n "$dllsearchpath"; then
-	  $ECHO "\
-    # Add the dll search path components to the executable PATH
-    PATH=$dllsearchpath:\$PATH
-"
-	fi
-
 	$ECHO "\
     if test \"\$libtool_execute_magic\" != \"$magic\"; then
       # Run the actual program with our arguments.
-"
-	case $host in
-	# Backslashes separate directories on plain windows
-	*-*-mingw | *-*-os2* | *-cegcc*)
-	  $ECHO "\
-      exec \"\$progdir\\\\\$program\" \${1+\"\$@\"}
-"
-	  ;;
-
-	*)
-	  $ECHO "\
-      exec \"\$progdir/\$program\" \${1+\"\$@\"}
-"
-	  ;;
-	esac
-	$ECHO "\
-      \$ECHO \"\$0: cannot exec \$program \$*\" 1>&2
-      exit 1
+      func_exec_program \${1+\"\$@\"}
     fi
   else
     # The program doesn't exist.
     \$ECHO \"\$0: error: \\\`\$progdir/\$program' does not exist\" 1>&2
     \$ECHO \"This script is just a wrapper for \$program.\" 1>&2
-    $ECHO \"See the $PACKAGE documentation for more information.\" 1>&2
+    \$ECHO \"See the $PACKAGE documentation for more information.\" 1>&2
     exit 1
   fi
 fi\
 "
 }
-# end: func_emit_wrapper_part2
-
-
-# func_emit_wrapper [arg=no]
-#
-# Emit a libtool wrapper script on stdout.
-# Don't directly open a file because we may want to
-# incorporate the script contents within a cygwin/mingw
-# wrapper executable.  Must ONLY be called from within
-# func_mode_link because it depends on a number of variables
-# set therein.
-#
-# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
-# variable will take.  If 'yes', then the emitted script
-# will assume that the directory in which it is stored is
-# the $objdir directory.  This is a cygwin/mingw-specific
-# behavior.
-func_emit_wrapper ()
-{
-	func_emit_wrapper_arg1=no
-	if test -n "$1" ; then
-	  func_emit_wrapper_arg1=$1
-	fi
-
-	# split this up so that func_emit_cwrapperexe_src
-	# can call each part independently.
-	func_emit_wrapper_part1 "${func_emit_wrapper_arg1}"
-	func_emit_wrapper_part2 "${func_emit_wrapper_arg1}"
-}
-
-
-# func_to_host_path arg
-#
-# Convert paths to host format when used with build tools.
-# Intended for use with "native" mingw (where libtool itself
-# is running under the msys shell), or in the following cross-
-# build environments:
-#    $build          $host
-#    mingw (msys)    mingw  [e.g. native]
-#    cygwin          mingw
-#    *nix + wine     mingw
-# where wine is equipped with the `winepath' executable.
-# In the native mingw case, the (msys) shell automatically
-# converts paths for any non-msys applications it launches,
-# but that facility isn't available from inside the cwrapper.
-# Similar accommodations are necessary for $host mingw and
-# $build cygwin.  Calling this function does no harm for other
-# $host/$build combinations not listed above.
-#
-# ARG is the path (on $build) that should be converted to
-# the proper representation for $host. The result is stored
-# in $func_to_host_path_result.
-func_to_host_path ()
-{
-  func_to_host_path_result="$1"
-  if test -n "$1" ; then
-    case $host in
-      *mingw* )
-        lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
-        case $build in
-          *mingw* ) # actually, msys
-            # awkward: cmd appends spaces to result
-            lt_sed_strip_trailing_spaces="s/[ ]*\$//"
-            func_to_host_path_tmp1=`( cmd //c echo "$1" |\
-              $SED -e "$lt_sed_strip_trailing_spaces" ) 2>/dev/null || echo ""`
-            func_to_host_path_result=`echo "$func_to_host_path_tmp1" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          *cygwin* )
-            func_to_host_path_tmp1=`cygpath -w "$1"`
-            func_to_host_path_result=`echo "$func_to_host_path_tmp1" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          * )
-            # Unfortunately, winepath does not exit with a non-zero
-            # error code, so we are forced to check the contents of
-            # stdout. On the other hand, if the command is not
-            # found, the shell will set an exit code of 127 and print
-            # *an error message* to stdout. So we must check for both
-            # error code of zero AND non-empty stdout, which explains
-            # the odd construction:
-            func_to_host_path_tmp1=`winepath -w "$1" 2>/dev/null`
-            if test "$?" -eq 0 && test -n "${func_to_host_path_tmp1}"; then
-              func_to_host_path_result=`echo "$func_to_host_path_tmp1" |\
-                $SED -e "$lt_sed_naive_backslashify"`
-            else
-              # Allow warning below.
-              func_to_host_path_result=""
-            fi
-            ;;
-        esac
-        if test -z "$func_to_host_path_result" ; then
-          func_error "Could not determine host path corresponding to"
-          func_error "  '$1'"
-          func_error "Continuing, but uninstalled executables may not work."
-          # Fallback:
-          func_to_host_path_result="$1"
-        fi
-        ;;
-    esac
-  fi
-}
-# end: func_to_host_path
 
-# func_to_host_pathlist arg
-#
-# Convert pathlists to host format when used with build tools.
-# See func_to_host_path(), above. This function supports the
-# following $build/$host combinations (but does no harm for
-# combinations not listed here):
-#    $build          $host
-#    mingw (msys)    mingw  [e.g. native]
-#    cygwin          mingw
-#    *nix + wine     mingw
-#
-# Path separators are also converted from $build format to
-# $host format. If ARG begins or ends with a path separator
-# character, it is preserved (but converted to $host format)
-# on output.
-#
-# ARG is a pathlist (on $build) that should be converted to
-# the proper representation on $host. The result is stored
-# in $func_to_host_pathlist_result.
-func_to_host_pathlist ()
-{
-  func_to_host_pathlist_result="$1"
-  if test -n "$1" ; then
-    case $host in
-      *mingw* )
-        lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
-        # Remove leading and trailing path separator characters from
-        # ARG. msys behavior is inconsistent here, cygpath turns them
-        # into '.;' and ';.', and winepath ignores them completely.
-        func_to_host_pathlist_tmp2="$1"
-        # Once set for this call, this variable should not be
-        # reassigned. It is used in tha fallback case.
-        func_to_host_pathlist_tmp1=`echo "$func_to_host_pathlist_tmp2" |\
-          $SED -e 's|^:*||' -e 's|:*$||'`
-        case $build in
-          *mingw* ) # Actually, msys.
-            # Awkward: cmd appends spaces to result.
-            lt_sed_strip_trailing_spaces="s/[ ]*\$//"
-            func_to_host_pathlist_tmp2=`( cmd //c echo "$func_to_host_pathlist_tmp1" |\
-              $SED -e "$lt_sed_strip_trailing_spaces" ) 2>/dev/null || echo ""`
-            func_to_host_pathlist_result=`echo "$func_to_host_pathlist_tmp2" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          *cygwin* )
-            func_to_host_pathlist_tmp2=`cygpath -w -p "$func_to_host_pathlist_tmp1"`
-            func_to_host_pathlist_result=`echo "$func_to_host_pathlist_tmp2" |\
-              $SED -e "$lt_sed_naive_backslashify"`
-            ;;
-          * )
-            # unfortunately, winepath doesn't convert pathlists
-            func_to_host_pathlist_result=""
-            func_to_host_pathlist_oldIFS=$IFS
-            IFS=:
-            for func_to_host_pathlist_f in $func_to_host_pathlist_tmp1 ; do
-              IFS=$func_to_host_pathlist_oldIFS
-              if test -n "$func_to_host_pathlist_f" ; then
-                func_to_host_path "$func_to_host_pathlist_f"
-                if test -n "$func_to_host_path_result" ; then
-                  if test -z "$func_to_host_pathlist_result" ; then
-                    func_to_host_pathlist_result="$func_to_host_path_result"
-                  else
-                    func_to_host_pathlist_result="$func_to_host_pathlist_result;$func_to_host_path_result"
-                  fi
-                fi
-              fi
-              IFS=:
-            done
-            IFS=$func_to_host_pathlist_oldIFS
-            ;;
-        esac
-        if test -z "$func_to_host_pathlist_result" ; then
-          func_error "Could not determine the host path(s) corresponding to"
-          func_error "  '$1'"
-          func_error "Continuing, but uninstalled executables may not work."
-          # Fallback. This may break if $1 contains DOS-style drive
-          # specifications. The fix is not to complicate the expression
-          # below, but for the user to provide a working wine installation
-          # with winepath so that path translation in the cross-to-mingw
-          # case works properly.
-          lt_replace_pathsep_nix_to_dos="s|:|;|g"
-          func_to_host_pathlist_result=`echo "$func_to_host_pathlist_tmp1" |\
-            $SED -e "$lt_replace_pathsep_nix_to_dos"`
-        fi
-        # Now, add the leading and trailing path separators back
-        case "$1" in
-          :* ) func_to_host_pathlist_result=";$func_to_host_pathlist_result"
-            ;;
-        esac
-        case "$1" in
-          *: ) func_to_host_pathlist_result="$func_to_host_pathlist_result;"
-            ;;
-        esac
-        ;;
-    esac
-  fi
-}
-# end: func_to_host_pathlist
 
 # func_emit_cwrapperexe_src
 # emit the source code for a wrapper executable on stdout
@@ -3141,41 +4147,71 @@
 
    This wrapper executable should never be moved out of the build directory.
    If it is, it will not operate correctly.
-
-   Currently, it simply execs the wrapper *script* "$SHELL $output",
-   but could eventually absorb all of the scripts functionality and
-   exec $objdir/$outputname directly.
 */
 EOF
 	    cat <<"EOF"
+#ifdef _MSC_VER
+# define _CRT_SECURE_NO_DEPRECATE 1
+#endif
 #include <stdio.h>
 #include <stdlib.h>
 #ifdef _MSC_VER
 # include <direct.h>
 # include <process.h>
 # include <io.h>
-# define setmode _setmode
 #else
 # include <unistd.h>
 # include <stdint.h>
 # ifdef __CYGWIN__
 #  include <io.h>
-#  define HAVE_SETENV
-#  ifdef __STRICT_ANSI__
+# endif
+#endif
+#include <malloc.h>
+#include <stdarg.h>
+#include <assert.h>
+#include <string.h>
+#include <ctype.h>
+#include <errno.h>
+#include <fcntl.h>
+#include <sys/stat.h>
+
+/* declarations of non-ANSI functions */
+#if defined(__MINGW32__)
+# ifdef __STRICT_ANSI__
+int _putenv (const char *);
+# endif
+#elif defined(__CYGWIN__)
+# ifdef __STRICT_ANSI__
 char *realpath (const char *, char *);
 int putenv (char *);
 int setenv (const char *, const char *, int);
-#  endif
 # endif
+/* #elif defined (other platforms) ... */
+#endif
+
+/* portability defines, excluding path handling macros */
+#if defined(_MSC_VER)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+# define S_IXUSR _S_IEXEC
+# ifndef _INTPTR_T_DEFINED
+#  define _INTPTR_T_DEFINED
+#  define intptr_t int
+# endif
+#elif defined(__MINGW32__)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+#elif defined(__CYGWIN__)
+# define HAVE_SETENV
+# define FOPEN_WB "wb"
+/* #elif defined (other platforms) ... */
 #endif
-#include <malloc.h>
-#include <stdarg.h>
-#include <assert.h>
-#include <string.h>
-#include <ctype.h>
-#include <errno.h>
-#include <fcntl.h>
-#include <sys/stat.h>
 
 #if defined(PATH_MAX)
 # define LT_PATHMAX PATH_MAX
@@ -3192,14 +4228,7 @@
 # define S_IXGRP 0
 #endif
 
-#ifdef _MSC_VER
-# define S_IXUSR _S_IEXEC
-# define stat _stat
-# ifndef _INTPTR_T_DEFINED
-#  define intptr_t int
-# endif
-#endif
-
+/* path handling portability macros */
 #ifndef DIR_SEPARATOR
 # define DIR_SEPARATOR '/'
 # define PATH_SEPARATOR ':'
@@ -3230,10 +4259,6 @@
 # define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)
 #endif /* PATH_SEPARATOR_2 */
 
-#ifdef __CYGWIN__
-# define FOPEN_WB "wb"
-#endif
-
 #ifndef FOPEN_WB
 # define FOPEN_WB "w"
 #endif
@@ -3246,22 +4271,13 @@
   if (stale) { free ((void *) stale); stale = 0; } \
 } while (0)
 
-#undef LTWRAPPER_DEBUGPRINTF
-#if defined DEBUGWRAPPER
-# define LTWRAPPER_DEBUGPRINTF(args) ltwrapper_debugprintf args
-static void
-ltwrapper_debugprintf (const char *fmt, ...)
-{
-    va_list args;
-    va_start (args, fmt);
-    (void) vfprintf (stderr, fmt, args);
-    va_end (args);
-}
+#if defined(LT_DEBUGWRAPPER)
+static int lt_debug = 1;
 #else
-# define LTWRAPPER_DEBUGPRINTF(args)
+static int lt_debug = 0;
 #endif
 
-const char *program_name = NULL;
+const char *program_name = "libtool-wrapper"; /* in case xstrdup fails */
 
 void *xmalloc (size_t num);
 char *xstrdup (const char *string);
@@ -3271,41 +4287,27 @@
 int make_executable (const char *path);
 int check_executable (const char *path);
 char *strendzap (char *str, const char *pat);
-void lt_fatal (const char *message, ...);
+void lt_debugprintf (const char *file, int line, const char *fmt, ...);
+void lt_fatal (const char *file, int line, const char *message, ...);
+static const char *nonnull (const char *s);
+static const char *nonempty (const char *s);
 void lt_setenv (const char *name, const char *value);
 char *lt_extend_str (const char *orig_value, const char *add, int to_end);
-void lt_opt_process_env_set (const char *arg);
-void lt_opt_process_env_prepend (const char *arg);
-void lt_opt_process_env_append (const char *arg);
-int lt_split_name_value (const char *arg, char** name, char** value);
 void lt_update_exe_path (const char *name, const char *value);
 void lt_update_lib_path (const char *name, const char *value);
-
-static const char *script_text_part1 =
-EOF
-
-	    func_emit_wrapper_part1 yes |
-	        $SED -e 's/\([\\"]\)/\\\1/g' \
-	             -e 's/^/  "/' -e 's/$/\\n"/'
-	    echo ";"
-	    cat <<EOF
-
-static const char *script_text_part2 =
+char **prepare_spawn (char **argv);
+void lt_dump_script (FILE *f);
 EOF
-	    func_emit_wrapper_part2 yes |
-	        $SED -e 's/\([\\"]\)/\\\1/g' \
-	             -e 's/^/  "/' -e 's/$/\\n"/'
-	    echo ";"
 
 	    cat <<EOF
-const char * MAGIC_EXE = "$magic_exe";
+volatile const char * MAGIC_EXE = "$magic_exe";
 const char * LIB_PATH_VARNAME = "$shlibpath_var";
 EOF
 
 	    if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
-              func_to_host_pathlist "$temp_rpath"
+              func_to_host_path "$temp_rpath"
 	      cat <<EOF
-const char * LIB_PATH_VALUE   = "$func_to_host_pathlist_result";
+const char * LIB_PATH_VALUE   = "$func_to_host_path_result";
 EOF
 	    else
 	      cat <<"EOF"
@@ -3314,10 +4316,10 @@
 	    fi
 
 	    if test -n "$dllsearchpath"; then
-              func_to_host_pathlist "$dllsearchpath:"
+              func_to_host_path "$dllsearchpath:"
 	      cat <<EOF
 const char * EXE_PATH_VARNAME = "PATH";
-const char * EXE_PATH_VALUE   = "$func_to_host_pathlist_result";
+const char * EXE_PATH_VALUE   = "$func_to_host_path_result";
 EOF
 	    else
 	      cat <<"EOF"
@@ -3340,24 +4342,10 @@
 	    cat <<"EOF"
 
 #define LTWRAPPER_OPTION_PREFIX         "--lt-"
-#define LTWRAPPER_OPTION_PREFIX_LENGTH  5
 
-static const size_t opt_prefix_len         = LTWRAPPER_OPTION_PREFIX_LENGTH;
 static const char *ltwrapper_option_prefix = LTWRAPPER_OPTION_PREFIX;
-
 static const char *dumpscript_opt       = LTWRAPPER_OPTION_PREFIX "dump-script";
-
-static const size_t env_set_opt_len     = LTWRAPPER_OPTION_PREFIX_LENGTH + 7;
-static const char *env_set_opt          = LTWRAPPER_OPTION_PREFIX "env-set";
-  /* argument is putenv-style "foo=bar", value of foo is set to bar */
-
-static const size_t env_prepend_opt_len = LTWRAPPER_OPTION_PREFIX_LENGTH + 11;
-static const char *env_prepend_opt      = LTWRAPPER_OPTION_PREFIX "env-prepend";
-  /* argument is putenv-style "foo=bar", new value of foo is bar${foo} */
-
-static const size_t env_append_opt_len  = LTWRAPPER_OPTION_PREFIX_LENGTH + 10;
-static const char *env_append_opt       = LTWRAPPER_OPTION_PREFIX "env-append";
-  /* argument is putenv-style "foo=bar", new value of foo is ${foo}bar */
+static const char *debug_opt            = LTWRAPPER_OPTION_PREFIX "debug";
 
 int
 main (int argc, char *argv[])
@@ -3374,10 +4362,13 @@
   int i;
 
   program_name = (char *) xstrdup (base_name (argv[0]));
-  LTWRAPPER_DEBUGPRINTF (("(main) argv[0]      : %s\n", argv[0]));
-  LTWRAPPER_DEBUGPRINTF (("(main) program_name : %s\n", program_name));
+  newargz = XMALLOC (char *, argc + 1);
 
-  /* very simple arg parsing; don't want to rely on getopt */
+  /* very simple arg parsing; don't want to rely on getopt
+   * also, copy all non cwrapper options to newargz, except
+   * argz[0], which is handled differently
+   */
+  newargc=0;
   for (i = 1; i < argc; i++)
     {
       if (strcmp (argv[i], dumpscript_opt) == 0)
@@ -3391,25 +4382,57 @@
 	      esac
 
 	    cat <<"EOF"
-	  printf ("%s", script_text_part1);
-	  printf ("%s", script_text_part2);
+	  lt_dump_script (stdout);
 	  return 0;
 	}
+      if (strcmp (argv[i], debug_opt) == 0)
+	{
+          lt_debug = 1;
+          continue;
+	}
+      if (strcmp (argv[i], ltwrapper_option_prefix) == 0)
+        {
+          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
+             namespace, but it is not one of the ones we know about and
+             have already dealt with, above (inluding dump-script), then
+             report an error. Otherwise, targets might begin to believe
+             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
+             namespace. The first time any user complains about this, we'll
+             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
+             or a configure.ac-settable value.
+           */
+          lt_fatal (__FILE__, __LINE__,
+		    "unrecognized %s option: '%s'",
+                    ltwrapper_option_prefix, argv[i]);
+        }
+      /* otherwise ... */
+      newargz[++newargc] = xstrdup (argv[i]);
     }
+  newargz[++newargc] = NULL;
+
+EOF
+	    cat <<EOF
+  /* The GNU banner must be the first non-error debug message */
+  lt_debugprintf (__FILE__, __LINE__, "libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\n");
+EOF
+	    cat <<"EOF"
+  lt_debugprintf (__FILE__, __LINE__, "(main) argv[0]: %s\n", argv[0]);
+  lt_debugprintf (__FILE__, __LINE__, "(main) program_name: %s\n", program_name);
 
-  newargz = XMALLOC (char *, argc + 1);
   tmp_pathspec = find_executable (argv[0]);
   if (tmp_pathspec == NULL)
-    lt_fatal ("Couldn't find %s", argv[0]);
-  LTWRAPPER_DEBUGPRINTF (("(main) found exe (before symlink chase) at : %s\n",
-			  tmp_pathspec));
+    lt_fatal (__FILE__, __LINE__, "couldn't find %s", argv[0]);
+  lt_debugprintf (__FILE__, __LINE__,
+                  "(main) found exe (before symlink chase) at: %s\n",
+		  tmp_pathspec);
 
   actual_cwrapper_path = chase_symlinks (tmp_pathspec);
-  LTWRAPPER_DEBUGPRINTF (("(main) found exe (after symlink chase) at : %s\n",
-			  actual_cwrapper_path));
+  lt_debugprintf (__FILE__, __LINE__,
+                  "(main) found exe (after symlink chase) at: %s\n",
+		  actual_cwrapper_path);
   XFREE (tmp_pathspec);
 
-  actual_cwrapper_name = xstrdup( base_name (actual_cwrapper_path));
+  actual_cwrapper_name = xstrdup (base_name (actual_cwrapper_path));
   strendzap (actual_cwrapper_path, actual_cwrapper_name);
 
   /* wrapper name transforms */
@@ -3427,8 +4450,9 @@
   target_name = tmp_pathspec;
   tmp_pathspec = 0;
 
-  LTWRAPPER_DEBUGPRINTF (("(main) libtool target name: %s\n",
-			  target_name));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(main) libtool target name: %s\n",
+		  target_name);
 EOF
 
 	    cat <<EOF
@@ -3478,80 +4502,19 @@
 
   lt_setenv ("BIN_SH", "xpg4"); /* for Tru64 */
   lt_setenv ("DUALCASE", "1");  /* for MSK sh */
-  lt_update_lib_path (LIB_PATH_VARNAME, LIB_PATH_VALUE);
+  /* Update the DLL searchpath.  EXE_PATH_VALUE ($dllsearchpath) must
+     be prepended before (that is, appear after) LIB_PATH_VALUE ($temp_rpath)
+     because on Windows, both *_VARNAMEs are PATH but uninstalled
+     libraries must come first. */
   lt_update_exe_path (EXE_PATH_VARNAME, EXE_PATH_VALUE);
+  lt_update_lib_path (LIB_PATH_VARNAME, LIB_PATH_VALUE);
 
-  newargc=0;
-  for (i = 1; i < argc; i++)
-    {
-      if (strncmp (argv[i], env_set_opt, env_set_opt_len) == 0)
-        {
-          if (argv[i][env_set_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_set_opt_len + 1;
-              lt_opt_process_env_set (p);
-            }
-          else if (argv[i][env_set_opt_len] == '\0' && i + 1 < argc)
-            {
-              lt_opt_process_env_set (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal ("%s missing required argument", env_set_opt);
-          continue;
-        }
-      if (strncmp (argv[i], env_prepend_opt, env_prepend_opt_len) == 0)
-        {
-          if (argv[i][env_prepend_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_prepend_opt_len + 1;
-              lt_opt_process_env_prepend (p);
-            }
-          else if (argv[i][env_prepend_opt_len] == '\0' && i + 1 < argc)
-            {
-              lt_opt_process_env_prepend (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal ("%s missing required argument", env_prepend_opt);
-          continue;
-        }
-      if (strncmp (argv[i], env_append_opt, env_append_opt_len) == 0)
-        {
-          if (argv[i][env_append_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_append_opt_len + 1;
-              lt_opt_process_env_append (p);
-            }
-          else if (argv[i][env_append_opt_len] == '\0' && i + 1 < argc)
-            {
-              lt_opt_process_env_append (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal ("%s missing required argument", env_append_opt);
-          continue;
-        }
-      if (strncmp (argv[i], ltwrapper_option_prefix, opt_prefix_len) == 0)
-        {
-          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
-             namespace, but it is not one of the ones we know about and
-             have already dealt with, above (inluding dump-script), then
-             report an error. Otherwise, targets might begin to believe
-             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
-             namespace. The first time any user complains about this, we'll
-             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
-             or a configure.ac-settable value.
-           */
-          lt_fatal ("Unrecognized option in %s namespace: '%s'",
-                    ltwrapper_option_prefix, argv[i]);
-        }
-      /* otherwise ... */
-      newargz[++newargc] = xstrdup (argv[i]);
-    }
-  newargz[++newargc] = NULL;
-
-  LTWRAPPER_DEBUGPRINTF     (("(main) lt_argv_zero : %s\n", (lt_argv_zero ? lt_argv_zero : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__, "(main) lt_argv_zero: %s\n",
+		  nonnull (lt_argv_zero));
   for (i = 0; i < newargc; i++)
     {
-      LTWRAPPER_DEBUGPRINTF (("(main) newargz[%d]   : %s\n", i, (newargz[i] ? newargz[i] : "<NULL>")));
+      lt_debugprintf (__FILE__, __LINE__, "(main) newargz[%d]: %s\n",
+		      i, nonnull (newargz[i]));
     }
 
 EOF
@@ -3560,11 +4523,14 @@
 	      mingw*)
 		cat <<"EOF"
   /* execv doesn't actually work on mingw as expected on unix */
+  newargz = prepare_spawn (newargz);
   rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
   if (rval == -1)
     {
       /* failed to start process */
-      LTWRAPPER_DEBUGPRINTF (("(main) failed to launch target \"%s\": errno = %d\n", lt_argv_zero, errno));
+      lt_debugprintf (__FILE__, __LINE__,
+		      "(main) failed to launch target \"%s\": %s\n",
+		      lt_argv_zero, nonnull (strerror (errno)));
       return 127;
     }
   return rval;
@@ -3586,7 +4552,7 @@
 {
   void *p = (void *) malloc (num);
   if (!p)
-    lt_fatal ("Memory exhausted");
+    lt_fatal (__FILE__, __LINE__, "memory exhausted");
 
   return p;
 }
@@ -3620,8 +4586,8 @@
 {
   struct stat st;
 
-  LTWRAPPER_DEBUGPRINTF (("(check_executable)  : %s\n",
-			  path ? (*path ? path : "EMPTY!") : "NULL!"));
+  lt_debugprintf (__FILE__, __LINE__, "(check_executable): %s\n",
+                  nonempty (path));
   if ((!path) || (!*path))
     return 0;
 
@@ -3638,8 +4604,8 @@
   int rval = 0;
   struct stat st;
 
-  LTWRAPPER_DEBUGPRINTF (("(make_executable)   : %s\n",
-			  path ? (*path ? path : "EMPTY!") : "NULL!"));
+  lt_debugprintf (__FILE__, __LINE__, "(make_executable): %s\n",
+                  nonempty (path));
   if ((!path) || (!*path))
     return 0;
 
@@ -3665,8 +4631,8 @@
   int tmp_len;
   char *concat_name;
 
-  LTWRAPPER_DEBUGPRINTF (("(find_executable)   : %s\n",
-			  wrapper ? (*wrapper ? wrapper : "EMPTY!") : "NULL!"));
+  lt_debugprintf (__FILE__, __LINE__, "(find_executable): %s\n",
+                  nonempty (wrapper));
 
   if ((wrapper == NULL) || (*wrapper == '\0'))
     return NULL;
@@ -3719,7 +4685,8 @@
 		{
 		  /* empty path: current directory */
 		  if (getcwd (tmp, LT_PATHMAX) == NULL)
-		    lt_fatal ("getcwd failed");
+		    lt_fatal (__FILE__, __LINE__, "getcwd failed: %s",
+                              nonnull (strerror (errno)));
 		  tmp_len = strlen (tmp);
 		  concat_name =
 		    XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
@@ -3744,7 +4711,8 @@
     }
   /* Relative path | not found in path: prepend cwd */
   if (getcwd (tmp, LT_PATHMAX) == NULL)
-    lt_fatal ("getcwd failed");
+    lt_fatal (__FILE__, __LINE__, "getcwd failed: %s",
+              nonnull (strerror (errno)));
   tmp_len = strlen (tmp);
   concat_name = XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
   memcpy (concat_name, tmp, tmp_len);
@@ -3770,8 +4738,9 @@
   int has_symlinks = 0;
   while (strlen (tmp_pathspec) && !has_symlinks)
     {
-      LTWRAPPER_DEBUGPRINTF (("checking path component for symlinks: %s\n",
-			      tmp_pathspec));
+      lt_debugprintf (__FILE__, __LINE__,
+		      "checking path component for symlinks: %s\n",
+		      tmp_pathspec);
       if (lstat (tmp_pathspec, &s) == 0)
 	{
 	  if (S_ISLNK (s.st_mode) != 0)
@@ -3793,8 +4762,9 @@
 	}
       else
 	{
-	  char *errstr = strerror (errno);
-	  lt_fatal ("Error accessing file %s (%s)", tmp_pathspec, errstr);
+	  lt_fatal (__FILE__, __LINE__,
+		    "error accessing file \"%s\": %s",
+		    tmp_pathspec, nonnull (strerror (errno)));
 	}
     }
   XFREE (tmp_pathspec);
@@ -3807,7 +4777,8 @@
   tmp_pathspec = realpath (pathspec, buf);
   if (tmp_pathspec == 0)
     {
-      lt_fatal ("Could not follow symlinks for %s", pathspec);
+      lt_fatal (__FILE__, __LINE__,
+		"could not follow symlinks for %s", pathspec);
     }
   return xstrdup (tmp_pathspec);
 #endif
@@ -3833,11 +4804,25 @@
   return str;
 }
 
+void
+lt_debugprintf (const char *file, int line, const char *fmt, ...)
+{
+  va_list args;
+  if (lt_debug)
+    {
+      (void) fprintf (stderr, "%s:%s:%d: ", program_name, file, line);
+      va_start (args, fmt);
+      (void) vfprintf (stderr, fmt, args);
+      va_end (args);
+    }
+}
+
 static void
-lt_error_core (int exit_status, const char *mode,
+lt_error_core (int exit_status, const char *file,
+	       int line, const char *mode,
 	       const char *message, va_list ap)
 {
-  fprintf (stderr, "%s: %s: ", program_name, mode);
+  fprintf (stderr, "%s:%s:%d: %s: ", program_name, file, line, mode);
   vfprintf (stderr, message, ap);
   fprintf (stderr, ".\n");
 
@@ -3846,20 +4831,32 @@
 }
 
 void
-lt_fatal (const char *message, ...)
+lt_fatal (const char *file, int line, const char *message, ...)
 {
   va_list ap;
   va_start (ap, message);
-  lt_error_core (EXIT_FAILURE, "FATAL", message, ap);
+  lt_error_core (EXIT_FAILURE, file, line, "FATAL", message, ap);
   va_end (ap);
 }
 
+static const char *
+nonnull (const char *s)
+{
+  return s ? s : "(null)";
+}
+
+static const char *
+nonempty (const char *s)
+{
+  return (s && !*s) ? "(empty)" : nonnull (s);
+}
+
 void
 lt_setenv (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF (("(lt_setenv) setting '%s' to '%s'\n",
-                          (name ? name : "<NULL>"),
-                          (value ? value : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(lt_setenv) setting '%s' to '%s'\n",
+                  nonnull (name), nonnull (value));
   {
 #ifdef HAVE_SETENV
     /* always make a copy, for consistency with !HAVE_SETENV */
@@ -3904,95 +4901,12 @@
   return new_value;
 }
 
-int
-lt_split_name_value (const char *arg, char** name, char** value)
-{
-  const char *p;
-  int len;
-  if (!arg || !*arg)
-    return 1;
-
-  p = strchr (arg, (int)'=');
-
-  if (!p)
-    return 1;
-
-  *value = xstrdup (++p);
-
-  len = strlen (arg) - strlen (*value);
-  *name = XMALLOC (char, len);
-  strncpy (*name, arg, len-1);
-  (*name)[len - 1] = '\0';
-
-  return 0;
-}
-
-void
-lt_opt_process_env_set (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-
-  if (lt_split_name_value (arg, &name, &value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal ("bad argument for %s: '%s'", env_set_opt, arg);
-    }
-
-  lt_setenv (name, value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
-lt_opt_process_env_prepend (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-  char *new_value = NULL;
-
-  if (lt_split_name_value (arg, &name, &value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal ("bad argument for %s: '%s'", env_prepend_opt, arg);
-    }
-
-  new_value = lt_extend_str (getenv (name), value, 0);
-  lt_setenv (name, new_value);
-  XFREE (new_value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
-lt_opt_process_env_append (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-  char *new_value = NULL;
-
-  if (lt_split_name_value (arg, &name, &value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal ("bad argument for %s: '%s'", env_append_opt, arg);
-    }
-
-  new_value = lt_extend_str (getenv (name), value, 1);
-  lt_setenv (name, new_value);
-  XFREE (new_value);
-  XFREE (name);
-  XFREE (value);
-}
-
 void
 lt_update_exe_path (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF (("(lt_update_exe_path) modifying '%s' by prepending '%s'\n",
-                          (name ? name : "<NULL>"),
-                          (value ? value : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(lt_update_exe_path) modifying '%s' by prepending '%s'\n",
+                  nonnull (name), nonnull (value));
 
   if (name && *name && value && *value)
     {
@@ -4011,9 +4925,9 @@
 void
 lt_update_lib_path (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF (("(lt_update_lib_path) modifying '%s' by prepending '%s'\n",
-                          (name ? name : "<NULL>"),
-                          (value ? value : "<NULL>")));
+  lt_debugprintf (__FILE__, __LINE__,
+		  "(lt_update_lib_path) modifying '%s' by prepending '%s'\n",
+                  nonnull (name), nonnull (value));
 
   if (name && *name && value && *value)
     {
@@ -4023,11 +4937,158 @@
     }
 }
 
+EOF
+	    case $host_os in
+	      mingw*)
+		cat <<"EOF"
+
+/* Prepares an argument vector before calling spawn().
+   Note that spawn() does not by itself call the command interpreter
+     (getenv ("COMSPEC") != NULL ? getenv ("COMSPEC") :
+      ({ OSVERSIONINFO v; v.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
+         GetVersionEx(&v);
+         v.dwPlatformId == VER_PLATFORM_WIN32_NT;
+      }) ? "cmd.exe" : "command.com").
+   Instead it simply concatenates the arguments, separated by ' ', and calls
+   CreateProcess().  We must quote the arguments since Win32 CreateProcess()
+   interprets characters like ' ', '\t', '\\', '"' (but not '<' and '>') in a
+   special way:
+   - Space and tab are interpreted as delimiters. They are not treated as
+     delimiters if they are surrounded by double quotes: "...".
+   - Unescaped double quotes are removed from the input. Their only effect is
+     that within double quotes, space and tab are treated like normal
+     characters.
+   - Backslashes not followed by double quotes are not special.
+   - But 2*n+1 backslashes followed by a double quote become
+     n backslashes followed by a double quote (n >= 0):
+       \" -> "
+       \\\" -> \"
+       \\\\\" -> \\"
+ */
+#define SHELL_SPECIAL_CHARS "\"\\ \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037"
+#define SHELL_SPACE_CHARS " \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037"
+char **
+prepare_spawn (char **argv)
+{
+  size_t argc;
+  char **new_argv;
+  size_t i;
+
+  /* Count number of arguments.  */
+  for (argc = 0; argv[argc] != NULL; argc++)
+    ;
+
+  /* Allocate new argument vector.  */
+  new_argv = XMALLOC (char *, argc + 1);
+
+  /* Put quoted arguments into the new argument vector.  */
+  for (i = 0; i < argc; i++)
+    {
+      const char *string = argv[i];
+
+      if (string[0] == '\0')
+	new_argv[i] = xstrdup ("\"\"");
+      else if (strpbrk (string, SHELL_SPECIAL_CHARS) != NULL)
+	{
+	  int quote_around = (strpbrk (string, SHELL_SPACE_CHARS) != NULL);
+	  size_t length;
+	  unsigned int backslashes;
+	  const char *s;
+	  char *quoted_string;
+	  char *p;
+
+	  length = 0;
+	  backslashes = 0;
+	  if (quote_around)
+	    length++;
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '"')
+		length += backslashes + 1;
+	      length++;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    length += backslashes + 1;
+
+	  quoted_string = XMALLOC (char, length + 1);
+
+	  p = quoted_string;
+	  backslashes = 0;
+	  if (quote_around)
+	    *p++ = '"';
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '"')
+		{
+		  unsigned int j;
+		  for (j = backslashes + 1; j > 0; j--)
+		    *p++ = '\\';
+		}
+	      *p++ = c;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    {
+	      unsigned int j;
+	      for (j = backslashes; j > 0; j--)
+		*p++ = '\\';
+	      *p++ = '"';
+	    }
+	  *p = '\0';
+
+	  new_argv[i] = quoted_string;
+	}
+      else
+	new_argv[i] = (char *) string;
+    }
+  new_argv[argc] = NULL;
+
+  return new_argv;
+}
+EOF
+		;;
+	    esac
 
+            cat <<"EOF"
+void lt_dump_script (FILE* f)
+{
+EOF
+	    func_emit_wrapper yes |
+	      $SED -n -e '
+s/^\(.\{79\}\)\(..*\)/\1\
+\2/
+h
+s/\([\\"]\)/\\\1/g
+s/$/\\n/
+s/\([^\n]*\).*/  fputs ("\1", f);/p
+g
+D'
+            cat <<"EOF"
+}
 EOF
 }
 # end: func_emit_cwrapperexe_src
 
+# func_win32_import_lib_p ARG
+# True if ARG is an import lib, as indicated by $file_magic_cmd
+func_win32_import_lib_p ()
+{
+    $opt_debug
+    case `eval $file_magic_cmd \"\$1\" 2>/dev/null | $SED -e 10q` in
+    *import*) : ;;
+    *) false ;;
+    esac
+}
+
 # func_mode_link arg...
 func_mode_link ()
 {
@@ -4072,6 +5133,7 @@
     new_inherited_linker_flags=
 
     avoid_version=no
+    bindir=
     dlfiles=
     dlprefiles=
     dlself=no
@@ -4164,6 +5226,11 @@
 	esac
 
 	case $prev in
+	bindir)
+	  bindir="$arg"
+	  prev=
+	  continue
+	  ;;
 	dlfiles|dlprefiles)
 	  if test "$preload" = no; then
 	    # Add the symbol object into the linking commands.
@@ -4195,9 +5262,9 @@
 	    ;;
 	  *)
 	    if test "$prev" = dlfiles; then
-	      dlfiles="$dlfiles $arg"
+	      func_append dlfiles " $arg"
 	    else
-	      dlprefiles="$dlprefiles $arg"
+	      func_append dlprefiles " $arg"
 	    fi
 	    prev=
 	    continue
@@ -4221,7 +5288,7 @@
 	    *-*-darwin*)
 	      case "$deplibs " in
 		*" $qarg.ltframework "*) ;;
-		*) deplibs="$deplibs $qarg.ltframework" # this is fixed later
+		*) func_append deplibs " $qarg.ltframework" # this is fixed later
 		   ;;
 	      esac
 	      ;;
@@ -4240,7 +5307,7 @@
 	    moreargs=
 	    for fil in `cat "$save_arg"`
 	    do
-#	      moreargs="$moreargs $fil"
+#	      func_append moreargs " $fil"
 	      arg=$fil
 	      # A libtool-controlled object.
 
@@ -4269,7 +5336,7 @@
 
 		  if test "$prev" = dlfiles; then
 		    if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
-		      dlfiles="$dlfiles $pic_object"
+		      func_append dlfiles " $pic_object"
 		      prev=
 		      continue
 		    else
@@ -4281,7 +5348,7 @@
 		  # CHECK ME:  I think I busted this.  -Ossama
 		  if test "$prev" = dlprefiles; then
 		    # Preload the old-style object.
-		    dlprefiles="$dlprefiles $pic_object"
+		    func_append dlprefiles " $pic_object"
 		    prev=
 		  fi
 
@@ -4351,12 +5418,12 @@
 	  if test "$prev" = rpath; then
 	    case "$rpath " in
 	    *" $arg "*) ;;
-	    *) rpath="$rpath $arg" ;;
+	    *) func_append rpath " $arg" ;;
 	    esac
 	  else
 	    case "$xrpath " in
 	    *" $arg "*) ;;
-	    *) xrpath="$xrpath $arg" ;;
+	    *) func_append xrpath " $arg" ;;
 	    esac
 	  fi
 	  prev=
@@ -4368,28 +5435,28 @@
 	  continue
 	  ;;
 	weak)
-	  weak_libs="$weak_libs $arg"
+	  func_append weak_libs " $arg"
 	  prev=
 	  continue
 	  ;;
 	xcclinker)
-	  linker_flags="$linker_flags $qarg"
-	  compiler_flags="$compiler_flags $qarg"
+	  func_append linker_flags " $qarg"
+	  func_append compiler_flags " $qarg"
 	  prev=
 	  func_append compile_command " $qarg"
 	  func_append finalize_command " $qarg"
 	  continue
 	  ;;
 	xcompiler)
-	  compiler_flags="$compiler_flags $qarg"
+	  func_append compiler_flags " $qarg"
 	  prev=
 	  func_append compile_command " $qarg"
 	  func_append finalize_command " $qarg"
 	  continue
 	  ;;
 	xlinker)
-	  linker_flags="$linker_flags $qarg"
-	  compiler_flags="$compiler_flags $wl$qarg"
+	  func_append linker_flags " $qarg"
+	  func_append compiler_flags " $wl$qarg"
 	  prev=
 	  func_append compile_command " $wl$qarg"
 	  func_append finalize_command " $wl$qarg"
@@ -4425,6 +5492,11 @@
 	continue
 	;;
 
+      -bindir)
+	prev=bindir
+	continue
+	;;
+
       -dlopen)
 	prev=dlfiles
 	continue
@@ -4475,15 +5547,16 @@
 	;;
 
       -L*)
-	func_stripname '-L' '' "$arg"
-	dir=$func_stripname_result
-	if test -z "$dir"; then
+	func_stripname "-L" '' "$arg"
+	if test -z "$func_stripname_result"; then
 	  if test "$#" -gt 0; then
 	    func_fatal_error "require no space between \`-L' and \`$1'"
 	  else
 	    func_fatal_error "need path for \`-L' option"
 	  fi
 	fi
+	func_resolve_sysroot "$func_stripname_result"
+	dir=$func_resolve_sysroot_result
 	# We need an absolute path.
 	case $dir in
 	[\\/]* | [A-Za-z]:[\\/]*) ;;
@@ -4495,24 +5568,30 @@
 	  ;;
 	esac
 	case "$deplibs " in
-	*" -L$dir "*) ;;
+	*" -L$dir "* | *" $arg "*)
+	  # Will only happen for absolute or sysroot arguments
+	  ;;
 	*)
-	  deplibs="$deplibs -L$dir"
-	  lib_search_path="$lib_search_path $dir"
+	  # Preserve sysroot, but never include relative directories
+	  case $dir in
+	    [\\/]* | [A-Za-z]:[\\/]* | =*) func_append deplibs " $arg" ;;
+	    *) func_append deplibs " -L$dir" ;;
+	  esac
+	  func_append lib_search_path " $dir"
 	  ;;
 	esac
 	case $host in
 	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
-	  testbindir=`$ECHO "X$dir" | $Xsed -e 's*/lib$*/bin*'`
+	  testbindir=`$ECHO "$dir" | $SED 's*/lib$*/bin*'`
 	  case :$dllsearchpath: in
 	  *":$dir:"*) ;;
 	  ::) dllsearchpath=$dir;;
-	  *) dllsearchpath="$dllsearchpath:$dir";;
+	  *) func_append dllsearchpath ":$dir";;
 	  esac
 	  case :$dllsearchpath: in
 	  *":$testbindir:"*) ;;
 	  ::) dllsearchpath=$testbindir;;
-	  *) dllsearchpath="$dllsearchpath:$testbindir";;
+	  *) func_append dllsearchpath ":$testbindir";;
 	  esac
 	  ;;
 	esac
@@ -4522,7 +5601,7 @@
       -l*)
 	if test "X$arg" = "X-lc" || test "X$arg" = "X-lm"; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # These systems don't actually have a C or math library (as such)
 	    continue
 	    ;;
@@ -4536,7 +5615,7 @@
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])
 	    # Rhapsody C and math libraries are in the System framework
-	    deplibs="$deplibs System.ltframework"
+	    func_append deplibs " System.ltframework"
 	    continue
 	    ;;
 	  *-*-sco3.2v5* | *-*-sco5v6*)
@@ -4556,7 +5635,7 @@
 	   ;;
 	 esac
 	fi
-	deplibs="$deplibs $arg"
+	func_append deplibs " $arg"
 	continue
 	;;
 
@@ -4568,21 +5647,22 @@
       # Tru64 UNIX uses -model [arg] to determine the layout of C++
       # classes, name mangling, and exception handling.
       # Darwin uses the -arch flag to determine output architecture.
-      -model|-arch|-isysroot)
-	compiler_flags="$compiler_flags $arg"
+      -model|-arch|-isysroot|--sysroot)
+	func_append compiler_flags " $arg"
 	func_append compile_command " $arg"
 	func_append finalize_command " $arg"
 	prev=xcompiler
 	continue
 	;;
 
-      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
-	compiler_flags="$compiler_flags $arg"
+      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe \
+      |-threads|-fopenmp|-openmp|-mp|-xopenmp|-omp|-qsmp=*)
+	func_append compiler_flags " $arg"
 	func_append compile_command " $arg"
 	func_append finalize_command " $arg"
 	case "$new_inherited_linker_flags " in
 	    *" $arg "*) ;;
-	    * ) new_inherited_linker_flags="$new_inherited_linker_flags $arg" ;;
+	    * ) func_append new_inherited_linker_flags " $arg" ;;
 	esac
 	continue
 	;;
@@ -4649,13 +5729,17 @@
 	# We need an absolute path.
 	case $dir in
 	[\\/]* | [A-Za-z]:[\\/]*) ;;
+	=*)
+	  func_stripname '=' '' "$dir"
+	  dir=$lt_sysroot$func_stripname_result
+	  ;;
 	*)
 	  func_fatal_error "only absolute run-paths are allowed"
 	  ;;
 	esac
 	case "$xrpath " in
 	*" $dir "*) ;;
-	*) xrpath="$xrpath $dir" ;;
+	*) func_append xrpath " $dir" ;;
 	esac
 	continue
 	;;
@@ -4708,8 +5792,8 @@
 	for flag in $args; do
 	  IFS="$save_ifs"
           func_quote_for_eval "$flag"
-	  arg="$arg $wl$func_quote_for_eval_result"
-	  compiler_flags="$compiler_flags $func_quote_for_eval_result"
+	  func_append arg " $func_quote_for_eval_result"
+	  func_append compiler_flags " $func_quote_for_eval_result"
 	done
 	IFS="$save_ifs"
 	func_stripname ' ' '' "$arg"
@@ -4724,9 +5808,9 @@
 	for flag in $args; do
 	  IFS="$save_ifs"
           func_quote_for_eval "$flag"
-	  arg="$arg $wl$func_quote_for_eval_result"
-	  compiler_flags="$compiler_flags $wl$func_quote_for_eval_result"
-	  linker_flags="$linker_flags $func_quote_for_eval_result"
+	  func_append arg " $wl$func_quote_for_eval_result"
+	  func_append compiler_flags " $wl$func_quote_for_eval_result"
+	  func_append linker_flags " $func_quote_for_eval_result"
 	done
 	IFS="$save_ifs"
 	func_stripname ' ' '' "$arg"
@@ -4754,23 +5838,27 @@
 	arg="$func_quote_for_eval_result"
 	;;
 
-      # -64, -mips[0-9] enable 64-bit mode on the SGI compiler
-      # -r[0-9][0-9]* specifies the processor on the SGI compiler
-      # -xarch=*, -xtarget=* enable 64-bit mode on the Sun compiler
-      # +DA*, +DD* enable 64-bit mode on the HP compiler
-      # -q* pass through compiler args for the IBM compiler
-      # -m*, -t[45]*, -txscale* pass through architecture-specific
-      # compiler args for GCC
-      # -F/path gives path to uninstalled frameworks, gcc on darwin
-      # -p, -pg, --coverage, -fprofile-* pass through profiling flag for GCC
-      # @file GCC response files
+      # Flags to be passed through unchanged, with rationale:
+      # -64, -mips[0-9]      enable 64-bit mode for the SGI compiler
+      # -r[0-9][0-9]*        specify processor for the SGI compiler
+      # -xarch=*, -xtarget=* enable 64-bit mode for the Sun compiler
+      # +DA*, +DD*           enable 64-bit mode for the HP compiler
+      # -q*                  compiler args for the IBM compiler
+      # -m*, -t[45]*, -txscale* architecture-specific flags for GCC
+      # -F/path              path to uninstalled frameworks, gcc on darwin
+      # -p, -pg, --coverage, -fprofile-*  profiling flags for GCC
+      # @file                GCC response files
+      # -tp=*                Portland pgcc target processor selection
+      # --sysroot=*          for sysroot support
+      # -O*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
       -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*| \
-      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*)
+      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*|-tp=*|--sysroot=*| \
+      -O*|-flto*|-fwhopr*|-fuse-linker-plugin)
         func_quote_for_eval "$arg"
 	arg="$func_quote_for_eval_result"
         func_append compile_command " $arg"
         func_append finalize_command " $arg"
-        compiler_flags="$compiler_flags $arg"
+        func_append compiler_flags " $arg"
         continue
         ;;
 
@@ -4782,7 +5870,7 @@
 
       *.$objext)
 	# A standard object.
-	objs="$objs $arg"
+	func_append objs " $arg"
 	;;
 
       *.lo)
@@ -4813,7 +5901,7 @@
 
 	    if test "$prev" = dlfiles; then
 	      if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
-		dlfiles="$dlfiles $pic_object"
+		func_append dlfiles " $pic_object"
 		prev=
 		continue
 	      else
@@ -4825,7 +5913,7 @@
 	    # CHECK ME:  I think I busted this.  -Ossama
 	    if test "$prev" = dlprefiles; then
 	      # Preload the old-style object.
-	      dlprefiles="$dlprefiles $pic_object"
+	      func_append dlprefiles " $pic_object"
 	      prev=
 	    fi
 
@@ -4870,24 +5958,25 @@
 
       *.$libext)
 	# An archive.
-	deplibs="$deplibs $arg"
-	old_deplibs="$old_deplibs $arg"
+	func_append deplibs " $arg"
+	func_append old_deplibs " $arg"
 	continue
 	;;
 
       *.la)
 	# A libtool-controlled library.
 
+	func_resolve_sysroot "$arg"
 	if test "$prev" = dlfiles; then
 	  # This library was specified with -dlopen.
-	  dlfiles="$dlfiles $arg"
+	  func_append dlfiles " $func_resolve_sysroot_result"
 	  prev=
 	elif test "$prev" = dlprefiles; then
 	  # The library was specified with -dlpreopen.
-	  dlprefiles="$dlprefiles $arg"
+	  func_append dlprefiles " $func_resolve_sysroot_result"
 	  prev=
 	else
-	  deplibs="$deplibs $arg"
+	  func_append deplibs " $func_resolve_sysroot_result"
 	fi
 	continue
 	;;
@@ -4925,7 +6014,7 @@
 
     if test -n "$shlibpath_var"; then
       # get the directories listed in $shlibpath_var
-      eval shlib_search_path=\`\$ECHO \"X\${$shlibpath_var}\" \| \$Xsed -e \'s/:/ /g\'\`
+      eval shlib_search_path=\`\$ECHO \"\${$shlibpath_var}\" \| \$SED \'s/:/ /g\'\`
     else
       shlib_search_path=
     fi
@@ -4934,6 +6023,8 @@
 
     func_dirname "$output" "/" ""
     output_objdir="$func_dirname_result$objdir"
+    func_to_tool_file "$output_objdir/"
+    tool_output_objdir=$func_to_tool_file_result
     # Create the object directory.
     func_mkdir_p "$output_objdir"
 
@@ -4954,12 +6045,12 @@
     # Find all interdependent deplibs by searching for libraries
     # that are linked more than once (e.g. -la -lb -la)
     for deplib in $deplibs; do
-      if $opt_duplicate_deps ; then
+      if $opt_preserve_dup_deps ; then
 	case "$libs " in
-	*" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	*" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	esac
       fi
-      libs="$libs $deplib"
+      func_append libs " $deplib"
     done
 
     if test "$linkmode" = lib; then
@@ -4972,9 +6063,9 @@
       if $opt_duplicate_compiler_generated_deps; then
 	for pre_post_dep in $predeps $postdeps; do
 	  case "$pre_post_deps " in
-	  *" $pre_post_dep "*) specialdeplibs="$specialdeplibs $pre_post_deps" ;;
+	  *" $pre_post_dep "*) func_append specialdeplibs " $pre_post_deps" ;;
 	  esac
-	  pre_post_deps="$pre_post_deps $pre_post_dep"
+	  func_append pre_post_deps " $pre_post_dep"
 	done
       fi
       pre_post_deps=
@@ -5033,7 +6124,10 @@
 	case $pass in
 	dlopen) libs="$dlfiles" ;;
 	dlpreopen) libs="$dlprefiles" ;;
-	link) libs="$deplibs %DEPLIBS% $dependency_libs" ;;
+	link)
+	  libs="$deplibs %DEPLIBS%"
+	  test "X$link_all_deplibs" != Xno && libs="$libs $dependency_libs"
+	  ;;
 	esac
       fi
       if test "$linkmode,$pass" = "lib,dlpreopen"; then
@@ -5041,17 +6135,19 @@
 	for lib in $dlprefiles; do
 	  # Ignore non-libtool-libs
 	  dependency_libs=
+	  func_resolve_sysroot "$lib"
 	  case $lib in
-	  *.la)	func_source "$lib" ;;
+	  *.la)	func_source "$func_resolve_sysroot_result" ;;
 	  esac
 
 	  # Collect preopened libtool deplibs, except any this library
 	  # has declared as weak libs
 	  for deplib in $dependency_libs; do
-            deplib_base=`$ECHO "X$deplib" | $Xsed -e "$basename"`
+	    func_basename "$deplib"
+            deplib_base=$func_basename_result
 	    case " $weak_libs " in
 	    *" $deplib_base "*) ;;
-	    *) deplibs="$deplibs $deplib" ;;
+	    *) func_append deplibs " $deplib" ;;
 	    esac
 	  done
 	done
@@ -5067,16 +6163,17 @@
 	lib=
 	found=no
 	case $deplib in
-	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
+	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe \
+        |-threads|-fopenmp|-openmp|-mp|-xopenmp|-omp|-qsmp=*)
 	  if test "$linkmode,$pass" = "prog,link"; then
 	    compile_deplibs="$deplib $compile_deplibs"
 	    finalize_deplibs="$deplib $finalize_deplibs"
 	  else
-	    compiler_flags="$compiler_flags $deplib"
+	    func_append compiler_flags " $deplib"
 	    if test "$linkmode" = lib ; then
 		case "$new_inherited_linker_flags " in
 		    *" $deplib "*) ;;
-		    * ) new_inherited_linker_flags="$new_inherited_linker_flags $deplib" ;;
+		    * ) func_append new_inherited_linker_flags " $deplib" ;;
 		esac
 	    fi
 	  fi
@@ -5161,7 +6258,7 @@
 	    if test "$linkmode" = lib ; then
 		case "$new_inherited_linker_flags " in
 		    *" $deplib "*) ;;
-		    * ) new_inherited_linker_flags="$new_inherited_linker_flags $deplib" ;;
+		    * ) func_append new_inherited_linker_flags " $deplib" ;;
 		esac
 	    fi
 	  fi
@@ -5174,7 +6271,8 @@
 	    test "$pass" = conv && continue
 	    newdependency_libs="$deplib $newdependency_libs"
 	    func_stripname '-L' '' "$deplib"
-	    newlib_search_path="$newlib_search_path $func_stripname_result"
+	    func_resolve_sysroot "$func_stripname_result"
+	    func_append newlib_search_path " $func_resolve_sysroot_result"
 	    ;;
 	  prog)
 	    if test "$pass" = conv; then
@@ -5188,7 +6286,8 @@
 	      finalize_deplibs="$deplib $finalize_deplibs"
 	    fi
 	    func_stripname '-L' '' "$deplib"
-	    newlib_search_path="$newlib_search_path $func_stripname_result"
+	    func_resolve_sysroot "$func_stripname_result"
+	    func_append newlib_search_path " $func_resolve_sysroot_result"
 	    ;;
 	  *)
 	    func_warning "\`-L' is ignored for archives/objects"
@@ -5199,17 +6298,21 @@
 	-R*)
 	  if test "$pass" = link; then
 	    func_stripname '-R' '' "$deplib"
-	    dir=$func_stripname_result
+	    func_resolve_sysroot "$func_stripname_result"
+	    dir=$func_resolve_sysroot_result
 	    # Make sure the xrpath contains only unique directories.
 	    case "$xrpath " in
 	    *" $dir "*) ;;
-	    *) xrpath="$xrpath $dir" ;;
+	    *) func_append xrpath " $dir" ;;
 	    esac
 	  fi
 	  deplibs="$deplib $deplibs"
 	  continue
 	  ;;
-	*.la) lib="$deplib" ;;
+	*.la)
+	  func_resolve_sysroot "$deplib"
+	  lib=$func_resolve_sysroot_result
+	  ;;
 	*.$libext)
 	  if test "$pass" = conv; then
 	    deplibs="$deplib $deplibs"
@@ -5227,7 +6330,7 @@
 		match_pattern*)
 		  set dummy $deplibs_check_method; shift
 		  match_pattern_regex=`expr "$deplibs_check_method" : "$1 \(.*\)"`
-		  if eval "\$ECHO \"X$deplib\"" 2>/dev/null | $Xsed -e 10q \
+		  if eval "\$ECHO \"$deplib\"" 2>/dev/null | $SED 10q \
 		    | $EGREP "$match_pattern_regex" > /dev/null; then
 		    valid_a_lib=yes
 		  fi
@@ -5237,15 +6340,15 @@
 		;;
 	      esac
 	      if test "$valid_a_lib" != yes; then
-		$ECHO
+		echo
 		$ECHO "*** Warning: Trying to link with static lib archive $deplib."
-		$ECHO "*** I have the capability to make that library automatically link in when"
-		$ECHO "*** you link to this library.  But I can only do this if you have a"
-		$ECHO "*** shared version of the library, which you do not appear to have"
-		$ECHO "*** because the file extensions .$libext of this argument makes me believe"
-		$ECHO "*** that it is just a static archive that I should not use here."
+		echo "*** I have the capability to make that library automatically link in when"
+		echo "*** you link to this library.  But I can only do this if you have a"
+		echo "*** shared version of the library, which you do not appear to have"
+		echo "*** because the file extensions .$libext of this argument makes me believe"
+		echo "*** that it is just a static archive that I should not use here."
 	      else
-		$ECHO
+		echo
 		$ECHO "*** Warning: Linking the shared library $output against the"
 		$ECHO "*** static library $deplib is not portable!"
 		deplibs="$deplib $deplibs"
@@ -5272,11 +6375,11 @@
 	    if test "$pass" = dlpreopen || test "$dlopen_support" != yes || test "$build_libtool_libs" = no; then
 	      # If there is no dlopen support or we're linking statically,
 	      # we need to preload.
-	      newdlprefiles="$newdlprefiles $deplib"
+	      func_append newdlprefiles " $deplib"
 	      compile_deplibs="$deplib $compile_deplibs"
 	      finalize_deplibs="$deplib $finalize_deplibs"
 	    else
-	      newdlfiles="$newdlfiles $deplib"
+	      func_append newdlfiles " $deplib"
 	    fi
 	  fi
 	  continue
@@ -5318,20 +6421,20 @@
 
 	# Convert "-framework foo" to "foo.ltframework"
 	if test -n "$inherited_linker_flags"; then
-	  tmp_inherited_linker_flags=`$ECHO "X$inherited_linker_flags" | $Xsed -e 's/-framework \([^ $]*\)/\1.ltframework/g'`
+	  tmp_inherited_linker_flags=`$ECHO "$inherited_linker_flags" | $SED 's/-framework \([^ $]*\)/\1.ltframework/g'`
 	  for tmp_inherited_linker_flag in $tmp_inherited_linker_flags; do
 	    case " $new_inherited_linker_flags " in
 	      *" $tmp_inherited_linker_flag "*) ;;
-	      *) new_inherited_linker_flags="$new_inherited_linker_flags $tmp_inherited_linker_flag";;
+	      *) func_append new_inherited_linker_flags " $tmp_inherited_linker_flag";;
 	    esac
 	  done
 	fi
-	dependency_libs=`$ECHO "X $dependency_libs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	dependency_libs=`$ECHO " $dependency_libs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	if test "$linkmode,$pass" = "lib,link" ||
 	   test "$linkmode,$pass" = "prog,scan" ||
 	   { test "$linkmode" != prog && test "$linkmode" != lib; }; then
-	  test -n "$dlopen" && dlfiles="$dlfiles $dlopen"
-	  test -n "$dlpreopen" && dlprefiles="$dlprefiles $dlpreopen"
+	  test -n "$dlopen" && func_append dlfiles " $dlopen"
+	  test -n "$dlpreopen" && func_append dlprefiles " $dlpreopen"
 	fi
 
 	if test "$pass" = conv; then
@@ -5342,30 +6445,36 @@
 	      func_fatal_error "cannot find name of link library for \`$lib'"
 	    fi
 	    # It is a libtool convenience library, so add in its objects.
-	    convenience="$convenience $ladir/$objdir/$old_library"
-	    old_convenience="$old_convenience $ladir/$objdir/$old_library"
+	    func_append convenience " $ladir/$objdir/$old_library"
+	    func_append old_convenience " $ladir/$objdir/$old_library"
+	    tmp_libs=
+	    for deplib in $dependency_libs; do
+	      deplibs="$deplib $deplibs"
+	      if $opt_preserve_dup_deps ; then
+		case "$tmp_libs " in
+		*" $deplib "*) func_append specialdeplibs " $deplib" ;;
+		esac
+	      fi
+	      func_append tmp_libs " $deplib"
+	    done
 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
 	    func_fatal_error "\`$lib' is not a convenience library"
 	  fi
-	  tmp_libs=
-	  for deplib in $dependency_libs; do
-	    deplibs="$deplib $deplibs"
-	    if $opt_duplicate_deps ; then
-	      case "$tmp_libs " in
-	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
-	      esac
-	    fi
-	    tmp_libs="$tmp_libs $deplib"
-	  done
 	  continue
 	fi # $pass = conv
 
 
 	# Get the name of the library we link against.
 	linklib=
-	for l in $old_library $library_names; do
-	  linklib="$l"
-	done
+	if test -n "$old_library" &&
+	   { test "$prefer_static_libs" = yes ||
+	     test "$prefer_static_libs,$installed" = "built,no"; }; then
+	  linklib=$old_library
+	else
+	  for l in $old_library $library_names; do
+	    linklib="$l"
+	  done
+	fi
 	if test -z "$linklib"; then
 	  func_fatal_error "cannot find name of link library for \`$lib'"
 	fi
@@ -5382,9 +6491,9 @@
 	    # statically, we need to preload.  We also need to preload any
 	    # dependent libraries so libltdl's deplib preloader doesn't
 	    # bomb out in the load deplibs phase.
-	    dlprefiles="$dlprefiles $lib $dependency_libs"
+	    func_append dlprefiles " $lib $dependency_libs"
 	  else
-	    newdlfiles="$newdlfiles $lib"
+	    func_append newdlfiles " $lib"
 	  fi
 	  continue
 	fi # $pass = dlopen
@@ -5406,14 +6515,14 @@
 
 	# Find the relevant object directory and library name.
 	if test "X$installed" = Xyes; then
-	  if test ! -f "$libdir/$linklib" && test -f "$abs_ladir/$linklib"; then
+	  if test ! -f "$lt_sysroot$libdir/$linklib" && test -f "$abs_ladir/$linklib"; then
 	    func_warning "library \`$lib' was moved."
 	    dir="$ladir"
 	    absdir="$abs_ladir"
 	    libdir="$abs_ladir"
 	  else
-	    dir="$libdir"
-	    absdir="$libdir"
+	    dir="$lt_sysroot$libdir"
+	    absdir="$lt_sysroot$libdir"
 	  fi
 	  test "X$hardcode_automatic" = Xyes && avoidtemprpath=yes
 	else
@@ -5421,12 +6530,12 @@
 	    dir="$ladir"
 	    absdir="$abs_ladir"
 	    # Remove this search path later
-	    notinst_path="$notinst_path $abs_ladir"
+	    func_append notinst_path " $abs_ladir"
 	  else
 	    dir="$ladir/$objdir"
 	    absdir="$abs_ladir/$objdir"
 	    # Remove this search path later
-	    notinst_path="$notinst_path $abs_ladir"
+	    func_append notinst_path " $abs_ladir"
 	  fi
 	fi # $installed = yes
 	func_stripname 'lib' '.la' "$laname"
@@ -5437,20 +6546,46 @@
 	  if test -z "$libdir" && test "$linkmode" = prog; then
 	    func_fatal_error "only libraries may -dlpreopen a convenience library: \`$lib'"
 	  fi
-	  # Prefer using a static library (so that no silly _DYNAMIC symbols
-	  # are required to link).
-	  if test -n "$old_library"; then
-	    newdlprefiles="$newdlprefiles $dir/$old_library"
-	    # Keep a list of preopened convenience libraries to check
-	    # that they are being used correctly in the link pass.
-	    test -z "$libdir" && \
-		dlpreconveniencelibs="$dlpreconveniencelibs $dir/$old_library"
-	  # Otherwise, use the dlname, so that lt_dlopen finds it.
-	  elif test -n "$dlname"; then
-	    newdlprefiles="$newdlprefiles $dir/$dlname"
-	  else
-	    newdlprefiles="$newdlprefiles $dir/$linklib"
-	  fi
+	  case "$host" in
+	    # special handling for platforms with PE-DLLs.
+	    *cygwin* | *mingw* | *cegcc* )
+	      # Linker will automatically link against shared library if both
+	      # static and shared are present.  Therefore, ensure we extract
+	      # symbols from the import library if a shared library is present
+	      # (otherwise, the dlopen module name will be incorrect).  We do
+	      # this by putting the import library name into $newdlprefiles.
+	      # We recover the dlopen module name by 'saving' the la file
+	      # name in a special purpose variable, and (later) extracting the
+	      # dlname from the la file.
+	      if test -n "$dlname"; then
+	        func_tr_sh "$dir/$linklib"
+	        eval "libfile_$func_tr_sh_result=\$abs_ladir/\$laname"
+	        func_append newdlprefiles " $dir/$linklib"
+	      else
+	        func_append newdlprefiles " $dir/$old_library"
+	        # Keep a list of preopened convenience libraries to check
+	        # that they are being used correctly in the link pass.
+	        test -z "$libdir" && \
+	          func_append dlpreconveniencelibs " $dir/$old_library"
+	      fi
+	    ;;
+	    * )
+	      # Prefer using a static library (so that no silly _DYNAMIC symbols
+	      # are required to link).
+	      if test -n "$old_library"; then
+	        func_append newdlprefiles " $dir/$old_library"
+	        # Keep a list of preopened convenience libraries to check
+	        # that they are being used correctly in the link pass.
+	        test -z "$libdir" && \
+	          func_append dlpreconveniencelibs " $dir/$old_library"
+	      # Otherwise, use the dlname, so that lt_dlopen finds it.
+	      elif test -n "$dlname"; then
+	        func_append newdlprefiles " $dir/$dlname"
+	      else
+	        func_append newdlprefiles " $dir/$linklib"
+	      fi
+	    ;;
+	  esac
 	fi # $pass = dlpreopen
 
 	if test -z "$libdir"; then
@@ -5468,7 +6603,7 @@
 
 
 	if test "$linkmode" = prog && test "$pass" != link; then
-	  newlib_search_path="$newlib_search_path $ladir"
+	  func_append newlib_search_path " $ladir"
 	  deplibs="$lib $deplibs"
 
 	  linkalldeplibs=no
@@ -5481,7 +6616,8 @@
 	  for deplib in $dependency_libs; do
 	    case $deplib in
 	    -L*) func_stripname '-L' '' "$deplib"
-	         newlib_search_path="$newlib_search_path $func_stripname_result"
+	         func_resolve_sysroot "$func_stripname_result"
+	         func_append newlib_search_path " $func_resolve_sysroot_result"
 		 ;;
 	    esac
 	    # Need to link against all dependency_libs?
@@ -5492,12 +6628,12 @@
 	      # or/and link against static libraries
 	      newdependency_libs="$deplib $newdependency_libs"
 	    fi
-	    if $opt_duplicate_deps ; then
+	    if $opt_preserve_dup_deps ; then
 	      case "$tmp_libs " in
-	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	      esac
 	    fi
-	    tmp_libs="$tmp_libs $deplib"
+	    func_append tmp_libs " $deplib"
 	  done # for deplib
 	  continue
 	fi # $linkmode = prog...
@@ -5512,7 +6648,7 @@
 	      # Make sure the rpath contains only unique directories.
 	      case "$temp_rpath:" in
 	      *"$absdir:"*) ;;
-	      *) temp_rpath="$temp_rpath$absdir:" ;;
+	      *) func_append temp_rpath "$absdir:" ;;
 	      esac
 	    fi
 
@@ -5524,7 +6660,7 @@
 	    *)
 	      case "$compile_rpath " in
 	      *" $absdir "*) ;;
-	      *) compile_rpath="$compile_rpath $absdir"
+	      *) func_append compile_rpath " $absdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5533,7 +6669,7 @@
 	    *)
 	      case "$finalize_rpath " in
 	      *" $libdir "*) ;;
-	      *) finalize_rpath="$finalize_rpath $libdir"
+	      *) func_append finalize_rpath " $libdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5558,12 +6694,12 @@
 	  case $host in
 	  *cygwin* | *mingw* | *cegcc*)
 	      # No point in relinking DLLs because paths are not encoded
-	      notinst_deplibs="$notinst_deplibs $lib"
+	      func_append notinst_deplibs " $lib"
 	      need_relink=no
 	    ;;
 	  *)
 	    if test "$installed" = no; then
-	      notinst_deplibs="$notinst_deplibs $lib"
+	      func_append notinst_deplibs " $lib"
 	      need_relink=yes
 	    fi
 	    ;;
@@ -5580,7 +6716,7 @@
 	    fi
 	  done
 	  if test -z "$dlopenmodule" && test "$shouldnotlink" = yes && test "$pass" = link; then
-	    $ECHO
+	    echo
 	    if test "$linkmode" = prog; then
 	      $ECHO "*** Warning: Linking the executable $output against the loadable module"
 	    else
@@ -5598,7 +6734,7 @@
 	    *)
 	      case "$compile_rpath " in
 	      *" $absdir "*) ;;
-	      *) compile_rpath="$compile_rpath $absdir"
+	      *) func_append compile_rpath " $absdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5607,7 +6743,7 @@
 	    *)
 	      case "$finalize_rpath " in
 	      *" $libdir "*) ;;
-	      *) finalize_rpath="$finalize_rpath $libdir"
+	      *) func_append finalize_rpath " $libdir" ;;
 	      esac
 	      ;;
 	    esac
@@ -5661,7 +6797,7 @@
 	    linklib=$newlib
 	  fi # test -n "$old_archive_from_expsyms_cmds"
 
-	  if test "$linkmode" = prog || test "$mode" != relink; then
+	  if test "$linkmode" = prog || test "$opt_mode" != relink; then
 	    add_shlibpath=
 	    add_dir=
 	    add=
@@ -5683,9 +6819,9 @@
 		      if test "X$dlopenmodule" != "X$lib"; then
 			$ECHO "*** Warning: lib $linklib is a module, not a shared library"
 			if test -z "$old_library" ; then
-			  $ECHO
-			  $ECHO "*** And there doesn't seem to be a static archive available"
-			  $ECHO "*** The link will probably fail, sorry"
+			  echo
+			  echo "*** And there doesn't seem to be a static archive available"
+			  echo "*** The link will probably fail, sorry"
 			else
 			  add="$dir/$old_library"
 			fi
@@ -5712,12 +6848,12 @@
 	         test "$hardcode_direct_absolute" = no; then
 		add="$dir/$linklib"
 	      elif test "$hardcode_minus_L" = yes; then
-		add_dir="-L$dir"
+		add_dir="-L$absdir"
 		# Try looking first in the location we're being installed to.
 		if test -n "$inst_prefix_dir"; then
 		  case $libdir in
 		    [\\/]*)
-		      add_dir="$add_dir -L$inst_prefix_dir$libdir"
+		      func_append add_dir " -L$inst_prefix_dir$libdir"
 		      ;;
 		  esac
 		fi
@@ -5739,7 +6875,7 @@
 	    if test -n "$add_shlibpath"; then
 	      case :$compile_shlibpath: in
 	      *":$add_shlibpath:"*) ;;
-	      *) compile_shlibpath="$compile_shlibpath$add_shlibpath:" ;;
+	      *) func_append compile_shlibpath "$add_shlibpath:" ;;
 	      esac
 	    fi
 	    if test "$linkmode" = prog; then
@@ -5753,13 +6889,13 @@
 		 test "$hardcode_shlibpath_var" = yes; then
 		case :$finalize_shlibpath: in
 		*":$libdir:"*) ;;
-		*) finalize_shlibpath="$finalize_shlibpath$libdir:" ;;
+		*) func_append finalize_shlibpath "$libdir:" ;;
 		esac
 	      fi
 	    fi
 	  fi
 
-	  if test "$linkmode" = prog || test "$mode" = relink; then
+	  if test "$linkmode" = prog || test "$opt_mode" = relink; then
 	    add_shlibpath=
 	    add_dir=
 	    add=
@@ -5773,7 +6909,7 @@
 	    elif test "$hardcode_shlibpath_var" = yes; then
 	      case :$finalize_shlibpath: in
 	      *":$libdir:"*) ;;
-	      *) finalize_shlibpath="$finalize_shlibpath$libdir:" ;;
+	      *) func_append finalize_shlibpath "$libdir:" ;;
 	      esac
 	      add="-l$name"
 	    elif test "$hardcode_automatic" = yes; then
@@ -5790,7 +6926,7 @@
 	      if test -n "$inst_prefix_dir"; then
 		case $libdir in
 		  [\\/]*)
-		    add_dir="$add_dir -L$inst_prefix_dir$libdir"
+		    func_append add_dir " -L$inst_prefix_dir$libdir"
 		    ;;
 		esac
 	      fi
@@ -5825,21 +6961,21 @@
 
 	    # Just print a warning and add the library to dependency_libs so
 	    # that the program can be linked against the static library.
-	    $ECHO
+	    echo
 	    $ECHO "*** Warning: This system can not link to static lib archive $lib."
-	    $ECHO "*** I have the capability to make that library automatically link in when"
-	    $ECHO "*** you link to this library.  But I can only do this if you have a"
-	    $ECHO "*** shared version of the library, which you do not appear to have."
+	    echo "*** I have the capability to make that library automatically link in when"
+	    echo "*** you link to this library.  But I can only do this if you have a"
+	    echo "*** shared version of the library, which you do not appear to have."
 	    if test "$module" = yes; then
-	      $ECHO "*** But as you try to build a module library, libtool will still create "
-	      $ECHO "*** a static module, that should work as long as the dlopening application"
-	      $ECHO "*** is linked with the -dlopen flag to resolve symbols at runtime."
+	      echo "*** But as you try to build a module library, libtool will still create "
+	      echo "*** a static module, that should work as long as the dlopening application"
+	      echo "*** is linked with the -dlopen flag to resolve symbols at runtime."
 	      if test -z "$global_symbol_pipe"; then
-		$ECHO
-		$ECHO "*** However, this would only work if libtool was able to extract symbol"
-		$ECHO "*** lists from a program, using \`nm' or equivalent, but libtool could"
-		$ECHO "*** not find such a program.  So, this module is probably useless."
-		$ECHO "*** \`nm' from GNU binutils and a full rebuild may help."
+		echo
+		echo "*** However, this would only work if libtool was able to extract symbol"
+		echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
+		echo "*** not find such a program.  So, this module is probably useless."
+		echo "*** \`nm' from GNU binutils and a full rebuild may help."
 	      fi
 	      if test "$build_old_libs" = no; then
 		build_libtool_libs=module
@@ -5867,37 +7003,46 @@
 	           temp_xrpath=$func_stripname_result
 		   case " $xrpath " in
 		   *" $temp_xrpath "*) ;;
-		   *) xrpath="$xrpath $temp_xrpath";;
+		   *) func_append xrpath " $temp_xrpath";;
 		   esac;;
-	      *) temp_deplibs="$temp_deplibs $libdir";;
+	      *) func_append temp_deplibs " $libdir";;
 	      esac
 	    done
 	    dependency_libs="$temp_deplibs"
 	  fi
 
-	  newlib_search_path="$newlib_search_path $absdir"
+	  func_append newlib_search_path " $absdir"
 	  # Link against this library
 	  test "$link_static" = no && newdependency_libs="$abs_ladir/$laname $newdependency_libs"
 	  # ... and its dependency_libs
 	  tmp_libs=
 	  for deplib in $dependency_libs; do
 	    newdependency_libs="$deplib $newdependency_libs"
-	    if $opt_duplicate_deps ; then
+	    case $deplib in
+              -L*) func_stripname '-L' '' "$deplib"
+                   func_resolve_sysroot "$func_stripname_result";;
+              *) func_resolve_sysroot "$deplib" ;;
+            esac
+	    if $opt_preserve_dup_deps ; then
 	      case "$tmp_libs " in
-	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	      *" $func_resolve_sysroot_result "*)
+                func_append specialdeplibs " $func_resolve_sysroot_result" ;;
 	      esac
 	    fi
-	    tmp_libs="$tmp_libs $deplib"
+	    func_append tmp_libs " $func_resolve_sysroot_result"
 	  done
 
 	  if test "$link_all_deplibs" != no; then
 	    # Add the search paths of all dependency libraries
 	    for deplib in $dependency_libs; do
+	      path=
 	      case $deplib in
 	      -L*) path="$deplib" ;;
 	      *.la)
+	        func_resolve_sysroot "$deplib"
+	        deplib=$func_resolve_sysroot_result
 	        func_dirname "$deplib" "" "."
-		dir="$func_dirname_result"
+		dir=$func_dirname_result
 		# We need an absolute path.
 		case $dir in
 		[\\/]* | [A-Za-z]:[\\/]*) absdir="$dir" ;;
@@ -5924,8 +7069,8 @@
                       if test -z "$darwin_install_name"; then
                           darwin_install_name=`${OTOOL64} -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
                       fi
-		      compiler_flags="$compiler_flags ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"
-		      linker_flags="$linker_flags -dylib_file ${darwin_install_name}:${depdepl}"
+		      func_append compiler_flags " ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"
+		      func_append linker_flags " -dylib_file ${darwin_install_name}:${depdepl}"
 		      path=
 		    fi
 		  fi
@@ -5958,7 +7103,7 @@
 	  compile_deplibs="$new_inherited_linker_flags $compile_deplibs"
 	  finalize_deplibs="$new_inherited_linker_flags $finalize_deplibs"
 	else
-	  compiler_flags="$compiler_flags "`$ECHO "X $new_inherited_linker_flags" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  compiler_flags="$compiler_flags "`$ECHO " $new_inherited_linker_flags" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	fi
       fi
       dependency_libs="$newdependency_libs"
@@ -5975,7 +7120,7 @@
 	  for dir in $newlib_search_path; do
 	    case "$lib_search_path " in
 	    *" $dir "*) ;;
-	    *) lib_search_path="$lib_search_path $dir" ;;
+	    *) func_append lib_search_path " $dir" ;;
 	    esac
 	  done
 	  newlib_search_path=
@@ -6033,10 +7178,10 @@
 	    -L*)
 	      case " $tmp_libs " in
 	      *" $deplib "*) ;;
-	      *) tmp_libs="$tmp_libs $deplib" ;;
+	      *) func_append tmp_libs " $deplib" ;;
 	      esac
 	      ;;
-	    *) tmp_libs="$tmp_libs $deplib" ;;
+	    *) func_append tmp_libs " $deplib" ;;
 	    esac
 	  done
 	  eval $var=\"$tmp_libs\"
@@ -6052,7 +7197,7 @@
 	  ;;
 	esac
 	if test -n "$i" ; then
-	  tmp_libs="$tmp_libs $i"
+	  func_append tmp_libs " $i"
 	fi
       done
       dependency_libs=$tmp_libs
@@ -6093,7 +7238,7 @@
       # Now set the variables for building old libraries.
       build_libtool_libs=no
       oldlibs="$output"
-      objs="$objs$old_deplibs"
+      func_append objs "$old_deplibs"
       ;;
 
     lib)
@@ -6126,10 +7271,10 @@
 	if test "$deplibs_check_method" != pass_all; then
 	  func_fatal_error "cannot build libtool library \`$output' from non-libtool objects on this host:$objs"
 	else
-	  $ECHO
+	  echo
 	  $ECHO "*** Warning: Linking the shared library $output against the non-libtool"
 	  $ECHO "*** objects $objs is not portable!"
-	  libobjs="$libobjs $objs"
+	  func_append libobjs " $objs"
 	fi
       fi
 
@@ -6188,13 +7333,14 @@
 	  # which has an extra 1 added just for fun
 	  #
 	  case $version_type in
+	  # correct linux to gnu/linux during the next big refactor
 	  darwin|linux|osf|windows|none)
 	    func_arith $number_major + $number_minor
 	    current=$func_arith_result
 	    age="$number_minor"
 	    revision="$number_revision"
 	    ;;
-	  freebsd-aout|freebsd-elf|sunos)
+	  freebsd-aout|freebsd-elf|qnx|sunos)
 	    current="$number_major"
 	    revision="$number_minor"
 	    age="0"
@@ -6206,6 +7352,9 @@
 	    revision="$number_minor"
 	    lt_irix_increment=no
 	    ;;
+	  *)
+	    func_fatal_configuration "$modename: unknown library version type \`$version_type'"
+	    ;;
 	  esac
 	  ;;
 	no)
@@ -6304,7 +7453,7 @@
 	  versuffix="$major.$revision"
 	  ;;
 
-	linux)
+	linux) # correct to gnu/linux during the next big refactor
 	  func_arith $current - $age
 	  major=.$func_arith_result
 	  versuffix="$major.$age.$revision"
@@ -6327,7 +7476,7 @@
 	  done
 
 	  # Make executables depend on our current version.
-	  verstring="$verstring:${current}.0"
+	  func_append verstring ":${current}.0"
 	  ;;
 
 	qnx)
@@ -6395,10 +7544,10 @@
       fi
 
       func_generate_dlsyms "$libname" "$libname" "yes"
-      libobjs="$libobjs $symfileobj"
+      func_append libobjs " $symfileobj"
       test "X$libobjs" = "X " && libobjs=
 
-      if test "$mode" != relink; then
+      if test "$opt_mode" != relink; then
 	# Remove our outputs, but don't remove object files since they
 	# may have been created when compiling PIC objects.
 	removelist=
@@ -6414,7 +7563,7 @@
 		   continue
 		 fi
 	       fi
-	       removelist="$removelist $p"
+	       func_append removelist " $p"
 	       ;;
 	    *) ;;
 	  esac
@@ -6425,27 +7574,28 @@
 
       # Now set the variables for building old libraries.
       if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
-	oldlibs="$oldlibs $output_objdir/$libname.$libext"
+	func_append oldlibs " $output_objdir/$libname.$libext"
 
 	# Transform .lo files to .o files.
-	oldobjs="$objs "`$ECHO "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
+	oldobjs="$objs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; $lo2o" | $NL2SP`
       fi
 
       # Eliminate all temporary directories.
       #for path in $notinst_path; do
-      #	lib_search_path=`$ECHO "X$lib_search_path " | $Xsed -e "s% $path % %g"`
-      #	deplibs=`$ECHO "X$deplibs " | $Xsed -e "s% -L$path % %g"`
-      #	dependency_libs=`$ECHO "X$dependency_libs " | $Xsed -e "s% -L$path % %g"`
+      #	lib_search_path=`$ECHO "$lib_search_path " | $SED "s% $path % %g"`
+      #	deplibs=`$ECHO "$deplibs " | $SED "s% -L$path % %g"`
+      #	dependency_libs=`$ECHO "$dependency_libs " | $SED "s% -L$path % %g"`
       #done
 
       if test -n "$xrpath"; then
 	# If the user specified any rpath flags, then add them.
 	temp_xrpath=
 	for libdir in $xrpath; do
-	  temp_xrpath="$temp_xrpath -R$libdir"
+	  func_replace_sysroot "$libdir"
+	  func_append temp_xrpath " -R$func_replace_sysroot_result"
 	  case "$finalize_rpath " in
 	  *" $libdir "*) ;;
-	  *) finalize_rpath="$finalize_rpath $libdir" ;;
+	  *) func_append finalize_rpath " $libdir" ;;
 	  esac
 	done
 	if test "$hardcode_into_libs" != yes || test "$build_old_libs" = yes; then
@@ -6459,7 +7609,7 @@
       for lib in $old_dlfiles; do
 	case " $dlprefiles $dlfiles " in
 	*" $lib "*) ;;
-	*) dlfiles="$dlfiles $lib" ;;
+	*) func_append dlfiles " $lib" ;;
 	esac
       done
 
@@ -6469,19 +7619,19 @@
       for lib in $old_dlprefiles; do
 	case "$dlprefiles " in
 	*" $lib "*) ;;
-	*) dlprefiles="$dlprefiles $lib" ;;
+	*) func_append dlprefiles " $lib" ;;
 	esac
       done
 
       if test "$build_libtool_libs" = yes; then
 	if test -n "$rpath"; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # these systems don't actually have a c library (as such)!
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])
 	    # Rhapsody C library is in the System framework
-	    deplibs="$deplibs System.ltframework"
+	    func_append deplibs " System.ltframework"
 	    ;;
 	  *-*-netbsd*)
 	    # Don't link with libc until the a.out ld.so is fixed.
@@ -6498,7 +7648,7 @@
 	  *)
 	    # Add libc to deplibs on all other systems if necessary.
 	    if test "$build_libtool_need_lc" = "yes"; then
-	      deplibs="$deplibs -lc"
+	      func_append deplibs " -lc"
 	    fi
 	    ;;
 	  esac
@@ -6547,7 +7697,7 @@
 		if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		  case " $predeps $postdeps " in
 		  *" $i "*)
-		    newdeplibs="$newdeplibs $i"
+		    func_append newdeplibs " $i"
 		    i=""
 		    ;;
 		  esac
@@ -6558,21 +7708,21 @@
 		  set dummy $deplib_matches; shift
 		  deplib_match=$1
 		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
-		    newdeplibs="$newdeplibs $i"
+		    func_append newdeplibs " $i"
 		  else
 		    droppeddeps=yes
-		    $ECHO
+		    echo
 		    $ECHO "*** Warning: dynamic linker does not accept needed library $i."
-		    $ECHO "*** I have the capability to make that library automatically link in when"
-		    $ECHO "*** you link to this library.  But I can only do this if you have a"
-		    $ECHO "*** shared version of the library, which I believe you do not have"
-		    $ECHO "*** because a test_compile did reveal that the linker did not use it for"
-		    $ECHO "*** its dynamic dependency list that programs get resolved with at runtime."
+		    echo "*** I have the capability to make that library automatically link in when"
+		    echo "*** you link to this library.  But I can only do this if you have a"
+		    echo "*** shared version of the library, which I believe you do not have"
+		    echo "*** because a test_compile did reveal that the linker did not use it for"
+		    echo "*** its dynamic dependency list that programs get resolved with at runtime."
 		  fi
 		fi
 		;;
 	      *)
-		newdeplibs="$newdeplibs $i"
+		func_append newdeplibs " $i"
 		;;
 	      esac
 	    done
@@ -6590,7 +7740,7 @@
 		  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		    case " $predeps $postdeps " in
 		    *" $i "*)
-		      newdeplibs="$newdeplibs $i"
+		      func_append newdeplibs " $i"
 		      i=""
 		      ;;
 		    esac
@@ -6601,29 +7751,29 @@
 		    set dummy $deplib_matches; shift
 		    deplib_match=$1
 		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
-		      newdeplibs="$newdeplibs $i"
+		      func_append newdeplibs " $i"
 		    else
 		      droppeddeps=yes
-		      $ECHO
+		      echo
 		      $ECHO "*** Warning: dynamic linker does not accept needed library $i."
-		      $ECHO "*** I have the capability to make that library automatically link in when"
-		      $ECHO "*** you link to this library.  But I can only do this if you have a"
-		      $ECHO "*** shared version of the library, which you do not appear to have"
-		      $ECHO "*** because a test_compile did reveal that the linker did not use this one"
-		      $ECHO "*** as a dynamic dependency that programs can get resolved with at runtime."
+		      echo "*** I have the capability to make that library automatically link in when"
+		      echo "*** you link to this library.  But I can only do this if you have a"
+		      echo "*** shared version of the library, which you do not appear to have"
+		      echo "*** because a test_compile did reveal that the linker did not use this one"
+		      echo "*** as a dynamic dependency that programs can get resolved with at runtime."
 		    fi
 		  fi
 		else
 		  droppeddeps=yes
-		  $ECHO
+		  echo
 		  $ECHO "*** Warning!  Library $i is needed by this library but I was not able to"
-		  $ECHO "*** make it link in!  You will probably need to install it or some"
-		  $ECHO "*** library that it depends on before this library will be fully"
-		  $ECHO "*** functional.  Installing it before continuing would be even better."
+		  echo "*** make it link in!  You will probably need to install it or some"
+		  echo "*** library that it depends on before this library will be fully"
+		  echo "*** functional.  Installing it before continuing would be even better."
 		fi
 		;;
 	      *)
-		newdeplibs="$newdeplibs $i"
+		func_append newdeplibs " $i"
 		;;
 	      esac
 	    done
@@ -6640,15 +7790,27 @@
 	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		case " $predeps $postdeps " in
 		*" $a_deplib "*)
-		  newdeplibs="$newdeplibs $a_deplib"
+		  func_append newdeplibs " $a_deplib"
 		  a_deplib=""
 		  ;;
 		esac
 	      fi
 	      if test -n "$a_deplib" ; then
 		libname=`eval "\\$ECHO \"$libname_spec\""`
+		if test -n "$file_magic_glob"; then
+		  libnameglob=`func_echo_all "$libname" | $SED -e $file_magic_glob`
+		else
+		  libnameglob=$libname
+		fi
+		test "$want_nocaseglob" = yes && nocaseglob=`shopt -p nocaseglob`
 		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
+		  if test "$want_nocaseglob" = yes; then
+		    shopt -s nocaseglob
+		    potential_libs=`ls $i/$libnameglob[.-]* 2>/dev/null`
+		    $nocaseglob
+		  else
+		    potential_libs=`ls $i/$libnameglob[.-]* 2>/dev/null`
+		  fi
 		  for potent_lib in $potential_libs; do
 		      # Follow soft links.
 		      if ls -lLd "$potent_lib" 2>/dev/null |
@@ -6665,13 +7827,13 @@
 			potliblink=`ls -ld $potlib | ${SED} 's/.* -> //'`
 			case $potliblink in
 			[\\/]* | [A-Za-z]:[\\/]*) potlib="$potliblink";;
-			*) potlib=`$ECHO "X$potlib" | $Xsed -e 's,[^/]*$,,'`"$potliblink";;
+			*) potlib=`$ECHO "$potlib" | $SED 's,[^/]*$,,'`"$potliblink";;
 			esac
 		      done
 		      if eval $file_magic_cmd \"\$potlib\" 2>/dev/null |
 			 $SED -e 10q |
 			 $EGREP "$file_magic_regex" > /dev/null; then
-			newdeplibs="$newdeplibs $a_deplib"
+			func_append newdeplibs " $a_deplib"
 			a_deplib=""
 			break 2
 		      fi
@@ -6680,12 +7842,12 @@
 	      fi
 	      if test -n "$a_deplib" ; then
 		droppeddeps=yes
-		$ECHO
+		echo
 		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
-		$ECHO "*** I have the capability to make that library automatically link in when"
-		$ECHO "*** you link to this library.  But I can only do this if you have a"
-		$ECHO "*** shared version of the library, which you do not appear to have"
-		$ECHO "*** because I did check the linker path looking for a file starting"
+		echo "*** I have the capability to make that library automatically link in when"
+		echo "*** you link to this library.  But I can only do this if you have a"
+		echo "*** shared version of the library, which you do not appear to have"
+		echo "*** because I did check the linker path looking for a file starting"
 		if test -z "$potlib" ; then
 		  $ECHO "*** with $libname but no candidates were found. (...for file magic test)"
 		else
@@ -6696,7 +7858,7 @@
 	      ;;
 	    *)
 	      # Add a -L argument.
-	      newdeplibs="$newdeplibs $a_deplib"
+	      func_append newdeplibs " $a_deplib"
 	      ;;
 	    esac
 	  done # Gone through all deplibs.
@@ -6712,7 +7874,7 @@
 	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 		case " $predeps $postdeps " in
 		*" $a_deplib "*)
-		  newdeplibs="$newdeplibs $a_deplib"
+		  func_append newdeplibs " $a_deplib"
 		  a_deplib=""
 		  ;;
 		esac
@@ -6723,9 +7885,9 @@
 		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
 		  for potent_lib in $potential_libs; do
 		    potlib="$potent_lib" # see symlink-check above in file_magic test
-		    if eval "\$ECHO \"X$potent_lib\"" 2>/dev/null | $Xsed -e 10q | \
+		    if eval "\$ECHO \"$potent_lib\"" 2>/dev/null | $SED 10q | \
 		       $EGREP "$match_pattern_regex" > /dev/null; then
-		      newdeplibs="$newdeplibs $a_deplib"
+		      func_append newdeplibs " $a_deplib"
 		      a_deplib=""
 		      break 2
 		    fi
@@ -6734,12 +7896,12 @@
 	      fi
 	      if test -n "$a_deplib" ; then
 		droppeddeps=yes
-		$ECHO
+		echo
 		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
-		$ECHO "*** I have the capability to make that library automatically link in when"
-		$ECHO "*** you link to this library.  But I can only do this if you have a"
-		$ECHO "*** shared version of the library, which you do not appear to have"
-		$ECHO "*** because I did check the linker path looking for a file starting"
+		echo "*** I have the capability to make that library automatically link in when"
+		echo "*** you link to this library.  But I can only do this if you have a"
+		echo "*** shared version of the library, which you do not appear to have"
+		echo "*** because I did check the linker path looking for a file starting"
 		if test -z "$potlib" ; then
 		  $ECHO "*** with $libname but no candidates were found. (...for regex pattern test)"
 		else
@@ -6750,32 +7912,32 @@
 	      ;;
 	    *)
 	      # Add a -L argument.
-	      newdeplibs="$newdeplibs $a_deplib"
+	      func_append newdeplibs " $a_deplib"
 	      ;;
 	    esac
 	  done # Gone through all deplibs.
 	  ;;
 	none | unknown | *)
 	  newdeplibs=""
-	  tmp_deplibs=`$ECHO "X $deplibs" | $Xsed \
-	      -e 's/ -lc$//' -e 's/ -[LR][^ ]*//g'`
+	  tmp_deplibs=`$ECHO " $deplibs" | $SED 's/ -lc$//; s/ -[LR][^ ]*//g'`
 	  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 	    for i in $predeps $postdeps ; do
 	      # can't use Xsed below, because $i might contain '/'
-	      tmp_deplibs=`$ECHO "X $tmp_deplibs" | $Xsed -e "s,$i,,"`
+	      tmp_deplibs=`$ECHO " $tmp_deplibs" | $SED "s,$i,,"`
 	    done
 	  fi
-	  if $ECHO "X $tmp_deplibs" | $Xsed -e 's/[	 ]//g' |
-	     $GREP . >/dev/null; then
-	    $ECHO
+	  case $tmp_deplibs in
+	  *[!\	\ ]*)
+	    echo
 	    if test "X$deplibs_check_method" = "Xnone"; then
-	      $ECHO "*** Warning: inter-library dependencies are not supported in this platform."
+	      echo "*** Warning: inter-library dependencies are not supported in this platform."
 	    else
-	      $ECHO "*** Warning: inter-library dependencies are not known to be supported."
+	      echo "*** Warning: inter-library dependencies are not known to be supported."
 	    fi
-	    $ECHO "*** All declared inter-library dependencies are being dropped."
+	    echo "*** All declared inter-library dependencies are being dropped."
 	    droppeddeps=yes
-	  fi
+	    ;;
+	  esac
 	  ;;
 	esac
 	versuffix=$versuffix_save
@@ -6787,23 +7949,23 @@
 	case $host in
 	*-*-rhapsody* | *-*-darwin1.[012])
 	  # On Rhapsody replace the C library with the System framework
-	  newdeplibs=`$ECHO "X $newdeplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	  newdeplibs=`$ECHO " $newdeplibs" | $SED 's/ -lc / System.ltframework /'`
 	  ;;
 	esac
 
 	if test "$droppeddeps" = yes; then
 	  if test "$module" = yes; then
-	    $ECHO
-	    $ECHO "*** Warning: libtool could not satisfy all declared inter-library"
+	    echo
+	    echo "*** Warning: libtool could not satisfy all declared inter-library"
 	    $ECHO "*** dependencies of module $libname.  Therefore, libtool will create"
-	    $ECHO "*** a static module, that should work as long as the dlopening"
-	    $ECHO "*** application is linked with the -dlopen flag."
+	    echo "*** a static module, that should work as long as the dlopening"
+	    echo "*** application is linked with the -dlopen flag."
 	    if test -z "$global_symbol_pipe"; then
-	      $ECHO
-	      $ECHO "*** However, this would only work if libtool was able to extract symbol"
-	      $ECHO "*** lists from a program, using \`nm' or equivalent, but libtool could"
-	      $ECHO "*** not find such a program.  So, this module is probably useless."
-	      $ECHO "*** \`nm' from GNU binutils and a full rebuild may help."
+	      echo
+	      echo "*** However, this would only work if libtool was able to extract symbol"
+	      echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
+	      echo "*** not find such a program.  So, this module is probably useless."
+	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
 	    fi
 	    if test "$build_old_libs" = no; then
 	      oldlibs="$output_objdir/$libname.$libext"
@@ -6813,16 +7975,16 @@
 	      build_libtool_libs=no
 	    fi
 	  else
-	    $ECHO "*** The inter-library dependencies that have been dropped here will be"
-	    $ECHO "*** automatically added whenever a program is linked with this library"
-	    $ECHO "*** or is declared to -dlopen it."
+	    echo "*** The inter-library dependencies that have been dropped here will be"
+	    echo "*** automatically added whenever a program is linked with this library"
+	    echo "*** or is declared to -dlopen it."
 
 	    if test "$allow_undefined" = no; then
-	      $ECHO
-	      $ECHO "*** Since this library must not contain undefined symbols,"
-	      $ECHO "*** because either the platform does not support them or"
-	      $ECHO "*** it was explicitly requested with -no-undefined,"
-	      $ECHO "*** libtool will only create a static version of it."
+	      echo
+	      echo "*** Since this library must not contain undefined symbols,"
+	      echo "*** because either the platform does not support them or"
+	      echo "*** it was explicitly requested with -no-undefined,"
+	      echo "*** libtool will only create a static version of it."
 	      if test "$build_old_libs" = no; then
 		oldlibs="$output_objdir/$libname.$libext"
 		build_libtool_libs=module
@@ -6839,9 +8001,9 @@
       # Time to change all our "foo.ltframework" stuff back to "-framework foo"
       case $host in
 	*-*-darwin*)
-	  newdeplibs=`$ECHO "X $newdeplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	  new_inherited_linker_flags=`$ECHO "X $new_inherited_linker_flags" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	  deplibs=`$ECHO "X $deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  newdeplibs=`$ECHO " $newdeplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  new_inherited_linker_flags=`$ECHO " $new_inherited_linker_flags" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  deplibs=`$ECHO " $deplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	  ;;
       esac
 
@@ -6854,7 +8016,7 @@
 	*)
 	  case " $deplibs " in
 	  *" -L$path/$objdir "*)
-	    new_libs="$new_libs -L$path/$objdir" ;;
+	    func_append new_libs " -L$path/$objdir" ;;
 	  esac
 	  ;;
 	esac
@@ -6864,10 +8026,10 @@
 	-L*)
 	  case " $new_libs " in
 	  *" $deplib "*) ;;
-	  *) new_libs="$new_libs $deplib" ;;
+	  *) func_append new_libs " $deplib" ;;
 	  esac
 	  ;;
-	*) new_libs="$new_libs $deplib" ;;
+	*) func_append new_libs " $deplib" ;;
 	esac
       done
       deplibs="$new_libs"
@@ -6879,15 +8041,22 @@
 
       # Test again, we may have decided not to build it any more
       if test "$build_libtool_libs" = yes; then
+	# Remove ${wl} instances when linking with ld.
+	# FIXME: should test the right _cmds variable.
+	case $archive_cmds in
+	  *\$LD\ *) wl= ;;
+        esac
 	if test "$hardcode_into_libs" = yes; then
 	  # Hardcode the library paths
 	  hardcode_libdirs=
 	  dep_rpath=
 	  rpath="$finalize_rpath"
-	  test "$mode" != relink && rpath="$compile_rpath$rpath"
+	  test "$opt_mode" != relink && rpath="$compile_rpath$rpath"
 	  for libdir in $rpath; do
 	    if test -n "$hardcode_libdir_flag_spec"; then
 	      if test -n "$hardcode_libdir_separator"; then
+		func_replace_sysroot "$libdir"
+		libdir=$func_replace_sysroot_result
 		if test -z "$hardcode_libdirs"; then
 		  hardcode_libdirs="$libdir"
 		else
@@ -6896,18 +8065,18 @@
 		  *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
 		    ;;
 		  *)
-		    hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
+		    func_append hardcode_libdirs "$hardcode_libdir_separator$libdir"
 		    ;;
 		  esac
 		fi
 	      else
 		eval flag=\"$hardcode_libdir_flag_spec\"
-		dep_rpath="$dep_rpath $flag"
+		func_append dep_rpath " $flag"
 	      fi
 	    elif test -n "$runpath_var"; then
 	      case "$perm_rpath " in
 	      *" $libdir "*) ;;
-	      *) perm_rpath="$perm_rpath $libdir" ;;
+	      *) func_append perm_rpath " $libdir" ;;
 	      esac
 	    fi
 	  done
@@ -6915,17 +8084,13 @@
 	  if test -n "$hardcode_libdir_separator" &&
 	     test -n "$hardcode_libdirs"; then
 	    libdir="$hardcode_libdirs"
-	    if test -n "$hardcode_libdir_flag_spec_ld"; then
-	      eval dep_rpath=\"$hardcode_libdir_flag_spec_ld\"
-	    else
-	      eval dep_rpath=\"$hardcode_libdir_flag_spec\"
-	    fi
+	    eval "dep_rpath=\"$hardcode_libdir_flag_spec\""
 	  fi
 	  if test -n "$runpath_var" && test -n "$perm_rpath"; then
 	    # We should set the runpath_var.
 	    rpath=
 	    for dir in $perm_rpath; do
-	      rpath="$rpath$dir:"
+	      func_append rpath "$dir:"
 	    done
 	    eval "$runpath_var='$rpath\$$runpath_var'; export $runpath_var"
 	  fi
@@ -6933,7 +8098,7 @@
 	fi
 
 	shlibpath="$finalize_shlibpath"
-	test "$mode" != relink && shlibpath="$compile_shlibpath$shlibpath"
+	test "$opt_mode" != relink && shlibpath="$compile_shlibpath$shlibpath"
 	if test -n "$shlibpath"; then
 	  eval "$shlibpath_var='$shlibpath\$$shlibpath_var'; export $shlibpath_var"
 	fi
@@ -6959,18 +8124,18 @@
 	linknames=
 	for link
 	do
-	  linknames="$linknames $link"
+	  func_append linknames " $link"
 	done
 
 	# Use standard objects if they are pic
-	test -z "$pic_flag" && libobjs=`$ECHO "X$libobjs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	test -z "$pic_flag" && libobjs=`$ECHO "$libobjs" | $SP2NL | $SED "$lo2o" | $NL2SP`
 	test "X$libobjs" = "X " && libobjs=
 
 	delfiles=
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	  $opt_dry_run || cp "$export_symbols" "$output_objdir/$libname.uexp"
 	  export_symbols="$output_objdir/$libname.uexp"
-	  delfiles="$delfiles $export_symbols"
+	  func_append delfiles " $export_symbols"
 	fi
 
 	orig_export_symbols=
@@ -7001,13 +8166,45 @@
 	    $opt_dry_run || $RM $export_symbols
 	    cmds=$export_symbols_cmds
 	    save_ifs="$IFS"; IFS='~'
-	    for cmd in $cmds; do
+	    for cmd1 in $cmds; do
 	      IFS="$save_ifs"
-	      eval cmd=\"$cmd\"
-	      func_len " $cmd"
-	      len=$func_len_result
-	      if test "$len" -lt "$max_cmd_len" || test "$max_cmd_len" -le -1; then
+	      # Take the normal branch if the nm_file_list_spec branch
+	      # doesn't work or if tool conversion is not needed.
+	      case $nm_file_list_spec~$to_tool_file_cmd in
+		*~func_convert_file_noop | *~func_convert_file_msys_to_w32 | ~*)
+		  try_normal_branch=yes
+		  eval cmd=\"$cmd1\"
+		  func_len " $cmd"
+		  len=$func_len_result
+		  ;;
+		*)
+		  try_normal_branch=no
+		  ;;
+	      esac
+	      if test "$try_normal_branch" = yes \
+		 && { test "$len" -lt "$max_cmd_len" \
+		      || test "$max_cmd_len" -le -1; }
+	      then
+		func_show_eval "$cmd" 'exit $?'
+		skipped_export=false
+	      elif test -n "$nm_file_list_spec"; then
+		func_basename "$output"
+		output_la=$func_basename_result
+		save_libobjs=$libobjs
+		save_output=$output
+		output=${output_objdir}/${output_la}.nm
+		func_to_tool_file "$output"
+		libobjs=$nm_file_list_spec$func_to_tool_file_result
+		func_append delfiles " $output"
+		func_verbose "creating $NM input file list: $output"
+		for obj in $save_libobjs; do
+		  func_to_tool_file "$obj"
+		  $ECHO "$func_to_tool_file_result"
+		done > "$output"
+		eval cmd=\"$cmd1\"
 		func_show_eval "$cmd" 'exit $?'
+		output=$save_output
+		libobjs=$save_libobjs
 		skipped_export=false
 	      else
 		# The command line is too long to execute in one step.
@@ -7029,7 +8226,7 @@
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	  tmp_export_symbols="$export_symbols"
 	  test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
-	  $opt_dry_run || eval '$ECHO "X$include_expsyms" | $Xsed | $SP2NL >> "$tmp_export_symbols"'
+	  $opt_dry_run || eval '$ECHO "$include_expsyms" | $SP2NL >> "$tmp_export_symbols"'
 	fi
 
 	if test "X$skipped_export" != "X:" && test -n "$orig_export_symbols"; then
@@ -7041,7 +8238,7 @@
 	  # global variables. join(1) would be nice here, but unfortunately
 	  # isn't a blessed tool.
 	  $opt_dry_run || $SED -e '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' < $export_symbols > $output_objdir/$libname.filter
-	  delfiles="$delfiles $export_symbols $output_objdir/$libname.filter"
+	  func_append delfiles " $export_symbols $output_objdir/$libname.filter"
 	  export_symbols=$output_objdir/$libname.def
 	  $opt_dry_run || $SED -f $output_objdir/$libname.filter < $orig_export_symbols > $export_symbols
 	fi
@@ -7051,7 +8248,7 @@
 	  case " $convenience " in
 	  *" $test_deplib "*) ;;
 	  *)
-	    tmp_deplibs="$tmp_deplibs $test_deplib"
+	    func_append tmp_deplibs " $test_deplib"
 	    ;;
 	  esac
 	done
@@ -7071,21 +8268,21 @@
 	    test "X$libobjs" = "X " && libobjs=
 	  else
 	    gentop="$output_objdir/${outputname}x"
-	    generated="$generated $gentop"
+	    func_append generated " $gentop"
 
 	    func_extract_archives $gentop $convenience
-	    libobjs="$libobjs $func_extract_archives_result"
+	    func_append libobjs " $func_extract_archives_result"
 	    test "X$libobjs" = "X " && libobjs=
 	  fi
 	fi
 
 	if test "$thread_safe" = yes && test -n "$thread_safe_flag_spec"; then
 	  eval flag=\"$thread_safe_flag_spec\"
-	  linker_flags="$linker_flags $flag"
+	  func_append linker_flags " $flag"
 	fi
 
 	# Make a backup of the uninstalled library when relinking
-	if test "$mode" = relink; then
+	if test "$opt_mode" = relink; then
 	  $opt_dry_run || eval '(cd $output_objdir && $RM ${realname}U && $MV $realname ${realname}U)' || exit $?
 	fi
 
@@ -7130,7 +8327,8 @@
 	    save_libobjs=$libobjs
 	  fi
 	  save_output=$output
-	  output_la=`$ECHO "X$output" | $Xsed -e "$basename"`
+	  func_basename "$output"
+	  output_la=$func_basename_result
 
 	  # Clear the reloadable object creation command queue and
 	  # initialize k to one.
@@ -7143,13 +8341,16 @@
 	  if test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "$with_gnu_ld" = yes; then
 	    output=${output_objdir}/${output_la}.lnkscript
 	    func_verbose "creating GNU ld script: $output"
-	    $ECHO 'INPUT (' > $output
+	    echo 'INPUT (' > $output
 	    for obj in $save_libobjs
 	    do
-	      $ECHO "$obj" >> $output
+	      func_to_tool_file "$obj"
+	      $ECHO "$func_to_tool_file_result" >> $output
 	    done
-	    $ECHO ')' >> $output
-	    delfiles="$delfiles $output"
+	    echo ')' >> $output
+	    func_append delfiles " $output"
+	    func_to_tool_file "$output"
+	    output=$func_to_tool_file_result
 	  elif test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "X$file_list_spec" != X; then
 	    output=${output_objdir}/${output_la}.lnk
 	    func_verbose "creating linker input file list: $output"
@@ -7163,10 +8364,12 @@
 	    fi
 	    for obj
 	    do
-	      $ECHO "$obj" >> $output
+	      func_to_tool_file "$obj"
+	      $ECHO "$func_to_tool_file_result" >> $output
 	    done
-	    delfiles="$delfiles $output"
-	    output=$firstobj\"$file_list_spec$output\"
+	    func_append delfiles " $output"
+	    func_to_tool_file "$output"
+	    output=$firstobj\"$file_list_spec$func_to_tool_file_result\"
 	  else
 	    if test -n "$save_libobjs"; then
 	      func_verbose "creating reloadable object files..."
@@ -7190,17 +8393,19 @@
 		  # command to the queue.
 		  if test "$k" -eq 1 ; then
 		    # The first file doesn't have a previous command to add.
-		    eval concat_cmds=\"$reload_cmds $objlist $last_robj\"
+		    reload_objs=$objlist
+		    eval concat_cmds=\"$reload_cmds\"
 		  else
 		    # All subsequent reloadable object files will link in
 		    # the last one created.
-		    eval concat_cmds=\"\$concat_cmds~$reload_cmds $objlist $last_robj~\$RM $last_robj\"
+		    reload_objs="$objlist $last_robj"
+		    eval concat_cmds=\"\$concat_cmds~$reload_cmds~\$RM $last_robj\"
 		  fi
 		  last_robj=$output_objdir/$output_la-${k}.$objext
 		  func_arith $k + 1
 		  k=$func_arith_result
 		  output=$output_objdir/$output_la-${k}.$objext
-		  objlist=$obj
+		  objlist=" $obj"
 		  func_len " $last_robj"
 		  func_arith $len0 + $func_len_result
 		  len=$func_arith_result
@@ -7210,11 +8415,12 @@
 	      # reloadable object file.  All subsequent reloadable object
 	      # files will link in the last one created.
 	      test -z "$concat_cmds" || concat_cmds=$concat_cmds~
-	      eval concat_cmds=\"\${concat_cmds}$reload_cmds $objlist $last_robj\"
+	      reload_objs="$objlist $last_robj"
+	      eval concat_cmds=\"\${concat_cmds}$reload_cmds\"
 	      if test -n "$last_robj"; then
 	        eval concat_cmds=\"\${concat_cmds}~\$RM $last_robj\"
 	      fi
-	      delfiles="$delfiles $output"
+	      func_append delfiles " $output"
 
 	    else
 	      output=
@@ -7248,7 +8454,7 @@
 		lt_exit=$?
 
 		# Restore the uninstalled library and exit
-		if test "$mode" = relink; then
+		if test "$opt_mode" = relink; then
 		  ( cd "$output_objdir" && \
 		    $RM "${realname}T" && \
 		    $MV "${realname}U" "$realname" )
@@ -7269,7 +8475,7 @@
 	    if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	      tmp_export_symbols="$export_symbols"
 	      test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
-	      $opt_dry_run || eval '$ECHO "X$include_expsyms" | $Xsed | $SP2NL >> "$tmp_export_symbols"'
+	      $opt_dry_run || eval '$ECHO "$include_expsyms" | $SP2NL >> "$tmp_export_symbols"'
 	    fi
 
 	    if test -n "$orig_export_symbols"; then
@@ -7281,7 +8487,7 @@
 	      # global variables. join(1) would be nice here, but unfortunately
 	      # isn't a blessed tool.
 	      $opt_dry_run || $SED -e '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' < $export_symbols > $output_objdir/$libname.filter
-	      delfiles="$delfiles $export_symbols $output_objdir/$libname.filter"
+	      func_append delfiles " $export_symbols $output_objdir/$libname.filter"
 	      export_symbols=$output_objdir/$libname.def
 	      $opt_dry_run || $SED -f $output_objdir/$libname.filter < $orig_export_symbols > $export_symbols
 	    fi
@@ -7322,10 +8528,10 @@
 	# Add any objects from preloaded convenience libraries
 	if test -n "$dlprefiles"; then
 	  gentop="$output_objdir/${outputname}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $dlprefiles
-	  libobjs="$libobjs $func_extract_archives_result"
+	  func_append libobjs " $func_extract_archives_result"
 	  test "X$libobjs" = "X " && libobjs=
 	fi
 
@@ -7341,7 +8547,7 @@
 	    lt_exit=$?
 
 	    # Restore the uninstalled library and exit
-	    if test "$mode" = relink; then
+	    if test "$opt_mode" = relink; then
 	      ( cd "$output_objdir" && \
 	        $RM "${realname}T" && \
 		$MV "${realname}U" "$realname" )
@@ -7353,7 +8559,7 @@
 	IFS="$save_ifs"
 
 	# Restore the uninstalled library and exit
-	if test "$mode" = relink; then
+	if test "$opt_mode" = relink; then
 	  $opt_dry_run || eval '(cd $output_objdir && $RM ${realname}T && $MV $realname ${realname}T && $MV ${realname}U $realname)' || exit $?
 
 	  if test -n "$convenience"; then
@@ -7434,18 +8640,21 @@
       if test -n "$convenience"; then
 	if test -n "$whole_archive_flag_spec"; then
 	  eval tmp_whole_archive_flags=\"$whole_archive_flag_spec\"
-	  reload_conv_objs=$reload_objs\ `$ECHO "X$tmp_whole_archive_flags" | $Xsed -e 's|,| |g'`
+	  reload_conv_objs=$reload_objs\ `$ECHO "$tmp_whole_archive_flags" | $SED 's|,| |g'`
 	else
 	  gentop="$output_objdir/${obj}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $convenience
 	  reload_conv_objs="$reload_objs $func_extract_archives_result"
 	fi
       fi
 
+      # If we're not building shared, we need to use non_pic_objs
+      test "$build_libtool_libs" != yes && libobjs="$non_pic_objects"
+
       # Create the old-style object.
-      reload_objs="$objs$old_deplibs "`$ECHO "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e "$lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
+      reload_objs="$objs$old_deplibs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; /\.lib$/d; $lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
 
       output="$obj"
       func_execute_cmds "$reload_cmds" 'exit $?'
@@ -7505,8 +8714,8 @@
       case $host in
       *-*-rhapsody* | *-*-darwin1.[012])
 	# On Rhapsody replace the C library is the System framework
-	compile_deplibs=`$ECHO "X $compile_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
-	finalize_deplibs=`$ECHO "X $finalize_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	compile_deplibs=`$ECHO " $compile_deplibs" | $SED 's/ -lc / System.ltframework /'`
+	finalize_deplibs=`$ECHO " $finalize_deplibs" | $SED 's/ -lc / System.ltframework /'`
 	;;
       esac
 
@@ -7517,14 +8726,14 @@
 	if test "$tagname" = CXX ; then
 	  case ${MACOSX_DEPLOYMENT_TARGET-10.0} in
 	    10.[0123])
-	      compile_command="$compile_command ${wl}-bind_at_load"
-	      finalize_command="$finalize_command ${wl}-bind_at_load"
+	      func_append compile_command " ${wl}-bind_at_load"
+	      func_append finalize_command " ${wl}-bind_at_load"
 	    ;;
 	  esac
 	fi
 	# Time to change all our "foo.ltframework" stuff back to "-framework foo"
-	compile_deplibs=`$ECHO "X $compile_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	finalize_deplibs=`$ECHO "X $finalize_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	compile_deplibs=`$ECHO " $compile_deplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	finalize_deplibs=`$ECHO " $finalize_deplibs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	;;
       esac
 
@@ -7538,7 +8747,7 @@
 	*)
 	  case " $compile_deplibs " in
 	  *" -L$path/$objdir "*)
-	    new_libs="$new_libs -L$path/$objdir" ;;
+	    func_append new_libs " -L$path/$objdir" ;;
 	  esac
 	  ;;
 	esac
@@ -7548,17 +8757,17 @@
 	-L*)
 	  case " $new_libs " in
 	  *" $deplib "*) ;;
-	  *) new_libs="$new_libs $deplib" ;;
+	  *) func_append new_libs " $deplib" ;;
 	  esac
 	  ;;
-	*) new_libs="$new_libs $deplib" ;;
+	*) func_append new_libs " $deplib" ;;
 	esac
       done
       compile_deplibs="$new_libs"
 
 
-      compile_command="$compile_command $compile_deplibs"
-      finalize_command="$finalize_command $finalize_deplibs"
+      func_append compile_command " $compile_deplibs"
+      func_append finalize_command " $finalize_deplibs"
 
       if test -n "$rpath$xrpath"; then
 	# If the user specified any rpath flags, then add them.
@@ -7566,7 +8775,7 @@
 	  # This is the magic to use -rpath.
 	  case "$finalize_rpath " in
 	  *" $libdir "*) ;;
-	  *) finalize_rpath="$finalize_rpath $libdir" ;;
+	  *) func_append finalize_rpath " $libdir" ;;
 	  esac
 	done
       fi
@@ -7585,18 +8794,18 @@
 	      *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
 		;;
 	      *)
-		hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
+		func_append hardcode_libdirs "$hardcode_libdir_separator$libdir"
 		;;
 	      esac
 	    fi
 	  else
 	    eval flag=\"$hardcode_libdir_flag_spec\"
-	    rpath="$rpath $flag"
+	    func_append rpath " $flag"
 	  fi
 	elif test -n "$runpath_var"; then
 	  case "$perm_rpath " in
 	  *" $libdir "*) ;;
-	  *) perm_rpath="$perm_rpath $libdir" ;;
+	  *) func_append perm_rpath " $libdir" ;;
 	  esac
 	fi
 	case $host in
@@ -7605,12 +8814,12 @@
 	  case :$dllsearchpath: in
 	  *":$libdir:"*) ;;
 	  ::) dllsearchpath=$libdir;;
-	  *) dllsearchpath="$dllsearchpath:$libdir";;
+	  *) func_append dllsearchpath ":$libdir";;
 	  esac
 	  case :$dllsearchpath: in
 	  *":$testbindir:"*) ;;
 	  ::) dllsearchpath=$testbindir;;
-	  *) dllsearchpath="$dllsearchpath:$testbindir";;
+	  *) func_append dllsearchpath ":$testbindir";;
 	  esac
 	  ;;
 	esac
@@ -7636,18 +8845,18 @@
 	      *"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"*)
 		;;
 	      *)
-		hardcode_libdirs="$hardcode_libdirs$hardcode_libdir_separator$libdir"
+		func_append hardcode_libdirs "$hardcode_libdir_separator$libdir"
 		;;
 	      esac
 	    fi
 	  else
 	    eval flag=\"$hardcode_libdir_flag_spec\"
-	    rpath="$rpath $flag"
+	    func_append rpath " $flag"
 	  fi
 	elif test -n "$runpath_var"; then
 	  case "$finalize_perm_rpath " in
 	  *" $libdir "*) ;;
-	  *) finalize_perm_rpath="$finalize_perm_rpath $libdir" ;;
+	  *) func_append finalize_perm_rpath " $libdir" ;;
 	  esac
 	fi
       done
@@ -7661,8 +8870,8 @@
 
       if test -n "$libobjs" && test "$build_old_libs" = yes; then
 	# Transform all the library objects into standard objects.
-	compile_command=`$ECHO "X$compile_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
-	finalize_command=`$ECHO "X$finalize_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	compile_command=`$ECHO "$compile_command" | $SP2NL | $SED "$lo2o" | $NL2SP`
+	finalize_command=`$ECHO "$finalize_command" | $SP2NL | $SED "$lo2o" | $NL2SP`
       fi
 
       func_generate_dlsyms "$outputname" "@PROGRAM@" "no"
@@ -7674,15 +8883,15 @@
 
       wrappers_required=yes
       case $host in
+      *cegcc* | *mingw32ce*)
+        # Disable wrappers for cegcc and mingw32ce hosts, we are cross compiling anyway.
+        wrappers_required=no
+        ;;
       *cygwin* | *mingw* )
         if test "$build_libtool_libs" != yes; then
           wrappers_required=no
         fi
         ;;
-      *cegcc)
-        # Disable wrappers for cegcc, we are cross compiling anyway.
-        wrappers_required=no
-        ;;
       *)
         if test "$need_relink" = no || test "$build_libtool_libs" != yes; then
           wrappers_required=no
@@ -7691,13 +8900,19 @@
       esac
       if test "$wrappers_required" = no; then
 	# Replace the output file specification.
-	compile_command=`$ECHO "X$compile_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
+	compile_command=`$ECHO "$compile_command" | $SED 's%@OUTPUT@%'"$output"'%g'`
 	link_command="$compile_command$compile_rpath"
 
 	# We have no uninstalled library dependencies, so finalize right now.
 	exit_status=0
 	func_show_eval "$link_command" 'exit_status=$?'
 
+	if test -n "$postlink_cmds"; then
+	  func_to_tool_file "$output"
+	  postlink_cmds=`func_echo_all "$postlink_cmds" | $SED -e 's%@OUTPUT@%'"$output"'%g' -e 's%@TOOL_OUTPUT@%'"$func_to_tool_file_result"'%g'`
+	  func_execute_cmds "$postlink_cmds" 'exit $?'
+	fi
+
 	# Delete the generated files.
 	if test -f "$output_objdir/${outputname}S.${objext}"; then
 	  func_show_eval '$RM "$output_objdir/${outputname}S.${objext}"'
@@ -7720,7 +8935,7 @@
 	  # We should set the runpath_var.
 	  rpath=
 	  for dir in $perm_rpath; do
-	    rpath="$rpath$dir:"
+	    func_append rpath "$dir:"
 	  done
 	  compile_var="$runpath_var=\"$rpath\$$runpath_var\" "
 	fi
@@ -7728,7 +8943,7 @@
 	  # We should set the runpath_var.
 	  rpath=
 	  for dir in $finalize_perm_rpath; do
-	    rpath="$rpath$dir:"
+	    func_append rpath "$dir:"
 	  done
 	  finalize_var="$runpath_var=\"$rpath\$$runpath_var\" "
 	fi
@@ -7738,11 +8953,18 @@
 	# We don't need to create a wrapper script.
 	link_command="$compile_var$compile_command$compile_rpath"
 	# Replace the output file specification.
-	link_command=`$ECHO "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
+	link_command=`$ECHO "$link_command" | $SED 's%@OUTPUT@%'"$output"'%g'`
 	# Delete the old output file.
 	$opt_dry_run || $RM $output
 	# Link the executable and exit
 	func_show_eval "$link_command" 'exit $?'
+
+	if test -n "$postlink_cmds"; then
+	  func_to_tool_file "$output"
+	  postlink_cmds=`func_echo_all "$postlink_cmds" | $SED -e 's%@OUTPUT@%'"$output"'%g' -e 's%@TOOL_OUTPUT@%'"$func_to_tool_file_result"'%g'`
+	  func_execute_cmds "$postlink_cmds" 'exit $?'
+	fi
+
 	exit $EXIT_SUCCESS
       fi
 
@@ -7757,7 +8979,7 @@
 	if test "$fast_install" != no; then
 	  link_command="$finalize_var$compile_command$finalize_rpath"
 	  if test "$fast_install" = yes; then
-	    relink_command=`$ECHO "X$compile_var$compile_command$compile_rpath" | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
+	    relink_command=`$ECHO "$compile_var$compile_command$compile_rpath" | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
 	  else
 	    # fast_install is set to needless
 	    relink_command=
@@ -7769,13 +8991,19 @@
       fi
 
       # Replace the output file specification.
-      link_command=`$ECHO "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
+      link_command=`$ECHO "$link_command" | $SED 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
 
       # Delete the old output files.
       $opt_dry_run || $RM $output $output_objdir/$outputname $output_objdir/lt-$outputname
 
       func_show_eval "$link_command" 'exit $?'
 
+      if test -n "$postlink_cmds"; then
+	func_to_tool_file "$output_objdir/$outputname"
+	postlink_cmds=`func_echo_all "$postlink_cmds" | $SED -e 's%@OUTPUT@%'"$output_objdir/$outputname"'%g' -e 's%@TOOL_OUTPUT@%'"$func_to_tool_file_result"'%g'`
+	func_execute_cmds "$postlink_cmds" 'exit $?'
+      fi
+
       # Now create the wrapper script.
       func_verbose "creating $output"
 
@@ -7793,18 +9021,7 @@
 	  fi
 	done
 	relink_command="(cd `pwd`; $relink_command)"
-	relink_command=`$ECHO "X$relink_command" | $Xsed -e "$sed_quote_subst"`
-      fi
-
-      # Quote $ECHO for shipping.
-      if test "X$ECHO" = "X$SHELL $progpath --fallback-echo"; then
-	case $progpath in
-	[\\/]* | [A-Za-z]:[\\/]*) qecho="$SHELL $progpath --fallback-echo";;
-	*) qecho="$SHELL `pwd`/$progpath --fallback-echo";;
-	esac
-	qecho=`$ECHO "X$qecho" | $Xsed -e "$sed_quote_subst"`
-      else
-	qecho=`$ECHO "X$ECHO" | $Xsed -e "$sed_quote_subst"`
+	relink_command=`$ECHO "$relink_command" | $SED "$sed_quote_subst"`
       fi
 
       # Only actually do things if not in dry run mode.
@@ -7884,7 +9101,7 @@
 	else
 	  oldobjs="$old_deplibs $non_pic_objects"
 	  if test "$preload" = yes && test -f "$symfileobj"; then
-	    oldobjs="$oldobjs $symfileobj"
+	    func_append oldobjs " $symfileobj"
 	  fi
 	fi
 	addlibs="$old_convenience"
@@ -7892,10 +9109,10 @@
 
       if test -n "$addlibs"; then
 	gentop="$output_objdir/${outputname}x"
-	generated="$generated $gentop"
+	func_append generated " $gentop"
 
 	func_extract_archives $gentop $addlibs
-	oldobjs="$oldobjs $func_extract_archives_result"
+	func_append oldobjs " $func_extract_archives_result"
       fi
 
       # Do each command in the archive commands.
@@ -7906,10 +9123,10 @@
 	# Add any objects from preloaded convenience libraries
 	if test -n "$dlprefiles"; then
 	  gentop="$output_objdir/${outputname}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $dlprefiles
-	  oldobjs="$oldobjs $func_extract_archives_result"
+	  func_append oldobjs " $func_extract_archives_result"
 	fi
 
 	# POSIX demands no paths to be encoded in archives.  We have
@@ -7925,9 +9142,9 @@
 	    done | sort | sort -uc >/dev/null 2>&1); then
 	  :
 	else
-	  $ECHO "copying selected object files to avoid basename conflicts..."
+	  echo "copying selected object files to avoid basename conflicts..."
 	  gentop="$output_objdir/${outputname}x"
-	  generated="$generated $gentop"
+	  func_append generated " $gentop"
 	  func_mkdir_p "$gentop"
 	  save_oldobjs=$oldobjs
 	  oldobjs=
@@ -7951,18 +9168,30 @@
 		esac
 	      done
 	      func_show_eval "ln $obj $gentop/$newobj || cp $obj $gentop/$newobj"
-	      oldobjs="$oldobjs $gentop/$newobj"
+	      func_append oldobjs " $gentop/$newobj"
 	      ;;
-	    *) oldobjs="$oldobjs $obj" ;;
+	    *) func_append oldobjs " $obj" ;;
 	    esac
 	  done
 	fi
+	func_to_tool_file "$oldlib" func_convert_file_msys_to_w32
+	tool_oldlib=$func_to_tool_file_result
 	eval cmds=\"$old_archive_cmds\"
 
 	func_len " $cmds"
 	len=$func_len_result
 	if test "$len" -lt "$max_cmd_len" || test "$max_cmd_len" -le -1; then
 	  cmds=$old_archive_cmds
+	elif test -n "$archiver_list_spec"; then
+	  func_verbose "using command file archive linking..."
+	  for obj in $oldobjs
+	  do
+	    func_to_tool_file "$obj"
+	    $ECHO "$func_to_tool_file_result"
+	  done > $output_objdir/$libname.libcmd
+	  func_to_tool_file "$output_objdir/$libname.libcmd"
+	  oldobjs=" $archiver_list_spec$func_to_tool_file_result"
+	  cmds=$old_archive_cmds
 	else
 	  # the command line is too long to link in one step, link in parts
 	  func_verbose "using piecewise archive linking..."
@@ -8036,7 +9265,7 @@
       done
       # Quote the link command for shipping.
       relink_command="(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"
-      relink_command=`$ECHO "X$relink_command" | $Xsed -e "$sed_quote_subst"`
+      relink_command=`$ECHO "$relink_command" | $SED "$sed_quote_subst"`
       if test "$hardcode_automatic" = yes ; then
 	relink_command=
       fi
@@ -8056,12 +9285,23 @@
 	      *.la)
 		func_basename "$deplib"
 		name="$func_basename_result"
-		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+		func_resolve_sysroot "$deplib"
+		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $func_resolve_sysroot_result`
 		test -z "$libdir" && \
 		  func_fatal_error "\`$deplib' is not a valid libtool archive"
-		newdependency_libs="$newdependency_libs $libdir/$name"
+		func_append newdependency_libs " ${lt_sysroot:+=}$libdir/$name"
+		;;
+	      -L*)
+		func_stripname -L '' "$deplib"
+		func_replace_sysroot "$func_stripname_result"
+		func_append newdependency_libs " -L$func_replace_sysroot_result"
 		;;
-	      *) newdependency_libs="$newdependency_libs $deplib" ;;
+	      -R*)
+		func_stripname -R '' "$deplib"
+		func_replace_sysroot "$func_stripname_result"
+		func_append newdependency_libs " -R$func_replace_sysroot_result"
+		;;
+	      *) func_append newdependency_libs " $deplib" ;;
 	      esac
 	    done
 	    dependency_libs="$newdependency_libs"
@@ -8075,9 +9315,9 @@
 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 		test -z "$libdir" && \
 		  func_fatal_error "\`$lib' is not a valid libtool archive"
-		newdlfiles="$newdlfiles $libdir/$name"
+		func_append newdlfiles " ${lt_sysroot:+=}$libdir/$name"
 		;;
-	      *) newdlfiles="$newdlfiles $lib" ;;
+	      *) func_append newdlfiles " $lib" ;;
 	      esac
 	    done
 	    dlfiles="$newdlfiles"
@@ -8094,7 +9334,7 @@
 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 		test -z "$libdir" && \
 		  func_fatal_error "\`$lib' is not a valid libtool archive"
-		newdlprefiles="$newdlprefiles $libdir/$name"
+		func_append newdlprefiles " ${lt_sysroot:+=}$libdir/$name"
 		;;
 	      esac
 	    done
@@ -8106,7 +9346,7 @@
 		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
 		*) abs=`pwd`"/$lib" ;;
 	      esac
-	      newdlfiles="$newdlfiles $abs"
+	      func_append newdlfiles " $abs"
 	    done
 	    dlfiles="$newdlfiles"
 	    newdlprefiles=
@@ -8115,15 +9355,33 @@
 		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
 		*) abs=`pwd`"/$lib" ;;
 	      esac
-	      newdlprefiles="$newdlprefiles $abs"
+	      func_append newdlprefiles " $abs"
 	    done
 	    dlprefiles="$newdlprefiles"
 	  fi
 	  $RM $output
 	  # place dlname in correct position for cygwin
+	  # In fact, it would be nice if we could use this code for all target
+	  # systems that can't hard-code library paths into their executables
+	  # and that have no shared library path variable independent of PATH,
+	  # but it turns out we can't easily determine that from inspecting
+	  # libtool variables, so we have to hard-code the OSs to which it
+	  # applies here; at the moment, that means platforms that use the PE
+	  # object format with DLL files.  See the long comment at the top of
+	  # tests/bindir.at for full details.
 	  tdlname=$dlname
 	  case $host,$output,$installed,$module,$dlname in
-	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
+	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll)
+	      # If a -bindir argument was supplied, place the dll there.
+	      if test "x$bindir" != x ;
+	      then
+		func_relative_path "$install_libdir" "$bindir"
+		tdlname=$func_relative_path_result$dlname
+	      else
+		# Otherwise fall back on heuristic.
+		tdlname=../bin/$dlname
+	      fi
+	      ;;
 	  esac
 	  $ECHO > $output "\
 # $outputname - a libtool library file
@@ -8182,7 +9440,7 @@
     exit $EXIT_SUCCESS
 }
 
-{ test "$mode" = link || test "$mode" = relink; } &&
+{ test "$opt_mode" = link || test "$opt_mode" = relink; } &&
     func_mode_link ${1+"$@"}
 
 
@@ -8202,9 +9460,9 @@
     for arg
     do
       case $arg in
-      -f) RM="$RM $arg"; rmforce=yes ;;
-      -*) RM="$RM $arg" ;;
-      *) files="$files $arg" ;;
+      -f) func_append RM " $arg"; rmforce=yes ;;
+      -*) func_append RM " $arg" ;;
+      *) func_append files " $arg" ;;
       esac
     done
 
@@ -8213,24 +9471,23 @@
 
     rmdirs=
 
-    origobjdir="$objdir"
     for file in $files; do
       func_dirname "$file" "" "."
       dir="$func_dirname_result"
       if test "X$dir" = X.; then
-	objdir="$origobjdir"
+	odir="$objdir"
       else
-	objdir="$dir/$origobjdir"
+	odir="$dir/$objdir"
       fi
       func_basename "$file"
       name="$func_basename_result"
-      test "$mode" = uninstall && objdir="$dir"
+      test "$opt_mode" = uninstall && odir="$dir"
 
-      # Remember objdir for removal later, being careful to avoid duplicates
-      if test "$mode" = clean; then
+      # Remember odir for removal later, being careful to avoid duplicates
+      if test "$opt_mode" = clean; then
 	case " $rmdirs " in
-	  *" $objdir "*) ;;
-	  *) rmdirs="$rmdirs $objdir" ;;
+	  *" $odir "*) ;;
+	  *) func_append rmdirs " $odir" ;;
 	esac
       fi
 
@@ -8256,18 +9513,17 @@
 
 	  # Delete the libtool libraries and symlinks.
 	  for n in $library_names; do
-	    rmfiles="$rmfiles $objdir/$n"
+	    func_append rmfiles " $odir/$n"
 	  done
-	  test -n "$old_library" && rmfiles="$rmfiles $objdir/$old_library"
+	  test -n "$old_library" && func_append rmfiles " $odir/$old_library"
 
-	  case "$mode" in
+	  case "$opt_mode" in
 	  clean)
-	    case "  $library_names " in
-	    # "  " in the beginning catches empty $dlname
+	    case " $library_names " in
 	    *" $dlname "*) ;;
-	    *) rmfiles="$rmfiles $objdir/$dlname" ;;
+	    *) test -n "$dlname" && func_append rmfiles " $odir/$dlname" ;;
 	    esac
-	    test -n "$libdir" && rmfiles="$rmfiles $objdir/$name $objdir/${name}i"
+	    test -n "$libdir" && func_append rmfiles " $odir/$name $odir/${name}i"
 	    ;;
 	  uninstall)
 	    if test -n "$library_names"; then
@@ -8295,19 +9551,19 @@
 	  # Add PIC object to the list of files to remove.
 	  if test -n "$pic_object" &&
 	     test "$pic_object" != none; then
-	    rmfiles="$rmfiles $dir/$pic_object"
+	    func_append rmfiles " $dir/$pic_object"
 	  fi
 
 	  # Add non-PIC object to the list of files to remove.
 	  if test -n "$non_pic_object" &&
 	     test "$non_pic_object" != none; then
-	    rmfiles="$rmfiles $dir/$non_pic_object"
+	    func_append rmfiles " $dir/$non_pic_object"
 	  fi
 	fi
 	;;
 
       *)
-	if test "$mode" = clean ; then
+	if test "$opt_mode" = clean ; then
 	  noexename=$name
 	  case $file in
 	  *.exe)
@@ -8317,7 +9573,7 @@
 	    noexename=$func_stripname_result
 	    # $file with .exe has already been added to rmfiles,
 	    # add $file without .exe
-	    rmfiles="$rmfiles $file"
+	    func_append rmfiles " $file"
 	    ;;
 	  esac
 	  # Do a test to see if this is a libtool program.
@@ -8326,7 +9582,7 @@
 	      func_ltwrapper_scriptname "$file"
 	      relink_command=
 	      func_source $func_ltwrapper_scriptname_result
-	      rmfiles="$rmfiles $func_ltwrapper_scriptname_result"
+	      func_append rmfiles " $func_ltwrapper_scriptname_result"
 	    else
 	      relink_command=
 	      func_source $dir/$noexename
@@ -8334,12 +9590,12 @@
 
 	    # note $name still contains .exe if it was in $file originally
 	    # as does the version of $file that was added into $rmfiles
-	    rmfiles="$rmfiles $objdir/$name $objdir/${name}S.${objext}"
+	    func_append rmfiles " $odir/$name $odir/${name}S.${objext}"
 	    if test "$fast_install" = yes && test -n "$relink_command"; then
-	      rmfiles="$rmfiles $objdir/lt-$name"
+	      func_append rmfiles " $odir/lt-$name"
 	    fi
 	    if test "X$noexename" != "X$name" ; then
-	      rmfiles="$rmfiles $objdir/lt-${noexename}.c"
+	      func_append rmfiles " $odir/lt-${noexename}.c"
 	    fi
 	  fi
 	fi
@@ -8347,7 +9603,6 @@
       esac
       func_show_eval "$RM $rmfiles" 'exit_status=1'
     done
-    objdir="$origobjdir"
 
     # Try to remove the ${objdir}s in the directories where we deleted files
     for dir in $rmdirs; do
@@ -8359,16 +9614,16 @@
     exit $exit_status
 }
 
-{ test "$mode" = uninstall || test "$mode" = clean; } &&
+{ test "$opt_mode" = uninstall || test "$opt_mode" = clean; } &&
     func_mode_uninstall ${1+"$@"}
 
-test -z "$mode" && {
+test -z "$opt_mode" && {
   help="$generic_help"
   func_fatal_help "you must specify a MODE"
 }
 
 test -z "$exec_cmd" && \
-  func_fatal_help "invalid operation mode \`$mode'"
+  func_fatal_help "invalid operation mode \`$opt_mode'"
 
 if test -n "$exec_cmd"; then
   eval exec "$exec_cmd"
Index: blcr-0.8.5/config/missing
===================================================================
--- blcr-0.8.5.orig/config/missing	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/config/missing	2013-03-26 22:50:49.000000000 +0000
@@ -1,10 +1,10 @@
 #! /bin/sh
 # Common stub for a few missing GNU programs while installing.
 
-scriptversion=2009-04-28.21; # UTC
+scriptversion=2012-01-06.13; # UTC
 
 # Copyright (C) 1996, 1997, 1999, 2000, 2002, 2003, 2004, 2005, 2006,
-# 2008, 2009 Free Software Foundation, Inc.
+# 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.
 # Originally by Fran,cois Pinard <pinard@iro.umontreal.ca>, 1996.
 
 # This program is free software; you can redistribute it and/or modify
@@ -84,7 +84,6 @@
   help2man     touch the output file
   lex          create \`lex.yy.c', if possible, from existing .c
   makeinfo     touch the output file
-  tar          try tar, gnutar, gtar, then tar without non-portable flags
   yacc         create \`y.tab.[ch]', if possible, from existing .[ch]
 
 Version suffixes to PROGRAM as well as the prefixes \`gnu-', \`gnu', and
@@ -122,15 +121,6 @@
     # Not GNU programs, they don't have --version.
     ;;
 
-  tar*)
-    if test -n "$run"; then
-       echo 1>&2 "ERROR: \`tar' requires --run"
-       exit 1
-    elif test "x$2" = "x--version" || test "x$2" = "x--help"; then
-       exit 1
-    fi
-    ;;
-
   *)
     if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
        # We have it, but it failed.
@@ -226,7 +216,7 @@
          \`Bison' from any GNU archive site."
     rm -f y.tab.c y.tab.h
     if test $# -ne 1; then
-        eval LASTARG="\${$#}"
+        eval LASTARG=\${$#}
 	case $LASTARG in
 	*.y)
 	    SRCFILE=`echo "$LASTARG" | sed 's/y$/c/'`
@@ -256,7 +246,7 @@
          \`Flex' from any GNU archive site."
     rm -f lex.yy.c
     if test $# -ne 1; then
-        eval LASTARG="\${$#}"
+        eval LASTARG=\${$#}
 	case $LASTARG in
 	*.l)
 	    SRCFILE=`echo "$LASTARG" | sed 's/l$/c/'`
@@ -318,41 +308,6 @@
     touch $file
     ;;
 
-  tar*)
-    shift
-
-    # We have already tried tar in the generic part.
-    # Look for gnutar/gtar before invocation to avoid ugly error
-    # messages.
-    if (gnutar --version > /dev/null 2>&1); then
-       gnutar "$@" && exit 0
-    fi
-    if (gtar --version > /dev/null 2>&1); then
-       gtar "$@" && exit 0
-    fi
-    firstarg="$1"
-    if shift; then
-	case $firstarg in
-	*o*)
-	    firstarg=`echo "$firstarg" | sed s/o//`
-	    tar "$firstarg" "$@" && exit 0
-	    ;;
-	esac
-	case $firstarg in
-	*h*)
-	    firstarg=`echo "$firstarg" | sed s/h//`
-	    tar "$firstarg" "$@" && exit 0
-	    ;;
-	esac
-    fi
-
-    echo 1>&2 "\
-WARNING: I can't seem to be able to run \`tar' with the given arguments.
-         You may want to install GNU tar or Free paxutils, or check the
-         command line arguments."
-    exit 1
-    ;;
-
   *)
     echo 1>&2 "\
 WARNING: \`$1' is needed, and is $msg.
Index: blcr-0.8.5/configure
===================================================================
--- blcr-0.8.5.orig/configure	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/configure	2013-03-26 22:50:47.000000000 +0000
@@ -2,12 +2,14 @@
 # From acinclude.m4 Revision: 1.177.14.17 .
 # From configure.ac Revision: 1.410.2.52 .
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.63 for blcr 0.8.5.
+# Generated by GNU Autoconf 2.69 for blcr 0.8.5.
 #
 # Report bugs to <http://ftg.lbl.gov/checkpoint>.
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+#
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
+#
+#
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
 #
@@ -34,13 +36,13 @@
 #     along with this program; if not, write to the Free Software
 #     Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 #
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -48,23 +50,15 @@
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -72,7 +66,13 @@
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -83,7 +83,7 @@
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -106,13 +106,6 @@
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -122,15 +115,16 @@
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -142,12 +136,16 @@
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -159,330 +157,353 @@
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
-  as_basename=basename
-else
-  as_basename=false
-fi
-
-
-# Name of the executable.
-as_me=`$as_basename -- "$0" ||
-$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
-	 X"$0" : 'X\(//\)$' \| \
-	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X/"$0" |
-    sed '/^.*\/\([^/][^/]*\)\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\/\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-
 # CDPATH.
-$as_unset CDPATH
-
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
-  if (eval ":") 2>/dev/null; then
-  as_have_required=yes
+  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\"\$@\"}'='\"\$@\"'
+  setopt NO_GLOB_SUBST
 else
-  as_have_required=no
+  case \`(set -o) 2>/dev/null\` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
 fi
-
-  if test $as_have_required = yes &&	 (eval ":
-(as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+"
+  as_required="as_fn_return () { (exit \$1); }
+as_fn_success () { as_fn_return 0; }
+as_fn_failure () { as_fn_return 1; }
+as_fn_ret_success () { return 0; }
+as_fn_ret_failure () { return 1; }
 
 exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+as_fn_success || { exitcode=1; echo as_fn_success failed.; }
+as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
+as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
+as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
+if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
+
+else
+  exitcode=1; echo positional parameters were not saved.
+fi
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
+  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
+  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
+  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
+  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
+test \$(( 1 + 1 )) = 2 || exit 1
+
+  test -n \"\${ZSH_VERSION+set}\${BASH_VERSION+set}\" || (
+    ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+    ECHO=\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO
+    ECHO=\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO\$ECHO
+    PATH=/empty FPATH=/empty; export PATH FPATH
+    test \"X\`printf %s \$ECHO\`\" = \"X\$ECHO\" \\
+      || test \"X\`print -r -- \$ECHO\`\" = \"X\$ECHO\" ) || exit 1"
+  if (eval "$as_required") 2>/dev/null; then :
+  as_have_required=yes
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_have_required=no
 fi
+  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
 
-test \$exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=\$LINENO
-  as_lineno_2=\$LINENO
-  test \"x\$as_lineno_1\" != \"x\$as_lineno_2\" &&
-  test \"x\`expr \$as_lineno_1 + 1\`\" = \"x\$as_lineno_2\") || { (exit 1); exit 1; }
-") 2> /dev/null; then
-  :
 else
-  as_candidate_shells=
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_found=false
 for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  case $as_dir in
+  as_found=:
+  case $as_dir in #(
 	 /*)
 	   for as_base in sh bash ksh sh5; do
-	     as_candidate_shells="$as_candidate_shells $as_dir/$as_base"
+	     # Try only shells that exist, to save several forks.
+	     as_shell=$as_dir/$as_base
+	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
+		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  CONFIG_SHELL=$as_shell as_have_required=yes
+		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  break 2
+fi
+fi
 	   done;;
        esac
+  as_found=false
 done
+$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
+	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
+  CONFIG_SHELL=$SHELL as_have_required=yes
+fi; }
 IFS=$as_save_IFS
 
 
-      for as_shell in $as_candidate_shells $SHELL; do
-	 # Try only shells that exist, to save several forks.
-	 if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
-		{ ("$as_shell") 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
+      if test "x$CONFIG_SHELL" != x; then :
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
+fi
+
+    if test x$as_have_required = xno; then :
+  $as_echo "$0: This script requires a shell more modern than all"
+  $as_echo "$0: the shells that I found on your system."
+  if test x${ZSH_VERSION+set} = xset ; then
+    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
+    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
+  else
+    $as_echo "$0: Please tell bug-autoconf@gnu.org and
+$0: http://ftg.lbl.gov/checkpoint about your system,
+$0: including any error possibly output before this
+$0: message. Then install a modern shell, or manually run
+$0: the script under such a shell if you do have one."
+  fi
+  exit 1
 fi
-
-
-:
-_ASEOF
-}; then
-  CONFIG_SHELL=$as_shell
-	       as_have_required=yes
-	       if { "$as_shell" 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
 fi
+fi
+SHELL=${CONFIG_SHELL-/bin/sh}
+export SHELL
+# Unset more variables known to interfere with behavior of common tools.
+CLICOLOR_FORCE= GREP_OPTIONS=
+unset CLICOLOR_FORCE GREP_OPTIONS
 
+## --------------------- ##
+## M4sh Shell Functions. ##
+## --------------------- ##
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
 
-:
-(as_func_return () {
-  (exit $1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
 
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
+} # as_fn_mkdir_p
 
-if as_func_ret_success; then
-  :
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
 else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
 
-if ( set x; as_func_ret_success y && test x = "$1" ); then
-  :
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
 else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test $exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2") || { (exit 1); exit 1; }
-
-_ASEOF
-}; then
-  break
-fi
-
-fi
-
-      done
-
-      if test "x$CONFIG_SHELL" != x; then
-  for as_var in BASH_ENV ENV
-	do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-	done
-	export CONFIG_SHELL
-	exec "$CONFIG_SHELL" "$as_myself" ${1+"$@"}
-fi
-
-
-    if test $as_have_required = no; then
-  echo This script requires a shell more modern than all the
-      echo shells that I found on your system.  Please install a
-      echo modern shell, or manually run the script under such a
-      echo shell if you do have one.
-      { (exit 1); exit 1; }
-fi
-
-
-fi
-
-fi
-
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
 
 
-(eval "as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
 
-exitcode=0
-if as_func_success; then
-  :
+if expr a : '\(a\)' >/dev/null 2>&1 &&
+   test "X`expr 00001 : '.*\(...\)'`" = X001; then
+  as_expr=expr
 else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
+  as_expr=false
 fi
 
-if as_func_ret_success; then
-  :
+if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
+  as_basename=basename
 else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
+  as_basename=false
 fi
 
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  as_dirname=false
 fi
 
-test \$exitcode = 0") || {
-  echo No shell found that supports shell functions.
-  echo Please tell bug-autoconf@gnu.org about your system,
-  echo including any error possibly output before this message.
-  echo This can help us improve future autoconf versions.
-  echo Configuration will now proceed without shell functions.
-}
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
 
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
+  as_lineno_1=$LINENO as_lineno_1a=$LINENO
+  as_lineno_2=$LINENO as_lineno_2a=$LINENO
+  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
+  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
+  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
   sed -n '
     p
     /[$]LINENO/=
@@ -499,9 +520,12 @@
       s/-\n.*//
     ' >$as_me.lineno &&
   chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
+    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -510,29 +534,18 @@
   exit
 }
 
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -547,49 +560,29 @@
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -597,161 +590,14 @@
 # Sed expression to map a string onto a valid variable name.
 as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
 
-
-
-
-# Check that we are running under the correct shell.
 SHELL=${CONFIG_SHELL-/bin/sh}
 
-case X$lt_ECHO in
-X*--fallback-echo)
-  # Remove one level of quotation (which was required for Make).
-  ECHO=`echo "$lt_ECHO" | sed 's,\\\\\$\\$0,'$0','`
-  ;;
-esac
-
-ECHO=${lt_ECHO-echo}
-if test "X$1" = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test "X$1" = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' ; then
-  # Yippee, $ECHO works!
-  :
-else
-  # Restart under the correct shell.
-  exec $SHELL "$0" --no-reexec ${1+"$@"}
-fi
-
-if test "X$1" = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat <<_LT_EOF
-$*
-_LT_EOF
-  exit 0
-fi
-
-# The HP-UX ksh and POSIX shell print the target directory to stdout
-# if CDPATH is set.
-(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
-
-if test -z "$lt_ECHO"; then
-  if test "X${echo_test_string+set}" != Xset; then
-    # find a string as large as possible, as long as the shell can cope with it
-    for cmd in 'sed 50q "$0"' 'sed 20q "$0"' 'sed 10q "$0"' 'sed 2q "$0"' 'echo test'; do
-      # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
-      if { echo_test_string=`eval $cmd`; } 2>/dev/null &&
-	 { test "X$echo_test_string" = "X$echo_test_string"; } 2>/dev/null
-      then
-        break
-      fi
-    done
-  fi
-
-  if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-     echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-     test "X$echo_testing_string" = "X$echo_test_string"; then
-    :
-  else
-    # The Solaris, AIX, and Digital Unix default echo programs unquote
-    # backslashes.  This makes it impossible to quote backslashes using
-    #   echo "$something" | sed 's/\\/\\\\/g'
-    #
-    # So, first we look for a working echo in the user's PATH.
-
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-    for dir in $PATH /usr/ucb; do
-      IFS="$lt_save_ifs"
-      if (test -f $dir/echo || test -f $dir/echo$ac_exeext) &&
-         test "X`($dir/echo '\t') 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`($dir/echo "$echo_test_string") 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        ECHO="$dir/echo"
-        break
-      fi
-    done
-    IFS="$lt_save_ifs"
-
-    if test "X$ECHO" = Xecho; then
-      # We didn't find a better echo, so look for alternatives.
-      if test "X`{ print -r '\t'; } 2>/dev/null`" = 'X\t' &&
-         echo_testing_string=`{ print -r "$echo_test_string"; } 2>/dev/null` &&
-         test "X$echo_testing_string" = "X$echo_test_string"; then
-        # This shell has a builtin print -r that does the trick.
-        ECHO='print -r'
-      elif { test -f /bin/ksh || test -f /bin/ksh$ac_exeext; } &&
-	   test "X$CONFIG_SHELL" != X/bin/ksh; then
-        # If we have ksh, try running configure again with it.
-        ORIGINAL_CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}
-        export ORIGINAL_CONFIG_SHELL
-        CONFIG_SHELL=/bin/ksh
-        export CONFIG_SHELL
-        exec $CONFIG_SHELL "$0" --no-reexec ${1+"$@"}
-      else
-        # Try using printf.
-        ECHO='printf %s\n'
-        if test "X`{ $ECHO '\t'; } 2>/dev/null`" = 'X\t' &&
-	   echo_testing_string=`{ $ECHO "$echo_test_string"; } 2>/dev/null` &&
-	   test "X$echo_testing_string" = "X$echo_test_string"; then
-	  # Cool, printf works
-	  :
-        elif echo_testing_string=`($ORIGINAL_CONFIG_SHELL "$0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($ORIGINAL_CONFIG_SHELL "$0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  CONFIG_SHELL=$ORIGINAL_CONFIG_SHELL
-	  export CONFIG_SHELL
-	  SHELL="$CONFIG_SHELL"
-	  export SHELL
-	  ECHO="$CONFIG_SHELL $0 --fallback-echo"
-        elif echo_testing_string=`($CONFIG_SHELL "$0" --fallback-echo '\t') 2>/dev/null` &&
-	     test "X$echo_testing_string" = 'X\t' &&
-	     echo_testing_string=`($CONFIG_SHELL "$0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	     test "X$echo_testing_string" = "X$echo_test_string"; then
-	  ECHO="$CONFIG_SHELL $0 --fallback-echo"
-        else
-	  # maybe with a smaller string...
-	  prev=:
-
-	  for cmd in 'echo test' 'sed 2q "$0"' 'sed 10q "$0"' 'sed 20q "$0"' 'sed 50q "$0"'; do
-	    if { test "X$echo_test_string" = "X`eval $cmd`"; } 2>/dev/null
-	    then
-	      break
-	    fi
-	    prev="$cmd"
-	  done
-
-	  if test "$prev" != 'sed 50q "$0"'; then
-	    echo_test_string=`eval $prev`
-	    export echo_test_string
-	    exec ${ORIGINAL_CONFIG_SHELL-${CONFIG_SHELL-/bin/sh}} "$0" ${1+"$@"}
-	  else
-	    # Oops.  We lost completely, so just stick with echo.
-	    ECHO=echo
-	  fi
-        fi
-      fi
-    fi
-  fi
-fi
-
-# Copy echo and quote the copy suitably for passing to libtool from
-# the Makefile, instead of quoting the original, which is used later.
-lt_ECHO=$ECHO
-if test "X$lt_ECHO" = "X$CONFIG_SHELL $0 --fallback-echo"; then
-   lt_ECHO="$CONFIG_SHELL \\\$\$0 --fallback-echo"
-fi
-
-
-
 
-exec 7<&0 </dev/null 6>&1
+test -n "$DJDIR" || exec 7<&0 </dev/null
+exec 6>&1
 
 # Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
@@ -766,7 +612,6 @@
 subdirs=
 MFLAGS=
 MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='blcr'
@@ -774,6 +619,7 @@
 PACKAGE_VERSION='0.8.5'
 PACKAGE_STRING='blcr 0.8.5'
 PACKAGE_BUGREPORT='http://ftg.lbl.gov/checkpoint'
+PACKAGE_URL=''
 
 ac_unique_file="cr_module/cr_module.c"
 # Factoring default headers for most tests.
@@ -879,8 +725,10 @@
 LIPO
 NMEDIT
 DSYMUTIL
-lt_ECHO
+MANIFEST_TOOL
+ac_ct_AR
 AR
+DLLTOOL
 OBJDUMP
 NM
 ac_ct_DUMPBIN
@@ -902,6 +750,7 @@
 am__fastdepCC_FALSE
 am__fastdepCC_TRUE
 CCDEPMODE
+am__nodep
 AMDEPBACKSLASH
 AMDEP_FALSE
 AMDEP_TRUE
@@ -949,6 +798,9 @@
 TOP_SRCDIR
 TOP_BUILDDIR
 PWD_PROG
+MAINT
+MAINTAINER_MODE_FALSE
+MAINTAINER_MODE_TRUE
 am__untar
 am__tar
 AMTAR
@@ -1018,6 +870,7 @@
 program_transform_name
 prefix
 exec_prefix
+PACKAGE_URL
 PACKAGE_BUGREPORT
 PACKAGE_STRING
 PACKAGE_VERSION
@@ -1029,6 +882,7 @@
 CR_KSYM_IMPORT_CALLS'
 ac_user_opts='
 enable_option_checking
+enable_maintainer_mode
 with_components
 with_linux
 with_linux_src
@@ -1058,6 +912,7 @@
 with_pic
 enable_fast_install
 with_gnu_ld
+with_sysroot
 enable_libtool_lock
 '
       ac_precious_vars='build_alias
@@ -1139,8 +994,9 @@
   fi
 
   case $ac_option in
-  *=*)	ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
   esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
@@ -1185,8 +1041,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1212,8 +1067,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1417,8 +1271,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1434,8 +1287,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1465,17 +1317,17 @@
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) { $as_echo "$as_me: error: unrecognized option: $ac_option
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; }
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
     ;;
 
   *=*)
     ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid variable name: $ac_envvar" >&2
-   { (exit 1); exit 1; }; }
+    case $ac_envvar in #(
+      '' | [0-9]* | *[!_$as_cr_alnum]* )
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
+    esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
 
@@ -1484,7 +1336,7 @@
     $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
     expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
       $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
-    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
+    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
     ;;
 
   esac
@@ -1492,15 +1344,13 @@
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  { $as_echo "$as_me: error: missing argument to $ac_option" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "missing argument to $ac_option"
 fi
 
 if test -n "$ac_unrecognized_opts"; then
   case $enable_option_checking in
     no) ;;
-    fatal) { $as_echo "$as_me: error: unrecognized options: $ac_unrecognized_opts" >&2
-   { (exit 1); exit 1; }; } ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
     *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
   esac
 fi
@@ -1523,8 +1373,7 @@
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  { $as_echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1538,8 +1387,6 @@
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used." >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1554,11 +1401,9 @@
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  { $as_echo "$as_me: error: working directory cannot be determined" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  { $as_echo "$as_me: error: pwd does not report name of working directory" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
@@ -1597,13 +1442,11 @@
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  { $as_echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || { $as_echo "$as_me: error: $ac_msg" >&2
-   { (exit 1); exit 1; }; }
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1643,7 +1486,7 @@
       --help=short        display options specific to this package
       --help=recursive    display the short help of all the included packages
   -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
+  -q, --quiet, --silent   do not print \`checking ...' messages
       --cache-file=FILE   cache test results in FILE [disabled]
   -C, --config-cache      alias for \`--cache-file=config.cache'
   -n, --no-create         do not create output files
@@ -1707,6 +1550,8 @@
   --disable-option-checking  ignore unrecognized --enable/--with options
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --disable-maintainer-mode  disable make rules and dependencies not useful
+			  (and sometimes confusing) to the casual installer
   --enable-config-report  enable report at the conclusion of the configure
                           script (default is yes)
   --enable-kbuild-verbose enable verbose output from the kbuild facility.
@@ -1769,9 +1614,11 @@
                           (default /usr/local/ftb)
   --with-bug2524          request that blcr use a work around for bug 2524
                           (ppc specific)
-  --with-pic              try to use only PIC/non-PIC objects [default=use
+  --with-pic[=PKGS]       try to use only PIC/non-PIC objects [default=use
                           both]
   --with-gnu-ld           assume the C compiler uses GNU ld [default=no]
+  --with-sysroot=DIR Search for dependent libraries within DIR
+                        (or the compiler's sysroot if not specified).
 
 Some influential environment variables:
   PERL        perl interpreter (required: for configure, build and testsuite)
@@ -1783,7 +1630,7 @@
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
   LIBS        libraries to pass to the linker, e.g. -l<library>
-  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I<include dir> if
+  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CXX         C++ compiler command
   CXXFLAGS    C++ compiler flags
@@ -1857,10 +1704,9 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 blcr configure 0.8.5
-generated by GNU Autoconf 2.63
+generated by GNU Autoconf 2.69
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 
@@ -1890,141 +1736,708 @@
 _ACEOF
   exit
 fi
-cat >config.log <<_ACEOF
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
 
-It was created by blcr $as_me 0.8.5, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+## ------------------------ ##
+## Autoconf initialization. ##
+## ------------------------ ##
+
+# ac_fn_c_try_compile LINENO
+# --------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-  $ $0 $@
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-_ACEOF
-exec 5>>config.log
+} # ac_fn_c_try_compile
+
+# ac_fn_cxx_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_compile ()
 {
-cat <<_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
-uname -m = `(uname -m) 2>/dev/null || echo unknown`
-uname -r = `(uname -r) 2>/dev/null || echo unknown`
-uname -s = `(uname -s) 2>/dev/null || echo unknown`
-uname -v = `(uname -v) 2>/dev/null || echo unknown`
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
-/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+} # ac_fn_cxx_try_compile
 
-/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
-/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
-/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
-/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+# ac_fn_cxx_try_cpp LINENO
+# ------------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-_ASUNAME
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  $as_echo "PATH: $as_dir"
-done
-IFS=$as_save_IFS
+} # ac_fn_cxx_try_cpp
 
-} >&5
+# ac_fn_c_try_run LINENO
+# ----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_c_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-cat >&5 <<_ACEOF
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
+} # ac_fn_c_try_run
 
-## ----------- ##
-## Core tests. ##
-## ----------- ##
+# ac_fn_c_compute_int LINENO EXPR VAR INCLUDES
+# --------------------------------------------
+# Tries to find the compile-time value of EXPR in a program that includes
+# INCLUDES, setting VAR accordingly. Returns whether the value could be
+# computed
+ac_fn_c_compute_int ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if test "$cross_compiling" = yes; then
+    # Depending upon the size, compute the lo and hi bounds.
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= 0)];
+test_array [0] = 0;
+return test_array [0];
 
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_lo=0 ac_mid=0
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
 
-
-# Keep a trace of the command line.
-# Strip out --no-create and --no-recursion so they do not pile up.
-# Strip out --silent because we don't want to record it for future runs.
-# Also quote any args containing shell meta-characters.
-# Make two passes to allow for proper duplicate-argument suppression.
-ac_configure_args=
-ac_configure_args0=
-ac_configure_args1=
-ac_must_keep_next=false
-for ac_pass in 1 2
-do
-  for ac_arg
-  do
-    case $ac_arg in
-    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
-    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-    | -silent | --silent | --silen | --sile | --sil)
-      continue ;;
-    *\'*)
-      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
-    esac
-    case $ac_pass in
-    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
-    2)
-      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
-      if test $ac_must_keep_next = true; then
-	ac_must_keep_next=false # Got value, back to normal.
-      else
-	case $ac_arg in
-	  *=* | --config-cache | -C | -disable-* | --disable-* \
-	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-	  | -with-* | --with-* | -without-* | --without-* | --x)
-	    case "$ac_configure_args0 " in
-	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
-	    esac
-	    ;;
-	  -* ) ac_must_keep_next=true ;;
-	esac
-      fi
-      ac_configure_args="$ac_configure_args '$ac_arg'"
-      ;;
-    esac
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid; break
+else
+  as_fn_arith $ac_mid + 1 && ac_lo=$as_val
+			if test $ac_lo -le $ac_mid; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid + 1 && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   done
-done
-$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
-
-# When interrupted or exit'd, cleanup temporary files, and complete
-# config.log.  We remove comments because anyway the quotes in there
-# would cause problems or look ugly.
-# WARNING: Use '\'' to represent an apostrophe within the trap.
-# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
-trap 'exit_status=$?
-  # Save into config.log some information that might help in debugging.
-  {
-    echo
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) < 0)];
+test_array [0] = 0;
+return test_array [0];
 
-    cat <<\_ASBOX
-## ---------------- ##
-## Cache variables. ##
-## ---------------- ##
-_ASBOX
-    echo
-    # The following way of writing the cache mishandles newlines in values,
-(
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=-1 ac_mid=-1
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_lo=$ac_mid; break
+else
+  as_fn_arith '(' $ac_mid ')' - 1 && ac_hi=$as_val
+			if test $ac_mid -le $ac_hi; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
+else
+  ac_lo= ac_hi=
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+# Binary search between lo and hi bounds.
+while test "x$ac_lo" != "x$ac_hi"; do
+  as_fn_arith '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo && ac_mid=$as_val
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid
+else
+  as_fn_arith '(' $ac_mid ')' + 1 && ac_lo=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+case $ac_lo in #((
+?*) eval "$3=\$ac_lo"; ac_retval=0 ;;
+'') ac_retval=1 ;;
+esac
+  else
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+static long int longval () { return $2; }
+static unsigned long int ulongval () { return $2; }
+#include <stdio.h>
+#include <stdlib.h>
+int
+main ()
+{
+
+  FILE *f = fopen ("conftest.val", "w");
+  if (! f)
+    return 1;
+  if (($2) < 0)
+    {
+      long int i = longval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%ld", i);
+    }
+  else
+    {
+      unsigned long int i = ulongval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%lu", i);
+    }
+  /* Do not output a trailing newline, as this causes \r\n confusion
+     on some platforms.  */
+  return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  echo >>conftest.val; read $3 <conftest.val; ac_retval=0
+else
+  ac_retval=1
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+rm -f conftest.val
+
+  fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_compute_int
+
+# ac_fn_c_try_cpp LINENO
+# ----------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_cpp
+
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_compile
+
+# ac_fn_c_try_link LINENO
+# -----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 test -x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_link
+
+# ac_fn_c_check_func LINENO FUNC VAR
+# ----------------------------------
+# Tests whether FUNC exists, setting the cache variable VAR accordingly
+ac_fn_c_check_func ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $2 innocuous_$2
+
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $2 (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
+
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+
+#undef $2
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char $2 ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_$2 || defined __stub___$2
+choke me
+#endif
+
+int
+main ()
+{
+return $2 ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_func
+
+# ac_fn_cxx_try_link LINENO
+# -------------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 test -x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_link
+cat >config.log <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+
+It was created by blcr $as_me 0.8.5, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
+
+  $ $0 $@
+
+_ACEOF
+exec 5>>config.log
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
+
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+
+_ASUNAME
+
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    $as_echo "PATH: $as_dir"
+  done
+IFS=$as_save_IFS
+
+} >&5
+
+cat >&5 <<_ACEOF
+
+
+## ----------- ##
+## Core tests. ##
+## ----------- ##
+
+_ACEOF
+
+
+# Keep a trace of the command line.
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Strip out --silent because we don't want to record it for future runs.
+# Also quote any args containing shell meta-characters.
+# Make two passes to allow for proper duplicate-argument suppression.
+ac_configure_args=
+ac_configure_args0=
+ac_configure_args1=
+ac_must_keep_next=false
+for ac_pass in 1 2
+do
+  for ac_arg
+  do
+    case $ac_arg in
+    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
+    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+    | -silent | --silent | --silen | --sile | --sil)
+      continue ;;
+    *\'*)
+      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    case $ac_pass in
+    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
+    2)
+      as_fn_append ac_configure_args1 " '$ac_arg'"
+      if test $ac_must_keep_next = true; then
+	ac_must_keep_next=false # Got value, back to normal.
+      else
+	case $ac_arg in
+	  *=* | --config-cache | -C | -disable-* | --disable-* \
+	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+	  | -with-* | --with-* | -without-* | --without-* | --x)
+	    case "$ac_configure_args0 " in
+	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+	    esac
+	    ;;
+	  -* ) ac_must_keep_next=true ;;
+	esac
+      fi
+      as_fn_append ac_configure_args " '$ac_arg'"
+      ;;
+    esac
+  done
+done
+{ ac_configure_args0=; unset ac_configure_args0;}
+{ ac_configure_args1=; unset ac_configure_args1;}
+
+# When interrupted or exit'd, cleanup temporary files, and complete
+# config.log.  We remove comments because anyway the quotes in there
+# would cause problems or look ugly.
+# WARNING: Use '\'' to represent an apostrophe within the trap.
+# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
+trap 'exit_status=$?
+  # Save into config.log some information that might help in debugging.
+  {
+    echo
+
+    $as_echo "## ---------------- ##
+## Cache variables. ##
+## ---------------- ##"
+    echo
+    # The following way of writing the cache mishandles newlines in values,
+(
   for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
     eval ac_val=\$$ac_var
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -2043,11 +2456,9 @@
 )
     echo
 
-    cat <<\_ASBOX
-## ----------------- ##
+    $as_echo "## ----------------- ##
 ## Output variables. ##
-## ----------------- ##
-_ASBOX
+## ----------------- ##"
     echo
     for ac_var in $ac_subst_vars
     do
@@ -2060,11 +2471,9 @@
     echo
 
     if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
+      $as_echo "## ------------------- ##
 ## File substitutions. ##
-## ------------------- ##
-_ASBOX
+## ------------------- ##"
       echo
       for ac_var in $ac_subst_files
       do
@@ -2078,11 +2487,9 @@
     fi
 
     if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
+      $as_echo "## ----------- ##
 ## confdefs.h. ##
-## ----------- ##
-_ASBOX
+## ----------- ##"
       echo
       cat confdefs.h
       echo
@@ -2096,46 +2503,53 @@
     exit $exit_status
 ' 0
 for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
+  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
 done
 ac_signal=0
 
 # confdefs.h avoids OS command line length limits that DEFS can exceed.
 rm -f -r conftest* confdefs.h
 
+$as_echo "/* confdefs.h */" > confdefs.h
+
 # Predefined preprocessor variables.
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_NAME "$PACKAGE_NAME"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_TARNAME "$PACKAGE_TARNAME"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_VERSION "$PACKAGE_VERSION"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_STRING "$PACKAGE_STRING"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
 _ACEOF
 
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_URL "$PACKAGE_URL"
+_ACEOF
+
 
 # Let the site file select an alternate cache file if it wants to.
 # Prefer an explicitly selected file to automatically selected ones.
 ac_site_file1=NONE
 ac_site_file2=NONE
 if test -n "$CONFIG_SITE"; then
-  ac_site_file1=$CONFIG_SITE
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
 elif test "x$prefix" != xNONE; then
   ac_site_file1=$prefix/share/config.site
   ac_site_file2=$prefix/etc/config.site
@@ -2146,19 +2560,23 @@
 for ac_site_file in "$ac_site_file1" "$ac_site_file2"
 do
   test "x$ac_site_file" = xNONE && continue
-  if test -r "$ac_site_file"; then
-    { $as_echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
+  if test /dev/null != "$ac_site_file" && test -r "$ac_site_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
 $as_echo "$as_me: loading site script $ac_site_file" >&6;}
     sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5; }
   fi
 done
 
 if test -r "$cache_file"; then
-  # Some versions of bash will fail to source /dev/null (special
-  # files actually), so we avoid doing that.
-  if test -f "$cache_file"; then
-    { $as_echo "$as_me:$LINENO: loading cache $cache_file" >&5
+  # Some versions of bash will fail to source /dev/null (special files
+  # actually), so we avoid doing that.  DJGPP emulates it as a regular file.
+  if test /dev/null != "$cache_file" && test -f "$cache_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
 $as_echo "$as_me: loading cache $cache_file" >&6;}
     case $cache_file in
       [\\/]* | ?:[\\/]* ) . "$cache_file";;
@@ -2166,7 +2584,7 @@
     esac
   fi
 else
-  { $as_echo "$as_me:$LINENO: creating cache $cache_file" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
 $as_echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
@@ -2181,11 +2599,11 @@
   eval ac_new_val=\$ac_env_${ac_var}_value
   case $ac_old_set,$ac_new_set in
     set,)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
 $as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,set)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
 $as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,);;
@@ -2195,17 +2613,17 @@
 	ac_old_val_w=`echo x $ac_old_val`
 	ac_new_val_w=`echo x $ac_new_val`
 	if test "$ac_old_val_w" != "$ac_new_val_w"; then
-	  { $as_echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
 $as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
 	  ac_cache_corrupted=:
 	else
-	  { $as_echo "$as_me:$LINENO: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
 $as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
 	  eval $ac_var=\$ac_old_val
 	fi
-	{ $as_echo "$as_me:$LINENO:   former value:  \`$ac_old_val'" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
 $as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
-	{ $as_echo "$as_me:$LINENO:   current value: \`$ac_new_val'" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
 $as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
       fi;;
   esac
@@ -2217,43 +2635,20 @@
     esac
     case " $ac_configure_args " in
       *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
     esac
   fi
 done
 if $ac_cache_corrupted; then
-  { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-  { $as_echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
 $as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  { { $as_echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
-$as_echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
 fi
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+## -------------------- ##
+## Main body of script. ##
+## -------------------- ##
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -2348,9 +2743,7 @@
   fi
 done
 if test -z "$ac_aux_dir"; then
-  { { $as_echo "$as_me:$LINENO: error: cannot find install-sh or install.sh in ./config \"$srcdir\"/./config" >&5
-$as_echo "$as_me: error: cannot find install-sh or install.sh in ./config \"$srcdir\"/./config" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find install-sh, install.sh, or shtool in ./config \"$srcdir\"/./config" "$LINENO" 5
 fi
 
 # These three variables are undocumented and unsupported,
@@ -2378,10 +2771,10 @@
 # OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
 # Reject install programs that cannot install multiple files.
-{ $as_echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a BSD-compatible install" >&5
 $as_echo_n "checking for a BSD-compatible install... " >&6; }
 if test -z "$INSTALL"; then
-if test "${ac_cv_path_install+set}" = set; then
+if ${ac_cv_path_install+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
@@ -2389,11 +2782,11 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  # Account for people who put trailing slashes in PATH elements.
-case $as_dir/ in
-  ./ | .// | /cC/* | \
+    # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in #((
+  ./ | .// | /[cC]/* | \
   /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
-  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
+  ?:[\\/]os2[\\/]install[\\/]* | ?:[\\/]OS2[\\/]INSTALL[\\/]* | \
   /usr/ucb/* ) ;;
   *)
     # OSF1 and SCO ODT 3.0 have their own names for install.
@@ -2401,7 +2794,7 @@
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -2430,7 +2823,7 @@
     ;;
 esac
 
-done
+  done
 IFS=$as_save_IFS
 
 rm -rf conftest.one conftest.two conftest.dir
@@ -2446,7 +2839,7 @@
     INSTALL=$ac_install_sh
   fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $INSTALL" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INSTALL" >&5
 $as_echo "$INSTALL" >&6; }
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
@@ -2457,7 +2850,7 @@
 
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-{ $as_echo "$as_me:$LINENO: checking whether build environment is sane" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether build environment is sane" >&5
 $as_echo_n "checking whether build environment is sane... " >&6; }
 # Just in case
 sleep 1
@@ -2468,15 +2861,11 @@
 '
 case `pwd` in
   *[\\\"\#\$\&\'\`$am_lf]*)
-    { { $as_echo "$as_me:$LINENO: error: unsafe absolute working directory name" >&5
-$as_echo "$as_me: error: unsafe absolute working directory name" >&2;}
-   { (exit 1); exit 1; }; };;
+    as_fn_error $? "unsafe absolute working directory name" "$LINENO" 5;;
 esac
 case $srcdir in
   *[\\\"\#\$\&\'\`$am_lf\ \	]*)
-    { { $as_echo "$as_me:$LINENO: error: unsafe srcdir value: \`$srcdir'" >&5
-$as_echo "$as_me: error: unsafe srcdir value: \`$srcdir'" >&2;}
-   { (exit 1); exit 1; }; };;
+    as_fn_error $? "unsafe srcdir value: \`$srcdir'" "$LINENO" 5;;
 esac
 
 # Do `set' in a subshell so we don't clobber the current shell's
@@ -2498,11 +2887,8 @@
       # if, for instance, CONFIG_SHELL is bash and it inherits a
       # broken ls alias from the environment.  This has actually
       # happened.  Such a system could not be considered "sane".
-      { { $as_echo "$as_me:$LINENO: error: ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" >&5
-$as_echo "$as_me: error: ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
+alias in your environment" "$LINENO" 5
    fi
 
    test "$2" = conftest.file
@@ -2511,13 +2897,10 @@
    # Ok.
    :
 else
-   { { $as_echo "$as_me:$LINENO: error: newly created file is older than distributed files!
-Check your system clock" >&5
-$as_echo "$as_me: error: newly created file is older than distributed files!
-Check your system clock" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "newly created file is older than distributed files!
+Check your system clock" "$LINENO" 5
 fi
-{ $as_echo "$as_me:$LINENO: result: yes" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 test "$program_prefix" != NONE &&
   program_transform_name="s&^&$program_prefix&;$program_transform_name"
@@ -2545,7 +2928,7 @@
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  { $as_echo "$as_me:$LINENO: WARNING: \`missing' script is too old or missing" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`missing' script is too old or missing" >&5
 $as_echo "$as_me: WARNING: \`missing' script is too old or missing" >&2;}
 fi
 
@@ -2566,9 +2949,9 @@
   if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
 set dummy ${ac_tool_prefix}strip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_STRIP+set}" = set; then
+if ${ac_cv_prog_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$STRIP"; then
@@ -2579,24 +2962,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 STRIP=$ac_cv_prog_STRIP
 if test -n "$STRIP"; then
-  { $as_echo "$as_me:$LINENO: result: $STRIP" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
 $as_echo "$STRIP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2606,9 +2989,9 @@
   ac_ct_STRIP=$STRIP
   # Extract the first word of "strip", so it can be a program name with args.
 set dummy strip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_STRIP"; then
@@ -2619,24 +3002,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
 if test -n "$ac_ct_STRIP"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_STRIP" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
 $as_echo "$ac_ct_STRIP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2645,7 +3028,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -2658,10 +3041,10 @@
 fi
 INSTALL_STRIP_PROGRAM="\$(install_sh) -c -s"
 
-{ $as_echo "$as_me:$LINENO: checking for a thread-safe mkdir -p" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a thread-safe mkdir -p" >&5
 $as_echo_n "checking for a thread-safe mkdir -p... " >&6; }
 if test -z "$MKDIR_P"; then
-  if test "${ac_cv_path_mkdir+set}" = set; then
+  if ${ac_cv_path_mkdir+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
@@ -2669,9 +3052,9 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in mkdir gmkdir; do
+    for ac_prog in mkdir gmkdir; do
 	 for ac_exec_ext in '' $ac_executable_extensions; do
-	   { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; } || continue
+	   as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext" || continue
 	   case `"$as_dir/$ac_prog$ac_exec_ext" --version 2>&1` in #(
 	     'mkdir (GNU coreutils) '* | \
 	     'mkdir (coreutils) '* | \
@@ -2681,11 +3064,12 @@
 	   esac
 	 done
        done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 
+  test -d ./--version && rmdir ./--version
   if test "${ac_cv_path_mkdir+set}" = set; then
     MKDIR_P="$ac_cv_path_mkdir -p"
   else
@@ -2693,11 +3077,10 @@
     # value for MKDIR_P within a source directory, because that will
     # break other packages using the cache if that directory is
     # removed, or if the value is a relative name.
-    test -d ./--version && rmdir ./--version
     MKDIR_P="$ac_install_sh -d"
   fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $MKDIR_P" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $MKDIR_P" >&5
 $as_echo "$MKDIR_P" >&6; }
 
 mkdir_p="$MKDIR_P"
@@ -2710,9 +3093,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_AWK+set}" = set; then
+if ${ac_cv_prog_AWK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$AWK"; then
@@ -2723,24 +3106,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AWK="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 AWK=$ac_cv_prog_AWK
 if test -n "$AWK"; then
-  { $as_echo "$as_me:$LINENO: result: $AWK" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AWK" >&5
 $as_echo "$AWK" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2748,11 +3131,11 @@
   test -n "$AWK" && break
 done
 
-{ $as_echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
 $as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
 set x ${MAKE-make}
 ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if { as_var=ac_cv_prog_make_${ac_make}_set; eval "test \"\${$as_var+set}\" = set"; }; then
+if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat >conftest.make <<\_ACEOF
@@ -2760,7 +3143,7 @@
 all:
 	@echo '@@@%%%=$(MAKE)=@@@%%%'
 _ACEOF
-# GNU make sometimes prints "make[1]: Entering...", which would confuse us.
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
 case `${MAKE-make} -f conftest.make 2>/dev/null` in
   *@@@%%%=?*=@@@%%%*)
     eval ac_cv_prog_make_${ac_make}_set=yes;;
@@ -2770,11 +3153,11 @@
 rm -f conftest.make
 fi
 if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
   SET_MAKE=
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
   SET_MAKE="MAKE=${MAKE-make}"
 fi
@@ -2794,9 +3177,7 @@
   am__isrc=' -I$(srcdir)'
   # test to see if srcdir already configured
   if test -f $srcdir/config.status; then
-    { { $as_echo "$as_me:$LINENO: error: source directory already configured; run \"make distclean\" there first" >&5
-$as_echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "source directory already configured; run \"make distclean\" there first" "$LINENO" 5
   fi
 fi
 
@@ -2842,14 +3223,38 @@
 
 # We need awk for the "check" target.  The system "awk" is bad on
 # some platforms.
-# Always define AMTAR for backward compatibility.
+# Always define AMTAR for backward compatibility.  Yes, it's still used
+# in the wild :-(  We should find a proper way to deprecate it ...
+AMTAR='$${TAR-tar}'
+
+am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'
+
+
 
-AMTAR=${AMTAR-"${am_missing_run}tar"}
 
-am__tar='${AMTAR} chof - "$$tardir"'; am__untar='${AMTAR} xf -'
 
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to enable maintainer-specific portions of Makefiles" >&5
+$as_echo_n "checking whether to enable maintainer-specific portions of Makefiles... " >&6; }
+    # Check whether --enable-maintainer-mode was given.
+if test "${enable_maintainer_mode+set}" = set; then :
+  enableval=$enable_maintainer_mode; USE_MAINTAINER_MODE=$enableval
+else
+  USE_MAINTAINER_MODE=yes
+fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $USE_MAINTAINER_MODE" >&5
+$as_echo "$USE_MAINTAINER_MODE" >&6; }
+   if test $USE_MAINTAINER_MODE = yes; then
+  MAINTAINER_MODE_TRUE=
+  MAINTAINER_MODE_FALSE='#'
+else
+  MAINTAINER_MODE_TRUE='#'
+  MAINTAINER_MODE_FALSE=
+fi
+
+  MAINT=$MAINTAINER_MODE_TRUE
 
 
 
@@ -2861,16 +3266,15 @@
 
 
 
-
 ################################################################################
 # Absolute paths to build and source dirs
 # need to substitute these into cscope script
 ################################################################################
 # Extract the first word of "pwd", so it can be a program name with args.
 set dummy pwd; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PWD_PROG+set}" = set; then
+if ${ac_cv_path_PWD_PROG+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PWD_PROG in
@@ -2883,14 +3287,14 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PWD_PROG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   test -z "$ac_cv_path_PWD_PROG" && ac_cv_path_PWD_PROG=""pwd -P""
@@ -2899,10 +3303,10 @@
 fi
 PWD_PROG=$ac_cv_path_PWD_PROG
 if test -n "$PWD_PROG"; then
-  { $as_echo "$as_me:$LINENO: result: $PWD_PROG" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PWD_PROG" >&5
 $as_echo "$PWD_PROG" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2918,15 +3322,13 @@
 
 
 # Check whether --with-components was given.
-if test "${with_components+set}" = set; then
+if test "${with_components+set}" = set; then :
   withval=$with_components;
 fi
 
   case x"$with_components" in
     xyes)
-      { { $as_echo "$as_me:$LINENO: error: --with-components requires an argument.  Known components are: modules util libcr include tests examples contrib" >&5
-$as_echo "$as_me: error: --with-components requires an argument.  Known components are: modules util libcr include tests examples contrib" >&2;}
-   { (exit 1); exit 1; }; };
+      as_fn_error $? "--with-components requires an argument.  Known components are: modules util libcr include tests examples contrib" "$LINENO" 5;
       ;;
     x)
       for cr_lcv in modules util libcr include tests examples contrib; do
@@ -2950,35 +3352,27 @@
 ################################################################################
 # Make sure we can run config.sub.
 $SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  { { $as_echo "$as_me:$LINENO: error: cannot run $SHELL $ac_aux_dir/config.sub" >&5
-$as_echo "$as_me: error: cannot run $SHELL $ac_aux_dir/config.sub" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
 
-{ $as_echo "$as_me:$LINENO: checking build system type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
 $as_echo_n "checking build system type... " >&6; }
-if test "${ac_cv_build+set}" = set; then
+if ${ac_cv_build+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_build_alias=$build_alias
 test "x$ac_build_alias" = x &&
   ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
 test "x$ac_build_alias" = x &&
-  { { $as_echo "$as_me:$LINENO: error: cannot guess build type; you must specify one" >&5
-$as_echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
 ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $ac_build_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_build" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
 $as_echo "$ac_cv_build" >&6; }
 case $ac_cv_build in
 *-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical build" >&5
-$as_echo "$as_me: error: invalid value of canonical build" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
 esac
 build=$ac_cv_build
 ac_save_IFS=$IFS; IFS='-'
@@ -2994,28 +3388,24 @@
 case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
 
 
-{ $as_echo "$as_me:$LINENO: checking host system type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
 $as_echo_n "checking host system type... " >&6; }
-if test "${ac_cv_host+set}" = set; then
+if ${ac_cv_host+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test "x$host_alias" = x; then
   ac_cv_host=$ac_cv_build
 else
   ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    { { $as_echo "$as_me:$LINENO: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&5
-$as_echo "$as_me: error: $SHELL $ac_aux_dir/config.sub $host_alias failed" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_host" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
 $as_echo "$ac_cv_host" >&6; }
 case $ac_cv_host in
 *-*-*) ;;
-*) { { $as_echo "$as_me:$LINENO: error: invalid value of canonical host" >&5
-$as_echo "$as_me: error: invalid value of canonical host" >&2;}
-   { (exit 1); exit 1; }; };;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
 esac
 host=$ac_cv_host
 ac_save_IFS=$IFS; IFS='-'
@@ -3062,13 +3452,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -3076,8 +3466,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -3099,19 +3489,28 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-    { { $as_echo "$as_me:$LINENO: error: the host system must be Linux (have $host_os)" >&5
-$as_echo "$as_me: error: the host system must be Linux (have $host_os)" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "the host system must be Linux (have $host_os)" "$LINENO" 5
     ;;
 esac
 CR_ARCH=$host_cpu
@@ -3147,13 +3546,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -3161,8 +3560,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -3184,19 +3583,28 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-    { { $as_echo "$as_me:$LINENO: error: i386 not supported, i486 or higher is required" >&5
-$as_echo "$as_me: error: i386 not supported, i486 or higher is required" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "i386 not supported, i486 or higher is required" "$LINENO" 5
     ;;
   i?86)
     CR_ARCH=i386
@@ -3238,9 +3646,7 @@
     cr_arch_incomplete=yes
     ;;
   *)
-    { { $as_echo "$as_me:$LINENO: error: Sorry, architecture $host_cpu is not supported at this time." >&5
-$as_echo "$as_me: error: Sorry, architecture $host_cpu is not supported at this time." >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "Sorry, architecture $host_cpu is not supported at this time." "$LINENO" 5
     ;;
 esac
 
@@ -3252,58 +3658,53 @@
 # Let user specify location of Linux kernel headers and build
 
 # Check whether --with-linux was given.
-if test "${with_linux+set}" = set; then
-  withval=$with_linux; if test x"$with_linux" != xyes; then
+if test "${with_linux+set}" = set; then :
+  withval=$with_linux; if test x"$with_linux" != xyes; then :
   LINUX_OBJ_ARG=$with_linux
 fi
-
 fi
 
 
 # Check whether --with-linux-src was given.
-if test "${with_linux_src+set}" = set; then
-  withval=$with_linux_src; if test x"$with_linux_src" != xyes; then
+if test "${with_linux_src+set}" = set; then :
+  withval=$with_linux_src; if test x"$with_linux_src" != xyes; then :
   LINUX_SRC_ARG=$with_linux_src
 fi
-
 fi
 
 
 # Let user specify location of kernel System.map and/or vmlinux
 
 # Check whether --with-system-map was given.
-if test "${with_system_map+set}" = set; then
-  withval=$with_system_map; if test x"$with_system_map" != xyes; then
+if test "${with_system_map+set}" = set; then :
+  withval=$with_system_map; if test x"$with_system_map" != xyes; then :
   LINUX_SYSTEM_MAP=$with_system_map
 fi
-
 fi
 
 
 # Check whether --with-vmlinux was given.
-if test "${with_vmlinux+set}" = set; then
-  withval=$with_vmlinux; if test x"$with_vmlinux" != xyes; then
+if test "${with_vmlinux+set}" = set; then :
+  withval=$with_vmlinux; if test x"$with_vmlinux" != xyes; then :
   LINUX_VMLINUX=$with_vmlinux
 fi
-
 fi
 
 
 # Let user specify dir to install kernel modules
 
 # Check whether --with-kmod-dir was given.
-if test "${with_kmod_dir+set}" = set; then
-  withval=$with_kmod_dir; if test x"$with_kmod_dir" != xyes; then
+if test "${with_kmod_dir+set}" = set; then :
+  withval=$with_kmod_dir; if test x"$with_kmod_dir" != xyes; then :
   CR_MODULE_DIR=$with_kmod_dir
 fi
-
 fi
 
 
 # Let user force UP, SMP or HUGEMEM kernel configs on RH (and similar) systems
 
 # Check whether --with-kernel-type was given.
-if test "${with_kernel_type+set}" = set; then
+if test "${with_kernel_type+set}" = set; then :
   withval=$with_kernel_type;
 fi
 
@@ -3311,7 +3712,7 @@
 # Let user supress the printing of the final configuration report
 
   # Check whether --enable-config-report was given.
-if test "${enable_config_report+set}" = set; then
+if test "${enable_config_report+set}" = set; then :
   enableval=$enable_config_report; :
 else
   enable_config_report=yes
@@ -3322,7 +3723,7 @@
 # Let the user request/supress use of V=1 with kbuild
 
   # Check whether --enable-kbuild-verbose was given.
-if test "${enable_kbuild_verbose+set}" = set; then
+if test "${enable_kbuild_verbose+set}" = set; then :
   enableval=$enable_kbuild_verbose; :
 else
   enable_kbuild_verbose=no
@@ -3333,7 +3734,7 @@
 # Debugging (implies tracing enabled by default)
 
   # Check whether --enable-debug was given.
-if test "${enable_debug+set}" = set; then
+if test "${enable_debug+set}" = set; then :
   enableval=$enable_debug; :
 else
   enable_debug=no
@@ -3350,31 +3751,25 @@
 
 
   if test x$enable_debug = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define CRI_DEBUG 1
-_ACEOF
+    $as_echo "#define CRI_DEBUG 1" >>confdefs.h
 
   else
-    cat >>confdefs.h <<\_ACEOF
-#define CRI_DEBUG 0
-_ACEOF
+    $as_echo "#define CRI_DEBUG 0" >>confdefs.h
 
   fi
 
 
-
-if test x$enable_debug = xyes; then
+if test x$enable_debug = xyes; then :
   CR_NDEBUG=""
 else
   CR_NDEBUG="-DNDEBUG"
 fi
 
 
-
 # Feature libcr-tracing
 
   # Check whether --enable-libcr-tracing was given.
-if test "${enable_libcr_tracing+set}" = set; then
+if test "${enable_libcr_tracing+set}" = set; then :
   enableval=$enable_libcr_tracing; :
 else
   enable_libcr_tracing=$enable_debug
@@ -3391,24 +3786,19 @@
 
 
   if test x$enable_libcr_tracing = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define LIBCR_TRACING 1
-_ACEOF
+    $as_echo "#define LIBCR_TRACING 1" >>confdefs.h
 
   else
-    cat >>confdefs.h <<\_ACEOF
-#define LIBCR_TRACING 0
-_ACEOF
+    $as_echo "#define LIBCR_TRACING 0" >>confdefs.h
 
   fi
 
 
 
-
 # Feature kernel-tracing
 
   # Check whether --enable-kernel-tracing was given.
-if test "${enable_kernel_tracing+set}" = set; then
+if test "${enable_kernel_tracing+set}" = set; then :
   enableval=$enable_kernel_tracing; :
 else
   enable_kernel_tracing=$enable_debug
@@ -3425,24 +3815,19 @@
 
 
   if test x$enable_kernel_tracing = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define CR_KERNEL_TRACING 1
-_ACEOF
+    $as_echo "#define CR_KERNEL_TRACING 1" >>confdefs.h
 
   else
-    cat >>confdefs.h <<\_ACEOF
-#define CR_KERNEL_TRACING 0
-_ACEOF
+    $as_echo "#define CR_KERNEL_TRACING 0" >>confdefs.h
 
   fi
 
 
 
-
 # Multilib support
 
   # Check whether --enable-multilib was given.
-if test "${enable_multilib+set}" = set; then
+if test "${enable_multilib+set}" = set; then :
   enableval=$enable_multilib; :
 else
   enable_multilib=no
@@ -3453,7 +3838,7 @@
 # Optional /etc/init.d/blcr file
 
   # Check whether --enable-init-script was given.
-if test "${enable_init_script+set}" = set; then
+if test "${enable_init_script+set}" = set; then :
   enableval=$enable_init_script; :
 else
   enable_init_script=no
@@ -3472,7 +3857,7 @@
 # Check is restoring uid, gid and supplemental groups is requested
 
   # Check whether --enable-restore-ids was given.
-if test "${enable_restore_ids+set}" = set; then
+if test "${enable_restore_ids+set}" = set; then :
   enableval=$enable_restore_ids; :
 else
   enable_restore_ids=no
@@ -3481,24 +3866,19 @@
 
 
   if test x$enable_restore_ids = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define CR_RESTORE_IDS 1
-_ACEOF
+    $as_echo "#define CR_RESTORE_IDS 1" >>confdefs.h
 
   else
-    cat >>confdefs.h <<\_ACEOF
-#define CR_RESTORE_IDS 0
-_ACEOF
+    $as_echo "#define CR_RESTORE_IDS 0" >>confdefs.h
 
   fi
 
 
 
-
 # Let user build against an already installed libcr
 
 # Check whether --with-installed-libcr was given.
-if test "${with_installed_libcr+set}" = set; then
+if test "${with_installed_libcr+set}" = set; then :
   withval=$with_installed_libcr;
 	cr_build_libcr=no
 	cr_build_include=no
@@ -3516,7 +3896,7 @@
 # Let user build/test against already installed utilities
 
 # Check whether --with-installed-util was given.
-if test "${with_installed_util+set}" = set; then
+if test "${with_installed_util+set}" = set; then :
   withval=$with_installed_util;
 	cr_build_util=no
 fi
@@ -3533,7 +3913,7 @@
 # Let user build/run/test against already installed kernel modules
 
 # Check whether --with-installed-modules was given.
-if test "${with_installed_modules+set}" = set; then
+if test "${with_installed_modules+set}" = set; then :
   withval=$with_installed_modules;
 	cr_build_modules=no
 fi
@@ -3542,7 +3922,7 @@
 # Let user request installation of the test suite
 
   # Check whether --enable-testsuite was given.
-if test "${enable_testsuite+set}" = set; then
+if test "${enable_testsuite+set}" = set; then :
   enableval=$enable_testsuite; :
 else
   enable_testsuite=no
@@ -3561,7 +3941,7 @@
 # Let user request static utils, tests and examples
 
   # Check whether --enable-all-static was given.
-if test "${enable_all_static+set}" = set; then
+if test "${enable_all_static+set}" = set; then :
   enableval=$enable_all_static; :
 else
   enable_all_static=no
@@ -3572,7 +3952,7 @@
 # Let user request optional "cr_info" util
 
   # Check whether --enable-cr-info was given.
-if test "${enable_cr_info+set}" = set; then
+if test "${enable_cr_info+set}" = set; then :
   enableval=$enable_cr_info; :
 else
   enable_cr_info=no
@@ -3583,7 +3963,7 @@
 # Let user specify location of optional FTB headers & libs
 
 # Check whether --with-ftb was given.
-if test "${with_ftb+set}" = set; then
+if test "${with_ftb+set}" = set; then :
   withval=$with_ftb; FTB_HOME=$withval; cr_force_ftb=yes
 else
   FTB_HOME='/usr/local/ftb'
@@ -3597,7 +3977,7 @@
 if expr $CR_ARCH : ppc >/dev/null; then
 
 # Check whether --with-bug2524 was given.
-if test "${with_bug2524+set}" = set; then
+if test "${with_bug2524+set}" = set; then :
   withval=$with_bug2524; force_bug2524=$withval
 fi
 
@@ -3618,9 +3998,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PERL+set}" = set; then
+if ${ac_cv_path_PERL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $PERL in
@@ -3633,14 +4013,14 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PERL="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   ;;
@@ -3648,10 +4028,10 @@
 fi
 PERL=$ac_cv_path_PERL
 if test -n "$PERL"; then
-  { $as_echo "$as_me:$LINENO: result: $PERL" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PERL" >&5
 $as_echo "$PERL" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3660,9 +4040,7 @@
 done
 
 if test -z "$PERL"; then
-  { { $as_echo "$as_me:$LINENO: error: cannot find a version of perl - please install perl and/or set \$PERL to indicate where it's located" >&5
-$as_echo "$as_me: error: cannot find a version of perl - please install perl and/or set \$PERL to indicate where it's located" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find a version of perl - please install perl and/or set \$PERL to indicate where it's located" "$LINENO" 5
 fi
 PERL=$PERL
 
@@ -3672,9 +4050,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_MAKE+set}" = set; then
+if ${ac_cv_path_MAKE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $MAKE in
@@ -3687,14 +4065,14 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_MAKE="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   ;;
@@ -3702,10 +4080,10 @@
 fi
 MAKE=$ac_cv_path_MAKE
 if test -n "$MAKE"; then
-  { $as_echo "$as_me:$LINENO: result: $MAKE" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAKE" >&5
 $as_echo "$MAKE" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3714,23 +4092,21 @@
 done
 
 if test -n "$MAKE"; then
-  { $as_echo "$as_me:$LINENO: checking if $MAKE is GNU make" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $MAKE is GNU make" >&5
 $as_echo_n "checking if $MAKE is GNU make... " >&6; }
   MAKE_VERSTR=`$MAKE --version | grep GNU 2> /dev/null`
   if test -z "$MAKE_VERSTR" ; then
-    { $as_echo "$as_me:$LINENO: result: no" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
   else
     #MAKE_VER=`echo "$MAKE_VERSTR" | perl -n -e 'if (/([[0-9]]+)\.([[0-9]]+)(\.[[0-9]]+)?/) { $maj=$1; $min=$2; $pat=$3; printf "%i%03i%03i",($maj,$min,($pat?$pat=~s/\.//:0)) }'`
     MAKE_VERSION=`echo "$MAKE_VERSTR" | perl -n -e 'if (/(([0-9]+)\.([0-9]+)(\.[0-9]+)?)/) { print $1 }'`
-    { $as_echo "$as_me:$LINENO: result: yes ($MAKE_VERSION)" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes ($MAKE_VERSION)" >&5
 $as_echo "yes ($MAKE_VERSION)" >&6; }
   fi
 fi
 if test -z "$MAKE_VERSTR" ; then
-  { { $as_echo "$as_me:$LINENO: error: cannot find a version of GNU make - please install GNU make and/or set \$MAKE to indicate where it's located" >&5
-$as_echo "$as_me: error: cannot find a version of GNU make - please install GNU make and/or set \$MAKE to indicate where it's located" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find a version of GNU make - please install GNU make and/or set \$MAKE to indicate where it's located" "$LINENO" 5
 fi
 
 # What language(s) do we need
@@ -3745,9 +4121,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then
+if ${ac_cv_prog_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$RANLIB"; then
@@ -3758,24 +4134,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 RANLIB=$ac_cv_prog_RANLIB
 if test -n "$RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $RANLIB" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
 $as_echo "$RANLIB" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3785,9 +4161,9 @@
   ac_ct_RANLIB=$RANLIB
   # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_RANLIB"; then
@@ -3798,24 +4174,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
 if test -n "$ac_ct_RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
 $as_echo "$ac_ct_RANLIB" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3824,7 +4200,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -3836,14 +4212,14 @@
 
 
 # For symbolic links
-{ $as_echo "$as_me:$LINENO: checking whether ln -s works" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
 $as_echo_n "checking whether ln -s works... " >&6; }
 LN_S=$as_ln_s
 if test "$LN_S" = "ln -s"; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no, using $LN_S" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
 $as_echo "no, using $LN_S" >&6; }
 fi
 
@@ -3862,7 +4238,7 @@
 .PHONY: am__doit
 END
 # If we don't find an include directive, just comment out the code.
-{ $as_echo "$as_me:$LINENO: checking for style of include used by $am_make" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for style of include used by $am_make" >&5
 $as_echo_n "checking for style of include used by $am_make... " >&6; }
 am__include="#"
 am__quote=
@@ -3890,18 +4266,19 @@
 fi
 
 
-{ $as_echo "$as_me:$LINENO: result: $_am_result" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $_am_result" >&5
 $as_echo "$_am_result" >&6; }
 rm -f confinc confmf
 
 # Check whether --enable-dependency-tracking was given.
-if test "${enable_dependency_tracking+set}" = set; then
+if test "${enable_dependency_tracking+set}" = set; then :
   enableval=$enable_dependency_tracking;
 fi
 
 if test "x$enable_dependency_tracking" != xno; then
   am_depcomp="$ac_aux_dir/depcomp"
   AMDEPBACKSLASH='\'
+  am__nodep='_no'
 fi
  if test "x$enable_dependency_tracking" != xno; then
   AMDEP_TRUE=
@@ -3920,9 +4297,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -3933,24 +4310,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3960,9 +4337,9 @@
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -3973,24 +4350,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3999,7 +4376,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4013,9 +4390,9 @@
           if test -n "$ac_tool_prefix"; then
     # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -4026,24 +4403,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4053,9 +4430,9 @@
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -4067,18 +4444,18 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
      fi
     ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
@@ -4097,10 +4474,10 @@
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4112,9 +4489,9 @@
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -4125,24 +4502,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4156,9 +4533,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -4169,24 +4546,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4199,7 +4576,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4210,57 +4587,37 @@
 fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4276,8 +4633,8 @@
 # Try to create an executable without -o first, disregard a.out.
 # It will help us diagnose broken compilers, and finding out an intuition
 # of exeext.
-{ $as_echo "$as_me:$LINENO: checking for C compiler default output file name" >&5
-$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
+$as_echo_n "checking whether the C compiler works... " >&6; }
 ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
 
 # The possible output files:
@@ -4293,17 +4650,17 @@
 done
 rm -f $ac_rmfiles
 
-if { (ac_try="$ac_link_default"
+if { { ac_try="$ac_link_default"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_link_default") 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
 # So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
 # in a Makefile.  We should not override ac_cv_exeext if it was cached,
@@ -4320,7 +4677,7 @@
 	# certainly right.
 	break;;
     *.* )
-        if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
+	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
 	then :; else
 	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
 	fi
@@ -4339,84 +4696,41 @@
 else
   ac_file=''
 fi
-
-{ $as_echo "$as_me:$LINENO: result: $ac_file" >&5
-$as_echo "$ac_file" >&6; }
-if test -z "$ac_file"; then
-  $as_echo "$as_me: failed program was:" >&5
+if test -z "$ac_file"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+$as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C compiler cannot create executables
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C compiler cannot create executables
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 fi
-
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
+$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
+$as_echo "$ac_file" >&6; }
 ac_exeext=$ac_cv_exeext
 
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether the C compiler works" >&5
-$as_echo_n "checking whether the C compiler works... " >&6; }
-# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
-# If not cross compiling, check that we can run a simple program.
-if test "$cross_compiling" != yes; then
-  if { ac_try='./$ac_file'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-    cross_compiling=no
-  else
-    if test "$cross_compiling" = maybe; then
-	cross_compiling=yes
-    else
-	{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-    fi
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-
 rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
 ac_clean_files=$ac_clean_files_save
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether we are cross compiling" >&5
-$as_echo_n "checking whether we are cross compiling... " >&6; }
-{ $as_echo "$as_me:$LINENO: result: $cross_compiling" >&5
-$as_echo "$cross_compiling" >&6; }
-
-{ $as_echo "$as_me:$LINENO: checking for suffix of executables" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
 $as_echo_n "checking for suffix of executables... " >&6; }
-if { (ac_try="$ac_link"
+if { { ac_try="$ac_link"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_link") 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   # If both `conftest.exe' and `conftest' are `present' (well, observable)
 # catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
 # work properly (i.e., refer to `conftest.exe'), while it won't with
@@ -4431,135 +4745,157 @@
   esac
 done
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5; }
 fi
-
-rm -f conftest$ac_cv_exeext
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_exeext" >&5
+rm -f conftest conftest$ac_cv_exeext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
 $as_echo "$ac_cv_exeext" >&6; }
 
 rm -f conftest.$ac_ext
 EXEEXT=$ac_cv_exeext
 ac_exeext=$EXEEXT
-{ $as_echo "$as_me:$LINENO: checking for suffix of object files" >&5
-$as_echo_n "checking for suffix of object files... " >&6; }
-if test "${ac_cv_objext+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-
+#include <stdio.h>
 int
 main ()
 {
+FILE *f = fopen ("conftest.out", "w");
+ return ferror (f) || fclose (f) != 0;
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.o conftest.obj
-if { (ac_try="$ac_compile"
+ac_clean_files="$ac_clean_files conftest.out"
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
+$as_echo_n "checking whether we are cross compiling... " >&6; }
+if test "$cross_compiling" != yes; then
+  { { ac_try="$ac_link"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
-  for ac_file in conftest.o conftest.obj conftest.*; do
-  test -f "$ac_file" || continue;
-  case $ac_file in
-    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
-    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
-       break;;
-  esac
-done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+  if { ac_try='./conftest$ac_cv_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
+    cross_compiling=no
+  else
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-fi
-
-rm -f conftest.$ac_cv_objext conftest.$ac_ext
+as_fn_error $? "cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details" "$LINENO" 5; }
+    fi
+  fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_objext" >&5
-$as_echo "$ac_cv_objext" >&6; }
-OBJEXT=$ac_cv_objext
-ac_objext=$OBJEXT
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
+$as_echo "$cross_compiling" >&6; }
+
+rm -f conftest.$ac_ext conftest$ac_cv_exeext conftest.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
+$as_echo_n "checking for suffix of object files... " >&6; }
+if ${ac_cv_objext+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
 main ()
 {
-#ifndef __GNUC__
-       choke me
-#endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
+rm -f conftest.o conftest.obj
+if { { ac_try="$ac_compile"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>&5
   ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  for ac_file in conftest.o conftest.obj conftest.*; do
+  test -f "$ac_file" || continue;
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
+    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
+       break;;
+  esac
+done
 else
   $as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_compiler_gnu=no
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
+$as_echo "$ac_cv_objext" >&6; }
+OBJEXT=$ac_cv_objext
+ac_objext=$OBJEXT
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
+fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
 $as_echo "$ac_cv_c_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GCC=yes
@@ -4568,20 +4904,16 @@
 fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4592,35 +4924,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4631,36 +4939,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -4671,42 +4955,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
 $as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
@@ -4723,23 +4982,18 @@
     CFLAGS=
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -4791,32 +5045,9 @@
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -4827,17 +5058,19 @@
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
 $as_echo "none needed" >&6; } ;;
   xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
 $as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
 $as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -4847,9 +5080,9 @@
 
 depcc="$CC"   am_compiler_list=
 
-{ $as_echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
 $as_echo_n "checking dependency style of $depcc... " >&6; }
-if test "${am_cv_CC_dependencies_compiler_type+set}" = set; then
+if ${am_cv_CC_dependencies_compiler_type+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
@@ -4858,6 +5091,7 @@
   # instance it was reported that on HP-UX the gcc test will end up
   # making a dummy file named `D' -- because `-MD' means `put the output
   # in D'.
+  rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
   # using a relative directory.
@@ -4917,7 +5151,7 @@
 	break
       fi
       ;;
-    msvisualcpp | msvcmsys)
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
       # This compiler won't grok `-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
@@ -4957,7 +5191,7 @@
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $am_cv_CC_dependencies_compiler_type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CC_dependencies_compiler_type" >&5
 $as_echo "$am_cv_CC_dependencies_compiler_type" >&6; }
 CCDEPMODE=depmode=$am_cv_CC_dependencies_compiler_type
 
@@ -4986,9 +5220,9 @@
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CXX+set}" = set; then
+if ${ac_cv_prog_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CXX"; then
@@ -4999,24 +5233,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CXX=$ac_cv_prog_CXX
 if test -n "$CXX"; then
-  { $as_echo "$as_me:$LINENO: result: $CXX" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXX" >&5
 $as_echo "$CXX" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -5030,9 +5264,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then
+if ${ac_cv_prog_ac_ct_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CXX"; then
@@ -5043,24 +5277,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CXX="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
 if test -n "$ac_ct_CXX"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CXX" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CXX" >&5
 $as_echo "$ac_ct_CXX" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -5073,7 +5307,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -5084,53 +5318,36 @@
   fi
 fi
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C++ compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C++ compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C++ compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
 $as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
-if test "${ac_cv_cxx_compiler_gnu+set}" = set; then
+if ${ac_cv_cxx_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5144,37 +5361,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cxx_compiler_gnu" >&5
 $as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GXX=yes
@@ -5183,20 +5379,16 @@
 fi
 ac_test_CXXFLAGS=${CXXFLAGS+set}
 ac_save_CXXFLAGS=$CXXFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CXX accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
 $as_echo_n "checking whether $CXX accepts -g... " >&6; }
-if test "${ac_cv_prog_cxx_g+set}" = set; then
+if ${ac_cv_prog_cxx_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_cxx_werror_flag=$ac_cxx_werror_flag
    ac_cxx_werror_flag=yes
    ac_cv_prog_cxx_g=no
    CXXFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5207,35 +5399,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_cv_prog_cxx_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CXXFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CXXFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5246,36 +5414,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_compile "$LINENO"; then :
 
-	ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+else
+  ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 	 CXXFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -5286,42 +5430,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_cxx_try_compile "$LINENO"; then :
   ac_cv_prog_cxx_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cxx_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cxx_g" >&5
 $as_echo "$ac_cv_prog_cxx_g" >&6; }
 if test "$ac_test_CXXFLAGS" = set; then
   CXXFLAGS=$ac_save_CXXFLAGS
@@ -5346,9 +5465,9 @@
 
 depcc="$CXX"  am_compiler_list=
 
-{ $as_echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
 $as_echo_n "checking dependency style of $depcc... " >&6; }
-if test "${am_cv_CXX_dependencies_compiler_type+set}" = set; then
+if ${am_cv_CXX_dependencies_compiler_type+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
@@ -5357,6 +5476,7 @@
   # instance it was reported that on HP-UX the gcc test will end up
   # making a dummy file named `D' -- because `-MD' means `put the output
   # in D'.
+  rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
   # using a relative directory.
@@ -5416,7 +5536,7 @@
 	break
       fi
       ;;
-    msvisualcpp | msvcmsys)
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
       # This compiler won't grok `-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
@@ -5456,7 +5576,7 @@
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $am_cv_CXX_dependencies_compiler_type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CXX_dependencies_compiler_type" >&5
 $as_echo "$am_cv_CXX_dependencies_compiler_type" >&6; }
 CXXDEPMODE=depmode=$am_cv_CXX_dependencies_compiler_type
 
@@ -5476,10 +5596,10 @@
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-{ $as_echo "$as_me:$LINENO: checking how to run the C++ preprocessor" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
 $as_echo_n "checking how to run the C++ preprocessor... " >&6; }
 if test -z "$CXXCPP"; then
-  if test "${ac_cv_prog_CXXCPP+set}" = set; then
+  if ${ac_cv_prog_CXXCPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CXXCPP needs to be expanded
@@ -5494,11 +5614,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -5507,78 +5623,34 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_cxx_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
   break
 fi
 
@@ -5590,7 +5662,7 @@
 else
   ac_cv_prog_CXXCPP=$CXXCPP
 fi
-{ $as_echo "$as_me:$LINENO: result: $CXXCPP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXXCPP" >&5
 $as_echo "$CXXCPP" >&6; }
 ac_preproc_ok=false
 for ac_cxx_preproc_warn_flag in '' yes
@@ -5601,11 +5673,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -5614,81 +5682,37 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_cxx_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_cxx_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
 CXX=no; }
 fi
@@ -5705,14 +5729,14 @@
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:$LINENO: checking how to run the C preprocessor" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
 $as_echo_n "checking how to run the C preprocessor... " >&6; }
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then
+  if ${ac_cv_prog_CPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
@@ -5727,11 +5751,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -5740,78 +5760,34 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
   break
 fi
 
@@ -5823,7 +5799,7 @@
 else
   ac_cv_prog_CPP=$CPP
 fi
-{ $as_echo "$as_me:$LINENO: result: $CPP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
 $as_echo "$CPP" >&6; }
 ac_preproc_ok=false
 for ac_c_preproc_warn_flag in '' yes
@@ -5834,11 +5810,7 @@
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -5847,87 +5819,40 @@
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -5937,9 +5862,9 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-{ $as_echo "$as_me:$LINENO: checking for grep that handles long lines and -e" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
 $as_echo_n "checking for grep that handles long lines and -e... " >&6; }
-if test "${ac_cv_path_GREP+set}" = set; then
+if ${ac_cv_path_GREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$GREP"; then
@@ -5950,10 +5875,10 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in grep ggrep; do
+    for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -5970,7 +5895,7 @@
     $as_echo 'GREP' >> "conftest.nl"
     "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_GREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_GREP="$ac_path_GREP"
@@ -5985,26 +5910,24 @@
       $ac_path_GREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_GREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_GREP=$GREP
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_GREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
 $as_echo "$ac_cv_path_GREP" >&6; }
  GREP="$ac_cv_path_GREP"
 
 
-{ $as_echo "$as_me:$LINENO: checking for egrep" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
 $as_echo_n "checking for egrep... " >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
+if ${ac_cv_path_EGREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
@@ -6018,10 +5941,10 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
+    for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -6038,7 +5961,7 @@
     $as_echo 'EGREP' >> "conftest.nl"
     "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_EGREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_EGREP="$ac_path_EGREP"
@@ -6053,12 +5976,10 @@
       $ac_path_EGREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_EGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_EGREP=$EGREP
@@ -6066,21 +5987,17 @@
 
    fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
 $as_echo "$ac_cv_path_EGREP" >&6; }
  EGREP="$ac_cv_path_EGREP"
 
 
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -6095,48 +6012,23 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -6146,18 +6038,14 @@
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -6167,14 +6055,10 @@
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -6201,118 +6085,33 @@
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
 $as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
 # On IRIX 5.3, sys/types and inttypes.h are conflicting.
-
-
-
-
-
-
-
-
-
 for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
 		  inttypes.h stdint.h unistd.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  eval "$as_ac_Header=yes"
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_Header=no"
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -6343,481 +6142,101 @@
 # version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
 # declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
 # This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:$LINENO: checking size of void *" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of void *" >&5
 $as_echo_n "checking size of void *... " >&6; }
-if test "${ac_cv_sizeof_void_p+set}" = set; then
+if ${ac_cv_sizeof_void_p+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) <= $ac_mid)];
-test_array [0] = 0
+  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (void *))" "ac_cv_sizeof_void_p"        "$ac_includes_default"; then :
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if test "$ac_cv_type_void_p" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (void *)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_void_p=0
+   fi
+fi
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_void_p" >&5
+$as_echo "$ac_cv_sizeof_void_p" >&6; }
+
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_VOID_P $ac_cv_sizeof_void_p
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+
+    ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether CXX='$CXX' acts like a C++ compiler" >&5
+$as_echo_n "checking whether CXX='$CXX' acts like a C++ compiler... " >&6; }
+if ${cr_cv_cxx_is_cxx+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      cr_cv_cxx_is_cxx=no
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+	#ifndef __cplusplus
+	    #error __cplusplus must be defined in a C++ compilation!
+	#endif
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) < 0)];
-test_array [0] = 0
-
+ int x = 1;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  cr_cv_cxx_is_cxx=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_cxx_is_cxx" >&5
+$as_echo "$cr_cv_cxx_is_cxx" >&6; }
+    if test x"$cr_cv_cxx_is_cxx" = xyes; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether CXX='$CXX' matches wordsize of CC" >&5
+$as_echo_n "checking whether CXX='$CXX' matches wordsize of CC... " >&6; }
+if ${cr_cv_cxx_voidp+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+        cr_cv_cxx_voidp=no
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
+
+	  #ifndef __cplusplus
+	      #error __cplusplus must be defined in a C++ compilation!
+	  #endif
+
 int
 main ()
 {
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) >= $ac_mid)];
-test_array [0] = 0
-
+ int a[(($ac_cv_sizeof_void_p == sizeof(void *))? 1 : -1)];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) ac_cv_sizeof_void_p=$ac_lo;;
-'') if test "$ac_cv_type_void_p" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_void_p=0
-   fi ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-static long int longval () { return (long int) (sizeof (void *)); }
-static unsigned long int ulongval () { return (long int) (sizeof (void *)); }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if (((long int) (sizeof (void *))) < 0)
-    {
-      long int i = longval ();
-      if (i != ((long int) (sizeof (void *))))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != ((long int) (sizeof (void *))))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_sizeof_void_p=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-if test "$ac_cv_type_void_p" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_void_p=0
-   fi
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_sizeof_void_p" >&5
-$as_echo "$ac_cv_sizeof_void_p" >&6; }
-
-
-
-cat >>confdefs.h <<_ACEOF
-#define SIZEOF_VOID_P $ac_cv_sizeof_void_p
-_ACEOF
-
-
-    ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-    { $as_echo "$as_me:$LINENO: checking whether CXX='$CXX' acts like a C++ compiler" >&5
-$as_echo_n "checking whether CXX='$CXX' acts like a C++ compiler... " >&6; }
-if test "${cr_cv_cxx_is_cxx+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-      cr_cv_cxx_is_cxx=no
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-	#ifndef __cplusplus
-	    #error __cplusplus must be defined in a C++ compilation!
-	#endif
-
-int
-main ()
-{
- int x = 1;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cr_cv_cxx_is_cxx=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_cxx_is_cxx" >&5
-$as_echo "$cr_cv_cxx_is_cxx" >&6; }
-    if test x"$cr_cv_cxx_is_cxx" = xyes; then
-      { $as_echo "$as_me:$LINENO: checking whether CXX='$CXX' matches wordsize of CC" >&5
-$as_echo_n "checking whether CXX='$CXX' matches wordsize of CC... " >&6; }
-if test "${cr_cv_cxx_voidp+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-        cr_cv_cxx_voidp=no
-        cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-	  #ifndef __cplusplus
-	      #error __cplusplus must be defined in a C++ compilation!
-	  #endif
-
-int
-main ()
-{
- int a[(($ac_cv_sizeof_void_p == sizeof(void *))? 1 : -1)];
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cr_cv_cxx_voidp=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  cr_cv_cxx_voidp=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_cxx_voidp" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_cxx_voidp" >&5
 $as_echo "$cr_cv_cxx_voidp" >&6; }
     fi
     ac_ext=c
@@ -6835,7 +6254,7 @@
 # We use libtool to build
 #   - only build shared lib for now
 # Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then
+if test "${enable_static+set}" = set; then :
   enableval=$enable_static; p=${PACKAGE-default}
     case $enableval in
     yes) enable_static=yes ;;
@@ -6867,14 +6286,14 @@
 
 case `pwd` in
   *\ * | *\	*)
-    { $as_echo "$as_me:$LINENO: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&5
 $as_echo "$as_me: WARNING: Libtool does not cope well with whitespace in \`pwd\`" >&2;} ;;
 esac
 
 
 
-macro_version='2.2.6b'
-macro_revision='1.3017'
+macro_version='2.4.2'
+macro_revision='1.3337'
 
 
 
@@ -6890,9 +6309,78 @@
 
 ltmain="$ac_aux_dir/ltmain.sh"
 
-{ $as_echo "$as_me:$LINENO: checking for a sed that does not truncate output" >&5
+# Backslashify metacharacters that are still active within
+# double-quoted strings.
+sed_quote_subst='s/\(["`$\\]\)/\\\1/g'
+
+# Same as above, but do not quote variable references.
+double_quote_subst='s/\(["`\\]\)/\\\1/g'
+
+# Sed substitution to delay expansion of an escaped shell variable in a
+# double_quote_subst'ed string.
+delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
+
+# Sed substitution to delay expansion of an escaped single quote.
+delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
+
+# Sed substitution to avoid accidental globbing in evaled expressions
+no_glob_subst='s/\*/\\\*/g'
+
+ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
+ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO$ECHO
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to print strings" >&5
+$as_echo_n "checking how to print strings... " >&6; }
+# Test print first, because it will be a builtin if present.
+if test "X`( print -r -- -n ) 2>/dev/null`" = X-n && \
+   test "X`print -r -- $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='print -r --'
+elif test "X`printf %s $ECHO 2>/dev/null`" = "X$ECHO"; then
+  ECHO='printf %s\n'
+else
+  # Use this function as a fallback that always works.
+  func_fallback_echo ()
+  {
+    eval 'cat <<_LTECHO_EOF
+$1
+_LTECHO_EOF'
+  }
+  ECHO='func_fallback_echo'
+fi
+
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO ""
+}
+
+case "$ECHO" in
+  printf*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: printf" >&5
+$as_echo "printf" >&6; } ;;
+  print*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: print -r" >&5
+$as_echo "print -r" >&6; } ;;
+  *) { $as_echo "$as_me:${as_lineno-$LINENO}: result: cat" >&5
+$as_echo "cat" >&6; } ;;
+esac
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a sed that does not truncate output" >&5
 $as_echo_n "checking for a sed that does not truncate output... " >&6; }
-if test "${ac_cv_path_SED+set}" = set; then
+if ${ac_cv_path_SED+:} false; then :
   $as_echo_n "(cached) " >&6
 else
             ac_script=s/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb/
@@ -6900,7 +6388,7 @@
        ac_script="$ac_script$as_nl$ac_script"
      done
      echo "$ac_script" 2>/dev/null | sed 99q >conftest.sed
-     $as_unset ac_script || ac_script=
+     { ac_script=; unset ac_script;}
      if test -z "$SED"; then
   ac_path_SED_found=false
   # Loop through the user's path and test for each of PROGNAME-LIST
@@ -6909,10 +6397,10 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in sed gsed; do
+    for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -6929,7 +6417,7 @@
     $as_echo '' >> "conftest.nl"
     "$ac_path_SED" -f conftest.sed < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_SED_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_SED="$ac_path_SED"
@@ -6944,19 +6432,17 @@
       $ac_path_SED_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_SED"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable sed could be found in \$PATH" >&5
-$as_echo "$as_me: error: no acceptable sed could be found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "no acceptable sed could be found in \$PATH" "$LINENO" 5
   fi
 else
   ac_cv_path_SED=$SED
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_SED" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_SED" >&5
 $as_echo "$ac_cv_path_SED" >&6; }
  SED="$ac_cv_path_SED"
   rm -f conftest.sed
@@ -6974,9 +6460,9 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for fgrep" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for fgrep" >&5
 $as_echo_n "checking for fgrep... " >&6; }
-if test "${ac_cv_path_FGREP+set}" = set; then
+if ${ac_cv_path_FGREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if echo 'ab*c' | $GREP -F 'ab*c' >/dev/null 2>&1
@@ -6990,10 +6476,10 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in fgrep; do
+    for ac_prog in fgrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_FGREP" && $as_test_x "$ac_path_FGREP"; } || continue
+      as_fn_executable_p "$ac_path_FGREP" || continue
 # Check for GNU ac_path_FGREP and select it if it is found.
   # Check for GNU $ac_path_FGREP
 case `"$ac_path_FGREP" --version 2>&1` in
@@ -7010,7 +6496,7 @@
     $as_echo 'FGREP' >> "conftest.nl"
     "$ac_path_FGREP" FGREP < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_FGREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_FGREP="$ac_path_FGREP"
@@ -7025,12 +6511,10 @@
       $ac_path_FGREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_FGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "no acceptable fgrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_FGREP=$FGREP
@@ -7038,7 +6522,7 @@
 
    fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_FGREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_FGREP" >&5
 $as_echo "$ac_cv_path_FGREP" >&6; }
  FGREP="$ac_cv_path_FGREP"
 
@@ -7064,7 +6548,7 @@
 
 
 # Check whether --with-gnu-ld was given.
-if test "${with_gnu_ld+set}" = set; then
+if test "${with_gnu_ld+set}" = set; then :
   withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
 else
   with_gnu_ld=no
@@ -7073,7 +6557,7 @@
 ac_prog=ld
 if test "$GCC" = yes; then
   # Check if gcc -print-prog-name=ld gives a path.
-  { $as_echo "$as_me:$LINENO: checking for ld used by $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
 $as_echo_n "checking for ld used by $CC... " >&6; }
   case $host in
   *-*-mingw*)
@@ -7103,13 +6587,13 @@
     ;;
   esac
 elif test "$with_gnu_ld" = yes; then
-  { $as_echo "$as_me:$LINENO: checking for GNU ld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
 $as_echo_n "checking for GNU ld... " >&6; }
 else
-  { $as_echo "$as_me:$LINENO: checking for non-GNU ld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
 $as_echo_n "checking for non-GNU ld... " >&6; }
 fi
-if test "${lt_cv_path_LD+set}" = set; then
+if ${lt_cv_path_LD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
@@ -7140,18 +6624,16 @@
 
 LD="$lt_cv_path_LD"
 if test -n "$LD"; then
-  { $as_echo "$as_me:$LINENO: result: $LD" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
 $as_echo "$LD" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-test -z "$LD" && { { $as_echo "$as_me:$LINENO: error: no acceptable ld found in \$PATH" >&5
-$as_echo "$as_me: error: no acceptable ld found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
-{ $as_echo "$as_me:$LINENO: checking if the linker ($LD) is GNU ld" >&5
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
 $as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then
+if ${lt_cv_prog_gnu_ld+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU lds only accept -v.
@@ -7164,7 +6646,7 @@
   ;;
 esac
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_gnu_ld" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
 $as_echo "$lt_cv_prog_gnu_ld" >&6; }
 with_gnu_ld=$lt_cv_prog_gnu_ld
 
@@ -7176,9 +6658,9 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for BSD- or MS-compatible name lister (nm)" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD- or MS-compatible name lister (nm)" >&5
 $as_echo_n "checking for BSD- or MS-compatible name lister (nm)... " >&6; }
-if test "${lt_cv_path_NM+set}" = set; then
+if ${lt_cv_path_NM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$NM"; then
@@ -7225,20 +6707,23 @@
   : ${lt_cv_path_NM=no}
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_path_NM" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_NM" >&5
 $as_echo "$lt_cv_path_NM" >&6; }
 if test "$lt_cv_path_NM" != "no"; then
   NM="$lt_cv_path_NM"
 else
   # Didn't find any BSD compatible name lister, look for dumpbin.
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in "dumpbin -symbols" "link -dump -symbols"
+  if test -n "$DUMPBIN"; then :
+    # Let the user override the test.
+  else
+    if test -n "$ac_tool_prefix"; then
+  for ac_prog in dumpbin "link -dump"
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_DUMPBIN+set}" = set; then
+if ${ac_cv_prog_DUMPBIN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$DUMPBIN"; then
@@ -7249,24 +6734,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 DUMPBIN=$ac_cv_prog_DUMPBIN
 if test -n "$DUMPBIN"; then
-  { $as_echo "$as_me:$LINENO: result: $DUMPBIN" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DUMPBIN" >&5
 $as_echo "$DUMPBIN" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -7276,13 +6761,13 @@
 fi
 if test -z "$DUMPBIN"; then
   ac_ct_DUMPBIN=$DUMPBIN
-  for ac_prog in "dumpbin -symbols" "link -dump -symbols"
+  for ac_prog in dumpbin "link -dump"
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_DUMPBIN+set}" = set; then
+if ${ac_cv_prog_ac_ct_DUMPBIN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_DUMPBIN"; then
@@ -7293,24 +6778,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_DUMPBIN=$ac_cv_prog_ac_ct_DUMPBIN
 if test -n "$ac_ct_DUMPBIN"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_DUMPBIN" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DUMPBIN" >&5
 $as_echo "$ac_ct_DUMPBIN" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -7323,7 +6808,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -7331,6 +6816,15 @@
   fi
 fi
 
+    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    *COFF*)
+      DUMPBIN="$DUMPBIN -symbols"
+      ;;
+    *)
+      DUMPBIN=:
+      ;;
+    esac
+  fi
 
   if test "$DUMPBIN" != ":"; then
     NM="$DUMPBIN"
@@ -7343,33 +6837,33 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking the name lister ($NM) interface" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the name lister ($NM) interface" >&5
 $as_echo_n "checking the name lister ($NM) interface... " >&6; }
-if test "${lt_cv_nm_interface+set}" = set; then
+if ${lt_cv_nm_interface+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_nm_interface="BSD nm"
   echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:7353: $ac_compile\"" >&5)
+  (eval echo "\"\$as_me:$LINENO: $ac_compile\"" >&5)
   (eval "$ac_compile" 2>conftest.err)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:7356: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
+  (eval echo "\"\$as_me:$LINENO: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
   (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
   cat conftest.err >&5
-  (eval echo "\"\$as_me:7359: output\"" >&5)
+  (eval echo "\"\$as_me:$LINENO: output\"" >&5)
   cat conftest.out >&5
   if $GREP 'External.*some_variable' conftest.out > /dev/null; then
     lt_cv_nm_interface="MS dumpbin"
   fi
   rm -f conftest*
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_nm_interface" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_nm_interface" >&5
 $as_echo "$lt_cv_nm_interface" >&6; }
 
 # find the maximum length of command line arguments
-{ $as_echo "$as_me:$LINENO: checking the maximum length of command line arguments" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the maximum length of command line arguments" >&5
 $as_echo_n "checking the maximum length of command line arguments... " >&6; }
-if test "${lt_cv_sys_max_cmd_len+set}" = set; then
+if ${lt_cv_sys_max_cmd_len+:} false; then :
   $as_echo_n "(cached) " >&6
 else
     i=0
@@ -7402,6 +6896,11 @@
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
+  mint*)
+    # On MiNT this can take a long time and run out of memory.
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
   amigaos*)
     # On AmigaOS with pdksh, this test takes hours, literally.
     # So we just punt and use a minimum line length of 8192.
@@ -7427,6 +6926,11 @@
     lt_cv_sys_max_cmd_len=196608
     ;;
 
+  os2*)
+    # The test takes a long time on OS/2.
+    lt_cv_sys_max_cmd_len=8192
+    ;;
+
   osf*)
     # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
     # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
@@ -7466,8 +6970,8 @@
       # If test is not a shell built-in, we'll probably end up computing a
       # maximum length that is only half of the actual maximum length, but
       # we can't tell.
-      while { test "X"`$SHELL $0 --fallback-echo "X$teststring$teststring" 2>/dev/null` \
-	         = "XX$teststring$teststring"; } >/dev/null 2>&1 &&
+      while { test "X"`env echo "$teststring$teststring" 2>/dev/null` \
+	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
 	      test $i != 17 # 1/2 MB should be enough
       do
         i=`expr $i + 1`
@@ -7487,10 +6991,10 @@
 fi
 
 if test -n $lt_cv_sys_max_cmd_len ; then
-  { $as_echo "$as_me:$LINENO: result: $lt_cv_sys_max_cmd_len" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sys_max_cmd_len" >&5
 $as_echo "$lt_cv_sys_max_cmd_len" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: none" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: none" >&5
 $as_echo "none" >&6; }
 fi
 max_cmd_len=$lt_cv_sys_max_cmd_len
@@ -7504,27 +7008,27 @@
 : ${MV="mv -f"}
 : ${RM="rm -f"}
 
-{ $as_echo "$as_me:$LINENO: checking whether the shell understands some XSI constructs" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands some XSI constructs" >&5
 $as_echo_n "checking whether the shell understands some XSI constructs... " >&6; }
 # Try some XSI features
 xsi_shell=no
 ( _lt_dummy="a/b/c"
-  test "${_lt_dummy##*/},${_lt_dummy%/*},"${_lt_dummy%"$_lt_dummy"}, \
-      = c,a/b,, \
+  test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
+      = c,a/b,b/c, \
     && eval 'test $(( 1 + 1 )) -eq 2 \
     && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
   && xsi_shell=yes
-{ $as_echo "$as_me:$LINENO: result: $xsi_shell" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $xsi_shell" >&5
 $as_echo "$xsi_shell" >&6; }
 
 
-{ $as_echo "$as_me:$LINENO: checking whether the shell understands \"+=\"" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands \"+=\"" >&5
 $as_echo_n "checking whether the shell understands \"+=\"... " >&6; }
 lt_shell_append=no
 ( foo=bar; set foo baz; eval "$1+=\$2" && test "$foo" = barbaz ) \
     >/dev/null 2>&1 \
   && lt_shell_append=yes
-{ $as_echo "$as_me:$LINENO: result: $lt_shell_append" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_shell_append" >&5
 $as_echo "$lt_shell_append" >&6; }
 
 
@@ -7559,14 +7063,88 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking for $LD option to reload object files" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to convert $build file names to $host format" >&5
+$as_echo_n "checking how to convert $build file names to $host format... " >&6; }
+if ${lt_cv_to_host_file_cmd+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_w32
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_cygwin_to_w32
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_w32
+        ;;
+    esac
+    ;;
+  *-*-cygwin* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_host_file_cmd=func_convert_file_msys_to_cygwin
+        ;;
+      *-*-cygwin* )
+        lt_cv_to_host_file_cmd=func_convert_file_noop
+        ;;
+      * ) # otherwise, assume *nix
+        lt_cv_to_host_file_cmd=func_convert_file_nix_to_cygwin
+        ;;
+    esac
+    ;;
+  * ) # unhandled hosts (and "normal" native builds)
+    lt_cv_to_host_file_cmd=func_convert_file_noop
+    ;;
+esac
+
+fi
+
+to_host_file_cmd=$lt_cv_to_host_file_cmd
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_to_host_file_cmd" >&5
+$as_echo "$lt_cv_to_host_file_cmd" >&6; }
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to convert $build file names to toolchain format" >&5
+$as_echo_n "checking how to convert $build file names to toolchain format... " >&6; }
+if ${lt_cv_to_tool_file_cmd+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  #assume ordinary cross tools, or native build.
+lt_cv_to_tool_file_cmd=func_convert_file_noop
+case $host in
+  *-*-mingw* )
+    case $build in
+      *-*-mingw* ) # actually msys
+        lt_cv_to_tool_file_cmd=func_convert_file_msys_to_w32
+        ;;
+    esac
+    ;;
+esac
+
+fi
+
+to_tool_file_cmd=$lt_cv_to_tool_file_cmd
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_to_tool_file_cmd" >&5
+$as_echo "$lt_cv_to_tool_file_cmd" >&6; }
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $LD option to reload object files" >&5
 $as_echo_n "checking for $LD option to reload object files... " >&6; }
-if test "${lt_cv_ld_reload_flag+set}" = set; then
+if ${lt_cv_ld_reload_flag+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_ld_reload_flag='-r'
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_ld_reload_flag" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_reload_flag" >&5
 $as_echo "$lt_cv_ld_reload_flag" >&6; }
 reload_flag=$lt_cv_ld_reload_flag
 case $reload_flag in
@@ -7575,6 +7153,11 @@
 esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
 case $host_os in
+  cygwin* | mingw* | pw32* | cegcc*)
+    if test "$GCC" != yes; then
+      reload_cmds=false
+    fi
+    ;;
   darwin*)
     if test "$GCC" = yes; then
       reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
@@ -7595,9 +7178,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}objdump", so it can be a program name with args.
 set dummy ${ac_tool_prefix}objdump; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_OBJDUMP+set}" = set; then
+if ${ac_cv_prog_OBJDUMP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$OBJDUMP"; then
@@ -7608,24 +7191,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 OBJDUMP=$ac_cv_prog_OBJDUMP
 if test -n "$OBJDUMP"; then
-  { $as_echo "$as_me:$LINENO: result: $OBJDUMP" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OBJDUMP" >&5
 $as_echo "$OBJDUMP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -7635,9 +7218,9 @@
   ac_ct_OBJDUMP=$OBJDUMP
   # Extract the first word of "objdump", so it can be a program name with args.
 set dummy objdump; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_OBJDUMP+set}" = set; then
+if ${ac_cv_prog_ac_ct_OBJDUMP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_OBJDUMP"; then
@@ -7648,24 +7231,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_OBJDUMP=$ac_cv_prog_ac_ct_OBJDUMP
 if test -n "$ac_ct_OBJDUMP"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_OBJDUMP" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OBJDUMP" >&5
 $as_echo "$ac_ct_OBJDUMP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -7674,7 +7257,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -7694,9 +7277,9 @@
 
 
 
-{ $as_echo "$as_me:$LINENO: checking how to recognize dependent libraries" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to recognize dependent libraries" >&5
 $as_echo_n "checking how to recognize dependent libraries... " >&6; }
-if test "${lt_cv_deplibs_check_method+set}" = set; then
+if ${lt_cv_deplibs_check_method+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_file_magic_cmd='$MAGIC_CMD'
@@ -7738,16 +7321,18 @@
   # Base MSYS/MinGW do not provide the 'file' command needed by
   # func_win32_libid shell function, so use a weaker test based on 'objdump',
   # unless we find 'file', for example because we are cross-compiling.
-  if ( file / ) >/dev/null 2>&1; then
+  # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
+  if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
     lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
     lt_cv_file_magic_cmd='func_win32_libid'
   else
-    lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'
+    # Keep this pattern in sync with the one in func_win32_libid.
+    lt_cv_deplibs_check_method='file_magic file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)'
     lt_cv_file_magic_cmd='$OBJDUMP -f'
   fi
   ;;
 
-cegcc)
+cegcc*)
   # use the weaker test based on 'objdump'. See mingw*.
   lt_cv_deplibs_check_method='file_magic file format pe-arm-.*little(.*architecture: arm)?'
   lt_cv_file_magic_cmd='$OBJDUMP -f'
@@ -7773,7 +7358,7 @@
   fi
   ;;
 
-gnu*)
+haiku*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -7785,11 +7370,11 @@
     lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
     ;;
   hppa*64*)
-    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - PA-RISC [0-9].[0-9]'
+    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF[ -][0-9][0-9])(-bit)?( [LM]SB)? shared object( file)?[, -]* PA-RISC [0-9]\.[0-9]'
     lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
     ;;
   *)
-    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9].[0-9]) shared library'
+    lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9]\.[0-9]) shared library'
     lt_cv_file_magic_test_file=/usr/lib/libc.sl
     ;;
   esac
@@ -7810,12 +7395,12 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd*)
+netbsd* | netbsdelf*-gnu)
   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
   else
@@ -7890,8 +7475,23 @@
 esac
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_deplibs_check_method" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_deplibs_check_method" >&5
 $as_echo "$lt_cv_deplibs_check_method" >&6; }
+
+file_magic_glob=
+want_nocaseglob=no
+if test "$build" = "$host"; then
+  case $host_os in
+  mingw* | pw32*)
+    if ( shopt | grep nocaseglob ) >/dev/null 2>&1; then
+      want_nocaseglob=yes
+    else
+      file_magic_glob=`echo aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ | $SED -e "s/\(..\)/s\/[\1]\/[\1]\/g;/g"`
+    fi
+    ;;
+  esac
+fi
+
 file_magic_cmd=$lt_cv_file_magic_cmd
 deplibs_check_method=$lt_cv_deplibs_check_method
 test -z "$deplibs_check_method" && deplibs_check_method=unknown
@@ -7907,12 +7507,165 @@
 
 
 
+
+
+
+
+
+
+
+
+
+
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}dlltool", so it can be a program name with args.
+set dummy ${ac_tool_prefix}dlltool; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_DLLTOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$DLLTOOL"; then
+  ac_cv_prog_DLLTOOL="$DLLTOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+DLLTOOL=$ac_cv_prog_DLLTOOL
+if test -n "$DLLTOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DLLTOOL" >&5
+$as_echo "$DLLTOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_DLLTOOL"; then
+  ac_ct_DLLTOOL=$DLLTOOL
+  # Extract the first word of "dlltool", so it can be a program name with args.
+set dummy dlltool; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_DLLTOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_DLLTOOL"; then
+  ac_cv_prog_ac_ct_DLLTOOL="$ac_ct_DLLTOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_DLLTOOL="dlltool"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_DLLTOOL=$ac_cv_prog_ac_ct_DLLTOOL
+if test -n "$ac_ct_DLLTOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DLLTOOL" >&5
+$as_echo "$ac_ct_DLLTOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_DLLTOOL" = x; then
+    DLLTOOL="false"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    DLLTOOL=$ac_ct_DLLTOOL
+  fi
+else
+  DLLTOOL="$ac_cv_prog_DLLTOOL"
+fi
+
+test -z "$DLLTOOL" && DLLTOOL=dlltool
+
+
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to associate runtime and link libraries" >&5
+$as_echo_n "checking how to associate runtime and link libraries... " >&6; }
+if ${lt_cv_sharedlib_from_linklib_cmd+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_sharedlib_from_linklib_cmd='unknown'
+
+case $host_os in
+cygwin* | mingw* | pw32* | cegcc*)
+  # two different shell functions defined in ltmain.sh
+  # decide which to use based on capabilities of $DLLTOOL
+  case `$DLLTOOL --help 2>&1` in
+  *--identify-strict*)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
+    ;;
+  *)
+    lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib_fallback
+    ;;
+  esac
+  ;;
+*)
+  # fallback: assume linklib IS sharedlib
+  lt_cv_sharedlib_from_linklib_cmd="$ECHO"
+  ;;
+esac
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sharedlib_from_linklib_cmd" >&5
+$as_echo "$lt_cv_sharedlib_from_linklib_cmd" >&6; }
+sharedlib_from_linklib_cmd=$lt_cv_sharedlib_from_linklib_cmd
+test -z "$sharedlib_from_linklib_cmd" && sharedlib_from_linklib_cmd=$ECHO
+
+
+
+
+
+
+
 if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}ar", so it can be a program name with args.
-set dummy ${ac_tool_prefix}ar; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+  for ac_prog in ar
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_AR+set}" = set; then
+if ${ac_cv_prog_AR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$AR"; then
@@ -7923,36 +7676,40 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_AR="${ac_tool_prefix}ar"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AR="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 AR=$ac_cv_prog_AR
 if test -n "$AR"; then
-  { $as_echo "$as_me:$LINENO: result: $AR" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AR" >&5
 $as_echo "$AR" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
+    test -n "$AR" && break
+  done
 fi
-if test -z "$ac_cv_prog_AR"; then
+if test -z "$AR"; then
   ac_ct_AR=$AR
-  # Extract the first word of "ar", so it can be a program name with args.
-set dummy ar; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+  for ac_prog in ar
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_AR+set}" = set; then
+if ${ac_cv_prog_ac_ct_AR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_AR"; then
@@ -7963,48 +7720,108 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_AR="ar"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_AR="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_AR=$ac_cv_prog_ac_ct_AR
 if test -n "$ac_ct_AR"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_AR" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_AR" >&5
 $as_echo "$ac_ct_AR" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
+
+  test -n "$ac_ct_AR" && break
+done
+
   if test "x$ac_ct_AR" = x; then
     AR="false"
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
     AR=$ac_ct_AR
   fi
-else
-  AR="$ac_cv_prog_AR"
 fi
 
-test -z "$AR" && AR=ar
-test -z "$AR_FLAGS" && AR_FLAGS=cru
+: ${AR=ar}
+: ${AR_FLAGS=cru}
+
+
+
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for archiver @FILE support" >&5
+$as_echo_n "checking for archiver @FILE support... " >&6; }
+if ${lt_cv_ar_at_file+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_ar_at_file=no
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
 
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  echo conftest.$ac_objext > conftest.lst
+      lt_ar_try='$AR $AR_FLAGS libconftest.a @conftest.lst >&5'
+      { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
+  (eval $lt_ar_try) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+      if test "$ac_status" -eq 0; then
+	# Ensure the archiver fails upon bogus file names.
+	rm -f conftest.$ac_objext libconftest.a
+	{ { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
+  (eval $lt_ar_try) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+	if test "$ac_status" -ne 0; then
+          lt_cv_ar_at_file=@
+        fi
+      fi
+      rm -f conftest.* libconftest.a
 
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ar_at_file" >&5
+$as_echo "$lt_cv_ar_at_file" >&6; }
 
+if test "x$lt_cv_ar_at_file" = xno; then
+  archiver_list_spec=
+else
+  archiver_list_spec=$lt_cv_ar_at_file
+fi
 
 
 
@@ -8015,9 +7832,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
 set dummy ${ac_tool_prefix}strip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_STRIP+set}" = set; then
+if ${ac_cv_prog_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$STRIP"; then
@@ -8028,24 +7845,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 STRIP=$ac_cv_prog_STRIP
 if test -n "$STRIP"; then
-  { $as_echo "$as_me:$LINENO: result: $STRIP" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
 $as_echo "$STRIP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8055,9 +7872,9 @@
   ac_ct_STRIP=$STRIP
   # Extract the first word of "strip", so it can be a program name with args.
 set dummy strip; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_STRIP"; then
@@ -8068,24 +7885,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
 if test -n "$ac_ct_STRIP"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_STRIP" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
 $as_echo "$ac_ct_STRIP" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8094,7 +7911,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -8114,9 +7931,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then
+if ${ac_cv_prog_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$RANLIB"; then
@@ -8127,24 +7944,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 RANLIB=$ac_cv_prog_RANLIB
 if test -n "$RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $RANLIB" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
 $as_echo "$RANLIB" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8154,9 +7971,9 @@
   ac_ct_RANLIB=$RANLIB
   # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_RANLIB"; then
@@ -8167,24 +7984,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
 if test -n "$ac_ct_RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
 $as_echo "$ac_ct_RANLIB" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8193,7 +8010,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -8218,15 +8035,27 @@
 if test -n "$RANLIB"; then
   case $host_os in
   openbsd*)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
     ;;
   *)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
     ;;
   esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
+  old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
 fi
 
+case $host_os in
+  darwin*)
+    lock_old_archive_extraction=yes ;;
+  *)
+    lock_old_archive_extraction=no ;;
+esac
+
+
+
+
+
+
 
 
 
@@ -8271,9 +8100,9 @@
 
 
 # Check for command to grab the raw symbol name followed by C symbol from nm.
-{ $as_echo "$as_me:$LINENO: checking command to parse $NM output from $compiler object" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking command to parse $NM output from $compiler object" >&5
 $as_echo_n "checking command to parse $NM output from $compiler object... " >&6; }
-if test "${lt_cv_sys_global_symbol_pipe+set}" = set; then
+if ${lt_cv_sys_global_symbol_pipe+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -8334,8 +8163,8 @@
 lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
 
 # Transform an extracted symbol line into symbol name and symbol address
-lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (void *) \&\2},/p'"
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([^ ]*\) $/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \(lib[^ ]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \(lib[^ ]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
 
 # Handle CRLF in mingw tool chain
 opt_cr=
@@ -8359,6 +8188,7 @@
     # which start with @ or ?.
     lt_cv_sys_global_symbol_pipe="$AWK '"\
 "     {last_section=section; section=\$ 3};"\
+"     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
 "     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
 "     \$ 0!~/External *\|/{next};"\
 "     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
@@ -8371,6 +8201,7 @@
   else
     lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[	 ]\($symcode$symcode*\)[	 ][	 ]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
   fi
+  lt_cv_sys_global_symbol_pipe="$lt_cv_sys_global_symbol_pipe | sed '/ __gnu_lto/d'"
 
   # Check to see that the pipe works correctly.
   pipe_works=no
@@ -8389,18 +8220,18 @@
 int main(){nm_test_var='a';nm_test_func();return(0);}
 _LT_EOF
 
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     # Now try to grab the symbols.
     nlist=conftest.nm
-    if { (eval echo "$as_me:$LINENO: \"$NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist\"") >&5
-  (eval $NM conftest.$ac_objext \| $lt_cv_sys_global_symbol_pipe \> $nlist) 2>&5
+    if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist\""; } >&5
+  (eval $NM conftest.$ac_objext \| "$lt_cv_sys_global_symbol_pipe" \> $nlist) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s "$nlist"; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s "$nlist"; then
       # Try sorting and uniquifying the output.
       if sort "$nlist" | uniq > "$nlist"T; then
 	mv -f "$nlist"T "$nlist"
@@ -8412,6 +8243,18 @@
       if $GREP ' nm_test_var$' "$nlist" >/dev/null; then
 	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
 	  cat <<_LT_EOF > conftest.$ac_ext
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT_DLSYM_CONST
+#else
+# define LT_DLSYM_CONST const
+#endif
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -8423,7 +8266,7 @@
 	  cat <<_LT_EOF >> conftest.$ac_ext
 
 /* The mapping between symbol names and symbols.  */
-const struct {
+LT_DLSYM_CONST struct {
   const char *name;
   void       *address;
 }
@@ -8449,19 +8292,19 @@
 _LT_EOF
 	  # Now try linking the two files.
 	  mv conftest.$ac_objext conftstm.$ac_objext
-	  lt_save_LIBS="$LIBS"
-	  lt_save_CFLAGS="$CFLAGS"
+	  lt_globsym_save_LIBS=$LIBS
+	  lt_globsym_save_CFLAGS=$CFLAGS
 	  LIBS="conftstm.$ac_objext"
 	  CFLAGS="$CFLAGS$lt_prog_compiler_no_builtin_flag"
-	  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext}; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext}; then
 	    pipe_works=yes
 	  fi
-	  LIBS="$lt_save_LIBS"
-	  CFLAGS="$lt_save_CFLAGS"
+	  LIBS=$lt_globsym_save_LIBS
+	  CFLAGS=$lt_globsym_save_CFLAGS
 	else
 	  echo "cannot find nm_test_func in $nlist" >&5
 	fi
@@ -8491,13 +8334,25 @@
   lt_cv_sys_global_symbol_to_cdecl=
 fi
 if test -z "$lt_cv_sys_global_symbol_pipe$lt_cv_sys_global_symbol_to_cdecl"; then
-  { $as_echo "$as_me:$LINENO: result: failed" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
 $as_echo "failed" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: ok" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
 $as_echo "ok" >&6; }
 fi
 
+# Response file support.
+if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+  nm_file_list_spec='@'
+elif $NM --help 2>/dev/null | grep '[@]FILE' >/dev/null; then
+  nm_file_list_spec='@'
+fi
+
+
+
+
+
+
 
 
 
@@ -8519,8 +8374,45 @@
 
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysroot" >&5
+$as_echo_n "checking for sysroot... " >&6; }
+
+# Check whether --with-sysroot was given.
+if test "${with_sysroot+set}" = set; then :
+  withval=$with_sysroot;
+else
+  with_sysroot=no
+fi
+
+
+lt_sysroot=
+case ${with_sysroot} in #(
+ yes)
+   if test "$GCC" = yes; then
+     lt_sysroot=`$CC --print-sysroot 2>/dev/null`
+   fi
+   ;; #(
+ /*)
+   lt_sysroot=`echo "$with_sysroot" | sed -e "$sed_quote_subst"`
+   ;; #(
+ no|'')
+   ;; #(
+ *)
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${with_sysroot}" >&5
+$as_echo "${with_sysroot}" >&6; }
+   as_fn_error $? "The sysroot must be an absolute path." "$LINENO" 5
+   ;;
+esac
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${lt_sysroot:-no}" >&5
+$as_echo "${lt_sysroot:-no}" >&6; }
+
+
+
+
+
 # Check whether --enable-libtool-lock was given.
-if test "${enable_libtool_lock+set}" = set; then
+if test "${enable_libtool_lock+set}" = set; then :
   enableval=$enable_libtool_lock;
 fi
 
@@ -8532,11 +8424,11 @@
 ia64-*-hpux*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     case `/usr/bin/file conftest.$ac_objext` in
       *ELF-32*)
 	HPUX_IA64_MODE="32"
@@ -8550,12 +8442,12 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 8553 "configure"' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  echo '#line '$LINENO' "configure"' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     if test "$lt_cv_prog_gnu_ld" = yes; then
       case `/usr/bin/file conftest.$ac_objext` in
 	*32-bit*)
@@ -8589,11 +8481,11 @@
 s390*-*linux*|s390*-*tpf*|sparc*-*linux*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     case `/usr/bin/file conftest.o` in
       *32-bit*)
 	case $host in
@@ -8642,9 +8534,9 @@
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
   SAVE_CFLAGS="$CFLAGS"
   CFLAGS="$CFLAGS -belf"
-  { $as_echo "$as_me:$LINENO: checking whether the C compiler needs -belf" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler needs -belf" >&5
 $as_echo_n "checking whether the C compiler needs -belf... " >&6; }
-if test "${lt_cv_cc_needs_belf+set}" = set; then
+if ${lt_cv_cc_needs_belf+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_ext=c
@@ -8653,11 +8545,7 @@
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-     cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -8668,38 +8556,13 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   lt_cv_cc_needs_belf=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	lt_cv_cc_needs_belf=no
+  lt_cv_cc_needs_belf=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
      ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -8707,25 +8570,38 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_cc_needs_belf" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_cc_needs_belf" >&5
 $as_echo "$lt_cv_cc_needs_belf" >&6; }
   if test x"$lt_cv_cc_needs_belf" != x"yes"; then
     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
     CFLAGS="$SAVE_CFLAGS"
   fi
   ;;
-sparc*-*solaris*)
+*-*solaris*)
   # Find out which ABI we are using.
   echo 'int i;' > conftest.$ac_ext
-  if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
     case `/usr/bin/file conftest.o` in
     *64-bit*)
       case $lt_cv_prog_gnu_ld in
-      yes*) LD="${LD-ld} -m elf64_sparc" ;;
+      yes*)
+        case $host in
+        i?86-*-solaris*)
+          LD="${LD-ld} -m elf_x86_64"
+          ;;
+        sparc*-*-solaris*)
+          LD="${LD-ld} -m elf64_sparc"
+          ;;
+        esac
+        # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
+        if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
+          LD="${LD-ld}_sol2"
+        fi
+        ;;
       *)
 	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
 	  LD="${LD-ld} -64"
@@ -8741,15 +8617,132 @@
 
 need_locks="$enable_libtool_lock"
 
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}mt", so it can be a program name with args.
+set dummy ${ac_tool_prefix}mt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_MANIFEST_TOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$MANIFEST_TOOL"; then
+  ac_cv_prog_MANIFEST_TOOL="$MANIFEST_TOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_MANIFEST_TOOL="${ac_tool_prefix}mt"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+MANIFEST_TOOL=$ac_cv_prog_MANIFEST_TOOL
+if test -n "$MANIFEST_TOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MANIFEST_TOOL" >&5
+$as_echo "$MANIFEST_TOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_MANIFEST_TOOL"; then
+  ac_ct_MANIFEST_TOOL=$MANIFEST_TOOL
+  # Extract the first word of "mt", so it can be a program name with args.
+set dummy mt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_MANIFEST_TOOL+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_MANIFEST_TOOL"; then
+  ac_cv_prog_ac_ct_MANIFEST_TOOL="$ac_ct_MANIFEST_TOOL" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_MANIFEST_TOOL="mt"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_MANIFEST_TOOL=$ac_cv_prog_ac_ct_MANIFEST_TOOL
+if test -n "$ac_ct_MANIFEST_TOOL"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_MANIFEST_TOOL" >&5
+$as_echo "$ac_ct_MANIFEST_TOOL" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_MANIFEST_TOOL" = x; then
+    MANIFEST_TOOL=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    MANIFEST_TOOL=$ac_ct_MANIFEST_TOOL
+  fi
+else
+  MANIFEST_TOOL="$ac_cv_prog_MANIFEST_TOOL"
+fi
+
+test -z "$MANIFEST_TOOL" && MANIFEST_TOOL=mt
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $MANIFEST_TOOL is a manifest tool" >&5
+$as_echo_n "checking if $MANIFEST_TOOL is a manifest tool... " >&6; }
+if ${lt_cv_path_mainfest_tool+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_path_mainfest_tool=no
+  echo "$as_me:$LINENO: $MANIFEST_TOOL '-?'" >&5
+  $MANIFEST_TOOL '-?' 2>conftest.err > conftest.out
+  cat conftest.err >&5
+  if $GREP 'Manifest Tool' conftest.out > /dev/null; then
+    lt_cv_path_mainfest_tool=yes
+  fi
+  rm -f conftest*
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_mainfest_tool" >&5
+$as_echo "$lt_cv_path_mainfest_tool" >&6; }
+if test "x$lt_cv_path_mainfest_tool" != xyes; then
+  MANIFEST_TOOL=:
+fi
+
+
+
+
+
 
   case $host_os in
     rhapsody* | darwin*)
     if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}dsymutil", so it can be a program name with args.
 set dummy ${ac_tool_prefix}dsymutil; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_DSYMUTIL+set}" = set; then
+if ${ac_cv_prog_DSYMUTIL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$DSYMUTIL"; then
@@ -8760,24 +8753,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 DSYMUTIL=$ac_cv_prog_DSYMUTIL
 if test -n "$DSYMUTIL"; then
-  { $as_echo "$as_me:$LINENO: result: $DSYMUTIL" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DSYMUTIL" >&5
 $as_echo "$DSYMUTIL" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8787,9 +8780,9 @@
   ac_ct_DSYMUTIL=$DSYMUTIL
   # Extract the first word of "dsymutil", so it can be a program name with args.
 set dummy dsymutil; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_DSYMUTIL+set}" = set; then
+if ${ac_cv_prog_ac_ct_DSYMUTIL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_DSYMUTIL"; then
@@ -8800,24 +8793,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_DSYMUTIL=$ac_cv_prog_ac_ct_DSYMUTIL
 if test -n "$ac_ct_DSYMUTIL"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_DSYMUTIL" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DSYMUTIL" >&5
 $as_echo "$ac_ct_DSYMUTIL" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8826,7 +8819,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -8839,9 +8832,9 @@
     if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}nmedit", so it can be a program name with args.
 set dummy ${ac_tool_prefix}nmedit; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_NMEDIT+set}" = set; then
+if ${ac_cv_prog_NMEDIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$NMEDIT"; then
@@ -8852,24 +8845,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 NMEDIT=$ac_cv_prog_NMEDIT
 if test -n "$NMEDIT"; then
-  { $as_echo "$as_me:$LINENO: result: $NMEDIT" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $NMEDIT" >&5
 $as_echo "$NMEDIT" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8879,9 +8872,9 @@
   ac_ct_NMEDIT=$NMEDIT
   # Extract the first word of "nmedit", so it can be a program name with args.
 set dummy nmedit; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_NMEDIT+set}" = set; then
+if ${ac_cv_prog_ac_ct_NMEDIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_NMEDIT"; then
@@ -8892,24 +8885,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_NMEDIT="nmedit"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_NMEDIT=$ac_cv_prog_ac_ct_NMEDIT
 if test -n "$ac_ct_NMEDIT"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_NMEDIT" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_NMEDIT" >&5
 $as_echo "$ac_ct_NMEDIT" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8918,7 +8911,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -8931,9 +8924,9 @@
     if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}lipo", so it can be a program name with args.
 set dummy ${ac_tool_prefix}lipo; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_LIPO+set}" = set; then
+if ${ac_cv_prog_LIPO+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$LIPO"; then
@@ -8944,24 +8937,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 LIPO=$ac_cv_prog_LIPO
 if test -n "$LIPO"; then
-  { $as_echo "$as_me:$LINENO: result: $LIPO" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIPO" >&5
 $as_echo "$LIPO" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -8971,9 +8964,9 @@
   ac_ct_LIPO=$LIPO
   # Extract the first word of "lipo", so it can be a program name with args.
 set dummy lipo; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_LIPO+set}" = set; then
+if ${ac_cv_prog_ac_ct_LIPO+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_LIPO"; then
@@ -8984,24 +8977,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_LIPO="lipo"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_LIPO=$ac_cv_prog_ac_ct_LIPO
 if test -n "$ac_ct_LIPO"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_LIPO" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_LIPO" >&5
 $as_echo "$ac_ct_LIPO" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9010,7 +9003,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -9023,9 +9016,9 @@
     if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}otool", so it can be a program name with args.
 set dummy ${ac_tool_prefix}otool; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_OTOOL+set}" = set; then
+if ${ac_cv_prog_OTOOL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$OTOOL"; then
@@ -9036,24 +9029,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 OTOOL=$ac_cv_prog_OTOOL
 if test -n "$OTOOL"; then
-  { $as_echo "$as_me:$LINENO: result: $OTOOL" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OTOOL" >&5
 $as_echo "$OTOOL" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9063,9 +9056,9 @@
   ac_ct_OTOOL=$OTOOL
   # Extract the first word of "otool", so it can be a program name with args.
 set dummy otool; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_OTOOL+set}" = set; then
+if ${ac_cv_prog_ac_ct_OTOOL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_OTOOL"; then
@@ -9076,24 +9069,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL="otool"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_OTOOL=$ac_cv_prog_ac_ct_OTOOL
 if test -n "$ac_ct_OTOOL"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_OTOOL" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OTOOL" >&5
 $as_echo "$ac_ct_OTOOL" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9102,7 +9095,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -9115,9 +9108,9 @@
     if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}otool64", so it can be a program name with args.
 set dummy ${ac_tool_prefix}otool64; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_OTOOL64+set}" = set; then
+if ${ac_cv_prog_OTOOL64+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$OTOOL64"; then
@@ -9128,24 +9121,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 OTOOL64=$ac_cv_prog_OTOOL64
 if test -n "$OTOOL64"; then
-  { $as_echo "$as_me:$LINENO: result: $OTOOL64" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $OTOOL64" >&5
 $as_echo "$OTOOL64" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9155,9 +9148,9 @@
   ac_ct_OTOOL64=$OTOOL64
   # Extract the first word of "otool64", so it can be a program name with args.
 set dummy otool64; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_OTOOL64+set}" = set; then
+if ${ac_cv_prog_ac_ct_OTOOL64+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_OTOOL64"; then
@@ -9168,24 +9161,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL64="otool64"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_OTOOL64=$ac_cv_prog_ac_ct_OTOOL64
 if test -n "$ac_ct_OTOOL64"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_OTOOL64" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_OTOOL64" >&5
 $as_echo "$ac_ct_OTOOL64" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9194,7 +9187,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -9230,9 +9223,9 @@
 
 
 
-    { $as_echo "$as_me:$LINENO: checking for -single_module linker flag" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -single_module linker flag" >&5
 $as_echo_n "checking for -single_module linker flag... " >&6; }
-if test "${lt_cv_apple_cc_single_mod+set}" = set; then
+if ${lt_cv_apple_cc_single_mod+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_apple_cc_single_mod=no
@@ -9248,7 +9241,13 @@
 	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
 	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
         _lt_result=$?
-	if test -f libconftest.dylib && test ! -s conftest.err && test $_lt_result = 0; then
+	# If there is a non-empty error log, and "single_module"
+	# appears in it, assume the flag caused a linker warning
+        if test -s conftest.err && $GREP single_module conftest.err; then
+	  cat conftest.err >&5
+	# Otherwise, if the output was created with a 0 exit code from
+	# the compiler, it worked.
+	elif test -f libconftest.dylib && test $_lt_result -eq 0; then
 	  lt_cv_apple_cc_single_mod=yes
 	else
 	  cat conftest.err >&5
@@ -9257,22 +9256,19 @@
 	rm -f conftest.*
       fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_apple_cc_single_mod" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_apple_cc_single_mod" >&5
 $as_echo "$lt_cv_apple_cc_single_mod" >&6; }
-    { $as_echo "$as_me:$LINENO: checking for -exported_symbols_list linker flag" >&5
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -exported_symbols_list linker flag" >&5
 $as_echo_n "checking for -exported_symbols_list linker flag... " >&6; }
-if test "${lt_cv_ld_exported_symbols_list+set}" = set; then
+if ${lt_cv_ld_exported_symbols_list+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_ld_exported_symbols_list=no
       save_LDFLAGS=$LDFLAGS
       echo "_main" > conftest.sym
       LDFLAGS="$LDFLAGS -Wl,-exported_symbols_list,conftest.sym"
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -9283,43 +9279,53 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   lt_cv_ld_exported_symbols_list=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	lt_cv_ld_exported_symbols_list=no
+  lt_cv_ld_exported_symbols_list=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 	LDFLAGS="$save_LDFLAGS"
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_ld_exported_symbols_list" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_exported_symbols_list" >&5
 $as_echo "$lt_cv_ld_exported_symbols_list" >&6; }
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -force_load linker flag" >&5
+$as_echo_n "checking for -force_load linker flag... " >&6; }
+if ${lt_cv_ld_force_load+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_ld_force_load=no
+      cat > conftest.c << _LT_EOF
+int forced_loaded() { return 2;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS -c -o conftest.o conftest.c" >&5
+      $LTCC $LTCFLAGS -c -o conftest.o conftest.c 2>&5
+      echo "$AR cru libconftest.a conftest.o" >&5
+      $AR cru libconftest.a conftest.o 2>&5
+      echo "$RANLIB libconftest.a" >&5
+      $RANLIB libconftest.a 2>&5
+      cat > conftest.c << _LT_EOF
+int main() { return 0;}
+_LT_EOF
+      echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&5
+      $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
+      _lt_result=$?
+      if test -s conftest.err && $GREP force_load conftest.err; then
+	cat conftest.err >&5
+      elif test -f conftest && test $_lt_result -eq 0 && $GREP forced_load conftest >/dev/null 2>&1 ; then
+	lt_cv_ld_force_load=yes
+      else
+	cat conftest.err >&5
+      fi
+        rm -f conftest.err libconftest.a conftest conftest.c
+        rm -rf conftest.dSYM
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_force_load" >&5
+$as_echo "$lt_cv_ld_force_load" >&6; }
     case $host_os in
     rhapsody* | darwin1.[012])
       _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
@@ -9347,7 +9353,7 @@
     else
       _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
     fi
-    if test "$DSYMUTIL" != ":"; then
+    if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
       _lt_dsymutil='~$DSYMUTIL $lib || :'
     else
       _lt_dsymutil=
@@ -9355,62 +9361,13 @@
     ;;
   esac
 
-
 for ac_header in dlfcn.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  eval "$as_ac_Header=yes"
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_Header=no"
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+do :
+  ac_fn_c_check_header_compile "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default
+"
+if test "x$ac_cv_header_dlfcn_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+#define HAVE_DLFCN_H 1
 _ACEOF
 
 fi
@@ -9419,840 +9376,135 @@
 
 
 
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-if test -z "$CXX"; then
-  if test -n "$CCC"; then
-    CXX=$CCC
-  else
-    if test -n "$ac_tool_prefix"; then
-  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CXX+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CXX"; then
-  ac_cv_prog_CXX="$CXX" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
+func_stripname_cnf ()
+{
+  case ${2} in
+  .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
+  *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+  esac
+} # func_stripname_cnf
 
-fi
-fi
-CXX=$ac_cv_prog_CXX
-if test -n "$CXX"; then
-  { $as_echo "$as_me:$LINENO: result: $CXX" >&5
-$as_echo "$CXX" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
 
 
-    test -n "$CXX" && break
-  done
-fi
-if test -z "$CXX"; then
-  ac_ct_CXX=$CXX
-  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CXX"; then
-  ac_cv_prog_ac_ct_CXX="$ac_ct_CXX" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_CXX="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
 
-fi
-fi
-ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
-if test -n "$ac_ct_CXX"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CXX" >&5
-$as_echo "$ac_ct_CXX" >&6; }
+
+# Set options
+
+
+
+        enable_dlopen=no
+
+
+  enable_win32_dll=no
+
+
+            # Check whether --enable-shared was given.
+if test "${enable_shared+set}" = set; then :
+  enableval=$enable_shared; p=${PACKAGE-default}
+    case $enableval in
+    yes) enable_shared=yes ;;
+    no) enable_shared=no ;;
+    *)
+      enable_shared=no
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for pkg in $enableval; do
+	IFS="$lt_save_ifs"
+	if test "X$pkg" = "X$p"; then
+	  enable_shared=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
+  enable_shared=yes
 fi
 
 
-  test -n "$ac_ct_CXX" && break
-done
 
-  if test "x$ac_ct_CXX" = x; then
-    CXX="g++"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CXX=$ac_ct_CXX
-  fi
-fi
 
-  fi
-fi
-# Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C++ compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C++ compiler" >&5
-$as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
-if test "${ac_cv_cxx_compiler_gnu+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_compiler_gnu=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_compiler_gnu=no
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
 
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu" >&5
-$as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GXX=yes
+
+# Check whether --with-pic was given.
+if test "${with_pic+set}" = set; then :
+  withval=$with_pic; lt_p=${PACKAGE-default}
+    case $withval in
+    yes|no) pic_mode=$withval ;;
+    *)
+      pic_mode=default
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for lt_pkg in $withval; do
+	IFS="$lt_save_ifs"
+	if test "X$lt_pkg" = "X$lt_p"; then
+	  pic_mode=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac
 else
-  GXX=
+  pic_mode=default
 fi
-ac_test_CXXFLAGS=${CXXFLAGS+set}
-ac_save_CXXFLAGS=$CXXFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CXX accepts -g" >&5
-$as_echo_n "checking whether $CXX accepts -g... " >&6; }
-if test "${ac_cv_prog_cxx_g+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_cxx_werror_flag=$ac_cxx_werror_flag
-   ac_cxx_werror_flag=yes
-   ac_cv_prog_cxx_g=no
-   CXXFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cxx_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+test -z "$pic_mode" && pic_mode=default
 
-	CXXFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cxx_werror_flag=$ac_save_cxx_werror_flag
-	 CXXFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_prog_cxx_g=yes
+
+  # Check whether --enable-fast-install was given.
+if test "${enable_fast_install+set}" = set; then :
+  enableval=$enable_fast_install; p=${PACKAGE-default}
+    case $enableval in
+    yes) enable_fast_install=yes ;;
+    no) enable_fast_install=no ;;
+    *)
+      enable_fast_install=no
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for pkg in $enableval; do
+	IFS="$lt_save_ifs"
+	if test "X$pkg" = "X$p"; then
+	  enable_fast_install=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  enable_fast_install=yes
+fi
 
 
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_cxx_werror_flag=$ac_save_cxx_werror_flag
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cxx_g" >&5
-$as_echo "$ac_cv_prog_cxx_g" >&6; }
-if test "$ac_test_CXXFLAGS" = set; then
-  CXXFLAGS=$ac_save_CXXFLAGS
-elif test $ac_cv_prog_cxx_g = yes; then
-  if test "$GXX" = yes; then
-    CXXFLAGS="-g -O2"
-  else
-    CXXFLAGS="-g"
-  fi
-else
-  if test "$GXX" = yes; then
-    CXXFLAGS="-O2"
-  else
-    CXXFLAGS=
-  fi
-fi
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-depcc="$CXX"  am_compiler_list=
-
-{ $as_echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
-$as_echo_n "checking dependency style of $depcc... " >&6; }
-if test "${am_cv_CXX_dependencies_compiler_type+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
-  # We make a subdir and do the tests there.  Otherwise we can end up
-  # making bogus files that we don't know about and never remove.  For
-  # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
-  mkdir conftest.dir
-  # Copy depcomp to subdir because otherwise we won't find it if we're
-  # using a relative directory.
-  cp "$am_depcomp" conftest.dir
-  cd conftest.dir
-  # We will build objects and dependencies in a subdirectory because
-  # it helps to detect inapplicable dependency modes.  For instance
-  # both Tru64's cc and ICC support -MD to output dependencies as a
-  # side effect of compilation, but ICC will put the dependencies in
-  # the current directory while Tru64 will put them in the object
-  # directory.
-  mkdir sub
-
-  am_cv_CXX_dependencies_compiler_type=none
-  if test "$am_compiler_list" = ""; then
-     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
-  fi
-  am__universal=false
-  case " $depcc " in #(
-     *\ -arch\ *\ -arch\ *) am__universal=true ;;
-     esac
-
-  for depmode in $am_compiler_list; do
-    # Setup a source with many dependencies, because some compilers
-    # like to wrap large dependency lists on column 80 (with \), and
-    # we should not choose a depcomp mode which is confused by this.
-    #
-    # We need to recreate these files for each test, as the compiler may
-    # overwrite some of them when testing with obscure command lines.
-    # This happens at least with the AIX C compiler.
-    : > sub/conftest.c
-    for i in 1 2 3 4 5 6; do
-      echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
-    done
-    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
-
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
-    # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
-    am__obj=sub/conftest.${OBJEXT-o}
-    am__minus_obj="-o $am__obj"
-    case $depmode in
-    gcc)
-      # This depmode causes a compiler race in universal mode.
-      test "$am__universal" = false || continue
-      ;;
-    nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
-      if test "x$enable_dependency_tracking" = xyes; then
-	continue
-      else
-	break
-      fi
-      ;;
-    msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
-      # not run yet.  These depmodes are late enough in the game, and
-      # so weak that their functioning should not be impacted.
-      am__obj=conftest.${OBJEXT-o}
-      am__minus_obj=
-      ;;
-    none) break ;;
-    esac
-    if depmode=$depmode \
-       source=sub/conftest.c object=$am__obj \
-       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
-       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
-         >/dev/null 2>conftest.err &&
-       grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
-       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
-       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
-       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
-      # icc doesn't choke on unknown options, it will just issue warnings
-      # or remarks (even with -Werror).  So we grep stderr for any message
-      # that says an option was ignored or not supported.
-      # When given -MP, icc 7.0 and 7.1 complain thusly:
-      #   icc: Command line warning: ignoring option '-M'; no argument required
-      # The diagnosis changed in icc 8.0:
-      #   icc: Command line remark: option '-MP' not supported
-      if (grep 'ignoring option' conftest.err ||
-          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
-        am_cv_CXX_dependencies_compiler_type=$depmode
-        break
-      fi
-    fi
-  done
-
-  cd ..
-  rm -rf conftest.dir
-else
-  am_cv_CXX_dependencies_compiler_type=none
-fi
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $am_cv_CXX_dependencies_compiler_type" >&5
-$as_echo "$am_cv_CXX_dependencies_compiler_type" >&6; }
-CXXDEPMODE=depmode=$am_cv_CXX_dependencies_compiler_type
-
- if
-  test "x$enable_dependency_tracking" != xno \
-  && test "$am_cv_CXX_dependencies_compiler_type" = gcc3; then
-  am__fastdepCXX_TRUE=
-  am__fastdepCXX_FALSE='#'
-else
-  am__fastdepCXX_TRUE='#'
-  am__fastdepCXX_FALSE=
-fi
-
-
-if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
-    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
-    (test "X$CXX" != "Xg++"))) ; then
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-{ $as_echo "$as_me:$LINENO: checking how to run the C++ preprocessor" >&5
-$as_echo_n "checking how to run the C++ preprocessor... " >&6; }
-if test -z "$CXXCPP"; then
-  if test "${ac_cv_prog_CXXCPP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-      # Double quotes because CXXCPP needs to be expanded
-    for CXXCPP in "$CXX -E" "/lib/cpp"
-    do
-      ac_preproc_ok=false
-for ac_cxx_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Broken: fails on valid input.
-continue
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  # Broken: success on invalid input.
-continue
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  break
-fi
-
-    done
-    ac_cv_prog_CXXCPP=$CXXCPP
-
-fi
-  CXXCPP=$ac_cv_prog_CXXCPP
-else
-  ac_cv_prog_CXXCPP=$CXXCPP
-fi
-{ $as_echo "$as_me:$LINENO: result: $CXXCPP" >&5
-$as_echo "$CXXCPP" >&6; }
-ac_preproc_ok=false
-for ac_cxx_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Broken: fails on valid input.
-continue
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  # Broken: success on invalid input.
-continue
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
-else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-_lt_caught_CXX_error=yes; }
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-else
-  _lt_caught_CXX_error=yes
-fi
-
-
-
-
-# Set options
-
-
-
-        enable_dlopen=no
-
-
-  enable_win32_dll=no
-
-
-            # Check whether --enable-shared was given.
-if test "${enable_shared+set}" = set; then
-  enableval=$enable_shared; p=${PACKAGE-default}
-    case $enableval in
-    yes) enable_shared=yes ;;
-    no) enable_shared=no ;;
-    *)
-      enable_shared=no
-      # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
-      for pkg in $enableval; do
-	IFS="$lt_save_ifs"
-	if test "X$pkg" = "X$p"; then
-	  enable_shared=yes
-	fi
-      done
-      IFS="$lt_save_ifs"
-      ;;
-    esac
-else
-  enable_shared=yes
-fi
-
-
-
-
-
-
-
-
-
-
-
-# Check whether --with-pic was given.
-if test "${with_pic+set}" = set; then
-  withval=$with_pic; pic_mode="$withval"
-else
-  pic_mode=default
-fi
-
-
-test -z "$pic_mode" && pic_mode=default
-
-
-
-
-
-
-
-  # Check whether --enable-fast-install was given.
-if test "${enable_fast_install+set}" = set; then
-  enableval=$enable_fast_install; p=${PACKAGE-default}
-    case $enableval in
-    yes) enable_fast_install=yes ;;
-    no) enable_fast_install=no ;;
-    *)
-      enable_fast_install=no
-      # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
-      for pkg in $enableval; do
-	IFS="$lt_save_ifs"
-	if test "X$pkg" = "X$p"; then
-	  enable_fast_install=yes
-	fi
-      done
-      IFS="$lt_save_ifs"
-      ;;
-    esac
-else
-  enable_fast_install=yes
-fi
 
 
 
 
 
 
+# This can be used to rebuild libtool when needed
+LIBTOOL_DEPS="$ltmain"
 
+# Always use our own libtool.
+LIBTOOL='$(SHELL) $(top_builddir)/libtool'
 
 
 
 
-# This can be used to rebuild libtool when needed
-LIBTOOL_DEPS="$ltmain"
 
-# Always use our own libtool.
-LIBTOOL='$(SHELL) $(top_builddir)/libtool'
 
 
 
@@ -10297,9 +9549,9 @@
    setopt NO_GLOB_SUBST
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for objdir" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for objdir" >&5
 $as_echo_n "checking for objdir... " >&6; }
-if test "${lt_cv_objdir+set}" = set; then
+if ${lt_cv_objdir+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   rm -f .libs 2>/dev/null
@@ -10312,7 +9564,7 @@
 fi
 rmdir .libs 2>/dev/null
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_objdir" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_objdir" >&5
 $as_echo "$lt_cv_objdir" >&6; }
 objdir=$lt_cv_objdir
 
@@ -10327,19 +9579,6 @@
 
 
 
-
-
-
-
-
-
-
-
-
-
-
-
-
 case $host_os in
 aix3*)
   # AIX sometimes has problems with the GCC collect2 program.  For some
@@ -10352,23 +9591,6 @@
   ;;
 esac
 
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-sed_quote_subst='s/\(["`$\\]\)/\\\1/g'
-
-# Same as above, but do not quote variable references.
-double_quote_subst='s/\(["`\\]\)/\\\1/g'
-
-# Sed substitution to delay expansion of an escaped shell variable in a
-# double_quote_subst'ed string.
-delay_variable_subst='s/\\\\\\\\\\\$/\\\\\\$/g'
-
-# Sed substitution to delay expansion of an escaped single quote.
-delay_single_quote_subst='s/'\''/'\'\\\\\\\'\''/g'
-
-# Sed substitution to avoid accidental globbing in evaled expressions
-no_glob_subst='s/\*/\\\*/g'
-
 # Global variables:
 ofile=libtool
 can_build_shared=yes
@@ -10397,7 +9619,7 @@
     *) break;;
   esac
 done
-cc_basename=`$ECHO "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
+cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
 
 
 # Only perform the check for file, if the check method requires it
@@ -10405,9 +9627,9 @@
 case $deplibs_check_method in
 file_magic*)
   if test "$file_magic_cmd" = '$MAGIC_CMD'; then
-    { $as_echo "$as_me:$LINENO: checking for ${ac_tool_prefix}file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ${ac_tool_prefix}file" >&5
 $as_echo_n "checking for ${ac_tool_prefix}file... " >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $MAGIC_CMD in
@@ -10458,10 +9680,10 @@
 
 MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
 if test -n "$MAGIC_CMD"; then
-  { $as_echo "$as_me:$LINENO: result: $MAGIC_CMD" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
 $as_echo "$MAGIC_CMD" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -10471,9 +9693,9 @@
 
 if test -z "$lt_cv_path_MAGIC_CMD"; then
   if test -n "$ac_tool_prefix"; then
-    { $as_echo "$as_me:$LINENO: checking for file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for file" >&5
 $as_echo_n "checking for file... " >&6; }
-if test "${lt_cv_path_MAGIC_CMD+set}" = set; then
+if ${lt_cv_path_MAGIC_CMD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $MAGIC_CMD in
@@ -10524,10 +9746,10 @@
 
 MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
 if test -n "$MAGIC_CMD"; then
-  { $as_echo "$as_me:$LINENO: result: $MAGIC_CMD" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
 $as_echo "$MAGIC_CMD" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -10602,11 +9824,16 @@
 lt_prog_compiler_no_builtin_flag=
 
 if test "$GCC" = yes; then
-  lt_prog_compiler_no_builtin_flag=' -fno-builtin'
+  case $cc_basename in
+  nvcc*)
+    lt_prog_compiler_no_builtin_flag=' -Xcompiler -fno-builtin' ;;
+  *)
+    lt_prog_compiler_no_builtin_flag=' -fno-builtin' ;;
+  esac
 
-  { $as_echo "$as_me:$LINENO: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -fno-rtti -fno-exceptions" >&5
 $as_echo_n "checking if $compiler supports -fno-rtti -fno-exceptions... " >&6; }
-if test "${lt_cv_prog_compiler_rtti_exceptions+set}" = set; then
+if ${lt_cv_prog_compiler_rtti_exceptions+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_rtti_exceptions=no
@@ -10622,15 +9849,15 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:10625: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:10629: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_rtti_exceptions=yes
@@ -10639,7 +9866,7 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
 $as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
 
 if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
@@ -10659,8 +9886,6 @@
 lt_prog_compiler_pic=
 lt_prog_compiler_static=
 
-{ $as_echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
 
   if test "$GCC" = yes; then
     lt_prog_compiler_wl='-Wl,'
@@ -10708,6 +9933,12 @@
       lt_prog_compiler_pic='-fno-common'
       ;;
 
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      lt_prog_compiler_static=
+      ;;
+
     hpux*)
       # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
       # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
@@ -10750,6 +9981,15 @@
       lt_prog_compiler_pic='-fPIC'
       ;;
     esac
+
+    case $cc_basename in
+    nvcc*) # Cuda Compiler Driver 2.2
+      lt_prog_compiler_wl='-Xlinker '
+      if test -n "$lt_prog_compiler_pic"; then
+        lt_prog_compiler_pic="-Xcompiler $lt_prog_compiler_pic"
+      fi
+      ;;
+    esac
   else
     # PORTME Check for flag to pass linker flags through the system compiler.
     case $host_os in
@@ -10791,7 +10031,7 @@
       lt_prog_compiler_static='-non_shared'
       ;;
 
-    linux* | k*bsd*-gnu)
+    linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
       case $cc_basename in
       # old Intel for x86_64 which still supported -KPIC.
       ecc*)
@@ -10812,7 +10052,13 @@
 	lt_prog_compiler_pic='--shared'
 	lt_prog_compiler_static='--static'
 	;;
-      pgcc* | pgf77* | pgf90* | pgf95*)
+      nagfor*)
+	# NAG Fortran compiler
+	lt_prog_compiler_wl='-Wl,-Wl,,'
+	lt_prog_compiler_pic='-PIC'
+	lt_prog_compiler_static='-Bstatic'
+	;;
+      pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
         # Portland Group compilers (*not* the Pentium gcc compiler,
 	# which looks to be a dead project)
 	lt_prog_compiler_wl='-Wl,'
@@ -10824,25 +10070,40 @@
         # All Alpha code is PIC.
         lt_prog_compiler_static='-non_shared'
         ;;
-      xl*)
-	# IBM XL C 8.0/Fortran 10.1 on PPC
+      xl* | bgxl* | bgf* | mpixl*)
+	# IBM XL C 8.0/Fortran 10.1, 11.1 on PPC and BlueGene
 	lt_prog_compiler_wl='-Wl,'
 	lt_prog_compiler_pic='-qpic'
 	lt_prog_compiler_static='-qstaticlink'
 	;;
       *)
 	case `$CC -V 2>&1 | sed 5q` in
+	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [1-7].* | *Sun*Fortran*\ 8.[0-3]*)
+	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
+	  lt_prog_compiler_pic='-KPIC'
+	  lt_prog_compiler_static='-Bstatic'
+	  lt_prog_compiler_wl=''
+	  ;;
+	*Sun\ F* | *Sun*Fortran*)
+	  lt_prog_compiler_pic='-KPIC'
+	  lt_prog_compiler_static='-Bstatic'
+	  lt_prog_compiler_wl='-Qoption ld '
+	  ;;
 	*Sun\ C*)
 	  # Sun C 5.9
 	  lt_prog_compiler_pic='-KPIC'
 	  lt_prog_compiler_static='-Bstatic'
 	  lt_prog_compiler_wl='-Wl,'
 	  ;;
-	*Sun\ F*)
-	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
-	  lt_prog_compiler_pic='-KPIC'
+        *Intel*\ [CF]*Compiler*)
+	  lt_prog_compiler_wl='-Wl,'
+	  lt_prog_compiler_pic='-fPIC'
+	  lt_prog_compiler_static='-static'
+	  ;;
+	*Portland\ Group*)
+	  lt_prog_compiler_wl='-Wl,'
+	  lt_prog_compiler_pic='-fpic'
 	  lt_prog_compiler_static='-Bstatic'
-	  lt_prog_compiler_wl=''
 	  ;;
 	esac
 	;;
@@ -10874,7 +10135,7 @@
       lt_prog_compiler_pic='-KPIC'
       lt_prog_compiler_static='-Bstatic'
       case $cc_basename in
-      f77* | f90* | f95*)
+      f77* | f90* | f95* | sunf77* | sunf90* | sunf95*)
 	lt_prog_compiler_wl='-Qoption ld ';;
       *)
 	lt_prog_compiler_wl='-Wl,';;
@@ -10931,21 +10192,25 @@
     lt_prog_compiler_pic="$lt_prog_compiler_pic -DPIC"
     ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $lt_prog_compiler_pic" >&5
-$as_echo "$lt_prog_compiler_pic" >&6; }
-
-
-
-
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
+if ${lt_cv_prog_compiler_pic+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_pic=$lt_prog_compiler_pic
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic" >&5
+$as_echo "$lt_cv_prog_compiler_pic" >&6; }
+lt_prog_compiler_pic=$lt_cv_prog_compiler_pic
 
 #
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic"; then
-  { $as_echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic works" >&5
 $as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic works... " >&6; }
-if test "${lt_cv_prog_compiler_pic_works+set}" = set; then
+if ${lt_cv_prog_compiler_pic_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_pic_works=no
@@ -10961,15 +10226,15 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:10964: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:10968: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_pic_works=yes
@@ -10978,7 +10243,7 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_pic_works" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_works" >&5
 $as_echo "$lt_cv_prog_compiler_pic_works" >&6; }
 
 if test x"$lt_cv_prog_compiler_pic_works" = xyes; then
@@ -10998,13 +10263,18 @@
 
 
 
+
+
+
+
+
 #
 # Check to make sure the static flag actually works.
 #
 wl=$lt_prog_compiler_wl eval lt_tmp_static_flag=\"$lt_prog_compiler_static\"
-{ $as_echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
 $as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
-if test "${lt_cv_prog_compiler_static_works+set}" = set; then
+if ${lt_cv_prog_compiler_static_works+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_static_works=no
@@ -11017,7 +10287,7 @@
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1>&5
-       $ECHO "X$_lt_linker_boilerplate" | $Xsed -e '/^$/d' > conftest.exp
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
        $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
        if diff conftest.exp conftest.er2 >/dev/null; then
          lt_cv_prog_compiler_static_works=yes
@@ -11030,7 +10300,7 @@
    LDFLAGS="$save_LDFLAGS"
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_static_works" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_static_works" >&5
 $as_echo "$lt_cv_prog_compiler_static_works" >&6; }
 
 if test x"$lt_cv_prog_compiler_static_works" = xyes; then
@@ -11045,9 +10315,9 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
 $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o+set}" = set; then
+if ${lt_cv_prog_compiler_c_o+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o=no
@@ -11066,16 +10336,16 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:11069: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:11073: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_c_o=yes
@@ -11092,7 +10362,7 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
 $as_echo "$lt_cv_prog_compiler_c_o" >&6; }
 
 
@@ -11100,9 +10370,9 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
 $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o+set}" = set; then
+if ${lt_cv_prog_compiler_c_o+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o=no
@@ -11121,16 +10391,16 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:11124: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:11128: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_c_o=yes
@@ -11147,7 +10417,7 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o" >&5
 $as_echo "$lt_cv_prog_compiler_c_o" >&6; }
 
 
@@ -11156,7 +10426,7 @@
 hard_links="nottested"
 if test "$lt_cv_prog_compiler_c_o" = no && test "$need_locks" != no; then
   # do not overwrite the value of need_locks provided by the user
-  { $as_echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
 $as_echo_n "checking if we can lock with hard links... " >&6; }
   hard_links=yes
   $RM conftest*
@@ -11164,10 +10434,10 @@
   touch conftest.a
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { $as_echo "$as_me:$LINENO: result: $hard_links" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
 $as_echo "$hard_links" >&6; }
   if test "$hard_links" = no; then
-    { $as_echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
 $as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
@@ -11180,7 +10450,7 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
 $as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
   runpath_var=
@@ -11196,7 +10466,6 @@
   hardcode_direct=no
   hardcode_direct_absolute=no
   hardcode_libdir_flag_spec=
-  hardcode_libdir_flag_spec_ld=
   hardcode_libdir_separator=
   hardcode_minus_L=no
   hardcode_shlibpath_var=unsupported
@@ -11240,10 +10509,39 @@
   openbsd*)
     with_gnu_ld=no
     ;;
+  linux* | k*bsd*-gnu | gnu*)
+    link_all_deplibs=no
+    ;;
   esac
 
   ld_shlibs=yes
+
+  # On some targets, GNU ld is compatible enough with the native linker
+  # that we're better off using the native interface for both.
+  lt_use_gnu_ld_interface=no
   if test "$with_gnu_ld" = yes; then
+    case $host_os in
+      aix*)
+	# The AIX port of GNU ld has always aspired to compatibility
+	# with the native linker.  However, as the warning in the GNU ld
+	# block says, versions before 2.19.5* couldn't really create working
+	# shared libraries, regardless of the interface used.
+	case `$LD -v 2>&1` in
+	  *\ \(GNU\ Binutils\)\ 2.19.5*) ;;
+	  *\ \(GNU\ Binutils\)\ 2.[2-9]*) ;;
+	  *\ \(GNU\ Binutils\)\ [3-9]*) ;;
+	  *)
+	    lt_use_gnu_ld_interface=yes
+	    ;;
+	esac
+	;;
+      *)
+	lt_use_gnu_ld_interface=yes
+	;;
+    esac
+  fi
+
+  if test "$lt_use_gnu_ld_interface" = yes; then
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
@@ -11261,6 +10559,7 @@
     fi
     supports_anon_versioning=no
     case `$LD -v 2>&1` in
+      *GNU\ gold*) supports_anon_versioning=yes ;;
       *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
       *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
       *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
@@ -11276,11 +10575,12 @@
 	ld_shlibs=no
 	cat <<_LT_EOF 1>&2
 
-*** Warning: the GNU linker, at least up to release 2.9.1, is reported
+*** Warning: the GNU linker, at least up to release 2.19, is reported
 *** to be unable to reliably create shared libraries on AIX.
 *** Therefore, libtool is disabling shared libraries support.  If you
-*** really care for shared libraries, you may want to modify your PATH
-*** so that a non-GNU linker is found, and then restart.
+*** really care for shared libraries, you may want to install binutils
+*** 2.20 or above, or modify your PATH so that a non-GNU linker is found.
+*** You will then need to restart the configuration process.
 
 _LT_EOF
       fi
@@ -11316,10 +10616,12 @@
       # _LT_TAGVAR(hardcode_libdir_flag_spec, ) is actually meaningless,
       # as there is no search path for DLLs.
       hardcode_libdir_flag_spec='-L$libdir'
+      export_dynamic_flag_spec='${wl}--export-all-symbols'
       allow_undefined_flag=unsupported
       always_export_symbols=no
       enable_shared_with_static_runtimes=yes
-      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW][ ]/s/.*[ ]//'\'' | sort | uniq > $export_symbols'
+      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/;s/^.*[ ]__nm__\([^ ]*\)[ ][^ ]*/\1 DATA/;/^I[ ]/d;/^[AITW][ ]/s/.* //'\'' | sort | uniq > $export_symbols'
+      exclude_expsyms='[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname'
 
       if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
         archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
@@ -11337,6 +10639,11 @@
       fi
       ;;
 
+    haiku*)
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      link_all_deplibs=yes
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
@@ -11352,7 +10659,7 @@
       archive_expsym_cmds='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
       ;;
 
-    gnu* | linux* | tpf* | k*bsd*-gnu)
+    gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
       tmp_diet=no
       if test "$host_os" = linux-dietlibc; then
 	case $cc_basename in
@@ -11362,15 +10669,16 @@
       if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
 	 && test "$tmp_diet" = no
       then
-	tmp_addflag=
+	tmp_addflag=' $pic_flag'
 	tmp_sharedflag='-shared'
 	case $cc_basename,$host_cpu in
         pgcc*)				# Portland Group C compiler
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  tmp_addflag=' $pic_flag'
 	  ;;
-	pgf77* | pgf90* | pgf95*)	# Portland Group f77 and f90 compilers
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	pgf77* | pgf90* | pgf95* | pgfortran*)
+					# Portland Group f77 and f90 compilers
+	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  tmp_addflag=' $pic_flag -Mnomain' ;;
 	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
 	  tmp_addflag=' -i_dynamic' ;;
@@ -11381,13 +10689,17 @@
 	lf95*)				# Lahey Fortran 8.1
 	  whole_archive_flag_spec=
 	  tmp_sharedflag='--shared' ;;
-	xl[cC]*)			# IBM XL C 8.0 on PPC (deal with xlf below)
+	xl[cC]* | bgxl[cC]* | mpixl[cC]*) # IBM XL C 8.0 on PPC (deal with xlf below)
 	  tmp_sharedflag='-qmkshrobj'
 	  tmp_addflag= ;;
+	nvcc*)	# Cuda Compiler Driver 2.2
+	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  compiler_needs_object=yes
+	  ;;
 	esac
 	case `$CC -V 2>&1 | sed 5q` in
 	*Sun\ C*)			# Sun C 5.9
-	  whole_archive_flag_spec='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	  whole_archive_flag_spec='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	  compiler_needs_object=yes
 	  tmp_sharedflag='-G' ;;
 	*Sun\ F*)			# Sun Fortran 8.3
@@ -11403,17 +10715,16 @@
         fi
 
 	case $cc_basename in
-	xlf*)
+	xlf* | bgf* | bgxlf* | mpixlf*)
 	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
 	  whole_archive_flag_spec='--whole-archive$convenience --no-whole-archive'
-	  hardcode_libdir_flag_spec=
-	  hardcode_libdir_flag_spec_ld='-rpath $libdir'
-	  archive_cmds='$LD -shared $libobjs $deplibs $compiler_flags -soname $soname -o $lib'
+	  hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+	  archive_cmds='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
 	  if test "x$supports_anon_versioning" = xyes; then
 	    archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
 	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
 	      echo "local: *; };" >> $output_objdir/$libname.ver~
-	      $LD -shared $libobjs $deplibs $compiler_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
+	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
 	  fi
 	  ;;
 	esac
@@ -11422,13 +10733,13 @@
       fi
       ;;
 
-    netbsd*)
+    netbsd* | netbsdelf*-gnu)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
       else
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       fi
       ;;
 
@@ -11446,8 +10757,8 @@
 
 _LT_EOF
       elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	ld_shlibs=no
       fi
@@ -11493,8 +10804,8 @@
 
     *)
       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	ld_shlibs=no
       fi
@@ -11534,8 +10845,10 @@
       else
 	# If we're using GNU nm, then we don't want the "-C" option.
 	# -C means demangle to AIX nm, but means don't demangle with GNU nm
+	# Also, AIX nm treats weak defined symbols like other global
+	# defined symbols, whereas GNU nm marks them as "W".
 	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
 	else
 	  export_symbols_cmds='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
 	fi
@@ -11597,6 +10910,7 @@
 	if test "$aix_use_runtimelinking" = yes; then
 	  shared_flag="$shared_flag "'${wl}-G'
 	fi
+	link_all_deplibs=no
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -11622,11 +10936,13 @@
 	allow_undefined_flag='-berok'
         # Determine the default libpath from the value encoded in an
         # empty executable.
-        cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+        if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath_+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -11637,54 +10953,34 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
 
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath_=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
 fi
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_="/usr/lib:/lib"
+  fi
 
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
+  aix_libpath=$lt_cv_aix_libpath_
+fi
 
         hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
-        archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+        archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
       else
 	if test "$host_cpu" = ia64; then
 	  hardcode_libdir_flag_spec='${wl}-R $libdir:/usr/lib:/lib'
@@ -11693,11 +10989,13 @@
 	else
 	 # Determine the default libpath from the value encoded in an
 	 # empty executable.
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath_+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -11708,59 +11006,44 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
 
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath_=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
 fi
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  if test -z "$lt_cv_aix_libpath_"; then
+    lt_cv_aix_libpath_="/usr/lib:/lib"
+  fi
 
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
+  aix_libpath=$lt_cv_aix_libpath_
+fi
 
 	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
 	  # Warning - without using the other run time loading flags,
 	  # -berok will link without error, but may produce a broken library.
 	  no_undefined_flag=' ${wl}-bernotok'
 	  allow_undefined_flag=' ${wl}-berok'
-	  # Exported symbols can be pulled into shared objects from archives
-	  whole_archive_flag_spec='$convenience'
+	  if test "$with_gnu_ld" = yes; then
+	    # We only use this code for GNU lds that support --whole-archive.
+	    whole_archive_flag_spec='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	  else
+	    # Exported symbols can be pulled into shared objects from archives
+	    whole_archive_flag_spec='$convenience'
+	  fi
 	  archive_cmds_need_lc=yes
 	  # This is similar to how AIX traditionally builds its shared libraries.
 	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
@@ -11792,20 +11075,64 @@
       # Microsoft Visual C++.
       # hardcode_libdir_flag_spec is actually meaningless, as there is
       # no search path for DLLs.
-      hardcode_libdir_flag_spec=' '
-      allow_undefined_flag=unsupported
-      # Tell ltmain to make .lib files, not .a files.
-      libext=lib
-      # Tell ltmain to make .dll files, not .so files.
-      shrext_cmds=".dll"
-      # FIXME: Setting linknames here is a bad hack.
-      archive_cmds='$CC -o $lib $libobjs $compiler_flags `$ECHO "X$deplibs" | $Xsed -e '\''s/ -lc$//'\''` -link -dll~linknames='
-      # The linker will automatically build a .lib file if we build a DLL.
-      old_archive_from_new_cmds='true'
-      # FIXME: Should let the user specify the lib program.
-      old_archive_cmds='lib -OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path='`cygpath -w "$srcfile"`'
-      enable_shared_with_static_runtimes=yes
+      case $cc_basename in
+      cl*)
+	# Native MSVC
+	hardcode_libdir_flag_spec=' '
+	allow_undefined_flag=unsupported
+	always_export_symbols=yes
+	file_list_spec='@'
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	archive_cmds='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	  else
+	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	  fi~
+	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	  linknames='
+	# The linker will not automatically build a static lib if we build a DLL.
+	# _LT_TAGVAR(old_archive_from_new_cmds, )='true'
+	enable_shared_with_static_runtimes=yes
+	exclude_expsyms='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+	export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1,DATA/'\'' | $SED -e '\''/^[AITW][ ]/s/.*[ ]//'\'' | sort | uniq > $export_symbols'
+	# Don't use ranlib
+	old_postinstall_cmds='chmod 644 $oldlib'
+	postlink_cmds='lt_outputfile="@OUTPUT@"~
+	  lt_tool_outputfile="@TOOL_OUTPUT@"~
+	  case $lt_outputfile in
+	    *.exe|*.EXE) ;;
+	    *)
+	      lt_outputfile="$lt_outputfile.exe"
+	      lt_tool_outputfile="$lt_tool_outputfile.exe"
+	      ;;
+	  esac~
+	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	    $RM "$lt_outputfile.manifest";
+	  fi'
+	;;
+      *)
+	# Assume MSVC wrapper
+	hardcode_libdir_flag_spec=' '
+	allow_undefined_flag=unsupported
+	# Tell ltmain to make .lib files, not .a files.
+	libext=lib
+	# Tell ltmain to make .dll files, not .so files.
+	shrext_cmds=".dll"
+	# FIXME: Setting linknames here is a bad hack.
+	archive_cmds='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
+	# The linker will automatically build a .lib file if we build a DLL.
+	old_archive_from_new_cmds='true'
+	# FIXME: Should let the user specify the lib program.
+	old_archive_cmds='lib -OUT:$oldlib$oldobjs$old_deplibs'
+	enable_shared_with_static_runtimes=yes
+	;;
+      esac
       ;;
 
     darwin* | rhapsody*)
@@ -11815,7 +11142,12 @@
   hardcode_direct=no
   hardcode_automatic=yes
   hardcode_shlibpath_var=unsupported
-  whole_archive_flag_spec=''
+  if test "$lt_cv_ld_force_load" = "yes"; then
+    whole_archive_flag_spec='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+
+  else
+    whole_archive_flag_spec=''
+  fi
   link_all_deplibs=yes
   allow_undefined_flag="$_lt_dar_allow_undefined"
   case $cc_basename in
@@ -11823,7 +11155,7 @@
      *) _lt_dar_can_shared=$GCC ;;
   esac
   if test "$_lt_dar_can_shared" = "yes"; then
-    output_verbose_link_cmd=echo
+    output_verbose_link_cmd=func_echo_all
     archive_cmds="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
     module_cmds="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
     archive_expsym_cmds="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
@@ -11841,10 +11173,6 @@
       hardcode_shlibpath_var=no
       ;;
 
-    freebsd1*)
-      ld_shlibs=no
-      ;;
-
     # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
     # support.  Future versions do this automatically, but an explicit c++rt0.o
     # does not break anything, and helps significantly (at the cost of a little
@@ -11857,7 +11185,7 @@
       ;;
 
     # Unfortunately, older versions of FreeBSD 2 do not have this feature.
-    freebsd2*)
+    freebsd2.*)
       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
       hardcode_direct=yes
       hardcode_minus_L=yes
@@ -11866,7 +11194,7 @@
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
     freebsd* | dragonfly*)
-      archive_cmds='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
+      archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec='-R$libdir'
       hardcode_direct=yes
       hardcode_shlibpath_var=no
@@ -11874,7 +11202,7 @@
 
     hpux9*)
       if test "$GCC" = yes; then
-	archive_cmds='$RM $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
 	archive_cmds='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
@@ -11889,14 +11217,13 @@
       ;;
 
     hpux10*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
-	archive_cmds='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+	archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
       else
 	archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
       fi
       if test "$with_gnu_ld" = no; then
 	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
-	hardcode_libdir_flag_spec_ld='+b $libdir'
 	hardcode_libdir_separator=:
 	hardcode_direct=yes
 	hardcode_direct_absolute=yes
@@ -11908,16 +11235,16 @@
       ;;
 
     hpux11*)
-      if test "$GCC" = yes -a "$with_gnu_ld" = no; then
+      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
 	case $host_cpu in
 	hppa*64*)
 	  archive_cmds='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  archive_cmds='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  archive_cmds='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	esac
       else
@@ -11929,23 +11256,62 @@
 	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
-	  ;;
-	esac
-      fi
-      if test "$with_gnu_ld" = no; then
-	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
-	hardcode_libdir_separator=:
 
-	case $host_cpu in
-	hppa*64*|ia64*)
-	  hardcode_direct=no
-	  hardcode_shlibpath_var=no
-	  ;;
-	*)
-	  hardcode_direct=yes
-	  hardcode_direct_absolute=yes
-	  export_dynamic_flag_spec='${wl}-E'
+	  # Older versions of the 11.00 compiler do not understand -b yet
+	  # (HP92453-01 A.11.01.20 doesn't, HP92453-01 B.11.X.35175-35176.GP does)
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $CC understands -b" >&5
+$as_echo_n "checking if $CC understands -b... " >&6; }
+if ${lt_cv_prog_compiler__b+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler__b=no
+   save_LDFLAGS="$LDFLAGS"
+   LDFLAGS="$LDFLAGS -b"
+   echo "$lt_simple_link_test_code" > conftest.$ac_ext
+   if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
+     # The linker can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     if test -s conftest.err; then
+       # Append any errors to the config.log.
+       cat conftest.err 1>&5
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
+       $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+       if diff conftest.exp conftest.er2 >/dev/null; then
+         lt_cv_prog_compiler__b=yes
+       fi
+     else
+       lt_cv_prog_compiler__b=yes
+     fi
+   fi
+   $RM -r conftest*
+   LDFLAGS="$save_LDFLAGS"
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler__b" >&5
+$as_echo "$lt_cv_prog_compiler__b" >&6; }
+
+if test x"$lt_cv_prog_compiler__b" = xyes; then
+    archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+else
+    archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
+fi
+
+	  ;;
+	esac
+      fi
+      if test "$with_gnu_ld" = no; then
+	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
+	hardcode_libdir_separator=:
+
+	case $host_cpu in
+	hppa*64*|ia64*)
+	  hardcode_direct=no
+	  hardcode_shlibpath_var=no
+	  ;;
+	*)
+	  hardcode_direct=yes
+	  hardcode_direct_absolute=yes
+	  export_dynamic_flag_spec='${wl}-E'
 
 	  # hardcode_minus_L: Not really in the search PATH,
 	  # but as the default location of the library.
@@ -11957,52 +11323,39 @@
 
     irix5* | irix6* | nonstopux*)
       if test "$GCC" = yes; then
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	# Try to use the -exported_symbol ld option, if it does not
 	# work, assume that -exports_file does not work either and
 	# implicitly export all symbols.
-        save_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
-        cat >conftest.$ac_ext <<_ACEOF
-int foo(void) {}
+	# This should be the same for all languages, so no per-tag cache variable.
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $host_os linker accepts -exported_symbol" >&5
+$as_echo_n "checking whether the $host_os linker accepts -exported_symbol... " >&6; }
+if ${lt_cv_irix_exported_symbol+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  save_LDFLAGS="$LDFLAGS"
+	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
+	   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+int foo (void) { return 0; }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
-
+if ac_fn_c_try_link "$LINENO"; then :
+  lt_cv_irix_exported_symbol=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
+  lt_cv_irix_exported_symbol=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-        LDFLAGS="$save_LDFLAGS"
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+           LDFLAGS="$save_LDFLAGS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_irix_exported_symbol" >&5
+$as_echo "$lt_cv_irix_exported_symbol" >&6; }
+	if test "$lt_cv_irix_exported_symbol" = yes; then
+          archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
+	fi
       else
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
+	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
       fi
       archive_cmds_need_lc='no'
       hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
@@ -12011,7 +11364,7 @@
       link_all_deplibs=yes
       ;;
 
-    netbsd*)
+    netbsd* | netbsdelf*-gnu)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -12064,17 +11417,17 @@
       hardcode_libdir_flag_spec='-L$libdir'
       hardcode_minus_L=yes
       allow_undefined_flag=unsupported
-      archive_cmds='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$ECHO DATA >> $output_objdir/$libname.def~$ECHO " SINGLE NONSHARED" >> $output_objdir/$libname.def~$ECHO EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
+      archive_cmds='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
       old_archive_from_new_cmds='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
     osf3*)
       if test "$GCC" = yes; then
 	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
       else
 	allow_undefined_flag=' -expect_unresolved \*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
       fi
       archive_cmds_need_lc='no'
       hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
@@ -12084,13 +11437,13 @@
     osf4* | osf5*)	# as osf3* with the addition of -msym flag
       if test "$GCC" = yes; then
 	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
       else
 	allow_undefined_flag=' -expect_unresolved \*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
-	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
+	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec='-rpath $libdir'
@@ -12103,9 +11456,9 @@
       no_undefined_flag=' -z defs'
       if test "$GCC" = yes; then
 	wlarc='${wl}'
-	archive_cmds='$CC -shared ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_cmds='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -shared ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
       else
 	case `$CC -V 2>&1` in
 	*"Compilers 5.0"*)
@@ -12254,7 +11607,7 @@
     fi
   fi
 
-{ $as_echo "$as_me:$LINENO: result: $ld_shlibs" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs" >&5
 $as_echo "$ld_shlibs" >&6; }
 test "$ld_shlibs" = no && can_build_shared=no
 
@@ -12291,46 +11644,52 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      { $as_echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
 $as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
-      $RM conftest*
-      echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+if ${lt_cv_archive_cmds_need_lc+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  $RM conftest*
+	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+	if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
-        soname=conftest
-        lib=conftest
-        libobjs=conftest.$ac_objext
-        deplibs=
-        wl=$lt_prog_compiler_wl
-	pic_flag=$lt_prog_compiler_pic
-        compiler_flags=-v
-        linker_flags=-v
-        verstring=
-        output_objdir=.
-        libname=conftest
-        lt_save_allow_undefined_flag=$allow_undefined_flag
-        allow_undefined_flag=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\"") >&5
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
+	  soname=conftest
+	  lib=conftest
+	  libobjs=conftest.$ac_objext
+	  deplibs=
+	  wl=$lt_prog_compiler_wl
+	  pic_flag=$lt_prog_compiler_pic
+	  compiler_flags=-v
+	  linker_flags=-v
+	  verstring=
+	  output_objdir=.
+	  libname=conftest
+	  lt_save_allow_undefined_flag=$allow_undefined_flag
+	  allow_undefined_flag=
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\""; } >&5
   (eval $archive_cmds 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-        then
-	  archive_cmds_need_lc=no
-        else
-	  archive_cmds_need_lc=yes
-        fi
-        allow_undefined_flag=$lt_save_allow_undefined_flag
-      else
-        cat conftest.err 1>&5
-      fi
-      $RM conftest*
-      { $as_echo "$as_me:$LINENO: result: $archive_cmds_need_lc" >&5
-$as_echo "$archive_cmds_need_lc" >&6; }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+	  then
+	    lt_cv_archive_cmds_need_lc=no
+	  else
+	    lt_cv_archive_cmds_need_lc=yes
+	  fi
+	  allow_undefined_flag=$lt_save_allow_undefined_flag
+	else
+	  cat conftest.err 1>&5
+	fi
+	$RM conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_archive_cmds_need_lc" >&5
+$as_echo "$lt_cv_archive_cmds_need_lc" >&6; }
+      archive_cmds_need_lc=$lt_cv_archive_cmds_need_lc
       ;;
     esac
   fi
@@ -12488,12 +11847,7 @@
 
 
 
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
 $as_echo_n "checking dynamic linker characteristics... " >&6; }
 
 if test "$GCC" = yes; then
@@ -12501,16 +11855,23 @@
     darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
     *) lt_awk_arg="/^libraries:/" ;;
   esac
-  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-  if $ECHO "$lt_search_path_spec" | $GREP ';' >/dev/null ; then
+  case $host_os in
+    mingw* | cegcc*) lt_sed_strip_eq="s,=\([A-Za-z]:\),\1,g" ;;
+    *) lt_sed_strip_eq="s,=/,/,g" ;;
+  esac
+  lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
+  case $lt_search_path_spec in
+  *\;*)
     # if the path contains ";" then we assume it to be the separator
     # otherwise default to the standard path separator (i.e. ":") - it is
     # assumed that no part of a normal pathname contains ";" but that should
     # okay in the real world where ";" in dirpaths is itself problematic.
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED -e 's/;/ /g'`
-  else
-    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-  fi
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED 's/;/ /g'`
+    ;;
+  *)
+    lt_search_path_spec=`$ECHO "$lt_search_path_spec" | $SED "s/$PATH_SEPARATOR/ /g"`
+    ;;
+  esac
   # Ok, now we have the path, separated by spaces, we can step through it
   # and add multilib dir if necessary.
   lt_tmp_lt_search_path_spec=
@@ -12523,7 +11884,7 @@
 	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
     fi
   done
-  lt_search_path_spec=`$ECHO $lt_tmp_lt_search_path_spec | awk '
+  lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
 BEGIN {RS=" "; FS="/|\n";} {
   lt_foo="";
   lt_count=0;
@@ -12543,7 +11904,13 @@
   if (lt_foo != "") { lt_freq[lt_foo]++; }
   if (lt_freq[lt_foo] == 1) { print lt_foo; }
 }'`
-  sys_lib_search_path_spec=`$ECHO $lt_search_path_spec`
+  # AWK program above erroneously prepends '/' to C:/dos/paths
+  # for these hosts.
+  case $host_os in
+    mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
+      $SED 's,/\([A-Za-z]:\),\1,g'` ;;
+  esac
+  sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
 else
   sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
 fi
@@ -12569,7 +11936,7 @@
 
 case $host_os in
 aix3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
@@ -12578,7 +11945,7 @@
   ;;
 
 aix[4-9]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   hardcode_into_libs=yes
@@ -12631,7 +11998,7 @@
   m68k)
     library_names_spec='$libname.ixlibrary $libname.a'
     # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$ECHO "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
     ;;
   esac
   ;;
@@ -12643,7 +12010,7 @@
   ;;
 
 bsdi[45]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
@@ -12662,8 +12029,9 @@
   need_version=no
   need_lib_prefix=no
 
-  case $GCC,$host_os in
-  yes,cygwin* | yes,mingw* | yes,pw32* | yes,cegcc*)
+  case $GCC,$cc_basename in
+  yes,*)
+    # gcc
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
     postinstall_cmds='base_file=`basename \${file}`~
@@ -12684,36 +12052,83 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+
+      sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"
       ;;
     mingw* | cegcc*)
       # MinGW DLLs use traditional 'lib' prefix
       soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec=`$CC -print-search-dirs | $GREP "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
-        # It is most probably a Windows format PATH printed by
-        # mingw gcc, but we are running on Cygwin. Gcc prints its search
-        # path with ; separators, and with drive letters. We can handle the
-        # drive letters (cygwin fileutils understands them), so leave them,
-        # especially as we might pass files found there to a mingw objdump,
-        # which wouldn't understand a cygwinified path. Ahh.
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-      else
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-      fi
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
       library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
+    dynamic_linker='Win32 ld.exe'
+    ;;
+
+  *,cl*)
+    # Native MSVC
+    libname_spec='$name'
+    soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+    library_names_spec='${libname}.dll.lib'
+
+    case $build_os in
+    mingw*)
+      sys_lib_search_path_spec=
+      lt_save_ifs=$IFS
+      IFS=';'
+      for lt_path in $LIB
+      do
+        IFS=$lt_save_ifs
+        # Let DOS variable expansion print the short 8.3 style file name.
+        lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
+        sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
+      done
+      IFS=$lt_save_ifs
+      # Convert to MSYS style.
+      sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([a-zA-Z]\\):| /\\1|g' -e 's|^ ||'`
+      ;;
+    cygwin*)
+      # Convert to unix form, then to dos form, then back to unix form
+      # but this time dos style (no spaces!) so that the unix form looks
+      # like /cygdrive/c/PROGRA~1:/cygdr...
+      sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
+      sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
+      sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      ;;
+    *)
+      sys_lib_search_path_spec="$LIB"
+      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
+        # It is most probably a Windows format PATH.
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      fi
+      # FIXME: find the short name or the path components, as spaces are
+      # common. (e.g. "Program Files" -> "PROGRA~1")
+      ;;
+    esac
+
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+    dynamic_linker='Win32 link.exe'
     ;;
 
   *)
+    # Assume MSVC wrapper
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    dynamic_linker='Win32 ld.exe'
     ;;
   esac
-  dynamic_linker='Win32 ld.exe'
   # FIXME: first we should search . and the directory the executable is in
   shlibpath_var=PATH
   ;;
@@ -12734,7 +12149,7 @@
   ;;
 
 dgux*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
@@ -12742,10 +12157,6 @@
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
-
 freebsd* | dragonfly*)
   # DragonFly does not have aout.  When/if they implement a new
   # versioning mechanism, adjust this.
@@ -12753,7 +12164,7 @@
     objformat=`/usr/bin/objformat`
   else
     case $host_os in
-    freebsd[123]*) objformat=aout ;;
+    freebsd[23].*) objformat=aout ;;
     *) objformat=elf ;;
     esac
   fi
@@ -12771,7 +12182,7 @@
   esac
   shlibpath_var=LD_LIBRARY_PATH
   case $host_os in
-  freebsd2*)
+  freebsd2.*)
     shlibpath_overrides_runpath=yes
     ;;
   freebsd3.[01]* | freebsdelf3.[01]*)
@@ -12790,13 +12201,16 @@
   esac
   ;;
 
-gnu*)
-  version_type=linux
+haiku*)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
+  dynamic_linker="$host_os runtime_loader"
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_var=LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
   hardcode_into_libs=yes
   ;;
 
@@ -12842,12 +12256,14 @@
     soname_spec='${libname}${release}${shared_ext}$major'
     ;;
   esac
-  # HP-UX runs *really* slowly unless shared libraries are mode 555.
+  # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
   postinstall_cmds='chmod 555 $lib'
+  # or fails outright, so override atomically:
+  install_override_mode=555
   ;;
 
 interix[3-9]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
@@ -12863,7 +12279,7 @@
     nonstopux*) version_type=nonstopux ;;
     *)
 	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
+		version_type=linux # correct to gnu/linux during the next big refactor
 	else
 		version_type=irix
 	fi ;;
@@ -12900,9 +12316,9 @@
   dynamic_linker=no
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
-  version_type=linux
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -12910,16 +12326,17 @@
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
+
   # Some binutils ld are patched to set DT_RUNPATH
-  save_LDFLAGS=$LDFLAGS
-  save_libdir=$libdir
-  eval "libdir=/foo; wl=\"$lt_prog_compiler_wl\"; \
-       LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec\""
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  if ${lt_cv_shlibpath_overrides_runpath+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_shlibpath_overrides_runpath=no
+    save_LDFLAGS=$LDFLAGS
+    save_libdir=$libdir
+    eval "libdir=/foo; wl=\"$lt_prog_compiler_wl\"; \
+	 LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec\""
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -12930,56 +12347,29 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then
-  shlibpath_overrides_runpath=yes
+if ac_fn_c_try_link "$LINENO"; then :
+  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then :
+  lt_cv_shlibpath_overrides_runpath=yes
 fi
-
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    LDFLAGS=$save_LDFLAGS
+    libdir=$save_libdir
 
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-  LDFLAGS=$save_LDFLAGS
-  libdir=$save_libdir
+  shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
 
   # This implies no fast_install, which is unacceptable.
   # Some rework will be needed to allow for fast_install
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Add ABI-specific directories to the system library path.
-  sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
-
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec $lt_ld_extra"
+    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
+    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
   fi
 
   # We used to test for /lib/ld.so.1 and disable shared libraries on
@@ -12991,6 +12381,18 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
+netbsdelf*-gnu)
+  version_type=linux
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='NetBSD ld.elf_so'
+  ;;
+
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -13010,7 +12412,7 @@
   ;;
 
 newsos6)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
@@ -13079,7 +12481,7 @@
   ;;
 
 solaris*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -13104,7 +12506,7 @@
   ;;
 
 sysv4 | sysv4.3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -13128,7 +12530,7 @@
 
 sysv4*MP*)
   if test -d /usr/nec ;then
-    version_type=linux
+    version_type=linux # correct to gnu/linux during the next big refactor
     library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
     soname_spec='$libname${shared_ext}.$major'
     shlibpath_var=LD_LIBRARY_PATH
@@ -13159,7 +12561,7 @@
 
 tpf*)
   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -13169,7 +12571,7 @@
   ;;
 
 uts4*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -13179,7 +12581,7 @@
   dynamic_linker=no
   ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $dynamic_linker" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
 $as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
@@ -13281,7 +12683,12 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
 $as_echo_n "checking how to hardcode library paths into programs... " >&6; }
 hardcode_action=
 if test -n "$hardcode_libdir_flag_spec" ||
@@ -13306,7 +12713,7 @@
   # directories.
   hardcode_action=unsupported
 fi
-{ $as_echo "$as_me:$LINENO: result: $hardcode_action" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action" >&5
 $as_echo "$hardcode_action" >&6; }
 
 if test "$hardcode_action" = relink ||
@@ -13351,18 +12758,14 @@
 
   darwin*)
   # if libdl is installed we need to link against it
-    { $as_echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
+if ${ac_cv_lib_dl_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -13380,43 +12783,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlopen=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlopen=no
+  ac_cv_lib_dl_dlopen=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
 else
 
@@ -13429,106 +12807,18 @@
     ;;
 
   *)
-    { $as_echo "$as_me:$LINENO: checking for shl_load" >&5
-$as_echo_n "checking for shl_load... " >&6; }
-if test "${ac_cv_func_shl_load+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define shl_load to an innocuous variant, in case <limits.h> declares shl_load.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define shl_load innocuous_shl_load
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char shl_load (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef shl_load
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char shl_load ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_shl_load || defined __stub___shl_load
-choke me
-#endif
-
-int
-main ()
-{
-return shl_load ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_shl_load=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_shl_load=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_shl_load" >&5
-$as_echo "$ac_cv_func_shl_load" >&6; }
-if test "x$ac_cv_func_shl_load" = x""yes; then
+    ac_fn_c_check_func "$LINENO" "shl_load" "ac_cv_func_shl_load"
+if test "x$ac_cv_func_shl_load" = xyes; then :
   lt_cv_dlopen="shl_load"
 else
-  { $as_echo "$as_me:$LINENO: checking for shl_load in -ldld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
 $as_echo_n "checking for shl_load in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_shl_load+set}" = set; then
+if ${ac_cv_lib_dld_shl_load+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -13546,145 +12836,32 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dld_shl_load=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dld_shl_load=no
+  ac_cv_lib_dld_shl_load=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dld_shl_load" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
 $as_echo "$ac_cv_lib_dld_shl_load" >&6; }
-if test "x$ac_cv_lib_dld_shl_load" = x""yes; then
+if test "x$ac_cv_lib_dld_shl_load" = xyes; then :
   lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"
 else
-  { $as_echo "$as_me:$LINENO: checking for dlopen" >&5
-$as_echo_n "checking for dlopen... " >&6; }
-if test "${ac_cv_func_dlopen+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define dlopen to an innocuous variant, in case <limits.h> declares dlopen.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define dlopen innocuous_dlopen
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char dlopen (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef dlopen
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dlopen ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_dlopen || defined __stub___dlopen
-choke me
-#endif
-
-int
-main ()
-{
-return dlopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_dlopen=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_dlopen=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_dlopen" >&5
-$as_echo "$ac_cv_func_dlopen" >&6; }
-if test "x$ac_cv_func_dlopen" = x""yes; then
+  ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
+if test "x$ac_cv_func_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen"
 else
-  { $as_echo "$as_me:$LINENO: checking for dlopen in -ldl" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlopen+set}" = set; then
+if ${ac_cv_lib_dl_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -13702,57 +12879,28 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlopen=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlopen=no
+  ac_cv_lib_dl_dlopen=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlopen" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
-if test "x$ac_cv_lib_dl_dlopen" = x""yes; then
+if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
 else
-  { $as_echo "$as_me:$LINENO: checking for dlopen in -lsvld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -lsvld" >&5
 $as_echo_n "checking for dlopen in -lsvld... " >&6; }
-if test "${ac_cv_lib_svld_dlopen+set}" = set; then
+if ${ac_cv_lib_svld_dlopen+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsvld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -13770,57 +12918,28 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_svld_dlopen=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_svld_dlopen=no
+  ac_cv_lib_svld_dlopen=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_svld_dlopen" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_svld_dlopen" >&5
 $as_echo "$ac_cv_lib_svld_dlopen" >&6; }
-if test "x$ac_cv_lib_svld_dlopen" = x""yes; then
+if test "x$ac_cv_lib_svld_dlopen" = xyes; then :
   lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
 else
-  { $as_echo "$as_me:$LINENO: checking for dld_link in -ldld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dld_link in -ldld" >&5
 $as_echo_n "checking for dld_link in -ldld... " >&6; }
-if test "${ac_cv_lib_dld_dld_link+set}" = set; then
+if ${ac_cv_lib_dld_dld_link+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldld  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -13838,43 +12957,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dld_dld_link=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dld_dld_link=no
+  ac_cv_lib_dld_dld_link=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dld_dld_link" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_dld_link" >&5
 $as_echo "$ac_cv_lib_dld_dld_link" >&6; }
-if test "x$ac_cv_lib_dld_dld_link" = x""yes; then
+if test "x$ac_cv_lib_dld_dld_link" = xyes; then :
   lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"
 fi
 
@@ -13913,9 +13007,9 @@
     save_LIBS="$LIBS"
     LIBS="$lt_cv_dlopen_libs $LIBS"
 
-    { $as_echo "$as_me:$LINENO: checking whether a program can dlopen itself" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a program can dlopen itself" >&5
 $as_echo_n "checking whether a program can dlopen itself... " >&6; }
-if test "${lt_cv_dlopen_self+set}" = set; then
+if ${lt_cv_dlopen_self+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   	  if test "$cross_compiling" = yes; then :
@@ -13924,7 +13018,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 13927 "configure"
+#line $LINENO "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -13965,7 +13059,13 @@
 #  endif
 #endif
 
-void fnord() { int i=42;}
+/* When -fvisbility=hidden is used, assume the code has been annotated
+   correspondingly for the symbols needed.  */
+#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+int fnord () __attribute__((visibility("default")));
+#endif
+
+int fnord () { return 42; }
 int main ()
 {
   void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
@@ -13974,7 +13074,11 @@
   if (self)
     {
       if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
-      else if (dlsym( self,"_fnord")) status = $lt_dlneed_uscore;
+      else
+        {
+	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
+          else puts (dlerror ());
+	}
       /* dlclose (self); */
     }
   else
@@ -13983,11 +13087,11 @@
   return status;
 }
 _LT_EOF
-  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
     (./conftest; exit; ) >&5 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -14004,14 +13108,14 @@
 
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_dlopen_self" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self" >&5
 $as_echo "$lt_cv_dlopen_self" >&6; }
 
     if test "x$lt_cv_dlopen_self" = xyes; then
       wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
-      { $as_echo "$as_me:$LINENO: checking whether a statically linked program can dlopen itself" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a statically linked program can dlopen itself" >&5
 $as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
-if test "${lt_cv_dlopen_self_static+set}" = set; then
+if ${lt_cv_dlopen_self_static+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   	  if test "$cross_compiling" = yes; then :
@@ -14020,7 +13124,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<_LT_EOF
-#line 14023 "configure"
+#line $LINENO "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
@@ -14061,7 +13165,13 @@
 #  endif
 #endif
 
-void fnord() { int i=42;}
+/* When -fvisbility=hidden is used, assume the code has been annotated
+   correspondingly for the symbols needed.  */
+#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+int fnord () __attribute__((visibility("default")));
+#endif
+
+int fnord () { return 42; }
 int main ()
 {
   void *self = dlopen (0, LT_DLGLOBAL|LT_DLLAZY_OR_NOW);
@@ -14070,7 +13180,11 @@
   if (self)
     {
       if (dlsym (self,"fnord"))       status = $lt_dlno_uscore;
-      else if (dlsym( self,"_fnord")) status = $lt_dlneed_uscore;
+      else
+        {
+	  if (dlsym( self,"_fnord"))  status = $lt_dlneed_uscore;
+          else puts (dlerror ());
+	}
       /* dlclose (self); */
     }
   else
@@ -14079,11 +13193,11 @@
   return status;
 }
 _LT_EOF
-  if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && test -s conftest${ac_exeext} 2>/dev/null; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
     (./conftest; exit; ) >&5 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -14100,7 +13214,7 @@
 
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_dlopen_self_static" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self_static" >&5
 $as_echo "$lt_cv_dlopen_self_static" >&6; }
     fi
 
@@ -14139,12 +13253,12 @@
 
 striplib=
 old_striplib=
-{ $as_echo "$as_me:$LINENO: checking whether stripping libraries is possible" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether stripping libraries is possible" >&5
 $as_echo_n "checking whether stripping libraries is possible... " >&6; }
 if test -n "$STRIP" && $STRIP -V 2>&1 | $GREP "GNU strip" >/dev/null; then
   test -z "$old_striplib" && old_striplib="$STRIP --strip-debug"
   test -z "$striplib" && striplib="$STRIP --strip-unneeded"
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 else
 # FIXME - insert some real tests, host_os isn't really good enough
@@ -14153,15 +13267,15 @@
     if test -n "$STRIP" ; then
       striplib="$STRIP -x"
       old_striplib="$STRIP -S"
-      { $as_echo "$as_me:$LINENO: result: yes" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
     else
-      { $as_echo "$as_me:$LINENO: result: no" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
     fi
     ;;
   *)
-    { $as_echo "$as_me:$LINENO: result: no" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
     ;;
   esac
@@ -14179,12 +13293,12 @@
 
 
   # Report which library types will actually be built
-  { $as_echo "$as_me:$LINENO: checking if libtool supports shared libraries" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if libtool supports shared libraries" >&5
 $as_echo_n "checking if libtool supports shared libraries... " >&6; }
-  { $as_echo "$as_me:$LINENO: result: $can_build_shared" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $can_build_shared" >&5
 $as_echo "$can_build_shared" >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking whether to build shared libraries" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
 $as_echo_n "checking whether to build shared libraries... " >&6; }
   test "$can_build_shared" = "no" && enable_shared=no
 
@@ -14205,14 +13319,14 @@
     fi
     ;;
   esac
-  { $as_echo "$as_me:$LINENO: result: $enable_shared" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_shared" >&5
 $as_echo "$enable_shared" >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking whether to build static libraries" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
 $as_echo_n "checking whether to build static libraries... " >&6; }
   # Make sure either enable_shared or enable_static is yes.
   test "$enable_shared" = yes || enable_static=yes
-  { $as_echo "$as_me:$LINENO: result: $enable_static" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_static" >&5
 $as_echo "$enable_static" >&6; }
 
 
@@ -14227,6 +13341,145 @@
 
 CC="$lt_save_CC"
 
+      if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
+    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
+    (test "X$CXX" != "Xg++"))) ; then
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
+$as_echo_n "checking how to run the C++ preprocessor... " >&6; }
+if test -z "$CXXCPP"; then
+  if ${ac_cv_prog_CXXCPP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+      # Double quotes because CXXCPP needs to be expanded
+    for CXXCPP in "$CXX -E" "/lib/cpp"
+    do
+      ac_preproc_ok=false
+for ac_cxx_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+  break
+fi
+
+    done
+    ac_cv_prog_CXXCPP=$CXXCPP
+
+fi
+  CXXCPP=$ac_cv_prog_CXXCPP
+else
+  ac_cv_prog_CXXCPP=$CXXCPP
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXXCPP" >&5
+$as_echo "$CXXCPP" >&6; }
+ac_preproc_ok=false
+for ac_cxx_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C++ preprocessor \"$CXXCPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+else
+  _lt_caught_CXX_error=yes
+fi
 
 ac_ext=cpp
 ac_cpp='$CXXCPP $CPPFLAGS'
@@ -14243,7 +13496,6 @@
 hardcode_direct_CXX=no
 hardcode_direct_absolute_CXX=no
 hardcode_libdir_flag_spec_CXX=
-hardcode_libdir_flag_spec_ld_CXX=
 hardcode_libdir_separator_CXX=
 hardcode_minus_L_CXX=no
 hardcode_shlibpath_var_CXX=unsupported
@@ -14253,6 +13505,8 @@
 module_expsym_cmds_CXX=
 link_all_deplibs_CXX=unknown
 old_archive_cmds_CXX=$old_archive_cmds
+reload_flag_CXX=$reload_flag
+reload_cmds_CXX=$reload_cmds
 no_undefined_flag_CXX=
 whole_archive_flag_spec_CXX=
 enable_shared_with_static_runtimes_CXX=no
@@ -14308,6 +13562,7 @@
 
   # Allow CC to be a program name with arguments.
   lt_save_CC=$CC
+  lt_save_CFLAGS=$CFLAGS
   lt_save_LD=$LD
   lt_save_GCC=$GCC
   GCC=$GXX
@@ -14325,6 +13580,7 @@
   fi
   test -z "${LDCXX+set}" || LD=$LDCXX
   CC=${CXX-"c++"}
+  CFLAGS=$CXXFLAGS
   compiler=$CC
   compiler_CXX=$CC
   for cc_temp in $compiler""; do
@@ -14335,7 +13591,7 @@
     *) break;;
   esac
 done
-cc_basename=`$ECHO "X$cc_temp" | $Xsed -e 's%.*/%%' -e "s%^$host_alias-%%"`
+cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
 
 
   if test -n "$compiler"; then
@@ -14353,7 +13609,7 @@
 
 
 # Check whether --with-gnu-ld was given.
-if test "${with_gnu_ld+set}" = set; then
+if test "${with_gnu_ld+set}" = set; then :
   withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
 else
   with_gnu_ld=no
@@ -14362,7 +13618,7 @@
 ac_prog=ld
 if test "$GCC" = yes; then
   # Check if gcc -print-prog-name=ld gives a path.
-  { $as_echo "$as_me:$LINENO: checking for ld used by $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
 $as_echo_n "checking for ld used by $CC... " >&6; }
   case $host in
   *-*-mingw*)
@@ -14392,13 +13648,13 @@
     ;;
   esac
 elif test "$with_gnu_ld" = yes; then
-  { $as_echo "$as_me:$LINENO: checking for GNU ld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
 $as_echo_n "checking for GNU ld... " >&6; }
 else
-  { $as_echo "$as_me:$LINENO: checking for non-GNU ld" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
 $as_echo_n "checking for non-GNU ld... " >&6; }
 fi
-if test "${lt_cv_path_LD+set}" = set; then
+if ${lt_cv_path_LD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
@@ -14429,18 +13685,16 @@
 
 LD="$lt_cv_path_LD"
 if test -n "$LD"; then
-  { $as_echo "$as_me:$LINENO: result: $LD" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
 $as_echo "$LD" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-test -z "$LD" && { { $as_echo "$as_me:$LINENO: error: no acceptable ld found in \$PATH" >&5
-$as_echo "$as_me: error: no acceptable ld found in \$PATH" >&2;}
-   { (exit 1); exit 1; }; }
-{ $as_echo "$as_me:$LINENO: checking if the linker ($LD) is GNU ld" >&5
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
 $as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
-if test "${lt_cv_prog_gnu_ld+set}" = set; then
+if ${lt_cv_prog_gnu_ld+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU lds only accept -v.
@@ -14453,7 +13707,7 @@
   ;;
 esac
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_gnu_ld" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
 $as_echo "$lt_cv_prog_gnu_ld" >&6; }
 with_gnu_ld=$lt_cv_prog_gnu_ld
 
@@ -14466,8 +13720,8 @@
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        archive_expsym_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        archive_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        archive_expsym_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 
         hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
         export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
@@ -14499,7 +13753,7 @@
       # Commands to make compiler produce verbose output that lists
       # what "hidden" libraries, object files and flags are used when
       # linking a shared library.
-      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
     else
       GXX=no
@@ -14508,7 +13762,7 @@
     fi
 
     # PORTME: fill in a description of your system's C++ link characteristics
-    { $as_echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
 $as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
     ld_shlibs_CXX=yes
     case $host_os in
@@ -14609,11 +13863,13 @@
           allow_undefined_flag_CXX='-berok'
           # Determine the default libpath from the value encoded in an empty
           # executable.
-          cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+          if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath__CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -14624,55 +13880,35 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_cxx_try_link "$LINENO"; then :
 
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath__CXX=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
 fi
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX="/usr/lib:/lib"
+  fi
 
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
+  aix_libpath=$lt_cv_aix_libpath__CXX
+fi
 
           hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
 
-          archive_expsym_cmds_CXX='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then $ECHO "X${wl}${allow_undefined_flag}" | $Xsed; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+          archive_expsym_cmds_CXX='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
         else
           if test "$host_cpu" = ia64; then
 	    hardcode_libdir_flag_spec_CXX='${wl}-R $libdir:/usr/lib:/lib'
@@ -14681,11 +13917,13 @@
           else
 	    # Determine the default libpath from the value encoded in an
 	    # empty executable.
-	    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	    if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath__CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -14696,59 +13934,44 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_cxx_try_link "$LINENO"; then :
 
-lt_aix_libpath_sed='
-    /Import File Strings/,/^$/ {
-	/^0/ {
-	    s/^0  *\(.*\)$/\1/
-	    p
-	}
-    }'
-aix_libpath=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
-# Check for a 64-bit object if we didn't find anything.
-if test -z "$aix_libpath"; then
-  aix_libpath=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath__CXX=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
 fi
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX="/usr/lib:/lib"
+  fi
 
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-if test -z "$aix_libpath"; then aix_libpath="/usr/lib:/lib"; fi
+  aix_libpath=$lt_cv_aix_libpath__CXX
+fi
 
 	    hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
 	    # Warning - without using the other run time loading flags,
 	    # -berok will link without error, but may produce a broken library.
 	    no_undefined_flag_CXX=' ${wl}-bernotok'
 	    allow_undefined_flag_CXX=' ${wl}-berok'
-	    # Exported symbols can be pulled into shared objects from archives
-	    whole_archive_flag_spec_CXX='$convenience'
+	    if test "$with_gnu_ld" = yes; then
+	      # We only use this code for GNU lds that support --whole-archive.
+	      whole_archive_flag_spec_CXX='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    else
+	      # Exported symbols can be pulled into shared objects from archives
+	      whole_archive_flag_spec_CXX='$convenience'
+	    fi
 	    archive_cmds_need_lc_CXX=yes
 	    # This is similar to how AIX traditionally builds its shared
 	    # libraries.
@@ -14778,28 +14001,75 @@
         ;;
 
       cygwin* | mingw* | pw32* | cegcc*)
-        # _LT_TAGVAR(hardcode_libdir_flag_spec, CXX) is actually meaningless,
-        # as there is no search path for DLLs.
-        hardcode_libdir_flag_spec_CXX='-L$libdir'
-        allow_undefined_flag_CXX=unsupported
-        always_export_symbols_CXX=no
-        enable_shared_with_static_runtimes_CXX=yes
-
-        if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-          archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-          # If the export-symbols file already is a .def file (1st line
-          # is EXPORTS), use it as is; otherwise, prepend...
-          archive_expsym_cmds_CXX='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	    cp $export_symbols $output_objdir/$soname.def;
-          else
-	    echo EXPORTS > $output_objdir/$soname.def;
-	    cat $export_symbols >> $output_objdir/$soname.def;
-          fi~
-          $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-        else
-          ld_shlibs_CXX=no
-        fi
-        ;;
+	case $GXX,$cc_basename in
+	,cl* | no,cl*)
+	  # Native MSVC
+	  # hardcode_libdir_flag_spec is actually meaningless, as there is
+	  # no search path for DLLs.
+	  hardcode_libdir_flag_spec_CXX=' '
+	  allow_undefined_flag_CXX=unsupported
+	  always_export_symbols_CXX=yes
+	  file_list_spec_CXX='@'
+	  # Tell ltmain to make .lib files, not .a files.
+	  libext=lib
+	  # Tell ltmain to make .dll files, not .so files.
+	  shrext_cmds=".dll"
+	  # FIXME: Setting linknames here is a bad hack.
+	  archive_cmds_CXX='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	  archive_expsym_cmds_CXX='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      $SED -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	    else
+	      $SED -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	    fi~
+	    $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	    linknames='
+	  # The linker will not automatically build a static lib if we build a DLL.
+	  # _LT_TAGVAR(old_archive_from_new_cmds, CXX)='true'
+	  enable_shared_with_static_runtimes_CXX=yes
+	  # Don't use ranlib
+	  old_postinstall_cmds_CXX='chmod 644 $oldlib'
+	  postlink_cmds_CXX='lt_outputfile="@OUTPUT@"~
+	    lt_tool_outputfile="@TOOL_OUTPUT@"~
+	    case $lt_outputfile in
+	      *.exe|*.EXE) ;;
+	      *)
+		lt_outputfile="$lt_outputfile.exe"
+		lt_tool_outputfile="$lt_tool_outputfile.exe"
+		;;
+	    esac~
+	    func_to_tool_file "$lt_outputfile"~
+	    if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	      $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	      $RM "$lt_outputfile.manifest";
+	    fi'
+	  ;;
+	*)
+	  # g++
+	  # _LT_TAGVAR(hardcode_libdir_flag_spec, CXX) is actually meaningless,
+	  # as there is no search path for DLLs.
+	  hardcode_libdir_flag_spec_CXX='-L$libdir'
+	  export_dynamic_flag_spec_CXX='${wl}--export-all-symbols'
+	  allow_undefined_flag_CXX=unsupported
+	  always_export_symbols_CXX=no
+	  enable_shared_with_static_runtimes_CXX=yes
+
+	  if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
+	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	    # If the export-symbols file already is a .def file (1st line
+	    # is EXPORTS), use it as is; otherwise, prepend...
+	    archive_expsym_cmds_CXX='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      cp $export_symbols $output_objdir/$soname.def;
+	    else
+	      echo EXPORTS > $output_objdir/$soname.def;
+	      cat $export_symbols >> $output_objdir/$soname.def;
+	    fi~
+	    $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	  else
+	    ld_shlibs_CXX=no
+	  fi
+	  ;;
+	esac
+	;;
       darwin* | rhapsody*)
 
 
@@ -14807,7 +14077,12 @@
   hardcode_direct_CXX=no
   hardcode_automatic_CXX=yes
   hardcode_shlibpath_var_CXX=unsupported
-  whole_archive_flag_spec_CXX=''
+  if test "$lt_cv_ld_force_load" = "yes"; then
+    whole_archive_flag_spec_CXX='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+
+  else
+    whole_archive_flag_spec_CXX=''
+  fi
   link_all_deplibs_CXX=yes
   allow_undefined_flag_CXX="$_lt_dar_allow_undefined"
   case $cc_basename in
@@ -14815,7 +14090,7 @@
      *) _lt_dar_can_shared=$GCC ;;
   esac
   if test "$_lt_dar_can_shared" = "yes"; then
-    output_verbose_link_cmd=echo
+    output_verbose_link_cmd=func_echo_all
     archive_cmds_CXX="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
     module_cmds_CXX="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
     archive_expsym_cmds_CXX="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
@@ -14849,7 +14124,7 @@
         esac
         ;;
 
-      freebsd[12]*)
+      freebsd2.*)
         # C++ shared libraries reported to be fairly broken before
 	# switch to ELF
         ld_shlibs_CXX=no
@@ -14865,7 +14140,9 @@
         ld_shlibs_CXX=yes
         ;;
 
-      gnu*)
+      haiku*)
+        archive_cmds_CXX='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        link_all_deplibs_CXX=yes
         ;;
 
       hpux9*)
@@ -14892,11 +14169,11 @@
             # explicitly linking system object files so we need to strip them
             # from the output so that they don't get included in the library
             # dependencies.
-            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
             ;;
           *)
             if test "$GXX" = yes; then
-              archive_cmds_CXX='$RM $output_objdir/$soname~$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+              archive_cmds_CXX='$RM $output_objdir/$soname~$CC -shared -nostdlib $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
             else
               # FIXME: insert proper C++ library support
               ld_shlibs_CXX=no
@@ -14957,7 +14234,7 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
           *)
 	    if test "$GXX" = yes; then
@@ -14967,10 +14244,10 @@
 	            archive_cmds_CXX='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          ia64*)
-	            archive_cmds_CXX='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            archive_cmds_CXX='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          *)
-	            archive_cmds_CXX='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            archive_cmds_CXX='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	        esac
 	      fi
@@ -15000,7 +14277,7 @@
         case $cc_basename in
           CC*)
 	    # SGI C++
-	    archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	    archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -ar", where "CC" is the IRIX C++ compiler.  This is
@@ -15011,9 +14288,9 @@
           *)
 	    if test "$GXX" = yes; then
 	      if test "$with_gnu_ld" = no; then
-	        archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	        archive_cmds_CXX='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	      else
-	        archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` -o $lib'
+	        archive_cmds_CXX='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` -o $lib'
 	      fi
 	    fi
 	    link_all_deplibs_CXX=yes
@@ -15024,7 +14301,7 @@
         inherit_rpath_CXX=yes
         ;;
 
-      linux* | k*bsd*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
         case $cc_basename in
           KCC*)
 	    # Kuck and Associates, Inc. (KAI) C++ Compiler
@@ -15042,7 +14319,7 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 
 	    hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
 	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
@@ -15079,26 +14356,26 @@
           pgCC* | pgcpp*)
             # Portland Group C++ compiler
 	    case `$CC -V` in
-	    *pgCC\ [1-5]* | *pgcpp\ [1-5]*)
+	    *pgCC\ [1-5].* | *pgcpp\ [1-5].*)
 	      prelink_cmds_CXX='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $objs $libobjs $compile_deplibs~
-		compile_command="$compile_command `find $tpldir -name \*.o | $NL2SP`"'
+		compile_command="$compile_command `find $tpldir -name \*.o | sort | $NL2SP`"'
 	      old_archive_cmds_CXX='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $oldobjs$old_deplibs~
-		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | $NL2SP`~
+		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | sort | $NL2SP`~
 		$RANLIB $oldlib'
 	      archive_cmds_CXX='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
 	      archive_expsym_cmds_CXX='tpldir=Template.dir~
 		rm -rf $tpldir~
 		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
 	      ;;
-	    *) # Version 6 will use weak symbols
+	    *) # Version 6 and above use weak symbols
 	      archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
 	      archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
 	      ;;
@@ -15106,7 +14383,7 @@
 
 	    hardcode_libdir_flag_spec_CXX='${wl}--rpath ${wl}$libdir'
 	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
-	    whole_archive_flag_spec_CXX='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	    whole_archive_flag_spec_CXX='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
             ;;
 	  cxx*)
 	    # Compaq C++
@@ -15125,9 +14402,9 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`$ECHO "X$templist" | $Xsed -e "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "X$list" | $Xsed'
 	    ;;
-	  xl*)
+	  xl* | mpixl* | bgxl*)
 	    # IBM XL 8.0 on PPC, with GNU ld
 	    hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
@@ -15147,13 +14424,13 @@
 	      archive_cmds_CXX='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	      archive_expsym_cmds_CXX='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file ${wl}$export_symbols'
 	      hardcode_libdir_flag_spec_CXX='-R$libdir'
-	      whole_archive_flag_spec_CXX='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; $ECHO \"$new_convenience\"` ${wl}--no-whole-archive'
+	      whole_archive_flag_spec_CXX='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
 	      compiler_needs_object_CXX=yes
 
 	      # Not sure whether something based on
 	      # $CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1
 	      # would be better.
-	      output_verbose_link_cmd='echo'
+	      output_verbose_link_cmd='func_echo_all'
 
 	      # Archives containing C++ object files must be created using
 	      # "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -15222,7 +14499,7 @@
 	    export_dynamic_flag_spec_CXX='${wl}-E'
 	    whole_archive_flag_spec_CXX="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
 	  fi
-	  output_verbose_link_cmd=echo
+	  output_verbose_link_cmd=func_echo_all
 	else
 	  ld_shlibs_CXX=no
 	fi
@@ -15257,15 +14534,15 @@
 	    case $host in
 	      osf3*)
 	        allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	        archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && $ECHO "X${wl}-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	        archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && func_echo_all "${wl}-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	        hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 		;;
 	      *)
 	        allow_undefined_flag_CXX=' -expect_unresolved \*'
-	        archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib'
+	        archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
 	        archive_expsym_cmds_CXX='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done~
 	          echo "-hidden">> $lib.exp~
-	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "X-set_version $verstring" | $Xsed` -update_registry ${output_objdir}/so_locations -o $lib~
+	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~
 	          $RM $lib.exp'
 	        hardcode_libdir_flag_spec_CXX='-rpath $libdir'
 		;;
@@ -15281,17 +14558,17 @@
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`$ECHO "X$templist" | $Xsed -e "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; $ECHO "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
 	  *)
 	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	      allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
 	      case $host in
 	        osf3*)
-	          archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "X${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 		  ;;
 	        *)
-	          archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && $ECHO "${wl}-set_version ${wl}$verstring" | $Xsed` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          archive_cmds_CXX='$CC -shared $pic_flag -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 		  ;;
 	      esac
 
@@ -15301,7 +14578,7 @@
 	      # Commands to make compiler produce verbose output that lists
 	      # what "hidden" libraries, object files and flags are used when
 	      # linking a shared library.
-	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
 	    else
 	      # FIXME: insert proper C++ library support
@@ -15337,7 +14614,7 @@
 
       solaris*)
         case $cc_basename in
-          CC*)
+          CC* | sunCC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
             archive_cmds_need_lc_CXX=yes
 	    no_undefined_flag_CXX=' -zdefs'
@@ -15358,7 +14635,7 @@
 	    esac
 	    link_all_deplibs_CXX=yes
 
-	    output_verbose_link_cmd='echo'
+	    output_verbose_link_cmd='func_echo_all'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -xar", where "CC" is the Sun C++ compiler.  This is
@@ -15378,14 +14655,14 @@
 	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
 	      no_undefined_flag_CXX=' ${wl}-z ${wl}defs'
 	      if $CC --version | $GREP -v '^2\.7' > /dev/null; then
-	        archive_cmds_CXX='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        archive_cmds_CXX='$CC -shared $pic_flag -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 	        archive_expsym_cmds_CXX='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-		  $CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+		  $CC -shared $pic_flag -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
 
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
-	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      else
 	        # g++ 2.7 appears to require `-G' NOT `-shared' on this
 	        # platform.
@@ -15396,7 +14673,7 @@
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
-	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP "\-L"'
+	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      fi
 
 	      hardcode_libdir_flag_spec_CXX='${wl}-R $wl$libdir'
@@ -15450,6 +14727,10 @@
           CC*)
 	    archive_cmds_CXX='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	    archive_expsym_cmds_CXX='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    old_archive_cmds_CXX='$CC -Tprelink_objects $oldobjs~
+	      '"$old_archive_cmds_CXX"
+	    reload_cmds_CXX='$CC -Tprelink_objects $reload_objs~
+	      '"$reload_cmds_CXX"
 	    ;;
 	  *)
 	    archive_cmds_CXX='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
@@ -15483,7 +14764,7 @@
         ;;
     esac
 
-    { $as_echo "$as_me:$LINENO: result: $ld_shlibs_CXX" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_CXX" >&5
 $as_echo "$ld_shlibs_CXX" >&6; }
     test "$ld_shlibs_CXX" = no && can_build_shared=no
 
@@ -15511,11 +14792,19 @@
 };
 _LT_EOF
 
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+
+_lt_libdeps_save_CFLAGS=$CFLAGS
+case "$CC $CFLAGS " in #(
+*\ -flto*\ *) CFLAGS="$CFLAGS -fno-lto" ;;
+*\ -fwhopr*\ *) CFLAGS="$CFLAGS -fno-whopr" ;;
+*\ -fuse-linker-plugin*\ *) CFLAGS="$CFLAGS -fno-use-linker-plugin" ;;
+esac
+
+if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
   # Parse the compiler output and extract the necessary
   # objects, libraries and library flags.
 
@@ -15524,7 +14813,7 @@
   pre_test_object_deps_done=no
 
   for p in `eval "$output_verbose_link_cmd"`; do
-    case $p in
+    case ${prev}${p} in
 
     -L* | -R* | -l*)
        # Some compilers place space between "-{L,R}" and the path.
@@ -15533,13 +14822,22 @@
           test $p = "-R"; then
 	 prev=$p
 	 continue
-       else
-	 prev=
        fi
 
+       # Expand the sysroot to ease extracting the directories later.
+       if test -z "$prev"; then
+         case $p in
+         -L*) func_stripname_cnf '-L' '' "$p"; prev=-L; p=$func_stripname_result ;;
+         -R*) func_stripname_cnf '-R' '' "$p"; prev=-R; p=$func_stripname_result ;;
+         -l*) func_stripname_cnf '-l' '' "$p"; prev=-l; p=$func_stripname_result ;;
+         esac
+       fi
+       case $p in
+       =*) func_stripname_cnf '=' '' "$p"; p=$lt_sysroot$func_stripname_result ;;
+       esac
        if test "$pre_test_object_deps_done" = no; then
-	 case $p in
-	 -L* | -R*)
+	 case ${prev} in
+	 -L | -R)
 	   # Internal compiler library paths should come after those
 	   # provided the user.  The postdeps already come after the
 	   # user supplied libs so there is no need to process them.
@@ -15559,8 +14857,10 @@
 	   postdeps_CXX="${postdeps_CXX} ${prev}${p}"
 	 fi
        fi
+       prev=
        ;;
 
+    *.lto.$objext) ;; # Ignore GCC LTO objects
     *.$objext)
        # This assumes that the test object file only shows up
        # once in the compiler output.
@@ -15596,6 +14896,7 @@
 fi
 
 $RM -f confest.$objext
+CFLAGS=$_lt_libdeps_save_CFLAGS
 
 # PORTME: override above test on systems where it is broken
 case $host_os in
@@ -15631,7 +14932,7 @@
 
 solaris*)
   case $cc_basename in
-  CC*)
+  CC* | sunCC*)
     # The more standards-conforming stlport4 library is
     # incompatible with the Cstd library. Avoid specifying
     # it if it's in CXXFLAGS. Ignore libCrun as
@@ -15696,8 +14997,6 @@
 lt_prog_compiler_pic_CXX=
 lt_prog_compiler_static_CXX=
 
-{ $as_echo "$as_me:$LINENO: checking for $compiler option to produce PIC" >&5
-$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
 
   # C++ specific cases for pic, static, wl, etc.
   if test "$GXX" = yes; then
@@ -15747,6 +15046,11 @@
       # DJGPP does not support shared libraries at all
       lt_prog_compiler_pic_CXX=
       ;;
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      lt_prog_compiler_static_CXX=
+      ;;
     interix[3-9]*)
       # Interix 3.x gcc -fpic/-fPIC options generate broken code.
       # Instead, we relocate shared libraries at runtime.
@@ -15796,6 +15100,11 @@
 	  ;;
 	esac
 	;;
+      mingw* | cygwin* | os2* | pw32* | cegcc*)
+	# This hack is so that the source file can tell whether it is being
+	# built for inclusion in a dll (and should export symbols for example).
+	lt_prog_compiler_pic_CXX='-DDLL_EXPORT'
+	;;
       dgux*)
 	case $cc_basename in
 	  ec++*)
@@ -15852,7 +15161,7 @@
 	    ;;
 	esac
 	;;
-      linux* | k*bsd*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
 	case $cc_basename in
 	  KCC*)
 	    # KAI C++ Compiler
@@ -15885,8 +15194,8 @@
 	    lt_prog_compiler_pic_CXX=
 	    lt_prog_compiler_static_CXX='-non_shared'
 	    ;;
-	  xlc* | xlC*)
-	    # IBM XL 8.0 on PPC
+	  xlc* | xlC* | bgxl[cC]* | mpixl[cC]*)
+	    # IBM XL 8.0, 9.0 on PPC and BlueGene
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_pic_CXX='-qpic'
 	    lt_prog_compiler_static_CXX='-qstaticlink'
@@ -15916,7 +15225,7 @@
 	    ;;
 	esac
 	;;
-      netbsd*)
+      netbsd* | netbsdelf*-gnu)
 	;;
       *qnx* | *nto*)
         # QNX uses GNU C++, but need to define -shared option too, otherwise
@@ -15948,7 +15257,7 @@
 	;;
       solaris*)
 	case $cc_basename in
-	  CC*)
+	  CC* | sunCC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    lt_prog_compiler_static_CXX='-Bstatic'
@@ -16013,18 +15322,25 @@
     lt_prog_compiler_pic_CXX="$lt_prog_compiler_pic_CXX -DPIC"
     ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $lt_prog_compiler_pic_CXX" >&5
-$as_echo "$lt_prog_compiler_pic_CXX" >&6; }
-
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
+if ${lt_cv_prog_compiler_pic_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_pic_CXX=$lt_prog_compiler_pic_CXX
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_pic_CXX" >&6; }
+lt_prog_compiler_pic_CXX=$lt_cv_prog_compiler_pic_CXX
 
 #
 # Check to make sure the PIC flag actually works.
 #
 if test -n "$lt_prog_compiler_pic_CXX"; then
-  { $as_echo "$as_me:$LINENO: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
 $as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works... " >&6; }
-if test "${lt_cv_prog_compiler_pic_works_CXX+set}" = set; then
+if ${lt_cv_prog_compiler_pic_works_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_pic_works_CXX=no
@@ -16040,15 +15356,15 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16043: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>conftest.err)
    ac_status=$?
    cat conftest.err >&5
-   echo "$as_me:16047: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s "$ac_outfile"; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings other than the usual output.
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' >conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
      $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
      if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_pic_works_CXX=yes
@@ -16057,7 +15373,7 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_pic_works_CXX" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_works_CXX" >&5
 $as_echo "$lt_cv_prog_compiler_pic_works_CXX" >&6; }
 
 if test x"$lt_cv_prog_compiler_pic_works_CXX" = xyes; then
@@ -16074,13 +15390,15 @@
 
 
 
+
+
 #
 # Check to make sure the static flag actually works.
 #
 wl=$lt_prog_compiler_wl_CXX eval lt_tmp_static_flag=\"$lt_prog_compiler_static_CXX\"
-{ $as_echo "$as_me:$LINENO: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
 $as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
-if test "${lt_cv_prog_compiler_static_works_CXX+set}" = set; then
+if ${lt_cv_prog_compiler_static_works_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_static_works_CXX=no
@@ -16093,7 +15411,7 @@
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1>&5
-       $ECHO "X$_lt_linker_boilerplate" | $Xsed -e '/^$/d' > conftest.exp
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
        $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
        if diff conftest.exp conftest.er2 >/dev/null; then
          lt_cv_prog_compiler_static_works_CXX=yes
@@ -16106,7 +15424,7 @@
    LDFLAGS="$save_LDFLAGS"
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_static_works_CXX" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_static_works_CXX" >&5
 $as_echo "$lt_cv_prog_compiler_static_works_CXX" >&6; }
 
 if test x"$lt_cv_prog_compiler_static_works_CXX" = xyes; then
@@ -16118,9 +15436,9 @@
 
 
 
-    { $as_echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
 $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o_CXX+set}" = set; then
+if ${lt_cv_prog_compiler_c_o_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o_CXX=no
@@ -16139,16 +15457,16 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16142: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:16146: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_c_o_CXX=yes
@@ -16165,14 +15483,14 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o_CXX" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_CXX" >&5
 $as_echo "$lt_cv_prog_compiler_c_o_CXX" >&6; }
 
 
 
-    { $as_echo "$as_me:$LINENO: checking if $compiler supports -c -o file.$ac_objext" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
 $as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
-if test "${lt_cv_prog_compiler_c_o_CXX+set}" = set; then
+if ${lt_cv_prog_compiler_c_o_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_c_o_CXX=no
@@ -16191,16 +15509,16 @@
    -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo "\"\$as_me:16194: $lt_compile\"" >&5)
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
    (eval "$lt_compile" 2>out/conftest.err)
    ac_status=$?
    cat out/conftest.err >&5
-   echo "$as_me:16198: \$? = $ac_status" >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
    if (exit $ac_status) && test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     $ECHO "X$_lt_compiler_boilerplate" | $Xsed -e '/^$/d' > out/conftest.exp
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
      $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
      if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
        lt_cv_prog_compiler_c_o_CXX=yes
@@ -16217,7 +15535,7 @@
    $RM conftest*
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_prog_compiler_c_o_CXX" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_CXX" >&5
 $as_echo "$lt_cv_prog_compiler_c_o_CXX" >&6; }
 
 
@@ -16226,7 +15544,7 @@
 hard_links="nottested"
 if test "$lt_cv_prog_compiler_c_o_CXX" = no && test "$need_locks" != no; then
   # do not overwrite the value of need_locks provided by the user
-  { $as_echo "$as_me:$LINENO: checking if we can lock with hard links" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
 $as_echo_n "checking if we can lock with hard links... " >&6; }
   hard_links=yes
   $RM conftest*
@@ -16234,10 +15552,10 @@
   touch conftest.a
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
-  { $as_echo "$as_me:$LINENO: result: $hard_links" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
 $as_echo "$hard_links" >&6; }
   if test "$hard_links" = no; then
-    { $as_echo "$as_me:$LINENO: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
 $as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
@@ -16247,33 +15565,46 @@
 
 
 
-    { $as_echo "$as_me:$LINENO: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
 $as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
 
   export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
+  exclude_expsyms_CXX='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
   case $host_os in
   aix[4-9]*)
     # If we're using GNU nm, then we don't want the "-C" option.
     # -C means demangle to AIX nm, but means don't demangle with GNU nm
+    # Also, AIX nm treats weak defined symbols like other global defined
+    # symbols, whereas GNU nm marks them as "W".
     if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-      export_symbols_cmds_CXX='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+      export_symbols_cmds_CXX='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
     else
       export_symbols_cmds_CXX='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
     fi
     ;;
   pw32*)
     export_symbols_cmds_CXX="$ltdll_cmds"
-  ;;
+    ;;
   cygwin* | mingw* | cegcc*)
-    export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/;/^.*[ ]__nm__/s/^.*[ ]__nm__\([^ ]*\)[ ][^ ]*/\1 DATA/;/^I[ ]/d;/^[AITW][ ]/s/.* //'\'' | sort | uniq > $export_symbols'
-  ;;
+    case $cc_basename in
+    cl*)
+      exclude_expsyms_CXX='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+      ;;
+    *)
+      export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/;s/^.*[ ]__nm__\([^ ]*\)[ ][^ ]*/\1 DATA/;/^I[ ]/d;/^[AITW][ ]/s/.* //'\'' | sort | uniq > $export_symbols'
+      exclude_expsyms_CXX='[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname'
+      ;;
+    esac
+    ;;
+  linux* | k*bsd*-gnu | gnu*)
+    link_all_deplibs_CXX=no
+    ;;
   *)
     export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
-  ;;
+    ;;
   esac
-  exclude_expsyms_CXX='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
 
-{ $as_echo "$as_me:$LINENO: result: $ld_shlibs_CXX" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_CXX" >&5
 $as_echo "$ld_shlibs_CXX" >&6; }
 test "$ld_shlibs_CXX" = no && can_build_shared=no
 
@@ -16301,46 +15632,52 @@
       # Test whether the compiler implicitly links with -lc since on some
       # systems, -lgcc has to come before -lc. If gcc already passes -lc
       # to ld, don't add -lc before -lgcc.
-      { $as_echo "$as_me:$LINENO: checking whether -lc should be explicitly linked in" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
 $as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
-      $RM conftest*
-      echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+if ${lt_cv_archive_cmds_need_lc_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  $RM conftest*
+	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
 
-      if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+	if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } 2>conftest.err; then
-        soname=conftest
-        lib=conftest
-        libobjs=conftest.$ac_objext
-        deplibs=
-        wl=$lt_prog_compiler_wl_CXX
-	pic_flag=$lt_prog_compiler_pic_CXX
-        compiler_flags=-v
-        linker_flags=-v
-        verstring=
-        output_objdir=.
-        libname=conftest
-        lt_save_allow_undefined_flag=$allow_undefined_flag_CXX
-        allow_undefined_flag_CXX=
-        if { (eval echo "$as_me:$LINENO: \"$archive_cmds_CXX 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\"") >&5
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
+	  soname=conftest
+	  lib=conftest
+	  libobjs=conftest.$ac_objext
+	  deplibs=
+	  wl=$lt_prog_compiler_wl_CXX
+	  pic_flag=$lt_prog_compiler_pic_CXX
+	  compiler_flags=-v
+	  linker_flags=-v
+	  verstring=
+	  output_objdir=.
+	  libname=conftest
+	  lt_save_allow_undefined_flag=$allow_undefined_flag_CXX
+	  allow_undefined_flag_CXX=
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds_CXX 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\""; } >&5
   (eval $archive_cmds_CXX 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1) 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-        then
-	  archive_cmds_need_lc_CXX=no
-        else
-	  archive_cmds_need_lc_CXX=yes
-        fi
-        allow_undefined_flag_CXX=$lt_save_allow_undefined_flag
-      else
-        cat conftest.err 1>&5
-      fi
-      $RM conftest*
-      { $as_echo "$as_me:$LINENO: result: $archive_cmds_need_lc_CXX" >&5
-$as_echo "$archive_cmds_need_lc_CXX" >&6; }
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+	  then
+	    lt_cv_archive_cmds_need_lc_CXX=no
+	  else
+	    lt_cv_archive_cmds_need_lc_CXX=yes
+	  fi
+	  allow_undefined_flag_CXX=$lt_save_allow_undefined_flag
+	else
+	  cat conftest.err 1>&5
+	fi
+	$RM conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_archive_cmds_need_lc_CXX" >&5
+$as_echo "$lt_cv_archive_cmds_need_lc_CXX" >&6; }
+      archive_cmds_need_lc_CXX=$lt_cv_archive_cmds_need_lc_CXX
       ;;
     esac
   fi
@@ -16408,9 +15745,7 @@
 
 
 
-
-
-    { $as_echo "$as_me:$LINENO: checking dynamic linker characteristics" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
 $as_echo_n "checking dynamic linker characteristics... " >&6; }
 
 library_names_spec=
@@ -16435,7 +15770,7 @@
 
 case $host_os in
 aix3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
@@ -16444,7 +15779,7 @@
   ;;
 
 aix[4-9]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   hardcode_into_libs=yes
@@ -16497,7 +15832,7 @@
   m68k)
     library_names_spec='$libname.ixlibrary $libname.a'
     # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$ECHO "X$lib" | $Xsed -e '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
     ;;
   esac
   ;;
@@ -16509,7 +15844,7 @@
   ;;
 
 bsdi[45]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
@@ -16528,8 +15863,9 @@
   need_version=no
   need_lib_prefix=no
 
-  case $GCC,$host_os in
-  yes,cygwin* | yes,mingw* | yes,pw32* | yes,cegcc*)
+  case $GCC,$cc_basename in
+  yes,*)
+    # gcc
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
     postinstall_cmds='base_file=`basename \${file}`~
@@ -16550,36 +15886,82 @@
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
       soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec="/usr/lib /lib/w32api /lib /usr/local/lib"
+
       ;;
     mingw* | cegcc*)
       # MinGW DLLs use traditional 'lib' prefix
       soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-      sys_lib_search_path_spec=`$CC -print-search-dirs | $GREP "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
-        # It is most probably a Windows format PATH printed by
-        # mingw gcc, but we are running on Cygwin. Gcc prints its search
-        # path with ; separators, and with drive letters. We can handle the
-        # drive letters (cygwin fileutils understands them), so leave them,
-        # especially as we might pass files found there to a mingw objdump,
-        # which wouldn't understand a cygwinified path. Ahh.
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-      else
-        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-      fi
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
       library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
+    dynamic_linker='Win32 ld.exe'
+    ;;
+
+  *,cl*)
+    # Native MSVC
+    libname_spec='$name'
+    soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+    library_names_spec='${libname}.dll.lib'
+
+    case $build_os in
+    mingw*)
+      sys_lib_search_path_spec=
+      lt_save_ifs=$IFS
+      IFS=';'
+      for lt_path in $LIB
+      do
+        IFS=$lt_save_ifs
+        # Let DOS variable expansion print the short 8.3 style file name.
+        lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
+        sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
+      done
+      IFS=$lt_save_ifs
+      # Convert to MSYS style.
+      sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([a-zA-Z]\\):| /\\1|g' -e 's|^ ||'`
+      ;;
+    cygwin*)
+      # Convert to unix form, then to dos form, then back to unix form
+      # but this time dos style (no spaces!) so that the unix form looks
+      # like /cygdrive/c/PROGRA~1:/cygdr...
+      sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
+      sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
+      sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      ;;
+    *)
+      sys_lib_search_path_spec="$LIB"
+      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
+        # It is most probably a Windows format PATH.
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      fi
+      # FIXME: find the short name or the path components, as spaces are
+      # common. (e.g. "Program Files" -> "PROGRA~1")
+      ;;
+    esac
+
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+    dynamic_linker='Win32 link.exe'
     ;;
 
   *)
+    # Assume MSVC wrapper
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    dynamic_linker='Win32 ld.exe'
     ;;
   esac
-  dynamic_linker='Win32 ld.exe'
   # FIXME: first we should search . and the directory the executable is in
   shlibpath_var=PATH
   ;;
@@ -16599,7 +15981,7 @@
   ;;
 
 dgux*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
@@ -16607,10 +15989,6 @@
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
-
 freebsd* | dragonfly*)
   # DragonFly does not have aout.  When/if they implement a new
   # versioning mechanism, adjust this.
@@ -16618,7 +15996,7 @@
     objformat=`/usr/bin/objformat`
   else
     case $host_os in
-    freebsd[123]*) objformat=aout ;;
+    freebsd[23].*) objformat=aout ;;
     *) objformat=elf ;;
     esac
   fi
@@ -16636,7 +16014,7 @@
   esac
   shlibpath_var=LD_LIBRARY_PATH
   case $host_os in
-  freebsd2*)
+  freebsd2.*)
     shlibpath_overrides_runpath=yes
     ;;
   freebsd3.[01]* | freebsdelf3.[01]*)
@@ -16655,13 +16033,16 @@
   esac
   ;;
 
-gnu*)
-  version_type=linux
+haiku*)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
+  dynamic_linker="$host_os runtime_loader"
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_var=LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
   hardcode_into_libs=yes
   ;;
 
@@ -16707,12 +16088,14 @@
     soname_spec='${libname}${release}${shared_ext}$major'
     ;;
   esac
-  # HP-UX runs *really* slowly unless shared libraries are mode 555.
+  # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
   postinstall_cmds='chmod 555 $lib'
+  # or fails outright, so override atomically:
+  install_override_mode=555
   ;;
 
 interix[3-9]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
@@ -16728,7 +16111,7 @@
     nonstopux*) version_type=nonstopux ;;
     *)
 	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
+		version_type=linux # correct to gnu/linux during the next big refactor
 	else
 		version_type=irix
 	fi ;;
@@ -16765,9 +16148,9 @@
   dynamic_linker=no
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu)
-  version_type=linux
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -16775,16 +16158,17 @@
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
+
   # Some binutils ld are patched to set DT_RUNPATH
-  save_LDFLAGS=$LDFLAGS
-  save_libdir=$libdir
-  eval "libdir=/foo; wl=\"$lt_prog_compiler_wl_CXX\"; \
-       LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec_CXX\""
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  if ${lt_cv_shlibpath_overrides_runpath+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_shlibpath_overrides_runpath=no
+    save_LDFLAGS=$LDFLAGS
+    save_libdir=$libdir
+    eval "libdir=/foo; wl=\"$lt_prog_compiler_wl_CXX\"; \
+	 LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec_CXX\""
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -16795,56 +16179,29 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then
-  shlibpath_overrides_runpath=yes
+if ac_fn_cxx_try_link "$LINENO"; then :
+  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then :
+  lt_cv_shlibpath_overrides_runpath=yes
 fi
-
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    LDFLAGS=$save_LDFLAGS
+    libdir=$save_libdir
 
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-  LDFLAGS=$save_LDFLAGS
-  libdir=$save_libdir
+  shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
 
   # This implies no fast_install, which is unacceptable.
   # Some rework will be needed to allow for fast_install
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Add ABI-specific directories to the system library path.
-  sys_lib_dlsearch_path_spec="/lib64 /usr/lib64 /lib /usr/lib"
-
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
-    sys_lib_dlsearch_path_spec="$sys_lib_dlsearch_path_spec $lt_ld_extra"
+    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
+    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
   fi
 
   # We used to test for /lib/ld.so.1 and disable shared libraries on
@@ -16856,6 +16213,18 @@
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
+netbsdelf*-gnu)
+  version_type=linux
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='NetBSD ld.elf_so'
+  ;;
+
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -16875,7 +16244,7 @@
   ;;
 
 newsos6)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
@@ -16944,7 +16313,7 @@
   ;;
 
 solaris*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -16969,7 +16338,7 @@
   ;;
 
 sysv4 | sysv4.3*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -16993,7 +16362,7 @@
 
 sysv4*MP*)
   if test -d /usr/nec ;then
-    version_type=linux
+    version_type=linux # correct to gnu/linux during the next big refactor
     library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
     soname_spec='$libname${shared_ext}.$major'
     shlibpath_var=LD_LIBRARY_PATH
@@ -17024,7 +16393,7 @@
 
 tpf*)
   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -17034,7 +16403,7 @@
   ;;
 
 uts4*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
@@ -17044,7 +16413,7 @@
   dynamic_linker=no
   ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $dynamic_linker" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
 $as_echo "$dynamic_linker" >&6; }
 test "$dynamic_linker" = no && can_build_shared=no
 
@@ -17095,7 +16464,9 @@
 
 
 
-    { $as_echo "$as_me:$LINENO: checking how to hardcode library paths into programs" >&5
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
 $as_echo_n "checking how to hardcode library paths into programs... " >&6; }
 hardcode_action_CXX=
 if test -n "$hardcode_libdir_flag_spec_CXX" ||
@@ -17120,7 +16491,7 @@
   # directories.
   hardcode_action_CXX=unsupported
 fi
-{ $as_echo "$as_me:$LINENO: result: $hardcode_action_CXX" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action_CXX" >&5
 $as_echo "$hardcode_action_CXX" >&6; }
 
 if test "$hardcode_action_CXX" = relink ||
@@ -17142,6 +16513,7 @@
   fi # test -n "$compiler"
 
   CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
   LDCXX=$LD
   LD=$lt_save_LD
   GCC=$lt_save_GCC
@@ -17170,6 +16542,8 @@
 
 
 
+
+
         ac_config_commands="$ac_config_commands libtool"
 
 
@@ -17180,9 +16554,7 @@
 
 
 if test x"$enable_static$enable_all_static" = xnoyes; then
-  { { $as_echo "$as_me:$LINENO: error: You cannot pass --enable-all-static without one of --enable-static or --disable-shared" >&5
-$as_echo "$as_me: error: You cannot pass --enable-all-static without one of --enable-static or --disable-shared" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "You cannot pass --enable-all-static without one of --enable-static or --disable-shared" "$LINENO" 5
 fi
  if test $enable_static = yes; then
   CR_ENABLE_STATIC_TRUE=
@@ -17207,9 +16579,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_RPMBUILD+set}" = set; then
+if ${ac_cv_path_RPMBUILD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $RPMBUILD in
@@ -17223,14 +16595,14 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_RPMBUILD="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   ;;
@@ -17238,10 +16610,10 @@
 fi
 RPMBUILD=$ac_cv_path_RPMBUILD
 if test -n "$RPMBUILD"; then
-  { $as_echo "$as_me:$LINENO: result: $RPMBUILD" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RPMBUILD" >&5
 $as_echo "$RPMBUILD" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17275,9 +16647,9 @@
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -17288,24 +16660,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17315,9 +16687,9 @@
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -17328,24 +16700,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17354,7 +16726,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -17368,9 +16740,9 @@
           if test -n "$ac_tool_prefix"; then
     # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -17381,24 +16753,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17408,9 +16780,9 @@
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -17422,18 +16794,18 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
      fi
     ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
@@ -17452,10 +16824,10 @@
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17467,9 +16839,9 @@
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -17480,24 +16852,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17511,9 +16883,9 @@
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -17524,24 +16896,24 @@
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -17554,7 +16926,7 @@
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -17565,62 +16937,42 @@
 fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
 $as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+if ${ac_cv_c_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -17634,37 +16986,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
 $as_echo "$ac_cv_c_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GCC=yes
@@ -17673,20 +17004,16 @@
 fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -17697,35 +17024,11 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -17736,36 +17039,12 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -17776,42 +17055,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
 $as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
@@ -17828,23 +17082,18 @@
     CFLAGS=
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -17896,32 +17145,9 @@
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -17932,17 +17158,19 @@
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
 $as_echo "none needed" >&6; } ;;
   xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
 $as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
 $as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -17952,9 +17180,9 @@
 
 depcc="$CC"   am_compiler_list=
 
-{ $as_echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
 $as_echo_n "checking dependency style of $depcc... " >&6; }
-if test "${am_cv_CC_dependencies_compiler_type+set}" = set; then
+if ${am_cv_CC_dependencies_compiler_type+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
@@ -17963,6 +17191,7 @@
   # instance it was reported that on HP-UX the gcc test will end up
   # making a dummy file named `D' -- because `-MD' means `put the output
   # in D'.
+  rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
   # using a relative directory.
@@ -18022,7 +17251,7 @@
 	break
       fi
       ;;
-    msvisualcpp | msvcmsys)
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
       # This compiler won't grok `-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
@@ -18062,7 +17291,7 @@
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $am_cv_CC_dependencies_compiler_type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CC_dependencies_compiler_type" >&5
 $as_echo "$am_cv_CC_dependencies_compiler_type" >&6; }
 CCDEPMODE=depmode=$am_cv_CC_dependencies_compiler_type
 
@@ -18108,13 +17337,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -18122,8 +17351,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -18145,47 +17374,50 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-   { { $as_echo "$as_me:$LINENO: error: the C compiler '$CC' is not a GNU C compiler." >&5
-$as_echo "$as_me: error: the C compiler '$CC' is not a GNU C compiler." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "the C compiler '$CC' is not a GNU C compiler." "$LINENO" 5
   fi
 
 
 
 # Configure inlining (XXX: need to probe gcc for support?)
 
-cat >>confdefs.h <<\_ACEOF
-#define CR_INLINE static __inline__ __attribute__ ((__unused__))
-_ACEOF
+$as_echo "#define CR_INLINE static __inline__ __attribute__ ((__unused__))" >>confdefs.h
 
 
 # Check for additional flags needed when building libcr
 if test x"$cr_build_libcr" = xyes; then
 CR_LIBCR_CFLAGS=""
 
-    { $as_echo "$as_me:$LINENO: checking whether gcc accepts -Wall" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether gcc accepts -Wall" >&5
 $as_echo_n "checking whether gcc accepts -Wall... " >&6; }
-if test "${cr_cv_gcc_flag_WALL+set}" = set; then
+if ${cr_cv_gcc_flag_WALL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
     SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS -Wall"
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -18196,37 +17428,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   cr_cv_gcc_flag_WALL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cr_cv_gcc_flag_WALL=no
+  cr_cv_gcc_flag_WALL=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
     CFLAGS=$SAVE_CFLAGS
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_gcc_flag_WALL" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_gcc_flag_WALL" >&5
 $as_echo "$cr_cv_gcc_flag_WALL" >&6; }
 
   if eval test $cr_cv_gcc_flag_WALL = yes; then
@@ -18237,19 +17448,15 @@
 
 
 
-    { $as_echo "$as_me:$LINENO: checking whether gcc accepts -Wno-unused-function" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether gcc accepts -Wno-unused-function" >&5
 $as_echo_n "checking whether gcc accepts -Wno-unused-function... " >&6; }
-if test "${cr_cv_gcc_flag_WNO_UNUSED_FUNCTION+set}" = set; then
+if ${cr_cv_gcc_flag_WNO_UNUSED_FUNCTION+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
     SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS -Wno-unused-function"
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -18260,37 +17467,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   cr_cv_gcc_flag_WNO_UNUSED_FUNCTION=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cr_cv_gcc_flag_WNO_UNUSED_FUNCTION=no
+  cr_cv_gcc_flag_WNO_UNUSED_FUNCTION=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
     CFLAGS=$SAVE_CFLAGS
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_gcc_flag_WNO_UNUSED_FUNCTION" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_gcc_flag_WNO_UNUSED_FUNCTION" >&5
 $as_echo "$cr_cv_gcc_flag_WNO_UNUSED_FUNCTION" >&6; }
 
   if eval test $cr_cv_gcc_flag_WNO_UNUSED_FUNCTION = yes; then
@@ -18318,17 +17504,13 @@
 # Check for a sufficiently new glibc
 # XXX: What is our true lower bound?
 
-    { $as_echo "$as_me:$LINENO: checking for GNU libc version >= 2.2" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU libc version >= 2.2" >&5
 $as_echo_n "checking for GNU libc version >= 2.2... " >&6; }
-if test "${cr_cv_check_glibc_2_2_or_higher+set}" = set; then
+if ${cr_cv_check_glibc_2_2_or_higher+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 	#include <features.h>
@@ -18351,41 +17533,16 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   cr_cv_check_glibc_2_2_or_higher=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cr_cv_check_glibc_2_2_or_higher=no
+  cr_cv_check_glibc_2_2_or_higher=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_check_glibc_2_2_or_higher" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_check_glibc_2_2_or_higher" >&5
 $as_echo "$cr_cv_check_glibc_2_2_or_higher" >&6; }
 
   if eval test $cr_cv_check_glibc_2_2_or_higher = yes; then
@@ -18418,13 +17575,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -18432,8 +17589,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -18455,37 +17612,42 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-   { { $as_echo "$as_me:$LINENO: error: the C library does not appear to be glibc 2.2 or higher." >&5
-$as_echo "$as_me: error: the C library does not appear to be glibc 2.2 or higher." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "the C library does not appear to be glibc 2.2 or higher." "$LINENO" 5
   fi
 
 
 
 # Checks for required libraries and fail if they are not found
 # Note that we are NOT adding them to LIBS, just verifying their presence.
-{ $as_echo "$as_me:$LINENO: checking for dlsym in -ldl" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlsym in -ldl" >&5
 $as_echo_n "checking for dlsym in -ldl... " >&6; }
-if test "${ac_cv_lib_dl_dlsym+set}" = set; then
+if ${ac_cv_lib_dl_dlsym+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldl  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -18503,43 +17665,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_dl_dlsym=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_dl_dlsym=no
+  ac_cv_lib_dl_dlsym=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_dl_dlsym" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlsym" >&5
 $as_echo "$ac_cv_lib_dl_dlsym" >&6; }
-if test "x$ac_cv_lib_dl_dlsym" = x""yes; then
+if test "x$ac_cv_lib_dl_dlsym" = xyes; then :
   :
 else
   cat >confcache <<\_ACEOF
@@ -18569,13 +17706,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -18583,8 +17720,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -18606,33 +17743,38 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-   { { $as_echo "$as_me:$LINENO: error: required library libdl not found." >&5
-$as_echo "$as_me: error: required library libdl not found." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "required library libdl not found." "$LINENO" 5
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_create in -lpthread" >&5
 $as_echo_n "checking for pthread_create in -lpthread... " >&6; }
-if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
+if ${ac_cv_lib_pthread_pthread_create+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lpthread  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -18650,43 +17792,18 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_pthread_pthread_create=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_pthread_pthread_create=no
+  ac_cv_lib_pthread_pthread_create=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_create" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_create" >&5
 $as_echo "$ac_cv_lib_pthread_pthread_create" >&6; }
-if test "x$ac_cv_lib_pthread_pthread_create" = x""yes; then
+if test "x$ac_cv_lib_pthread_pthread_create" = xyes; then :
   :
 else
   cat >confcache <<\_ACEOF
@@ -18716,13 +17833,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -18730,8 +17847,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -18753,19 +17870,28 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-   { { $as_echo "$as_me:$LINENO: error: required library libpthread not found." >&5
-$as_echo "$as_me: error: required library libpthread not found." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "required library libpthread not found." "$LINENO" 5
 fi
 
 
@@ -18783,36 +17909,29 @@
 
 
 # Look for LinuxThreads in the default (probably dynamic) library
-{ $as_echo "$as_me:$LINENO: checking whether default pthreads library is LinuxThreads" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether default pthreads library is LinuxThreads" >&5
 $as_echo_n "checking whether default pthreads library is LinuxThreads... " >&6; }
-if test "${cr_cv_pt_default_lt+set}" = set; then
+if ${cr_cv_pt_default_lt+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
   SAVE_LIBS="$LIBS"
   LIBS="-lpthread $LIBS"
 
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
 
 
   if test "${cross_linuxthreads-unset}" = unset; then
-    { { $as_echo "$as_me:$LINENO: error: When cross-compiling, variable cross_linuxthreads must be set." >&5
-$as_echo "$as_me: error: When cross-compiling, variable cross_linuxthreads must be set." >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "When cross-compiling, variable cross_linuxthreads must be set." "$LINENO" 5
   fi
 
-    if test x"$cross_linuxthreads" != x0; then
+    if test x"$cross_linuxthreads" != x0; then :
   cr_cv_pt_default_lt=yes
 else
   cr_cv_pt_default_lt=no
 fi
-
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 	#include <sys/types.h>
@@ -18839,60 +17958,31 @@
 	    return ((long)join_val == (long)getpid());
 	}
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
   cr_cv_pt_default_lt=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-cr_cv_pt_default_lt=no
+  cr_cv_pt_default_lt=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
 
-
   LIBS="$SAVE_LIBS"
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_pt_default_lt" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_pt_default_lt" >&5
 $as_echo "$cr_cv_pt_default_lt" >&6; }
 if test x"$cr_cv_pt_default_lt" = xyes; then
-  { { $as_echo "$as_me:$LINENO: error: linking of BLCR to LinuxThreads is NOT supported.  Please try LDFLAGS='$ldsuggest' (or similar) on the configure command line to get NPTL." >&5
-$as_echo "$as_me: error: linking of BLCR to LinuxThreads is NOT supported.  Please try LDFLAGS='$ldsuggest' (or similar) on the configure command line to get NPTL." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "linking of BLCR to LinuxThreads is NOT supported.  Please try LDFLAGS='$ldsuggest' (or similar) on the configure command line to get NPTL." "$LINENO" 5
 fi
 
 # Now look for LinuxThreads in the static libs if we are building static ones ourself
 if test x"$enable_static" = xyes; then
   # Look for LinuxThreads in the static library
-  { $as_echo "$as_me:$LINENO: checking whether static pthreads library is LinuxThreads" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether static pthreads library is LinuxThreads" >&5
 $as_echo_n "checking whether static pthreads library is LinuxThreads... " >&6; }
-if test "${cr_cv_pt_static_lt+set}" = set; then
+if ${cr_cv_pt_static_lt+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -18901,27 +17991,20 @@
     LDFLAGS="$LDFLAGS -static"
     LIBS="-lpthread $LIBS"
 
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
 
 
   if test "${cross_linuxthreads_static-unset}" = unset; then
-    { { $as_echo "$as_me:$LINENO: error: When cross-compiling, variable cross_linuxthreads_static must be set." >&5
-$as_echo "$as_me: error: When cross-compiling, variable cross_linuxthreads_static must be set." >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "When cross-compiling, variable cross_linuxthreads_static must be set." "$LINENO" 5
   fi
 
-    if test x"$cross_linuxthreads_static" != x0; then
+    if test x"$cross_linuxthreads_static" != x0; then :
   cr_cv_pt_static_lt=yes
 else
   cr_cv_pt_static_lt=no
 fi
-
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 	#include <sys/types.h>
@@ -18948,51 +18031,24 @@
 	    return ((long)join_val == (long)getpid());
 	}
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
   cr_cv_pt_static_lt=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-cr_cv_pt_static_lt=no
+  cr_cv_pt_static_lt=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
 
-
     LIBS="$SAVE_LIBS"
     LDFLAGS="$SAVE_LDFLAGS"
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_pt_static_lt" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_pt_static_lt" >&5
 $as_echo "$cr_cv_pt_static_lt" >&6; }
   if test x"$cr_cv_pt_static_lt" = xyes; then
-    { $as_echo "$as_me:$LINENO: WARNING: static linking with pthreads appears to yield LinuxThreads, but BLCR supports only NPTL." >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: static linking with pthreads appears to yield LinuxThreads, but BLCR supports only NPTL." >&5
 $as_echo "$as_me: WARNING: static linking with pthreads appears to yield LinuxThreads, but BLCR supports only NPTL." >&2;}
     cr_static_link_warning="yes"
     if test x"$enable_all_static" = xyes; then
@@ -19023,13 +18079,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -19037,8 +18093,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -19060,6107 +18116,1958 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
 rm -f confcache
-      { { $as_echo "$as_me:$LINENO: error: static linking of BLCR to LinuxThreads is NOT supported.  Please try LDFLAGS='$ldsuggest' (or similar) on the configure command line to get NPTL." >&5
-$as_echo "$as_me: error: static linking of BLCR to LinuxThreads is NOT supported.  Please try LDFLAGS='$ldsuggest' (or similar) on the configure command line to get NPTL." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "static linking of BLCR to LinuxThreads is NOT supported.  Please try LDFLAGS='$ldsuggest' (or similar) on the configure command line to get NPTL." "$LINENO" 5
     fi
   fi
 fi
 
 # Check for atfork handling
-
 for ac_func in __register_atfork
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+do :
+  ac_fn_c_check_func "$LINENO" "__register_atfork" "ac_cv_func___register_atfork"
+if test "x$ac_cv_func___register_atfork" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE___REGISTER_ATFORK 1
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
 
-#undef $ac_func
+fi
+done
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
 
-int
-main ()
-{
-return $ac_func ();
-  ;
-  return 0;
-}
+# Check for call to disable NSCD
+for ac_func in __nss_disable_nscd
+do :
+  ac_fn_c_check_func "$LINENO" "__nss_disable_nscd" "ac_cv_func___nss_disable_nscd"
+if test "x$ac_cv_func___nss_disable_nscd" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE___NSS_DISABLE_NSCD 1
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	eval "$as_ac_var=no"
 fi
+done
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+
+# Check for pthread_attr_setstacksize
+SAVE_LIBS="$LIBS"
+LIBS="-lpthread $LIBS"
+for ac_func in pthread_attr_setstacksize
+do :
+  ac_fn_c_check_func "$LINENO" "pthread_attr_setstacksize" "ac_cv_func_pthread_attr_setstacksize"
+if test "x$ac_cv_func_pthread_attr_setstacksize" = xyes; then :
   cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+#define HAVE_PTHREAD_ATTR_SETSTACKSIZE 1
 _ACEOF
 
 fi
 done
 
+LIBS="$SAVE_LIBS"
 
-# Check for call to disable NSCD
-
-for ac_func in __nss_disable_nscd
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
+# Look for prctl(PR_SET_PDEATHSIG, ...)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for pctrl()" >&5
+$as_echo_n "checking for pctrl()... " >&6; }
+if ${cr_cv_prctl+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
 
-#undef $ac_func
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
+    #include <sys/prctl.h>
 
 int
 main ()
 {
-return $ac_func ();
+
+    int rc = prctl(PR_SET_PDEATHSIG, 0);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
+if ac_fn_c_try_compile "$LINENO"; then :
+  cr_cv_prctl=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_var=no"
+  cr_cv_prctl=no
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
 fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_prctl" >&5
+$as_echo "$cr_cv_prctl" >&6; }
 
-fi
-done
+  if test x$cr_cv_prctl = xyes; then
+    $as_echo "#define HAVE_PRCTL 1" >>confdefs.h
 
+  else
+    $as_echo "#define HAVE_PRCTL 0" >>confdefs.h
 
-# Check for pthread_attr_setstacksize
-SAVE_LIBS="$LIBS"
-LIBS="-lpthread $LIBS"
+  fi
 
-for ac_func in pthread_attr_setstacksize
-do
-as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_func" >&5
-$as_echo_n "checking for $ac_func... " >&6; }
-if { as_var=$as_ac_var; eval "test \"\${$as_var+set}\" = set"; }; then
+
+
+# Check various constants needed for asm
+SAVE_CFLAGS="$CFLAGS"
+CFLAGS="$CFLAGS -I${TOP_SRCDIR}/include"
+
+    CR_ASM_OP_HAND_CHKPT=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_OP_HAND_CHKPT" >&5
+$as_echo_n "checking for value for CR_ASM_OP_HAND_CHKPT... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define $ac_func innocuous_$ac_func
 
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char $ac_func (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
+    cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT="not found"
+    if ac_fn_c_compute_int "$LINENO" "CR_OP_HAND_CHKPT" "cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT"        "#include <sys/ioctl.h>
+	 #include \"blcr_ioctl.h\""; then :
 
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
+fi
 
-#undef $ac_func
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char $ac_func ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_$ac_func || defined __stub___$ac_func
-choke me
-#endif
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT" != "not found"; then
+    CR_ASM_OP_HAND_CHKPT="$cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT"
+  fi
 
-int
-main ()
-{
-return $ac_func ();
-  ;
-  return 0;
-}
+  if test -n "$CR_ASM_OP_HAND_CHKPT"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_OP_HAND_CHKPT $CR_ASM_OP_HAND_CHKPT
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  eval "$as_ac_var=yes"
+
+
+  fi
+
+
+    CR_ASM_CHECKPOINT_STUB=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_CHECKPOINT_STUB" >&5
+$as_echo_n "checking for value for CR_ASM_CHECKPOINT_STUB... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	eval "$as_ac_var=no"
+    cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB="not found"
+    if ac_fn_c_compute_int "$LINENO" "_CR_CHECKPOINT_STUB" "cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB"        "#include \"blcr_common.h.in\""; then :
+
 fi
 
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+
 fi
-ac_res=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_var'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB" != "not found"; then
+    CR_ASM_CHECKPOINT_STUB="$cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB"
+  fi
+
+  if test -n "$CR_ASM_CHECKPOINT_STUB"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_CHECKPOINT_STUB $CR_ASM_CHECKPOINT_STUB
 _ACEOF
 
-fi
-done
 
-LIBS="$SAVE_LIBS"
+  fi
+    # ICK!
 
-# Look for prctl(PR_SET_PDEATHSIG, ...)
-{ $as_echo "$as_me:$LINENO: checking for pctrl()" >&5
-$as_echo_n "checking for pctrl()... " >&6; }
-if test "${cr_cv_prctl+set}" = set; then
+    CR_ASM_OP_HAND_ABORT=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_OP_HAND_ABORT" >&5
+$as_echo_n "checking for value for CR_ASM_OP_HAND_ABORT... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_OP_HAND_ABORT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+    cr_cv_compute_int_CR_ASM_OP_HAND_ABORT="not found"
+    if ac_fn_c_compute_int "$LINENO" "CR_OP_HAND_ABORT" "cr_cv_compute_int_CR_ASM_OP_HAND_ABORT"        "#include <sys/ioctl.h>
+	 #include \"blcr_ioctl.h\""; then :
 
-    #include <sys/prctl.h>
+fi
 
-int
-main ()
-{
 
-    int rc = prctl(PR_SET_PDEATHSIG, 0);
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_OP_HAND_ABORT" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_OP_HAND_ABORT" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_OP_HAND_ABORT" != "not found"; then
+    CR_ASM_OP_HAND_ABORT="$cr_cv_compute_int_CR_ASM_OP_HAND_ABORT"
+  fi
 
-  ;
-  return 0;
-}
+  if test -n "$CR_ASM_OP_HAND_ABORT"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_OP_HAND_ABORT $CR_ASM_OP_HAND_ABORT
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cr_cv_prctl=yes
+
+
+  fi
+
+
+    CR_ASM_CHECKPOINT_OMIT=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_CHECKPOINT_OMIT" >&5
+$as_echo_n "checking for value for CR_ASM_CHECKPOINT_OMIT... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cr_cv_prctl=no
+    cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT="not found"
+    if ac_fn_c_compute_int "$LINENO" "CR_CHECKPOINT_OMIT" "cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT"        "#include \"blcr_common.h.in\""; then :
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_prctl" >&5
-$as_echo "$cr_cv_prctl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT" != "not found"; then
+    CR_ASM_CHECKPOINT_OMIT="$cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT"
+  fi
 
-  if test x$cr_cv_prctl = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PRCTL 1
+  if test -n "$CR_ASM_CHECKPOINT_OMIT"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_CHECKPOINT_OMIT $CR_ASM_CHECKPOINT_OMIT
 _ACEOF
 
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PRCTL 0
-_ACEOF
 
   fi
+    # ICK!
 
+    CR_ASM_SI_PID_OFFSET=""
 
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_SI_PID_OFFSET" >&5
+$as_echo_n "checking for value for CR_ASM_SI_PID_OFFSET... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_SI_PID_OFFSET+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
+    cr_cv_compute_int_CR_ASM_SI_PID_OFFSET="not found"
+    if ac_fn_c_compute_int "$LINENO" "offsetof(siginfo_t, si_pid)" "cr_cv_compute_int_CR_ASM_SI_PID_OFFSET"        "#include <signal.h>
+	 #include <stddef.h>
+	 #ifndef offsetof
+  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
+	 #endif"; then :
 
-# Check various constants needed for asm
-SAVE_CFLAGS="$CFLAGS"
-CFLAGS="$CFLAGS -I${TOP_SRCDIR}/include"
+fi
 
-    CR_ASM_OP_HAND_CHKPT=""
 
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_OP_HAND_CHKPT" >&5
-$as_echo_n "checking for value for CR_ASM_OP_HAND_CHKPT... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_SI_PID_OFFSET" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_SI_PID_OFFSET" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_SI_PID_OFFSET" != "not found"; then
+    CR_ASM_SI_PID_OFFSET="$cr_cv_compute_int_CR_ASM_SI_PID_OFFSET"
+  fi
 
-    cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+  if test -n "$CR_ASM_SI_PID_OFFSET"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_SI_PID_OFFSET $CR_ASM_SI_PID_OFFSET
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_CHKPT) >= 0)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_CHKPT) <= $ac_mid)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+  fi
+
+
+    CR_ASM_NR_ioctl=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_NR_ioctl" >&5
+$as_echo_n "checking for value for CR_ASM_NR_ioctl... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_NR_ioctl+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
+    cr_cv_compute_int_CR_ASM_NR_ioctl="not found"
+    if ac_fn_c_compute_int "$LINENO" "__NR_ioctl" "cr_cv_compute_int_CR_ASM_NR_ioctl"        "#include <asm/unistd.h>
+	 #include <linux/unistd.h>"; then :
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_CHKPT) < 0)];
-test_array [0] = 0
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_NR_ioctl" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_NR_ioctl" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_NR_ioctl" != "not found"; then
+    CR_ASM_NR_ioctl="$cr_cv_compute_int_CR_ASM_NR_ioctl"
+  fi
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+  if test -n "$CR_ASM_NR_ioctl"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_NR_ioctl $CR_ASM_NR_ioctl
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_CHKPT) >= $ac_mid)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
+  fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+
+    CR_ASM_NR_rt_sigreturn=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_ASM_NR_rt_sigreturn" >&5
+$as_echo_n "checking for value for CR_ASM_NR_rt_sigreturn... " >&6; }
+if ${cr_cv_compute_int_CR_ASM_NR_rt_sigreturn+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
+    cr_cv_compute_int_CR_ASM_NR_rt_sigreturn="not found"
+    if ac_fn_c_compute_int "$LINENO" "__NR_rt_sigreturn" "cr_cv_compute_int_CR_ASM_NR_rt_sigreturn"        "#include <asm/unistd.h>
+	 #include <linux/unistd.h>"; then :
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_ASM_NR_rt_sigreturn" >&5
+$as_echo "$cr_cv_compute_int_CR_ASM_NR_rt_sigreturn" >&6; }
+  if test "$cr_cv_compute_int_CR_ASM_NR_rt_sigreturn" != "not found"; then
+    CR_ASM_NR_rt_sigreturn="$cr_cv_compute_int_CR_ASM_NR_rt_sigreturn"
+  fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+  if test -n "$CR_ASM_NR_rt_sigreturn"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_ASM_NR_rt_sigreturn $CR_ASM_NR_rt_sigreturn
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_CHKPT) <= $ac_mid)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
+
+  fi
+
+CFLAGS="$SAVE_CFLAGS"
+
+# Probe for direction of stack growth
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for direction of stack growth" >&5
+$as_echo_n "checking for direction of stack growth... " >&6; }
+if ${cr_cv_check_stack_direction+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
+   if test "$cross_compiling" = yes; then :
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT=$ac_lo;;
-'')  ;;
-esac
+  if test "${cross_stack_direction-unset}" = unset; then
+    as_fn_error $? "When cross-compiling, variable cross_stack_direction must be set." "$LINENO" 5
+  fi
+
+	 if test $cross_stack_direction = 1; then
+	   cr_cv_check_stack_direction=up
+	 else
+	   cr_cv_check_stack_direction=down
+	 fi
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-static long int longval () { return CR_OP_HAND_CHKPT; }
-static unsigned long int ulongval () { return CR_OP_HAND_CHKPT; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((CR_OP_HAND_CHKPT) < 0)
-    {
-      long int i = longval ();
-      if (i != (CR_OP_HAND_CHKPT))
-	return 1;
-      fprintf (f, "%ld", i);
+    int find_stack_direction (void) {
+      static char *addr = 0;
+      auto char dummy;
+      if (addr == 0) {
+        addr = &dummy;
+        return find_stack_direction();
+      } else {
+        return (&dummy > addr) ? 0 : 1;
+      }
     }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (CR_OP_HAND_CHKPT))
-	return 1;
-      fprintf (f, "%lu", i);
+    int main(void) {
+      return find_stack_direction();
     }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT=`cat conftest.val`
+if ac_fn_c_try_run "$LINENO"; then :
+  cr_cv_check_stack_direction=up
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+  cr_cv_check_stack_direction=down
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
-rm -f conftest.val
+
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT" != "not found"; then
-    CR_ASM_OP_HAND_CHKPT="$cr_cv_compute_int_CR_ASM_OP_HAND_CHKPT"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_check_stack_direction" >&5
+$as_echo "$cr_cv_check_stack_direction" >&6; }
+  if test $cr_cv_check_stack_direction = up; then
+    cr_stack_direction=1
+  else
+    cr_stack_direction=-1
   fi
-
-  if test -n "$CR_ASM_OP_HAND_CHKPT"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_OP_HAND_CHKPT $CR_ASM_OP_HAND_CHKPT
+  cat >>confdefs.h <<_ACEOF
+#define CR_STACK_GROWTH $cr_stack_direction
 _ACEOF
 
 
 
-  fi
-
-
-    CR_ASM_CHECKPOINT_STUB=""
 
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_CHECKPOINT_STUB" >&5
-$as_echo_n "checking for value for CR_ASM_CHECKPOINT_STUB... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB+set}" = set; then
+# Look for FTB header and libs
+ cr_have_ftb=no
+ if test x"$FTB_HOME" != xno; then
+  cr_have_ftb=yes
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  CR_FTB_INCLUDES=""
+  CR_FTB_LDFLAGS=""
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FTB headers" >&5
+$as_echo_n "checking for FTB headers... " >&6; }
+if ${cr_cv_ftb_incdir+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+    cr_result=no
+    for cr_tmp in "" "${FTB_HOME}/include"; do
+      CPPFLAGS="$SAVE_CPPFLAGS${cr_tmp:+ -I$cr_tmp}"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include "blcr_common.h.in"
+
+        #include <libftb.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((_CR_CHECKPOINT_STUB) >= 0)];
-test_array [0] = 0
+
+        FTB_client_t x;
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  cr_result="$cr_tmp"; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    done
+    if test -z "$cr_result"; then
+      cr_cv_ftb_incdir="default"
+    else
+      cr_cv_ftb_incdir="$cr_result"
+    fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_ftb_incdir" >&5
+$as_echo "$cr_cv_ftb_incdir" >&6; }
+  if test x"$cr_cv_ftb_incdir" = xno; then
+    cr_have_ftb=no
+  elif test x"$cr_cv_ftb_incdir" != "xdefault"; then
+    CR_FTB_INCLUDES="-I$cr_cv_ftb_incdir"
+  fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FTB libs" >&5
+$as_echo_n "checking for FTB libs... " >&6; }
+if ${cr_cv_ftb_libdir+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    CPPFLAGS="$SAVE_CPPFLAGS $CR_FTB_INCLUDES"
+    LIBS="-lftb -lpthread $SAVE_LIBS"
+    cr_result=no
+    for cr_tmp in "" "${FTB_HOME}/lib64" "${FTB_HOME}/lib32" "${FTB_HOME}/lib"; do
+      LDFLAGS="$SAVE_LDFLAGS${cr_tmp:+-L$cr_tmp}"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include "blcr_common.h.in"
+
+        #include <libftb.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((_CR_CHECKPOINT_STUB) <= $ac_mid)];
-test_array [0] = 0
+
+        return FTB_Connect(NULL, NULL);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((_CR_CHECKPOINT_STUB) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((_CR_CHECKPOINT_STUB) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((_CR_CHECKPOINT_STUB) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-static long int longval () { return _CR_CHECKPOINT_STUB; }
-static unsigned long int ulongval () { return _CR_CHECKPOINT_STUB; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((_CR_CHECKPOINT_STUB) < 0)
-    {
-      long int i = longval ();
-      if (i != (_CR_CHECKPOINT_STUB))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (_CR_CHECKPOINT_STUB))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB" != "not found"; then
-    CR_ASM_CHECKPOINT_STUB="$cr_cv_compute_int_CR_ASM_CHECKPOINT_STUB"
-  fi
-
-  if test -n "$CR_ASM_CHECKPOINT_STUB"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_CHECKPOINT_STUB $CR_ASM_CHECKPOINT_STUB
-_ACEOF
-
-
-
-  fi
-    # ICK!
-
-    CR_ASM_OP_HAND_ABORT=""
-
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_OP_HAND_ABORT" >&5
-$as_echo_n "checking for value for CR_ASM_OP_HAND_ABORT... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_OP_HAND_ABORT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_compute_int_CR_ASM_OP_HAND_ABORT="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_ABORT) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_ABORT) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_ABORT) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_ABORT) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_OP_HAND_ABORT) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_OP_HAND_ABORT=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sys/ioctl.h>
-	 #include "blcr_ioctl.h"
-static long int longval () { return CR_OP_HAND_ABORT; }
-static unsigned long int ulongval () { return CR_OP_HAND_ABORT; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((CR_OP_HAND_ABORT) < 0)
-    {
-      long int i = longval ();
-      if (i != (CR_OP_HAND_ABORT))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (CR_OP_HAND_ABORT))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_OP_HAND_ABORT=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_OP_HAND_ABORT" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_OP_HAND_ABORT" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_OP_HAND_ABORT" != "not found"; then
-    CR_ASM_OP_HAND_ABORT="$cr_cv_compute_int_CR_ASM_OP_HAND_ABORT"
-  fi
-
-  if test -n "$CR_ASM_OP_HAND_ABORT"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_OP_HAND_ABORT $CR_ASM_OP_HAND_ABORT
-_ACEOF
-
-
-
-  fi
-
-
-    CR_ASM_CHECKPOINT_OMIT=""
-
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_CHECKPOINT_OMIT" >&5
-$as_echo_n "checking for value for CR_ASM_CHECKPOINT_OMIT... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_CHECKPOINT_OMIT) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_CHECKPOINT_OMIT) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_CHECKPOINT_OMIT) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_CHECKPOINT_OMIT) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-int
-main ()
-{
-static int test_array [1 - 2 * !((CR_CHECKPOINT_OMIT) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "blcr_common.h.in"
-static long int longval () { return CR_CHECKPOINT_OMIT; }
-static unsigned long int ulongval () { return CR_CHECKPOINT_OMIT; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((CR_CHECKPOINT_OMIT) < 0)
-    {
-      long int i = longval ();
-      if (i != (CR_CHECKPOINT_OMIT))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (CR_CHECKPOINT_OMIT))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT" != "not found"; then
-    CR_ASM_CHECKPOINT_OMIT="$cr_cv_compute_int_CR_ASM_CHECKPOINT_OMIT"
-  fi
-
-  if test -n "$CR_ASM_CHECKPOINT_OMIT"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_CHECKPOINT_OMIT $CR_ASM_CHECKPOINT_OMIT
-_ACEOF
-
-
-
-  fi
-    # ICK!
-
-    CR_ASM_SI_PID_OFFSET=""
-
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_SI_PID_OFFSET" >&5
-$as_echo_n "checking for value for CR_ASM_SI_PID_OFFSET... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_SI_PID_OFFSET+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_compute_int_CR_ASM_SI_PID_OFFSET="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <signal.h>
-	 #include <stddef.h>
-	 #ifndef offsetof
-  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
-	 #endif
-int
-main ()
-{
-static int test_array [1 - 2 * !((offsetof(siginfo_t, si_pid)) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <signal.h>
-	 #include <stddef.h>
-	 #ifndef offsetof
-  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
-	 #endif
-int
-main ()
-{
-static int test_array [1 - 2 * !((offsetof(siginfo_t, si_pid)) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <signal.h>
-	 #include <stddef.h>
-	 #ifndef offsetof
-  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
-	 #endif
-int
-main ()
-{
-static int test_array [1 - 2 * !((offsetof(siginfo_t, si_pid)) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <signal.h>
-	 #include <stddef.h>
-	 #ifndef offsetof
-  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
-	 #endif
-int
-main ()
-{
-static int test_array [1 - 2 * !((offsetof(siginfo_t, si_pid)) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <signal.h>
-	 #include <stddef.h>
-	 #ifndef offsetof
-  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
-	 #endif
-int
-main ()
-{
-static int test_array [1 - 2 * !((offsetof(siginfo_t, si_pid)) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_SI_PID_OFFSET=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <signal.h>
-	 #include <stddef.h>
-	 #ifndef offsetof
-  	    #define offsetof(TYPE, MEMBER) ((unsigned long) &((TYPE *)0)->MEMBER)
-	 #endif
-static long int longval () { return offsetof(siginfo_t, si_pid); }
-static unsigned long int ulongval () { return offsetof(siginfo_t, si_pid); }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((offsetof(siginfo_t, si_pid)) < 0)
-    {
-      long int i = longval ();
-      if (i != (offsetof(siginfo_t, si_pid)))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (offsetof(siginfo_t, si_pid)))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_SI_PID_OFFSET=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_SI_PID_OFFSET" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_SI_PID_OFFSET" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_SI_PID_OFFSET" != "not found"; then
-    CR_ASM_SI_PID_OFFSET="$cr_cv_compute_int_CR_ASM_SI_PID_OFFSET"
-  fi
-
-  if test -n "$CR_ASM_SI_PID_OFFSET"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_SI_PID_OFFSET $CR_ASM_SI_PID_OFFSET
-_ACEOF
-
-
-
-  fi
-
-
-    CR_ASM_NR_ioctl=""
-
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_NR_ioctl" >&5
-$as_echo_n "checking for value for CR_ASM_NR_ioctl... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_NR_ioctl+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_compute_int_CR_ASM_NR_ioctl="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_ioctl) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_ioctl) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_ioctl) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_ioctl) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_ioctl) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_NR_ioctl=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-static long int longval () { return __NR_ioctl; }
-static unsigned long int ulongval () { return __NR_ioctl; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((__NR_ioctl) < 0)
-    {
-      long int i = longval ();
-      if (i != (__NR_ioctl))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (__NR_ioctl))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_NR_ioctl=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_NR_ioctl" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_NR_ioctl" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_NR_ioctl" != "not found"; then
-    CR_ASM_NR_ioctl="$cr_cv_compute_int_CR_ASM_NR_ioctl"
-  fi
-
-  if test -n "$CR_ASM_NR_ioctl"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_NR_ioctl $CR_ASM_NR_ioctl
-_ACEOF
-
-
-
-  fi
-
-
-    CR_ASM_NR_rt_sigreturn=""
-
-    { $as_echo "$as_me:$LINENO: checking for value for CR_ASM_NR_rt_sigreturn" >&5
-$as_echo_n "checking for value for CR_ASM_NR_rt_sigreturn... " >&6; }
-if test "${cr_cv_compute_int_CR_ASM_NR_rt_sigreturn+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_compute_int_CR_ASM_NR_rt_sigreturn="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_rt_sigreturn) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_rt_sigreturn) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_rt_sigreturn) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_rt_sigreturn) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((__NR_rt_sigreturn) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_ASM_NR_rt_sigreturn=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <asm/unistd.h>
-	 #include <linux/unistd.h>
-static long int longval () { return __NR_rt_sigreturn; }
-static unsigned long int ulongval () { return __NR_rt_sigreturn; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((__NR_rt_sigreturn) < 0)
-    {
-      long int i = longval ();
-      if (i != (__NR_rt_sigreturn))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (__NR_rt_sigreturn))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_ASM_NR_rt_sigreturn=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_ASM_NR_rt_sigreturn" >&5
-$as_echo "$cr_cv_compute_int_CR_ASM_NR_rt_sigreturn" >&6; }
-  if test "$cr_cv_compute_int_CR_ASM_NR_rt_sigreturn" != "not found"; then
-    CR_ASM_NR_rt_sigreturn="$cr_cv_compute_int_CR_ASM_NR_rt_sigreturn"
-  fi
-
-  if test -n "$CR_ASM_NR_rt_sigreturn"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_ASM_NR_rt_sigreturn $CR_ASM_NR_rt_sigreturn
-_ACEOF
-
-
-
-  fi
-
-CFLAGS="$SAVE_CFLAGS"
-
-# Probe for direction of stack growth
-
-    { $as_echo "$as_me:$LINENO: checking for direction of stack growth" >&5
-$as_echo_n "checking for direction of stack growth... " >&6; }
-if test "${cr_cv_check_stack_direction+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-   if test "$cross_compiling" = yes; then
-
-  if test "${cross_stack_direction-unset}" = unset; then
-    { { $as_echo "$as_me:$LINENO: error: When cross-compiling, variable cross_stack_direction must be set." >&5
-$as_echo "$as_me: error: When cross-compiling, variable cross_stack_direction must be set." >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-
-	 if test $cross_stack_direction = 1; then
-	   cr_cv_check_stack_direction=up
-	 else
-	   cr_cv_check_stack_direction=down
-	 fi
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-    int find_stack_direction (void) {
-      static char *addr = 0;
-      auto char dummy;
-      if (addr == 0) {
-        addr = &dummy;
-        return find_stack_direction();
-      } else {
-        return (&dummy > addr) ? 0 : 1;
-      }
-    }
-    int main(void) {
-      return find_stack_direction();
-    }
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_check_stack_direction=up
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-cr_cv_check_stack_direction=down
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-
-
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_check_stack_direction" >&5
-$as_echo "$cr_cv_check_stack_direction" >&6; }
-  if test $cr_cv_check_stack_direction = up; then
-    cr_stack_direction=1
-  else
-    cr_stack_direction=-1
-  fi
-  cat >>confdefs.h <<_ACEOF
-#define CR_STACK_GROWTH $cr_stack_direction
-_ACEOF
-
-
-
-
-
-# Look for FTB header and libs
- cr_have_ftb=no
- if test x"$FTB_HOME" != xno; then
-  cr_have_ftb=yes
-  SAVE_CPPFLAGS="$CPPFLAGS"
-  SAVE_LDFLAGS="$LDFLAGS"
-  SAVE_LIBS="$LIBS"
-  CR_FTB_INCLUDES=""
-  CR_FTB_LDFLAGS=""
-  { $as_echo "$as_me:$LINENO: checking for FTB headers" >&5
-$as_echo_n "checking for FTB headers... " >&6; }
-if test "${cr_cv_ftb_incdir+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_result=no
-    for cr_tmp in "" "${FTB_HOME}/include"; do
-      CPPFLAGS="$SAVE_CPPFLAGS${cr_tmp:+ -I$cr_tmp}"
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-        #include <libftb.h>
-
-int
-main ()
-{
-
-        FTB_client_t x;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  cr_result="$cr_tmp"; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    done
-    if test -z "$cr_result"; then
-      cr_cv_ftb_incdir="default"
-    else
-      cr_cv_ftb_incdir="$cr_result"
-    fi
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_ftb_incdir" >&5
-$as_echo "$cr_cv_ftb_incdir" >&6; }
-  if test x"$cr_cv_ftb_incdir" = xno; then
-    cr_have_ftb=no
-  elif test x"$cr_cv_ftb_incdir" != "xdefault"; then
-    CR_FTB_INCLUDES="-I$cr_cv_ftb_incdir"
-  fi
-  { $as_echo "$as_me:$LINENO: checking for FTB libs" >&5
-$as_echo_n "checking for FTB libs... " >&6; }
-if test "${cr_cv_ftb_libdir+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    CPPFLAGS="$SAVE_CPPFLAGS $CR_FTB_INCLUDES"
-    LIBS="-lftb -lpthread $SAVE_LIBS"
-    cr_result=no
-    for cr_tmp in "" "${FTB_HOME}/lib64" "${FTB_HOME}/lib32" "${FTB_HOME}/lib"; do
-      LDFLAGS="$SAVE_LDFLAGS${cr_tmp:+-L$cr_tmp}"
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-        #include <libftb.h>
-
-int
-main ()
-{
-
-        return FTB_Connect(NULL, NULL);
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  cr_result="$cr_tmp"; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-    done
-    if test -z "$cr_result"; then
-      cr_cv_ftb_libdir="default"
-    else
-      cr_cv_ftb_libdir="$cr_result"
-    fi
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_ftb_libdir" >&5
-$as_echo "$cr_cv_ftb_libdir" >&6; }
-  if test x"$cr_cv_ftb_libdir" = xno; then
-    cr_have_ftb=no
-  elif test x"$cr_cv_ftb_libdir" != "xdefault"; then
-    CR_FTB_LDFLAGS="-L$cr_cv_ftb_libdir"
-    CR_FTB_LDADD="-lftb"
-  fi
-  LIBS="$SAVE_LIBS"
-  LDFLAGS="$SAVE_LDFLAGS"
-  CPPFLAGS="$SAVE_CPPFLAGS"
-  if test x"$cr_have_ftb$cr_force_ftb" = xnoyes; then
-    { { $as_echo "$as_me:$LINENO: error: Configured with --with-ftb='$FTB_HOME', but unable to build FTB test case" >&5
-$as_echo "$as_me: error: Configured with --with-ftb='$FTB_HOME', but unable to build FTB test case" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-
-
-
- fi
-
-  if test x$cr_have_ftb = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FTB 1
-_ACEOF
-
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FTB 0
-_ACEOF
-
-  fi
-
-
-
-
-fi # cr_build_libcr
-
-# Probe libc for the RT signal number to use
-
-    { $as_echo "$as_me:$LINENO: checking for value of CR_SIGNUM" >&5
-$as_echo_n "checking for value of CR_SIGNUM... " >&6; }
-if test "${cr_cv_check_cr_signum+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_check_cr_signum="failed"
-    SAVE_LIBS="$LIBS"
-    LIBS="-ldl -lpthread $LIBS"
-    if test "$cross_compiling" = yes; then
-
-  if test "${cross_signum-unset}" = unset; then
-    { { $as_echo "$as_me:$LINENO: error: When cross-compiling, variable cross_signum must be set." >&5
-$as_echo "$as_me: error: When cross-compiling, variable cross_signum must be set." >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-
-	 cr_cv_check_cr_signum=$cross_signum
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <stdio.h>
-	#include <dlfcn.h>
-
-	extern int __libc_allocate_rtsig(int);
-	int main()
-	{
-	  int s = -1;
-	  FILE *f=fopen("conftestval", "w");
-	  void *dlhandle = dlopen(NULL, RTLD_LAZY);
-	  if (dlhandle) {
-	    int *tmp = (int *)dlsym(dlhandle, "cri_signum");
-	    dlclose(dlhandle);
-	    if (tmp) s = *tmp;
-	  }
-	  if (s <= 0) {
-	    s=__libc_allocate_rtsig(0);
-	  }
-	  if (!f || s<=0) return(1);
-	  fprintf(f, "%d\n", s);
-	  return(0);
-	}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_check_cr_signum=`cat conftestval`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-{ { $as_echo "$as_me:$LINENO: error: Failed to probe CR_SIGNUM" >&5
-$as_echo "$as_me: error: Failed to probe CR_SIGNUM" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-
-
-    LIBS="$SAVE_LIBS"
-
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_check_cr_signum" >&5
-$as_echo "$cr_cv_check_cr_signum" >&6; }
-  CR_SIGNUM=$cr_cv_check_cr_signum
-
-
-
-# Check for 32- or 64-bit architecture
-# The cast to long int works around a bug in the HP C Compiler
-# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
-# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
-# This bug is HP SR number 8606223364.
-{ $as_echo "$as_me:$LINENO: checking size of void *" >&5
-$as_echo_n "checking size of void *... " >&6; }
-if test "${ac_cv_sizeof_void_p+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) >= 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) < 0)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) >= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo= ac_hi=
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !(((long int) (sizeof (void *))) <= $ac_mid)];
-test_array [0] = 0
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) ac_cv_sizeof_void_p=$ac_lo;;
-'') if test "$ac_cv_type_void_p" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_void_p=0
-   fi ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-static long int longval () { return (long int) (sizeof (void *)); }
-static unsigned long int ulongval () { return (long int) (sizeof (void *)); }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if (((long int) (sizeof (void *))) < 0)
-    {
-      long int i = longval ();
-      if (i != ((long int) (sizeof (void *))))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != ((long int) (sizeof (void *))))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_sizeof_void_p=`cat conftest.val`
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-if test "$ac_cv_type_void_p" = yes; then
-     { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute sizeof (void *)
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
-   else
-     ac_cv_sizeof_void_p=0
-   fi
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_sizeof_void_p" >&5
-$as_echo "$ac_cv_sizeof_void_p" >&6; }
-
-
-
-cat >>confdefs.h <<_ACEOF
-#define SIZEOF_VOID_P $ac_cv_sizeof_void_p
-_ACEOF
-
-
-CR_LIBARCH=$CR_ARCH
-if test $ac_cv_sizeof_void_p != $cr_wordsize; then
-  if test $cr_wordsize = 8; then
-    CR_LIBARCH=${CR_LIBARCH32:-$CR_ARCH32}
-  else
-    { { $as_echo "$as_me:$LINENO: error: CC='$CC' yields sizeof(void *) = $ac_cv_sizeof_void_p when expecting $cr_wordsize.$clue" >&5
-$as_echo "$as_me: error: CC='$CC' yields sizeof(void *) = $ac_cv_sizeof_void_p when expecting $cr_wordsize.$clue" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-fi
-
-
-################################################################################
-# Sub-configure for 32-bit libs on 64-bit platforms
-################################################################################
-
-cr_build_libcr32=no
-if test x"$enable_multilib" = xyes; then
-  if test x"$cr_build_libcr" != xyes; then
-    { { $as_echo "$as_me:$LINENO: error: --enable-multilib requested but not building libcr" >&5
-$as_echo "$as_me: error: --enable-multilib requested but not building libcr" >&2;}
-   { (exit 1); exit 1; }; }
-  elif test -f "${TOP_BUILDDIR}/configure.ac"; then # More robust than TOP_BUILDDIR == TOP_SRCDIR
-    { { $as_echo "$as_me:$LINENO: error: When requesting --enable-multilib, you must configure/build in a directory other than the one holding the BLCR sources" >&5
-$as_echo "$as_me: error: When requesting --enable-multilib, you must configure/build in a directory other than the one holding the BLCR sources" >&2;}
-   { (exit 1); exit 1; }; }
-  elif test -z "$CR_ARCH32"; then
-    { { $as_echo "$as_me:$LINENO: error: --enable-multilib not supported on architecture $CR_ARCH" >&5
-$as_echo "$as_me: error: --enable-multilib not supported on architecture $CR_ARCH" >&2;}
-   { (exit 1); exit 1; }; }
-  elif test $ac_cv_sizeof_void_p = 4; then
-    { { $as_echo "$as_me:$LINENO: error: --enable-multilib requested but CC='$CC' generates 32-bit objects.  Perhaps try configuring with CC='$CC -m64' or similar." >&5
-$as_echo "$as_me: error: --enable-multilib requested but CC='$CC' generates 32-bit objects.  Perhaps try configuring with CC='$CC -m64' or similar." >&2;}
-   { (exit 1); exit 1; }; }
-  elif test \! -d /lib64; then
-    { { $as_echo "$as_me:$LINENO: error: --enable-multilib requested but /lib64 does not exist" >&5
-$as_echo "$as_me: error: --enable-multilib requested but /lib64 does not exist" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-  if test -z "$libdir32"; then
-    if expr "$libdir" : '.*/lib64$' >/dev/null; then
-      libdir32=`echo $libdir | sed -e 's/64$//'`
-    elif test "$libdir" = '${exec_prefix}/lib'; then
-      libdir32='${exec_prefix}/lib'
-      libdir='${exec_prefix}/lib64'
-    else
-      { { $as_echo "$as_me:$LINENO: error: --enable-multilib requested but libdir='$libdir' does not end in 'lib64'" >&5
-$as_echo "$as_me: error: --enable-multilib requested but libdir='$libdir' does not end in 'lib64'" >&2;}
-   { (exit 1); exit 1; }; };
-    fi
-  fi
-  SUBCMD="${TOP_SRCDIR}/configure '--srcdir=${TOP_SRCDIR}' '--build=${CR_ARCH32}-linux' '--libdir=${libdir32}' --with-components=libcr,tests,examples"
-  eval set -- $ac_configure_args
-  for x in "$@"; do
-    case "$x" in
-      --host=*|--build=*|--target=*|host_alias=*|build_alias=*|target_alias=*|--libdir=*|--srcdir=*|--with-components=*|--enable-multilib|--enable-testsuite|--enable-init-script|CFLAGS=*|CXXFLAGS=*)
-	# skip
-	;;
-      *)
-	# keep as-is
-	SUBCMD="$SUBCMD '$x'"
-	;;
-    esac
-  done
-  # Strip -m64 out of CFLAGS and CXXFLAGS, if present
-  if test -n "$CFLAGS32"; then
-    SUBCMD="$SUBCMD 'CFLAGS=$CFLAGS32'"
-  elif test -n "$CFLAGS"; then
-    set --
-    for x in $CFLAGS; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
-    SUBCMD="$SUBCMD 'CFLAGS=$@'"
-  fi
-  if test -n "$CXXFLAGS32"; then
-    SUBCMD="$SUBCMD 'CXXFLAGS=$CXXFLAGS32'"
-  elif test -n "$CXXFLAGS"; then
-    set --
-    for x in $CXXFLAGS; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
-    SUBCMD="$SUBCMD 'CXXFLAGS=$@'"
-  fi
-  # Strip -m64 from definitions of CC and CXX, adding -m32
-  if test -n "$CC32"; then
-    SUBCMD="$SUBCMD 'CC=$CC32'"
-  else
-    set --
-    for x in $CC; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
-    SUBCMD="$SUBCMD 'CC=$@ -m32'"
-  fi
-  if test -n "$CXX32"; then
-    SUBCMD="$SUBCMD 'CXX=$CXX32'"
-  elif test -n "$CXX" -a "$CXX" != no; then
-    set --
-    for x in $CXX; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
-    SUBCMD="$SUBCMD 'CXX=$@ -m32'"
-  fi
-  # Look for 32-bit versions of remaining bin tools
-  if test -n "$CPP32"; then
-    SUBCMD="$SUBCMD 'CPP=$CPP32'"
-  fi
-  if test -n "$LD32"; then
-    SUBCMD="$SUBCMD 'LD=$LD32'"
-  fi
-  if test -n "$AR32"; then
-    SUBCMD="$SUBCMD 'AR=$AR32'"
-  fi
-  if test -n "$NM32"; then
-    SUBCMD="$SUBCMD 'NM=$NM32'"
-  fi
-  if test -n "$RANLIB32"; then
-    SUBCMD="$SUBCMD 'RANLIB=$RANLIB32'"
-  fi
-  # Others?
-  { $as_echo "$as_me:$LINENO: >>>> BEGIN sub-configure for 32-bit libs >>>>" >&5
-$as_echo "$as_me: >>>> BEGIN sub-configure for 32-bit libs >>>>" >&6;}
-  { $as_echo "$as_me:$LINENO: ${SUBCMD}" >&5
-$as_echo "$as_me: ${SUBCMD}" >&6;}
-  ( mkdir -p libcr32 && cd libcr32 && ln -sf ../util . && eval "${SUBCMD}" )
-  if test "$?" = 0; then
-    { $as_echo "$as_me:$LINENO: <<<< END sub-configure for 32-bit libs <<<<" >&5
-$as_echo "$as_me: <<<< END sub-configure for 32-bit libs <<<<" >&6;}
-    cr_build_libcr32=yes
-  else
-    rm -rf libcr32
-    { { $as_echo "$as_me:$LINENO: error: --enable-multilib requested but FAILED sub-configure for 32-bit libs" >&5
-$as_echo "$as_me: error: --enable-multilib requested but FAILED sub-configure for 32-bit libs" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-fi
- if test x$cr_build_libcr32 = xyes; then
-  CR_BUILD_LIBCR32_TRUE=
-  CR_BUILD_LIBCR32_FALSE='#'
-else
-  CR_BUILD_LIBCR32_TRUE='#'
-  CR_BUILD_LIBCR32_FALSE=
-fi
-
-
-################################################################################
-# Check kernel (source location, symbol table, features, etc.)
-################################################################################
-
-if test x"$cr_build_modules" = xyes; then
-
-# Compiler to build kernel modules
-{ $as_echo "$as_me:$LINENO: checking compiler to build kernel modules" >&5
-$as_echo_n "checking compiler to build kernel modules... " >&6; }
-if test -n "${KCC}"; then
-  { $as_echo "$as_me:$LINENO: result: $KCC (user setting)" >&5
-$as_echo "$KCC (user setting)" >&6; }
-else
-  KCC=$CC
-  { $as_echo "$as_me:$LINENO: result: $KCC (default)" >&5
-$as_echo "$KCC (default)" >&6; }
-fi
-
-
-# Find BSD-compatible NM command
-{ $as_echo "$as_me:$LINENO: checking for BSD- or MS-compatible name lister (nm)" >&5
-$as_echo_n "checking for BSD- or MS-compatible name lister (nm)... " >&6; }
-if test "${lt_cv_path_NM+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$NM"; then
-  # Let the user override the test.
-  lt_cv_path_NM="$NM"
-else
-  lt_nm_to_check="${ac_tool_prefix}nm"
-  if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
-    lt_nm_to_check="$lt_nm_to_check nm"
-  fi
-  for lt_tmp_nm in $lt_nm_to_check; do
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
-    for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
-      IFS="$lt_save_ifs"
-      test -z "$ac_dir" && ac_dir=.
-      tmp_nm="$ac_dir/$lt_tmp_nm"
-      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
-	# Check to see if the nm accepts a BSD-compat flag.
-	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
-	#   nm: unknown option "B" ignored
-	# Tru64's nm complains that /dev/null is an invalid object file
-	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
-	*/dev/null* | *'Invalid file or object type'*)
-	  lt_cv_path_NM="$tmp_nm -B"
-	  break
-	  ;;
-	*)
-	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
-	  */dev/null*)
-	    lt_cv_path_NM="$tmp_nm -p"
-	    break
-	    ;;
-	  *)
-	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
-	    continue # so that we can try to find one that supports BSD flags
-	    ;;
-	  esac
-	  ;;
-	esac
-      fi
-    done
-    IFS="$lt_save_ifs"
-  done
-  : ${lt_cv_path_NM=no}
-fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_path_NM" >&5
-$as_echo "$lt_cv_path_NM" >&6; }
-if test "$lt_cv_path_NM" != "no"; then
-  NM="$lt_cv_path_NM"
-else
-  # Didn't find any BSD compatible name lister, look for dumpbin.
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in "dumpbin -symbols" "link -dump -symbols"
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_DUMPBIN+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$DUMPBIN"; then
-  ac_cv_prog_DUMPBIN="$DUMPBIN" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-DUMPBIN=$ac_cv_prog_DUMPBIN
-if test -n "$DUMPBIN"; then
-  { $as_echo "$as_me:$LINENO: result: $DUMPBIN" >&5
-$as_echo "$DUMPBIN" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-    test -n "$DUMPBIN" && break
-  done
-fi
-if test -z "$DUMPBIN"; then
-  ac_ct_DUMPBIN=$DUMPBIN
-  for ac_prog in "dumpbin -symbols" "link -dump -symbols"
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_DUMPBIN+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_DUMPBIN"; then
-  ac_cv_prog_ac_ct_DUMPBIN="$ac_ct_DUMPBIN" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_DUMPBIN=$ac_cv_prog_ac_ct_DUMPBIN
-if test -n "$ac_ct_DUMPBIN"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_DUMPBIN" >&5
-$as_echo "$ac_ct_DUMPBIN" >&6; }
-else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$ac_ct_DUMPBIN" && break
-done
-
-  if test "x$ac_ct_DUMPBIN" = x; then
-    DUMPBIN=":"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    DUMPBIN=$ac_ct_DUMPBIN
-  fi
-fi
-
-
-  if test "$DUMPBIN" != ":"; then
-    NM="$DUMPBIN"
-  fi
-fi
-test -z "$NM" && NM=nm
-
-
-
-{ $as_echo "$as_me:$LINENO: checking the name lister ($NM) interface" >&5
-$as_echo_n "checking the name lister ($NM) interface... " >&6; }
-if test "${lt_cv_nm_interface+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  lt_cv_nm_interface="BSD nm"
-  echo "int some_variable = 0;" > conftest.$ac_ext
-  (eval echo "\"\$as_me:22992: $ac_compile\"" >&5)
-  (eval "$ac_compile" 2>conftest.err)
-  cat conftest.err >&5
-  (eval echo "\"\$as_me:22995: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
-  (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
-  cat conftest.err >&5
-  (eval echo "\"\$as_me:22998: output\"" >&5)
-  cat conftest.out >&5
-  if $GREP 'External.*some_variable' conftest.out > /dev/null; then
-    lt_cv_nm_interface="MS dumpbin"
-  fi
-  rm -f conftest*
-fi
-{ $as_echo "$as_me:$LINENO: result: $lt_cv_nm_interface" >&5
-$as_echo "$lt_cv_nm_interface" >&6; }
-
-NM=$NM
-
-
-# First deal with user-specified kernel type (UP, SMP, BIGMEM, etc.) if any.
-case x"$with_kernel_type" in
-  x|xyes|xno) ;;
-  *)
-  cr_kernel_type=`echo "$with_kernel_type" | tr 'a-z' 'A-Z'`
-  cr_header="/boot/kernel.h"
-  { $as_echo "$as_me:$LINENO: checking for $cr_header" >&5
-$as_echo_n "checking for $cr_header... " >&6; };
-  cr_result=ok
-  if test \! -e "$cr_header"; then
-    cr_result='missing'
-  elif test \! -r "$cr_header"; then
-    cr_result='not readable'
-  fi
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-  if test "$cr_result" != "ok"; then
-    { { $as_echo "$as_me:$LINENO: error: You have requested '--with-kernel-type=$cr_kernel_type', but $cr_header is $cr_result." >&5
-$as_echo "$as_me: error: You have requested '--with-kernel-type=$cr_kernel_type', but $cr_header is $cr_result." >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-  cr_kernel_var="__BOOT_KERNEL_$cr_kernel_type"
-  if test -z "`grep \"$cr_kernel_var\" $cr_header 2>/dev/null`"; then
-    { { $as_echo "$as_me:$LINENO: error: You have requested '--with-kernel-type=$cr_kernel_type', but $cr_header does not appear to support that type." >&5
-$as_echo "$as_me: error: You have requested '--with-kernel-type=$cr_kernel_type', but $cr_header does not appear to support that type." >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-  # The following sed command transforms all the #ifndef lines from kernel.h into
-  # corresponding preprocessor flags (on one line) which select the desired kernel type.
-  # Note use of [] for m4 quoting of a sed command containing [ and ]
-  CR_KTYPE_CPPFLAGS=`sed -n -e '/^#ifndef \('$cr_kernel_var'\)$/ {s//-D\1=1 /;H;}' \
-			     -e '/^#ifndef \(__BOOT_KERNEL_[A-Z]*\)$/ {s//-D\1=0 /;H;}' \
-			     -e '$ {x;s/[ \t\n]\+/ /g;s/^ //;s/ $//;p;}' \
-			     $cr_header`
-
-esac
-# Checks for required kernel src/obj dirs and fail if they are not found
-
-
-
-
-
-
-
-
-    if test "${LINUX_OBJ_ARG+set}${cr_cv_var_LINUX_OBJ_ARG+set}" = setset; then
-    if test "$LINUX_OBJ_ARG" != "$cr_cv_var_LINUX_OBJ_ARG"; then
-      { { $as_echo "$as_me:$LINENO: error: Cached LINUX_OBJ_ARG ($cr_cv_var_LINUX_OBJ_ARG) does not match current value ($LINUX_OBJ_ARG).  Remove '$cache_file' before re-running configure." >&5
-$as_echo "$as_me: error: Cached LINUX_OBJ_ARG ($cr_cv_var_LINUX_OBJ_ARG) does not match current value ($LINUX_OBJ_ARG).  Remove '$cache_file' before re-running configure." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  elif test "${cr_cv_var_LINUX_OBJ_ARG+set}" = set; then
-    LINUX_OBJ_ARG="$cr_cv_var_LINUX_OBJ_ARG"
-  fi
-
-  if expr X"$LINUX_OBJ_ARG" : X/ >/dev/null; then
-    # User provided a path
-
-  { $as_echo "$as_me:$LINENO: checking for Linux kernel build in ${LINUX_OBJ_ARG}" >&5
-$as_echo_n "checking for Linux kernel build in ${LINUX_OBJ_ARG}... " >&6; }
-  cr_cvname=cr_cv_kernel_obj_`$as_echo "${LINUX_OBJ_ARG}" | $as_tr_sh`
-  if { as_var=${cr_cvname}; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-
-    if test -d "${LINUX_OBJ_ARG}"; then
-      # Check for version.h
-
-  for cr_version_h in ${LINUX_OBJ_ARG}/include/linux/version.h ${LINUX_OBJ_ARG}/include/generated/uapi/linux/version.h none; do
-    test -r $cr_version_h && break
-  done
-  if test $cr_version_h = none; then
-    cr_tmp='version.h missing'
-  else
-    cr_tmp=`  $PERL -- - "${LINUX_OBJ_ARG}" "$KCC -E -I${LINUX_OBJ_ARG}/include -D__KERNEL__ -DMODULE $CR_KTYPE_CPPFLAGS $CPPFLAGS" <<'_EOF_'
-
-    my ($srcdir, $cpp_cmd) = @ARGV;
-    my $stamp = time;
-    $cpp_cmd =~ s/([#()])/\\${LINUX_OBJ_ARG}/g; # quote problematic shell metachars
-    FILE: foreach my $file (qw(linux/version.h linux/utsrelease.h generated/utsrelease.h)) {
-      my $path = "$srcdir/include/$file";
-      next FILE unless (-f $path);
-      open(F, "echo '=${stamp}->UTS_RELEASE<-' | ${cpp_cmd} -include ${path} - |") || exit 1;
-      LINE: while (<F>) {
-        next LINE if(/^#/);
-        if ((my $uts) = /=${stamp}->"((2\.6|3\.[0-9]+)\.[0-9].*)"<-/o) {
-          print "$uts\n";
-          exit 0;
-        }
-      }
-      close(F) || exit 1;
-    }
-    exit 1;
-
-_EOF_
-`
-    test $? = 0 || cr_tmp='no UTS_RELEASE could be extracted'
-    LINUX_VERSION_H=$cr_version_h
-
-  fi
-
-      # Check for .config if required
-      if expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-        test -r "${LINUX_OBJ_ARG}/.config" || cr_tmp='.config missing'
-      fi
-    else
-      cr_tmp='not found'
-    fi
-    eval "$cr_cvname='$cr_tmp'"
-    unset cr_tmp
-
-fi
-
-  eval "cr_result=\$$cr_cvname"
-  unset cr_cvname
-  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-    { $as_echo "$as_me:$LINENO: result: found version $cr_result" >&5
-$as_echo "found version $cr_result" >&6; }
-  else
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-  fi
-  # Check that version appears acceptible
-
-  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-    cr_linux_obj_ver="$cr_result"
-  else
-    cr_linux_obj_ver=''
-  fi
-
-
-
-  if test -z "$cr_linux_obj_ver"; then
-    { { $as_echo "$as_me:$LINENO: error: Directory ${LINUX_OBJ_ARG} does not appear to contain a Linux kernel build" >&5
-$as_echo "$as_me: error: Directory ${LINUX_OBJ_ARG} does not appear to contain a Linux kernel build" >&2;}
-   { (exit 1); exit 1; }; }
-  else
-    :
-  fi
-
-    LINUX_OBJ="${LINUX_OBJ_ARG}"
-  else
-    if test -z "$LINUX_OBJ_ARG"; then
-      cr_tmp_ver=`uname -r`
-    elif expr "$LINUX_OBJ_ARG" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-      cr_tmp_ver="$LINUX_OBJ_ARG"
-    else
-      { { $as_echo "$as_me:$LINENO: error: --with-linux argument '$LINUX_OBJ_ARG' is neither a kernel version string nor a full path" >&5
-$as_echo "$as_me: error: --with-linux argument '$LINUX_OBJ_ARG' is neither a kernel version string nor a full path" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_ver_patt="`echo $cr_tmp_ver | sed -e 's/\./\\\\./g;'`\$"
-    # Search standard locations
-    for cr_linux_dir in \
-			/lib/modules/${cr_tmp_ver}/build \
-			/usr/src/linux-${cr_tmp_ver}-obj \
-			/usr/src/linux-${cr_tmp_ver} \
-			/usr/src/linux-headers-${cr_tmp_ver} \
-	     		/usr/src/kernels/${cr_tmp_ver} \
-			; do
-
-  { $as_echo "$as_me:$LINENO: checking for Linux kernel build in ${cr_linux_dir}" >&5
-$as_echo_n "checking for Linux kernel build in ${cr_linux_dir}... " >&6; }
-  cr_cvname=cr_cv_kernel_obj_`$as_echo "${cr_linux_dir}" | $as_tr_sh`
-  if { as_var=${cr_cvname}; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-
-    if test -d "${cr_linux_dir}"; then
-      # Check for version.h
-
-  for cr_version_h in ${cr_linux_dir}/include/linux/version.h ${cr_linux_dir}/include/generated/uapi/linux/version.h none; do
-    test -r $cr_version_h && break
-  done
-  if test $cr_version_h = none; then
-    cr_tmp='version.h missing'
-  else
-    cr_tmp=`  $PERL -- - "${cr_linux_dir}" "$KCC -E -I${cr_linux_dir}/include -D__KERNEL__ -DMODULE $CR_KTYPE_CPPFLAGS $CPPFLAGS" <<'_EOF_'
-
-    my ($srcdir, $cpp_cmd) = @ARGV;
-    my $stamp = time;
-    $cpp_cmd =~ s/([#()])/\\${cr_linux_dir}/g; # quote problematic shell metachars
-    FILE: foreach my $file (qw(linux/version.h linux/utsrelease.h generated/utsrelease.h)) {
-      my $path = "$srcdir/include/$file";
-      next FILE unless (-f $path);
-      open(F, "echo '=${stamp}->UTS_RELEASE<-' | ${cpp_cmd} -include ${path} - |") || exit 1;
-      LINE: while (<F>) {
-        next LINE if(/^#/);
-        if ((my $uts) = /=${stamp}->"((2\.6|3\.[0-9]+)\.[0-9].*)"<-/o) {
-          print "$uts\n";
-          exit 0;
-        }
-      }
-      close(F) || exit 1;
-    }
-    exit 1;
-
-_EOF_
-`
-    test $? = 0 || cr_tmp='no UTS_RELEASE could be extracted'
-    LINUX_VERSION_H=$cr_version_h
-
-  fi
-
-      # Check for .config if required
-      if expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-        test -r "${cr_linux_dir}/.config" || cr_tmp='.config missing'
-      fi
-    else
-      cr_tmp='not found'
-    fi
-    eval "$cr_cvname='$cr_tmp'"
-    unset cr_tmp
-
-fi
-
-  eval "cr_result=\$$cr_cvname"
-  unset cr_cvname
-  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-    { $as_echo "$as_me:$LINENO: result: found version $cr_result" >&5
-$as_echo "found version $cr_result" >&6; }
-  else
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-  fi
-  # Check that version appears acceptible
-
-  if expr "$cr_result" : ${cr_ver_patt} >/dev/null; then
-    cr_linux_obj_ver="$cr_result"
-  else
-    cr_linux_obj_ver=''
-  fi
-
-
-      if test -n "$cr_linux_obj_ver"; then
-        LINUX_OBJ="${cr_linux_dir}"
-        break
-      fi
-    done
-
-  if test -z "$cr_linux_obj_ver"; then
-    { { $as_echo "$as_me:$LINENO: error: Could not find a directory containing a Linux kernel ${cr_tmp_ver} build.  Perhaps try --with-linux=FULL_PATH_TO_KERNEL_BUILD" >&5
-$as_echo "$as_me: error: Could not find a directory containing a Linux kernel ${cr_tmp_ver} build.  Perhaps try --with-linux=FULL_PATH_TO_KERNEL_BUILD" >&2;}
-   { (exit 1); exit 1; }; }
-  else
-    :
-  fi
-
-    unset cr_tmp_ver
-  fi
-
-
-  if test -n "$cr_linux_obj_ver"; then
-
-  cr_linux_src_ver=''
-
-    if test "${LINUX_SRC_ARG+set}${cr_cv_var_LINUX_SRC_ARG+set}" = setset; then
-    if test "$LINUX_SRC_ARG" != "$cr_cv_var_LINUX_SRC_ARG"; then
-      { { $as_echo "$as_me:$LINENO: error: Cached LINUX_SRC_ARG ($cr_cv_var_LINUX_SRC_ARG) does not match current value ($LINUX_SRC_ARG).  Remove '$cache_file' before re-running configure." >&5
-$as_echo "$as_me: error: Cached LINUX_SRC_ARG ($cr_cv_var_LINUX_SRC_ARG) does not match current value ($LINUX_SRC_ARG).  Remove '$cache_file' before re-running configure." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  elif test "${cr_cv_var_LINUX_SRC_ARG+set}" = set; then
-    LINUX_SRC_ARG="$cr_cv_var_LINUX_SRC_ARG"
-  fi
-
-  if expr X"$LINUX_SRC_ARG" : X/ >/dev/null; then
-    cr_list="$LINUX_SRC_ARG"
-  elif test -n "$LINUX_SRC_ARG"; then
-    { { $as_echo "$as_me:$LINENO: error: --with-linux-src argument '$LINUX_SRC_ARG' is not a full path" >&5
-$as_echo "$as_me: error: --with-linux-src argument '$LINUX_SRC_ARG' is not a full path" >&2;}
-   { (exit 1); exit 1; }; }
-  else
-    # Search standard locations
-    cr_list="${LINUX_OBJ} \
-	     /lib/modules/$cr_linux_obj_ver/source \
-	     /usr/src/linux-$cr_linux_obj_ver \
-	     /usr/src/linux-headers-$cr_linux_obj_ver \
-	     /usr/src/kernels/$cr_linux_obj_ver"
-  fi
-  for cr_linux_dir in $cr_list; do
-
-  { $as_echo "$as_me:$LINENO: checking for Linux kernel source in $cr_linux_dir" >&5
-$as_echo_n "checking for Linux kernel source in $cr_linux_dir... " >&6; }
-  cr_cvname=cr_cv_kernel_src_`$as_echo "$cr_linux_dir" | $as_tr_sh`
-  if { as_var=${cr_cvname}; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_tmp=''
-    if test -e "$cr_linux_dir/Makefile"; then
-      # First try using version.h, as some distros play odd games w/ the Makefile
-
-  for cr_version_h in $cr_linux_dir/include/linux/version.h $cr_linux_dir/include/generated/uapi/linux/version.h none; do
-    test -r $cr_version_h && break
-  done
-  if test $cr_version_h = none; then
-    cr_tmp='version.h missing'
-  else
-    cr_tmp=`  $PERL -- - "$cr_linux_dir" "$KCC -E -I$cr_linux_dir/include -D__KERNEL__ -DMODULE $CR_KTYPE_CPPFLAGS $CPPFLAGS" <<'_EOF_'
-
-    my ($srcdir, $cpp_cmd) = @ARGV;
-    my $stamp = time;
-    $cpp_cmd =~ s/([#()])/\\$cr_linux_dir/g; # quote problematic shell metachars
-    FILE: foreach my $file (qw(linux/version.h linux/utsrelease.h generated/utsrelease.h)) {
-      my $path = "$srcdir/include/$file";
-      next FILE unless (-f $path);
-      open(F, "echo '=${stamp}->UTS_RELEASE<-' | ${cpp_cmd} -include ${path} - |") || exit 1;
-      LINE: while (<F>) {
-        next LINE if(/^#/);
-        if ((my $uts) = /=${stamp}->"((2\.6|3\.[0-9]+)\.[0-9].*)"<-/o) {
-          print "$uts\n";
-          exit 0;
-        }
-      }
-      close(F) || exit 1;
-    }
-    exit 1;
-
-_EOF_
-`
-    test $? = 0 || cr_tmp='no UTS_RELEASE could be extracted'
-    LINUX_VERSION_H=$cr_version_h
-
-  fi
-
-      # Now trim EXTRAVERSION, or yield empty if no pattern match
-      cr_tmp=`echo $cr_tmp | sed -n -e '/^\(\(2\.6\|3\.[0-9][0-9]*\)\.[0-9]\+\).*$/ {s//\1/p;q;}'`
-
-      # Next try "asking" the Makefile
-      if test -z "$cr_tmp"; then
-        # If a dependency does not exist, then make may complain.
-        # The -k and 2>/dev/null take care of that.
-        cr_tmp=`(make -k echo_kver --no-print-directory -C $cr_linux_dir -f - 2>/dev/null | grep '^\(2\.6\|3\.[0-9][0-9]*\)\.') <<'_EOF_'
-echo_kver:
-	@echo '$(VERSION).$(PATCHLEVEL).$(SUBLEVEL)'
-
-include Makefile
-_EOF_`
-        expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null || cr_tmp='' # Reject if not matched to pattern
-      fi
-
-      # Finally try grepping the Makefile
-      if test -z "$cr_tmp"; then
-        # Note the use of [] for m4 quoting, since the pattern contains [ and ]
-        cr_linux_ver1=`sed -n -e '/^VERSION[ \t]*=[ \t]*\([0-9]\+\).*$/ {s//\1/p;q;}' "$cr_linux_dir/Makefile"`
-        cr_linux_ver2=`sed -n -e '/^PATCHLEVEL[ \t]*=[ \t]*\([0-9]\+\).*$/ {s//\1/p;q;}' "$cr_linux_dir/Makefile"`
-        cr_linux_ver3=`sed -n -e '/^SUBLEVEL[ \t]*=[ \t]*\([0-9]\+\).*$/ {s//\1/p;q;}' "$cr_linux_dir/Makefile"`
-        cr_tmp="${cr_linux_ver1}.${cr_linux_ver2}.${cr_linux_ver3}"
-        expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null || cr_tmp='' # Reject if not matched to pattern
-      fi
-
-      test -n "$cr_tmp" || cr_tmp='not found'
-    elif test -d "$cr_linux_dir"; then
-      cr_tmp='Makefile missing'
-    else
-      cr_tmp='not found'
-    fi
-    eval "$cr_cvname='$cr_tmp'"
-    unset cr_tmp
-
-fi
-
-  eval "cr_result=\$$cr_cvname"
-  unset cr_cvname
-  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
-    { $as_echo "$as_me:$LINENO: result: found version $cr_result" >&5
-$as_echo "found version $cr_result" >&6; }
-  else
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-  fi
-  # Check that version is acceptible (exact match, or a prefix with the next char non-numeric)
-  case "$cr_linux_obj_ver" in
-    ${cr_result}|${cr_result}[!0-9]*)      # the outer [] is m4 quoting
-        cr_linux_src_ver="$cr_result";;
-    *)  cr_linux_src_ver='';;
-  esac
-
-      if test -n "$cr_linux_src_ver"; then
-	LINUX_SRC="$cr_linux_dir"
-	break
-      fi
-  done
-
-  if test -z "$cr_linux_src_ver"; then
-    { { $as_echo "$as_me:$LINENO: error: Could not locate source directory corresponding to build directory '${LINUX_OBJ}'.  Please use --with-linux-src=FULL_PATH_TO_KERNEL_SRC" >&5
-$as_echo "$as_me: error: Could not locate source directory corresponding to build directory '${LINUX_OBJ}'.  Please use --with-linux-src=FULL_PATH_TO_KERNEL_SRC" >&2;}
-   { (exit 1); exit 1; }; }
-  else
-    :
-  fi
-
-
-  else
-    :
-  fi
-
-
-  if test -n "$cr_linux_src_ver" -a -n "$cr_linux_obj_ver"; then
-
-    case "$cr_linux_obj_ver" in
-      2.6.*) HAVE_LINUX_2_6=yes;;
-      3.*.*) HAVE_LINUX_3=yes;;
-    esac
-    LINUX_VER="$cr_linux_obj_ver"
-    CR_KERNEL=`echo $cr_linux_obj_ver | tr - _`
-    CR_KERNEL_BASE=`echo $CR_KERNEL | sed -e 's:smp\|enterprise\|bigmem\|hugemem::g'`
-    test -n "$LINUX_SRC_ARG" && cr_cv_var_LINUX_SRC_ARG="$LINUX_SRC_ARG"
-    test -n "$LINUX_OBJ_ARG" && cr_cv_var_LINUX_OBJ_ARG="$LINUX_OBJ_ARG"
-
-   if test -z "$cache_file" || \
-    test "$cache_file" = /dev/null || \
-    cmp "${LINUX_OBJ}/.config" .cached_kconfig >/dev/null 2>/dev/null; then
-   : # OK - either not caching or cached version still matches
- else
-   if test -f .cached_kconfig; then
-     { $as_echo "$as_me:$LINENO: WARNING: kernel configuration has changed... discarding cached results." >&5
-$as_echo "$as_me: WARNING: kernel configuration has changed... discarding cached results." >&2;}
-     rm -f .cached_kconfig
-   fi
-   for cr_var in cr_cv_kconfig__NON_EMPTY_HACK `(set) | grep "^cr_cv_kconfig_" | cut -d= -f1`; do
-     unset $cr_var
-   done
-   cp "${LINUX_OBJ}/.config" .cached_kconfig
- fi
-
-
-  else
-    :
-  fi
-
-
-if test -z "${HAVE_LINUX_2_6}" -a -z "${HAVE_LINUX_3}"; then
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-   { { $as_echo "$as_me:$LINENO: error: required Linux 2.6.x or 3.x.y kernel headers and/or build not found." >&5
-$as_echo "$as_me: error: required Linux 2.6.x or 3.x.y kernel headers and/or build not found." >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-
-# Module install dir
-
-{ $as_echo "$as_me:$LINENO: checking directory to install kernel modules" >&5
-$as_echo_n "checking directory to install kernel modules... " >&6; }
-if test -n "${CR_MODULE_DIR}"; then
-  cr_why='passed via --with-kmod-dir'
-elif test ${sysconfdir} = /etc; then
-  CR_MODULE_DIR="/lib/modules/${LINUX_VER}/extra"
-  cr_why='default when sysconfdir=/etc'
-else
-  CR_MODULE_DIR="${libdir}/${PACKAGE}/${LINUX_VER}"
-  cr_why='default'
-fi
-{ $as_echo "$as_me:$LINENO: result: ${CR_MODULE_DIR} ($cr_why)" >&5
-$as_echo "${CR_MODULE_DIR} ($cr_why)" >&6; }
-
-# Checks for matching (we hope) symbol table
-
-
-  { $as_echo "$as_me:$LINENO: checking for Linux kernel symbol table" >&5
-$as_echo_n "checking for Linux kernel symbol table... " >&6; }
-
-
-
-
-    if test "${LINUX_SYSTEM_MAP+set}${cr_cv_var_LINUX_SYSTEM_MAP+set}" = setset; then
-    if test "$LINUX_SYSTEM_MAP" != "$cr_cv_var_LINUX_SYSTEM_MAP"; then
-      { { $as_echo "$as_me:$LINENO: error: Cached LINUX_SYSTEM_MAP ($cr_cv_var_LINUX_SYSTEM_MAP) does not match current value ($LINUX_SYSTEM_MAP).  Remove '$cache_file' before re-running configure." >&5
-$as_echo "$as_me: error: Cached LINUX_SYSTEM_MAP ($cr_cv_var_LINUX_SYSTEM_MAP) does not match current value ($LINUX_SYSTEM_MAP).  Remove '$cache_file' before re-running configure." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  elif test "${cr_cv_var_LINUX_SYSTEM_MAP+set}" = set; then
-    LINUX_SYSTEM_MAP="$cr_cv_var_LINUX_SYSTEM_MAP"
-  fi
-
-
-    if test "${LINUX_VMLINUX+set}${cr_cv_var_LINUX_VMLINUX+set}" = setset; then
-    if test "$LINUX_VMLINUX" != "$cr_cv_var_LINUX_VMLINUX"; then
-      { { $as_echo "$as_me:$LINENO: error: Cached LINUX_VMLINUX ($cr_cv_var_LINUX_VMLINUX) does not match current value ($LINUX_VMLINUX).  Remove '$cache_file' before re-running configure." >&5
-$as_echo "$as_me: error: Cached LINUX_VMLINUX ($cr_cv_var_LINUX_VMLINUX) does not match current value ($LINUX_VMLINUX).  Remove '$cache_file' before re-running configure." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  elif test "${cr_cv_var_LINUX_VMLINUX+set}" = set; then
-    LINUX_VMLINUX="$cr_cv_var_LINUX_VMLINUX"
-  fi
-
-  LINUX_SYMTAB_CMD=""
-  # First try validating the user's (or cached) selection
-  if test -n "$LINUX_SYSTEM_MAP" ; then
-
-  if test -n ""$LINUX_SYSTEM_MAP"" -a -r ""$LINUX_SYSTEM_MAP"" && grep -e '[TD] sys_open' -e '[AB] _end' <""$LINUX_SYSTEM_MAP"" >/dev/null 2>/dev/null; then
-    if grep -B1 '[AB] _end' <""$LINUX_SYSTEM_MAP"" | grep _stext >/dev/null 2>/dev/null; then
-      # Reject "stripped" files (such as in FC2)
-      # Recognized (poorly) by _stext and _end as last two entries.
-      cr_stripped_maps="$cr_stripped_maps "$LINUX_SYSTEM_MAP""
-    else
-      LINUX_SYSTEM_MAP=""$LINUX_SYSTEM_MAP""
-      LINUX_SYMTAB_FILE=""$LINUX_SYSTEM_MAP""
-      LINUX_SYMTAB_CMD="cat "$LINUX_SYSTEM_MAP" 2>/dev/null"
-    fi
-  fi
-
-    if test -z "$LINUX_SYMTAB_CMD"; then
-      # The user specified a file, but we can't use it.  Abort.
-      { $as_echo "$as_me:$LINENO: result: failed" >&5
-$as_echo "failed" >&6; }
-      { { $as_echo "$as_me:$LINENO: error: Failed to validate \"$LINUX_SYSTEM_MAP\"" >&5
-$as_echo "$as_me: error: Failed to validate \"$LINUX_SYSTEM_MAP\"" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  fi
-  if test -z "$LINUX_SYMTAB_CMD" -a -n "$LINUX_VMLINUX" ; then
-
-
-  if test -n ""$LINUX_VMLINUX"" -a -r ""$LINUX_VMLINUX"" && ($NM ""$LINUX_VMLINUX"" | grep -e '[TD] sys_open' -e '[AB] _end') >/dev/null 2>/dev/null; then
-    LINUX_VMLINUX=""$LINUX_VMLINUX""
-    LINUX_SYMTAB_FILE=""$LINUX_VMLINUX""
-    LINUX_SYMTAB_CMD="$NM "$LINUX_VMLINUX" 2>/dev/null"
-  fi
-
-    if test -z "$LINUX_SYMTAB_CMD"; then
-      # The user specified a file, but we can't use it.  Abort.
-      { $as_echo "$as_me:$LINENO: result: failed" >&5
-$as_echo "failed" >&6; }
-      { { $as_echo "$as_me:$LINENO: error: Failed to validate \"$LINUX_VMLINUX\"" >&5
-$as_echo "$as_me: error: Failed to validate \"$LINUX_VMLINUX\"" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  fi
-  # Next try searching for System.map or vmlinux in standard locations
-  # Note we use the kernel version found in the headers, not `uname -r`
-  if test -z "$LINUX_SYMTAB_CMD" ; then
-    for cr_file_pattern in "$LINUX_OBJ/@-$LINUX_VER" \
-			   "/boot/@-$LINUX_VER"      \
-			   "/@-$LINUX_VER"           \
-			   "$LINUX_OBJ/@"            \
-			   "/usr/lib/debug/boot/@-$LINUX_VER" \
-			   "/usr/lib/debug/lib/modules/$LINUX_VER/@" \
-			; do
-      # Try System.map in the given location
-      cr_file=`echo $cr_file_pattern | sed -e 's|@|System.map|'`
-
-  if test -n "$cr_file" -a -r "$cr_file" && grep -e '[TD] sys_open' -e '[AB] _end' <"$cr_file" >/dev/null 2>/dev/null; then
-    if grep -B1 '[AB] _end' <"$cr_file" | grep _stext >/dev/null 2>/dev/null; then
-      # Reject "stripped" files (such as in FC2)
-      # Recognized (poorly) by _stext and _end as last two entries.
-      cr_stripped_maps="$cr_stripped_maps $cr_file"
-    else
-      LINUX_SYSTEM_MAP="$cr_file"
-      LINUX_SYMTAB_FILE="$cr_file"
-      LINUX_SYMTAB_CMD="cat $cr_file 2>/dev/null"
-    fi
-  fi
-
-      if test -n "$LINUX_SYMTAB_CMD"; then
-	break
-      fi
-      # Try vmlinux in the given location
-      cr_file=`echo $cr_file_pattern | sed -e 's|@|vmlinux|'`
-
-
-  if test -n "$cr_file" -a -r "$cr_file" && ($NM "$cr_file" | grep -e '[TD] sys_open' -e '[AB] _end') >/dev/null 2>/dev/null; then
-    LINUX_VMLINUX="$cr_file"
-    LINUX_SYMTAB_FILE="$cr_file"
-    LINUX_SYMTAB_CMD="$NM $cr_file 2>/dev/null"
-  fi
-
-      if test -n "$LINUX_SYMTAB_CMD"; then
-	break
-      fi
-    done
-  fi
-  # Announce our result
-  if test -z "$LINUX_SYMTAB_CMD"; then
-    LINUX_SYMTAB_CMD="true"
-    { $as_echo "$as_me:$LINENO: result: failed" >&5
-$as_echo "failed" >&6; }
-    cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
+if ac_fn_c_try_link "$LINENO"; then :
+  cr_result="$cr_tmp"; break
 fi
-rm -f confcache
-    if test -n "$cr_stripped_maps"; then
-      { $as_echo "$as_me:$LINENO: WARNING: Skipped stripped System.map file(s): $cr_stripped_maps" >&5
-$as_echo "$as_me: WARNING: Skipped stripped System.map file(s): $cr_stripped_maps" >&2;}
-      { { $as_echo "$as_me:$LINENO: error: Failed to locate kernel symbol table.  Try installing the kernel-debuginfo package matching your kernel, or using --with-system-map or --with-vmlinux." >&5
-$as_echo "$as_me: error: Failed to locate kernel symbol table.  Try installing the kernel-debuginfo package matching your kernel, or using --with-system-map or --with-vmlinux." >&2;}
-   { (exit 1); exit 1; }; }
-    else
-      { { $as_echo "$as_me:$LINENO: error: Failed to locate kernel symbol table.  Try using --with-system-map or --with-vmlinux." >&5
-$as_echo "$as_me: error: Failed to locate kernel symbol table.  Try using --with-system-map or --with-vmlinux." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-  else
-    { $as_echo "$as_me:$LINENO: result: $LINUX_SYMTAB_FILE" >&5
-$as_echo "$LINUX_SYMTAB_FILE" >&6; }
-    test -n "$LINUX_SYSTEM_MAP" && cr_cv_var_LINUX_SYSTEM_MAP="$LINUX_SYSTEM_MAP"
-    test -n "$LINUX_VMLINUX" && cr_cv_var_LINUX_VMLINUX="$LINUX_VMLINUX"
-
-   if test -z "$cache_file" || \
-    test "$cache_file" = /dev/null || \
-    cmp "${LINUX_SYMTAB_FILE}" .cached_ksymtab >/dev/null 2>/dev/null; then
-   : # OK - either not caching or cached version still matches
- else
-   if test -f .cached_ksymtab; then
-     { $as_echo "$as_me:$LINENO: WARNING: kernel symbol table has changed... discarding cached results." >&5
-$as_echo "$as_me: WARNING: kernel symbol table has changed... discarding cached results." >&2;}
-     rm -f .cached_ksymtab
-   fi
-   for cr_var in cr_cv_ksymtab__NON_EMPTY_HACK `(set) | grep "^cr_cv_ksymtab_" | cut -d= -f1`; do
-     unset $cr_var
-   done
-   cp "${LINUX_SYMTAB_FILE}" .cached_ksymtab
- fi
-
-  fi
-
-
-# Setup CR_KARCH to enable 32-bit user-space on 64-bit kernels
-CR_KARCH=$CR_ARCH
-if test $cr_wordsize = 4; then
-  # Count pointer hex digits in the System.map to id a 64-bit kernel
-  # Based on logic provided by Alan Woodland
-  { $as_echo "$as_me:$LINENO: checking for egrep" >&5
-$as_echo_n "checking for egrep... " >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
-   then ac_cv_path_EGREP="$GREP -E"
-   else
-     if test -z "$EGREP"; then
-  ac_path_EGREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
-# Check for GNU ac_path_EGREP and select it if it is found.
-  # Check for GNU $ac_path_EGREP
-case `"$ac_path_EGREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'EGREP' >> "conftest.nl"
-    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
-    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_EGREP="$ac_path_EGREP"
-      ac_path_EGREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_EGREP_found && break 3
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
     done
-  done
-done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_EGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-else
-  ac_cv_path_EGREP=$EGREP
-fi
-
-   fi
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
-$as_echo "$ac_cv_path_EGREP" >&6; }
- EGREP="$ac_cv_path_EGREP"
-
-
-  { $as_echo "$as_me:$LINENO: checking if kernel and user-space wordsize match" >&5
-$as_echo_n "checking if kernel and user-space wordsize match... " >&6; }
-  if eval $LINUX_SYMTAB_CMD | head | $EGREP '^[a-f0-9]{16}' >/dev/null 2>&1;then
-    { $as_echo "$as_me:$LINENO: result: no (32-bit user-space with 64-bit kernel)" >&5
-$as_echo "no (32-bit user-space with 64-bit kernel)" >&6; }
-    case $CR_KARCH in
-      i386)  CR_KARCH=x86_64;;
-      ppc)   CR_KARCH=ppc64;;
-      sparc) CR_KARCH=sparc64;;
-    esac
-  else
-    { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-  fi
-fi
-
-
-# Configure automake/kbuild glue
-
-
-  { $as_echo "$as_me:$LINENO: checking for parameters to interface GNU automake with Linux kbuild" >&5
-$as_echo_n "checking for parameters to interface GNU automake with Linux kbuild... " >&6; }
-if test "${cr_cv_KBUILD_MAKE_ARGS+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    if grep KBUILD_EXTMOD ${LINUX_SRC}/Makefile >/dev/null 2>/dev/null; then
-      cr_cv_KBUILD_MAKE_ARGS='KBUILD_EXTMOD=$(builddir)'
+    if test -z "$cr_result"; then
+      cr_cv_ftb_libdir="default"
     else
-      cr_cv_KBUILD_MAKE_ARGS='SUBDIRS=$(builddir) modules'
-    fi
-    if test "${LINUX_OBJ}" != "${LINUX_SRC}"; then
-      cr_cv_KBUILD_MAKE_ARGS="${cr_cv_KBUILD_MAKE_ARGS} O=${LINUX_OBJ}"
-    fi
-    if test x$enable_kbuild_verbose = xyes; then
-      cr_cv_KBUILD_MAKE_ARGS="${cr_cv_KBUILD_MAKE_ARGS} V=1"
-    fi
-    if test x$cross_compiling = xyes; then
-      cr_cv_KBUILD_MAKE_ARGS="$cr_cv_KBUILD_MAKE_ARGS ARCH=$CR_KARCH CROSS_COMPILE=$host_alias-"
+      cr_cv_ftb_libdir="$cr_result"
     fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_KBUILD_MAKE_ARGS" >&5
-$as_echo "$cr_cv_KBUILD_MAKE_ARGS" >&6; }
-  KBUILD_MAKE_ARGS="$cr_cv_KBUILD_MAKE_ARGS"
-    # Note: we'll actually try the result in CR_SET_KCFLAGS
-
-
-# Configure module compile flags and perform a sanity check
-
-  case "$CR_KARCH" in
-    ppc64)
-      CR_KSYM_PATTERN_DATA='[bBdDgGrRsStTvV] '
-      CR_KSYM_PATTERN_CODE='[dD] '         ;;
-    *)
-      CR_KSYM_PATTERN_DATA='[bBdDgGrRsStTvV] '
-      CR_KSYM_PATTERN_CODE='[tT] '
-      ;;
-  esac
-
-
-CR_KSYM_IMPORT_DECLS="${TOP_BUILDDIR}/.import_decls"
-
-echo '/* This file is autogenerated - do not edit or remove */' > $CR_KSYM_IMPORT_DECLS
-
-
-
-CR_KSYM_IMPORT_CALLS="${TOP_BUILDDIR}/.import_calls"
-
-echo '/* This file is autogenerated - do not edit or remove */' > $CR_KSYM_IMPORT_CALLS
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking for flags to compile Linux kernel probes" >&5
-$as_echo_n "checking for flags to compile Linux kernel probes... " >&6; }
-if test "${cr_cv_kconfig_kcflags+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-  rm -rf conftestdir
-  mkdir conftestdir
-  echo '#include <linux/sched.h>' > conftestdir/conftest.c
-  echo 'int foo = 0;' >> conftestdir/conftest.c
-  echo 'obj-m := conftest.o' >conftestdir/Makefile
-  unset cr_tmp
-  echo "make -C ${LINUX_SRC} builddir=\"`pwd`/conftestdir\" ${KBUILD_MAKE_ARGS} CC=\"${KCC}\" V=1" >&5
-  make -C ${LINUX_SRC} builddir="`pwd`/conftestdir" ${KBUILD_MAKE_ARGS} CC="${KCC}" V=1 >conftestdir/output 2>&1 </dev/null
-  if test $? = 0; then cr_tmp=`grep -m1 conftest\\.c conftestdir/output | sed -e "s:^[ 	]*${KCC}::"`; fi
-  cat conftestdir/output >&5
-  if test "${cr_tmp:+OK}" != OK; then
-      { $as_echo "$as_me:$LINENO: result: FAILED" >&5
-$as_echo "FAILED" >&6; }
-      cat conftestdir/output
-      if $EGREP 'include/(asm|linux)/[a-zA-Z0-9_-]+\.h:' conftestdir/output >/dev/null 2>&1; then
-        { $as_echo "$as_me:$LINENO: WARNING: Apparent compilation problem in ${LINUX_SRC}" >&5
-$as_echo "$as_me: WARNING: Apparent compilation problem in ${LINUX_SRC}" >&2;}
-	ver=`$KCC --version | head -1`
-        { $as_echo "$as_me:$LINENO: WARNING: Perhaps KCC='$KCC' ($ver) is not compatible with this kernel source" >&5
-$as_echo "$as_me: WARNING: Perhaps KCC='$KCC' ($ver) is not compatible with this kernel source" >&2;}
-	if test $cr_wordsize -gt $ac_cv_sizeof_void_p; then
-	  echo "$KCC" | grep -e '-m64' >/dev/null 2>/dev/null
-	  if test $? != 0; then
-            { $as_echo "$as_me:$LINENO: WARNING: You might try setting KCC='$KCC -m64'" >&5
-$as_echo "$as_me: WARNING: You might try setting KCC='$KCC -m64'" >&2;}
-          fi
-        fi
-      fi
-      if grep -i 'permission denied' conftestdir/output >/dev/null 2>&1; then
-        { $as_echo "$as_me:$LINENO: WARNING: Apparent permissions problem in ${LINUX_SRC}" >&5
-$as_echo "$as_me: WARNING: Apparent permissions problem in ${LINUX_SRC}" >&2;}
-      fi
-      rm -rf conftestdir
-      { { $as_echo "$as_me:$LINENO: error: Failed test run of kernel make/kbuild failed (see above)" >&5
-$as_echo "$as_me: error: Failed test run of kernel make/kbuild failed (see above)" >&2;}
-   { (exit 1); exit 1; }; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_ftb_libdir" >&5
+$as_echo "$cr_cv_ftb_libdir" >&6; }
+  if test x"$cr_cv_ftb_libdir" = xno; then
+    cr_have_ftb=no
+  elif test x"$cr_cv_ftb_libdir" != "xdefault"; then
+    CR_FTB_LDFLAGS="-L$cr_cv_ftb_libdir"
+    CR_FTB_LDADD="-lftb"
   fi
-  rm -rf conftestdir
-  cr_cv_kconfig_kcflags=''
-  prev_del=''
-  prev_inc=''
-  for arg in ${cr_tmp}; do
-    if test -n "$prev_del"; then # skip this arg at request of prev arg
-      prev_del=''
-      continue
-    fi
-    arg=`echo $arg | tr -d "\"'"` # remove quote marks
-    if test -n "$prev_inc"; then # prev arg says this arg is an -include
-      prev_inc=''
-      case "$arg" in
-	*include/linux/modversions.h) continue;;
-	/*) arg="-include $arg";;
-	*) arg="-include ${LINUX_OBJ}/$arg";;
-      esac
-    else
-      case "$arg" in
-	-o) prev_del=1; continue;;
-	-include) prev_inc=1; continue;;
-	-c) continue;;
-	conftest.c) continue;;
-	/*/conftest.c) continue;;
-	-Wp,-MD,*) continue;;
-	-Wp,-MMD,*) continue;;
-	-I/*) ;;
-	-I*) arg=`echo $arg | sed -e "s:-I:-I${LINUX_OBJ}/:"`;;
-      esac
-    fi
-    cr_cv_kconfig_kcflags="$cr_cv_kconfig_kcflags $arg"
-  done
-fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_kconfig_kcflags" >&5
-$as_echo "$cr_cv_kconfig_kcflags" >&6; }
-  KCFLAGS="$cr_cv_kconfig_kcflags"
-    { $as_echo "$as_me:$LINENO: checking if autoconf.h or kconfig.h is included implicitly" >&5
-$as_echo_n "checking if autoconf.h or kconfig.h is included implicitly... " >&6; }
-  if echo "$KCFLAGS" | grep -e 'include [^ ]*/autoconf\.h' -e 'include [^ ]*/kconfig\.h' >/dev/null 2>&1; then
-    { $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; };
-  else
-    { $as_echo "$as_me:$LINENO: result: no" >&5
-$as_echo "no" >&6; };
-    cat >>confdefs.h <<\_ACEOF
-#define CR_NEED_AUTOCONF_H 1
-_ACEOF
-
-
-
+  LIBS="$SAVE_LIBS"
+  LDFLAGS="$SAVE_LDFLAGS"
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  if test x"$cr_have_ftb$cr_force_ftb" = xnoyes; then
+    as_fn_error $? "Configured with --with-ftb='$FTB_HOME', but unable to build FTB test case" "$LINENO" 5
   fi
-  # Do these init steps early, in case first CR_FIND_KSYM is a conditional call
-
-
-
-
-# Now we can check if SYMTAB matches the kernel
-
-  { $as_echo "$as_me:$LINENO: checking for SMP kernel source" >&5
-$as_echo_n "checking for SMP kernel source... " >&6; }
-
-    if test "${cr_cv_kconfig_smp_source+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-
-	#ifdef CR_NEED_AUTOCONF_H
-	  #include <linux/autoconf.h>
-	#endif
-	#ifndef CONFIG_SMP
-	    choke me
-	#endif
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_smp_source=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_smp_source=no
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
-fi
+ fi
 
-  cr_result=$cr_cv_kconfig_smp_source
+  if test x$cr_have_ftb = xyes; then
+    $as_echo "#define HAVE_FTB 1" >>confdefs.h
 
-  if test $cr_result = yes; then
-    :
   else
-    :
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; };
-  cr_kernel_smp=$cr_result
-  { $as_echo "$as_me:$LINENO: checking for SMP kernel symbol table" >&5
-$as_echo_n "checking for SMP kernel symbol table... " >&6; }
-  cr_symtab_smp=no
-  if test -n "`eval $LINUX_SYMTAB_CMD | grep del_timer_sync 2>/dev/null | grep -v try_to_del_`"; then
-    cr_symtab_smp=yes
-  fi
-  { $as_echo "$as_me:$LINENO: result: $cr_symtab_smp" >&5
-$as_echo "$cr_symtab_smp" >&6; };
-  if test "$cr_kernel_smp" != "$cr_symtab_smp"; then
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
+    $as_echo "#define HAVE_FTB 0" >>confdefs.h
 
-    if test "$cr_kernel_smp" = yes; then
-      { { $as_echo "$as_me:$LINENO: error: Kernel source is configured SMP but the kernel symbol table is not.  Consider specifying a symbol table with --with-system-map or --with-vmlinux.  Or, if using kernel sources that are configured by /boot/kernel.h, you may try --with-kernel-type=UP to force a uni-processor interpretation of the sources." >&5
-$as_echo "$as_me: error: Kernel source is configured SMP but the kernel symbol table is not.  Consider specifying a symbol table with --with-system-map or --with-vmlinux.  Or, if using kernel sources that are configured by /boot/kernel.h, you may try --with-kernel-type=UP to force a uni-processor interpretation of the sources." >&2;}
-   { (exit 1); exit 1; }; }
-    else
-      { { $as_echo "$as_me:$LINENO: error: Kernel source is configured uni-processor but the kernel symbol table is SMP.  Consider specifying a symbol table with --with-system-map or --with-vmlinux.  Or, if using kernel sources that are configured by /boot/kernel.h, you may try --with-kernel-type=SMP to force an SMP interpretation of the sources." >&5
-$as_echo "$as_me: error: Kernel source is configured uni-processor but the kernel symbol table is SMP.  Consider specifying a symbol table with --with-system-map or --with-vmlinux.  Or, if using kernel sources that are configured by /boot/kernel.h, you may try --with-kernel-type=SMP to force an SMP interpretation of the sources." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
   fi
 
 
-## Check for optional kernel headers...
-
-
 
+fi # cr_build_libcr
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/syscalls.h" >&5
-$as_echo_n "checking kernel for linux/syscalls.h... " >&6; }
+# Probe libc for the RT signal number to use
 
-    if test "${cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H+set}" = set; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value of CR_SIGNUM" >&5
+$as_echo_n "checking for value of CR_SIGNUM... " >&6; }
+if ${cr_cv_check_cr_signum+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_check_cr_signum="failed"
+    SAVE_LIBS="$LIBS"
+    LIBS="-ldl -lpthread $LIBS"
+    if test "$cross_compiling" = yes; then :
 
+  if test "${cross_signum-unset}" = unset; then
+    as_fn_error $? "When cross-compiling, variable cross_signum must be set." "$LINENO" 5
+  fi
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-
-
-   #include <linux/syscalls.h>
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_SYSCALLS_H 1
-_ACEOF
-
-     HAVE_LINUX_SYSCALLS_H=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_SYSCALLS_H 0
-_ACEOF
-
-     HAVE_LINUX_SYSCALLS_H=''
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/pspace.h" >&5
-$as_echo_n "checking kernel for linux/pspace.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_LINUX_PSPACE_H+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-
+	 cr_cv_check_cr_signum=$cross_signum
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+	#include <dlfcn.h>
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+	extern int __libc_allocate_rtsig(int);
+	int main()
+	{
+	  int s = -1;
+	  FILE *f=fopen("conftestval", "w");
+	  void *dlhandle = dlopen(NULL, RTLD_LAZY);
+	  if (dlhandle) {
+	    int *tmp = (int *)dlsym(dlhandle, "cri_signum");
+	    dlclose(dlhandle);
+	    if (tmp) s = *tmp;
+	  }
+	  if (s <= 0) {
+	    s=__libc_allocate_rtsig(0);
+	  }
+	  if (!f || s<=0) return(1);
+	  fprintf(f, "%d\n", s);
+	  return(0);
+	}
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+if ac_fn_c_try_run "$LINENO"; then :
+  cr_cv_check_cr_signum=`cat conftestval`
+else
+  as_fn_error $? "Failed to probe CR_SIGNUM" "$LINENO" 5
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
 
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
+    LIBS="$SAVE_LIBS"
 
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_check_cr_signum" >&5
+$as_echo "$cr_cv_check_cr_signum" >&6; }
+  CR_SIGNUM=$cr_cv_check_cr_signum
 
-   #include <linux/pspace.h>
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_PSPACE_H=yes
+# Check for 32- or 64-bit architecture
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of void *" >&5
+$as_echo_n "checking size of void *... " >&6; }
+if ${ac_cv_sizeof_void_p+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  if ac_fn_c_compute_int "$LINENO" "(long int) (sizeof (void *))" "ac_cv_sizeof_void_p"        "$ac_includes_default"; then :
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_PSPACE_H=no
+else
+  if test "$ac_cv_type_void_p" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (void *)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_void_p=0
+   fi
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_void_p" >&5
+$as_echo "$ac_cv_sizeof_void_p" >&6; }
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_PSPACE_H
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_PSPACE_H 1
-_ACEOF
 
-     HAVE_LINUX_PSPACE_H=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_PSPACE_H 0
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_VOID_P $ac_cv_sizeof_void_p
 _ACEOF
 
-     HAVE_LINUX_PSPACE_H=''
+
+CR_LIBARCH=$CR_ARCH
+if test $ac_cv_sizeof_void_p != $cr_wordsize; then
+  if test $cr_wordsize = 8; then
+    CR_LIBARCH=${CR_LIBARCH32:-$CR_ARCH32}
+  else
+    as_fn_error $? "CC='$CC' yields sizeof(void *) = $ac_cv_sizeof_void_p when expecting $cr_wordsize.$clue" "$LINENO" 5
   fi
+fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+################################################################################
+# Sub-configure for 32-bit libs on 64-bit platforms
+################################################################################
 
+cr_build_libcr32=no
+if test x"$enable_multilib" = xyes; then
+  if test x"$cr_build_libcr" != xyes; then
+    as_fn_error $? "--enable-multilib requested but not building libcr" "$LINENO" 5
+  elif test -f "${TOP_BUILDDIR}/configure.ac"; then # More robust than TOP_BUILDDIR == TOP_SRCDIR
+    as_fn_error $? "When requesting --enable-multilib, you must configure/build in a directory other than the one holding the BLCR sources" "$LINENO" 5
+  elif test -z "$CR_ARCH32"; then
+    as_fn_error $? "--enable-multilib not supported on architecture $CR_ARCH" "$LINENO" 5
+  elif test $ac_cv_sizeof_void_p = 4; then
+    as_fn_error $? "--enable-multilib requested but CC='$CC' generates 32-bit objects.  Perhaps try configuring with CC='$CC -m64' or similar." "$LINENO" 5
+  elif test \! -d /lib64; then
+    as_fn_error $? "--enable-multilib requested but /lib64 does not exist" "$LINENO" 5
+  fi
+  if test -z "$libdir32"; then
+    if expr "$libdir" : '.*/lib64$' >/dev/null; then
+      libdir32=`echo $libdir | sed -e 's/64$//'`
+    elif test "$libdir" = '${exec_prefix}/lib'; then
+      libdir32='${exec_prefix}/lib'
+      libdir='${exec_prefix}/lib64'
+    else
+      as_fn_error $? "--enable-multilib requested but libdir='$libdir' does not end in 'lib64'" "$LINENO" 5;
+    fi
+  fi
+  SUBCMD="${TOP_SRCDIR}/configure '--srcdir=${TOP_SRCDIR}' '--build=${CR_ARCH32}-linux' '--libdir=${libdir32}' --with-components=libcr,tests,examples"
+  eval set -- $ac_configure_args
+  for x in "$@"; do
+    case "$x" in
+      --host=*|--build=*|--target=*|host_alias=*|build_alias=*|target_alias=*|--libdir=*|--srcdir=*|--with-components=*|--enable-multilib|--enable-testsuite|--enable-init-script|CFLAGS=*|CXXFLAGS=*)
+	# skip
+	;;
+      *)
+	# keep as-is
+	SUBCMD="$SUBCMD '$x'"
+	;;
+    esac
+  done
+  # Strip -m64 out of CFLAGS and CXXFLAGS, if present
+  if test -n "$CFLAGS32"; then
+    SUBCMD="$SUBCMD 'CFLAGS=$CFLAGS32'"
+  elif test -n "$CFLAGS"; then
+    set --
+    for x in $CFLAGS; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
+    SUBCMD="$SUBCMD 'CFLAGS=$@'"
+  fi
+  if test -n "$CXXFLAGS32"; then
+    SUBCMD="$SUBCMD 'CXXFLAGS=$CXXFLAGS32'"
+  elif test -n "$CXXFLAGS"; then
+    set --
+    for x in $CXXFLAGS; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
+    SUBCMD="$SUBCMD 'CXXFLAGS=$@'"
+  fi
+  # Strip -m64 from definitions of CC and CXX, adding -m32
+  if test -n "$CC32"; then
+    SUBCMD="$SUBCMD 'CC=$CC32'"
+  else
+    set --
+    for x in $CC; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
+    SUBCMD="$SUBCMD 'CC=$@ -m32'"
+  fi
+  if test -n "$CXX32"; then
+    SUBCMD="$SUBCMD 'CXX=$CXX32'"
+  elif test -n "$CXX" -a "$CXX" != no; then
+    set --
+    for x in $CXX; do test x"$x" = "x-m64" || set -- "$@" "$x"; done
+    SUBCMD="$SUBCMD 'CXX=$@ -m32'"
+  fi
+  # Look for 32-bit versions of remaining bin tools
+  if test -n "$CPP32"; then
+    SUBCMD="$SUBCMD 'CPP=$CPP32'"
+  fi
+  if test -n "$LD32"; then
+    SUBCMD="$SUBCMD 'LD=$LD32'"
+  fi
+  if test -n "$AR32"; then
+    SUBCMD="$SUBCMD 'AR=$AR32'"
+  fi
+  if test -n "$NM32"; then
+    SUBCMD="$SUBCMD 'NM=$NM32'"
+  fi
+  if test -n "$RANLIB32"; then
+    SUBCMD="$SUBCMD 'RANLIB=$RANLIB32'"
+  fi
+  # Others?
+  { $as_echo "$as_me:${as_lineno-$LINENO}: >>>> BEGIN sub-configure for 32-bit libs >>>>" >&5
+$as_echo "$as_me: >>>> BEGIN sub-configure for 32-bit libs >>>>" >&6;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: ${SUBCMD}" >&5
+$as_echo "$as_me: ${SUBCMD}" >&6;}
+  ( mkdir -p libcr32 && cd libcr32 && ln -sf ../util . && eval "${SUBCMD}" )
+  if test "$?" = 0; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: <<<< END sub-configure for 32-bit libs <<<<" >&5
+$as_echo "$as_me: <<<< END sub-configure for 32-bit libs <<<<" >&6;}
+    cr_build_libcr32=yes
+  else
+    rm -rf libcr32
+    as_fn_error $? "--enable-multilib requested but FAILED sub-configure for 32-bit libs" "$LINENO" 5
+  fi
+fi
+ if test x$cr_build_libcr32 = xyes; then
+  CR_BUILD_LIBCR32_TRUE=
+  CR_BUILD_LIBCR32_FALSE='#'
+else
+  CR_BUILD_LIBCR32_TRUE='#'
+  CR_BUILD_LIBCR32_FALSE=
+fi
 
 
+################################################################################
+# Check kernel (source location, symbol table, features, etc.)
+################################################################################
 
+if test x"$cr_build_modules" = xyes; then
 
+# Compiler to build kernel modules
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking compiler to build kernel modules" >&5
+$as_echo_n "checking compiler to build kernel modules... " >&6; }
+if test -n "${KCC}"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $KCC (user setting)" >&5
+$as_echo "$KCC (user setting)" >&6; }
+else
+  KCC=$CC
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $KCC (default)" >&5
+$as_echo "$KCC (default)" >&6; }
+fi
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/pid_namespace.h" >&5
-$as_echo_n "checking kernel for linux/pid_namespace.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H+set}" = set; then
+# Find BSD-compatible NM command
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for BSD- or MS-compatible name lister (nm)" >&5
+$as_echo_n "checking for BSD- or MS-compatible name lister (nm)... " >&6; }
+if ${lt_cv_path_NM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
+  if test -n "$NM"; then
+  # Let the user override the test.
+  lt_cv_path_NM="$NM"
+else
+  lt_nm_to_check="${ac_tool_prefix}nm"
+  if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
+    lt_nm_to_check="$lt_nm_to_check nm"
+  fi
+  for lt_tmp_nm in $lt_nm_to_check; do
+    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+    for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
+      IFS="$lt_save_ifs"
+      test -z "$ac_dir" && ac_dir=.
+      tmp_nm="$ac_dir/$lt_tmp_nm"
+      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
+	# Check to see if the nm accepts a BSD-compat flag.
+	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
+	#   nm: unknown option "B" ignored
+	# Tru64's nm complains that /dev/null is an invalid object file
+	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
+	*/dev/null* | *'Invalid file or object type'*)
+	  lt_cv_path_NM="$tmp_nm -B"
+	  break
+	  ;;
+	*)
+	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
+	  */dev/null*)
+	    lt_cv_path_NM="$tmp_nm -p"
+	    break
+	    ;;
+	  *)
+	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
+	    continue # so that we can try to find one that supports BSD flags
+	    ;;
+	  esac
+	  ;;
+	esac
+      fi
+    done
+    IFS="$lt_save_ifs"
+  done
+  : ${lt_cv_path_NM=no}
+fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_NM" >&5
+$as_echo "$lt_cv_path_NM" >&6; }
+if test "$lt_cv_path_NM" != "no"; then
+  NM="$lt_cv_path_NM"
+else
+  # Didn't find any BSD compatible name lister, look for dumpbin.
+  if test -n "$DUMPBIN"; then :
+    # Let the user override the test.
+  else
+    if test -n "$ac_tool_prefix"; then
+  for ac_prog in dumpbin "link -dump"
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_DUMPBIN+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$DUMPBIN"; then
+  ac_cv_prog_DUMPBIN="$DUMPBIN" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+DUMPBIN=$ac_cv_prog_DUMPBIN
+if test -n "$DUMPBIN"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DUMPBIN" >&5
+$as_echo "$DUMPBIN" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
+    test -n "$DUMPBIN" && break
+  done
+fi
+if test -z "$DUMPBIN"; then
+  ac_ct_DUMPBIN=$DUMPBIN
+  for ac_prog in dumpbin "link -dump"
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_DUMPBIN+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_DUMPBIN"; then
+  ac_cv_prog_ac_ct_DUMPBIN="$ac_ct_DUMPBIN" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
+fi
+fi
+ac_ct_DUMPBIN=$ac_cv_prog_ac_ct_DUMPBIN
+if test -n "$ac_ct_DUMPBIN"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_DUMPBIN" >&5
+$as_echo "$ac_ct_DUMPBIN" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
 
-   #include <linux/pid_namespace.h>
 
-int
-main ()
-{
+  test -n "$ac_ct_DUMPBIN" && break
+done
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  if test "x$ac_ct_DUMPBIN" = x; then
+    DUMPBIN=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H=no
+    DUMPBIN=$ac_ct_DUMPBIN
+  fi
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
+    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    *COFF*)
+      DUMPBIN="$DUMPBIN -symbols"
+      ;;
+    *)
+      DUMPBIN=:
+      ;;
+    esac
+  fi
 
+  if test "$DUMPBIN" != ":"; then
+    NM="$DUMPBIN"
+  fi
 fi
+test -z "$NM" && NM=nm
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_PID_NAMESPACE_H 1
-_ACEOF
 
-     HAVE_LINUX_PID_NAMESPACE_H=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_PID_NAMESPACE_H 0
-_ACEOF
 
-     HAVE_LINUX_PID_NAMESPACE_H=''
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the name lister ($NM) interface" >&5
+$as_echo_n "checking the name lister ($NM) interface... " >&6; }
+if ${lt_cv_nm_interface+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_nm_interface="BSD nm"
+  echo "int some_variable = 0;" > conftest.$ac_ext
+  (eval echo "\"\$as_me:$LINENO: $ac_compile\"" >&5)
+  (eval "$ac_compile" 2>conftest.err)
+  cat conftest.err >&5
+  (eval echo "\"\$as_me:$LINENO: $NM \\\"conftest.$ac_objext\\\"\"" >&5)
+  (eval "$NM \"conftest.$ac_objext\"" 2>conftest.err > conftest.out)
+  cat conftest.err >&5
+  (eval echo "\"\$as_me:$LINENO: output\"" >&5)
+  cat conftest.out >&5
+  if $GREP 'External.*some_variable' conftest.out > /dev/null; then
+    lt_cv_nm_interface="MS dumpbin"
   fi
+  rm -f conftest*
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_nm_interface" >&5
+$as_echo "$lt_cv_nm_interface" >&6; }
 
+NM=$NM
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
 
+# First deal with user-specified kernel type (UP, SMP, BIGMEM, etc.) if any.
+case x"$with_kernel_type" in
+  x|xyes|xno) ;;
+  *)
+  cr_kernel_type=`echo "$with_kernel_type" | tr 'a-z' 'A-Z'`
+  cr_header="/boot/kernel.h"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $cr_header" >&5
+$as_echo_n "checking for $cr_header... " >&6; };
+  cr_result=ok
+  if test \! -e "$cr_header"; then
+    cr_result='missing'
+  elif test \! -r "$cr_header"; then
+    cr_result='not readable'
+  fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+  if test "$cr_result" != "ok"; then
+    as_fn_error $? "You have requested '--with-kernel-type=$cr_kernel_type', but $cr_header is $cr_result." "$LINENO" 5
+  fi
+  cr_kernel_var="__BOOT_KERNEL_$cr_kernel_type"
+  if test -z "`grep \"$cr_kernel_var\" $cr_header 2>/dev/null`"; then
+    as_fn_error $? "You have requested '--with-kernel-type=$cr_kernel_type', but $cr_header does not appear to support that type." "$LINENO" 5
+  fi
+  # The following sed command transforms all the #ifndef lines from kernel.h into
+  # corresponding preprocessor flags (on one line) which select the desired kernel type.
+  # Note use of [] for m4 quoting of a sed command containing [ and ]
+  CR_KTYPE_CPPFLAGS=`sed -n -e '/^#ifndef \('$cr_kernel_var'\)$/ {s//-D\1=1 /;H;}' \
+			     -e '/^#ifndef \(__BOOT_KERNEL_[A-Z]*\)$/ {s//-D\1=0 /;H;}' \
+			     -e '$ {x;s/[ \t\n]\+/ /g;s/^ //;s/ $//;p;}' \
+			     $cr_header`
 
+esac
+# Checks for required kernel src/obj dirs and fail if they are not found
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/lockdep.h" >&5
-$as_echo_n "checking kernel for linux/lockdep.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
 
 
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+    if test "${LINUX_OBJ_ARG+set}${cr_cv_var_LINUX_OBJ_ARG+set}" = setset; then
+    if test "$LINUX_OBJ_ARG" != "$cr_cv_var_LINUX_OBJ_ARG"; then
+      as_fn_error $? "Cached LINUX_OBJ_ARG ($cr_cv_var_LINUX_OBJ_ARG) does not match current value ($LINUX_OBJ_ARG).  Remove '$cache_file' before re-running configure." "$LINENO" 5
+    fi
+  elif test "${cr_cv_var_LINUX_OBJ_ARG+set}" = set; then
+    LINUX_OBJ_ARG="$cr_cv_var_LINUX_OBJ_ARG"
+  fi
 
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
+  if expr X"$LINUX_OBJ_ARG" : X/ >/dev/null; then
+    # User provided a path
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for Linux kernel build in ${LINUX_OBJ_ARG}" >&5
+$as_echo_n "checking for Linux kernel build in ${LINUX_OBJ_ARG}... " >&6; }
+  cr_cvname=cr_cv_kernel_obj_`$as_echo "${LINUX_OBJ_ARG}" | $as_tr_sh`
+  if eval \${${cr_cvname}+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
-   #include <linux/lockdep.h>
+    if test -d "${LINUX_OBJ_ARG}"; then
+      # Check for version.h
 
-int
-main ()
-{
+  for cr_version_h in ${LINUX_OBJ_ARG}/include/linux/version.h ${LINUX_OBJ_ARG}/include/generated/uapi/linux/version.h none; do
+    test -r $cr_version_h && break
+  done
+  if test $cr_version_h = none; then
+    cr_tmp='version.h missing'
+  else
+    cr_tmp=`  $PERL -- - "${LINUX_OBJ_ARG}" "$KCC -E -I${LINUX_OBJ_ARG}/include -D__KERNEL__ -DMODULE $CR_KTYPE_CPPFLAGS $CPPFLAGS" <<'_EOF_'
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+    my ($srcdir, $cpp_cmd) = @ARGV;
+    my $stamp = time;
+    $cpp_cmd =~ s/([#()])/\\${LINUX_OBJ_ARG}/g; # quote problematic shell metachars
+    FILE: foreach my $file (qw(linux/version.h linux/utsrelease.h generated/utsrelease.h)) {
+      my $path = "$srcdir/include/$file";
+      next FILE unless (-f $path);
+      open(F, "echo '=${stamp}->UTS_RELEASE<-' | ${cpp_cmd} -include ${path} - |") || exit 1;
+      LINE: while (<F>) {
+        next LINE if(/^#/);
+        if ((my $uts) = /=${stamp}->"((2\.6|3\.[0-9]+)\.[0-9].*)"<-/o) {
+          print "$uts\n";
+          exit 0;
+        }
+      }
+      close(F) || exit 1;
+    }
+    exit 1;
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H=no
-fi
+_EOF_
+`
+    test $? = 0 || cr_tmp='no UTS_RELEASE could be extracted'
+    LINUX_VERSION_H=$cr_version_h
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  fi
 
+      # Check for .config if required
+      if expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+        test -r "${LINUX_OBJ_ARG}/.config" || cr_tmp='.config missing'
+      fi
+    else
+      cr_tmp='not found'
+    fi
+    eval "$cr_cvname='$cr_tmp'"
+    unset cr_tmp
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_LOCKDEP_H 1
-_ACEOF
-
-     HAVE_LINUX_LOCKDEP_H=1
+  eval "cr_result=\$$cr_cvname"
+  unset cr_cvname
+  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: found version $cr_result" >&5
+$as_echo "found version $cr_result" >&6; }
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_LOCKDEP_H 0
-_ACEOF
-
-     HAVE_LINUX_LOCKDEP_H=''
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
+  fi
+  # Check that version appears acceptible
 
+  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+    cr_linux_obj_ver="$cr_result"
+  else
+    cr_linux_obj_ver=''
+  fi
 
 
 
+  if test -z "$cr_linux_obj_ver"; then
+    as_fn_error $? "Directory ${LINUX_OBJ_ARG} does not appear to contain a Linux kernel build" "$LINENO" 5
+  else
+    :
+  fi
 
+    LINUX_OBJ="${LINUX_OBJ_ARG}"
+  else
+    if test -z "$LINUX_OBJ_ARG"; then
+      cr_tmp_ver=`uname -r`
+    elif expr "$LINUX_OBJ_ARG" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+      cr_tmp_ver="$LINUX_OBJ_ARG"
+    else
+      as_fn_error $? "--with-linux argument '$LINUX_OBJ_ARG' is neither a kernel version string nor a full path" "$LINENO" 5
+    fi
+    cr_ver_patt="`echo $cr_tmp_ver | sed -e 's/\./\\\\./g;'`\$"
+    # Search standard locations
+    for cr_linux_dir in \
+			/lib/modules/${cr_tmp_ver}/build \
+			/usr/src/linux-${cr_tmp_ver}-obj \
+			/usr/src/linux-${cr_tmp_ver} \
+			/usr/src/linux-headers-${cr_tmp_ver} \
+	     		/usr/src/kernels/${cr_tmp_ver} \
+			; do
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/compile.h" >&5
-$as_echo_n "checking kernel for linux/compile.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_LINUX_COMPILE_H+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for Linux kernel build in ${cr_linux_dir}" >&5
+$as_echo_n "checking for Linux kernel build in ${cr_linux_dir}... " >&6; }
+  cr_cvname=cr_cv_kernel_obj_`$as_echo "${cr_linux_dir}" | $as_tr_sh`
+  if eval \${${cr_cvname}+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    if test -d "${cr_linux_dir}"; then
+      # Check for version.h
 
+  for cr_version_h in ${cr_linux_dir}/include/linux/version.h ${cr_linux_dir}/include/generated/uapi/linux/version.h none; do
+    test -r $cr_version_h && break
+  done
+  if test $cr_version_h = none; then
+    cr_tmp='version.h missing'
+  else
+    cr_tmp=`  $PERL -- - "${cr_linux_dir}" "$KCC -E -I${cr_linux_dir}/include -D__KERNEL__ -DMODULE $CR_KTYPE_CPPFLAGS $CPPFLAGS" <<'_EOF_'
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-
+    my ($srcdir, $cpp_cmd) = @ARGV;
+    my $stamp = time;
+    $cpp_cmd =~ s/([#()])/\\${cr_linux_dir}/g; # quote problematic shell metachars
+    FILE: foreach my $file (qw(linux/version.h linux/utsrelease.h generated/utsrelease.h)) {
+      my $path = "$srcdir/include/$file";
+      next FILE unless (-f $path);
+      open(F, "echo '=${stamp}->UTS_RELEASE<-' | ${cpp_cmd} -include ${path} - |") || exit 1;
+      LINE: while (<F>) {
+        next LINE if(/^#/);
+        if ((my $uts) = /=${stamp}->"((2\.6|3\.[0-9]+)\.[0-9].*)"<-/o) {
+          print "$uts\n";
+          exit 0;
+        }
+      }
+      close(F) || exit 1;
+    }
+    exit 1;
 
-   #include <linux/compile.h>
+_EOF_
+`
+    test $? = 0 || cr_tmp='no UTS_RELEASE could be extracted'
+    LINUX_VERSION_H=$cr_version_h
 
-int
-main ()
-{
+  fi
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_COMPILE_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+      # Check for .config if required
+      if expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+        test -r "${cr_linux_dir}/.config" || cr_tmp='.config missing'
+      fi
+    else
+      cr_tmp='not found'
+    fi
+    eval "$cr_cvname='$cr_tmp'"
+    unset cr_tmp
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_COMPILE_H=no
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
+  eval "cr_result=\$$cr_cvname"
+  unset cr_cvname
+  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: found version $cr_result" >&5
+$as_echo "found version $cr_result" >&6; }
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+  fi
+  # Check that version appears acceptible
 
-fi
+  if expr "$cr_result" : ${cr_ver_patt} >/dev/null; then
+    cr_linux_obj_ver="$cr_result"
+  else
+    cr_linux_obj_ver=''
+  fi
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_COMPILE_H
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_COMPILE_H 1
-_ACEOF
+      if test -n "$cr_linux_obj_ver"; then
+        LINUX_OBJ="${cr_linux_dir}"
+        break
+      fi
+    done
 
-     HAVE_LINUX_COMPILE_H=1
+  if test -z "$cr_linux_obj_ver"; then
+    as_fn_error $? "Could not find a directory containing a Linux kernel ${cr_tmp_ver} build.  Perhaps try --with-linux=FULL_PATH_TO_KERNEL_BUILD" "$LINENO" 5
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_COMPILE_H 0
-_ACEOF
-
-     HAVE_LINUX_COMPILE_H=''
+    :
   fi
 
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
+    unset cr_tmp_ver
+  fi
 
 
+  if test -n "$cr_linux_obj_ver"; then
 
+  cr_linux_src_ver=''
 
+    if test "${LINUX_SRC_ARG+set}${cr_cv_var_LINUX_SRC_ARG+set}" = setset; then
+    if test "$LINUX_SRC_ARG" != "$cr_cv_var_LINUX_SRC_ARG"; then
+      as_fn_error $? "Cached LINUX_SRC_ARG ($cr_cv_var_LINUX_SRC_ARG) does not match current value ($LINUX_SRC_ARG).  Remove '$cache_file' before re-running configure." "$LINENO" 5
+    fi
+  elif test "${cr_cv_var_LINUX_SRC_ARG+set}" = set; then
+    LINUX_SRC_ARG="$cr_cv_var_LINUX_SRC_ARG"
+  fi
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/fdtable.h" >&5
-$as_echo_n "checking kernel for linux/fdtable.h... " >&6; }
+  if expr X"$LINUX_SRC_ARG" : X/ >/dev/null; then
+    cr_list="$LINUX_SRC_ARG"
+  elif test -n "$LINUX_SRC_ARG"; then
+    as_fn_error $? "--with-linux-src argument '$LINUX_SRC_ARG' is not a full path" "$LINENO" 5
+  else
+    # Search standard locations
+    cr_list="${LINUX_OBJ} \
+	     /lib/modules/$cr_linux_obj_ver/source \
+	     /usr/src/linux-$cr_linux_obj_ver \
+	     /usr/src/linux-headers-$cr_linux_obj_ver \
+	     /usr/src/kernels/$cr_linux_obj_ver"
+  fi
+  for cr_linux_dir in $cr_list; do
 
-    if test "${cr_cv_kconfig_HAVE_LINUX_FDTABLE_H+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for Linux kernel source in $cr_linux_dir" >&5
+$as_echo_n "checking for Linux kernel source in $cr_linux_dir... " >&6; }
+  cr_cvname=cr_cv_kernel_src_`$as_echo "$cr_linux_dir" | $as_tr_sh`
+  if eval \${${cr_cvname}+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_tmp=''
+    if test -e "$cr_linux_dir/Makefile"; then
+      # First try using version.h, as some distros play odd games w/ the Makefile
 
+  for cr_version_h in $cr_linux_dir/include/linux/version.h $cr_linux_dir/include/generated/uapi/linux/version.h none; do
+    test -r $cr_version_h && break
+  done
+  if test $cr_version_h = none; then
+    cr_tmp='version.h missing'
+  else
+    cr_tmp=`  $PERL -- - "$cr_linux_dir" "$KCC -E -I$cr_linux_dir/include -D__KERNEL__ -DMODULE $CR_KTYPE_CPPFLAGS $CPPFLAGS" <<'_EOF_'
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
+    my ($srcdir, $cpp_cmd) = @ARGV;
+    my $stamp = time;
+    $cpp_cmd =~ s/([#()])/\\$cr_linux_dir/g; # quote problematic shell metachars
+    FILE: foreach my $file (qw(linux/version.h linux/utsrelease.h generated/utsrelease.h)) {
+      my $path = "$srcdir/include/$file";
+      next FILE unless (-f $path);
+      open(F, "echo '=${stamp}->UTS_RELEASE<-' | ${cpp_cmd} -include ${path} - |") || exit 1;
+      LINE: while (<F>) {
+        next LINE if(/^#/);
+        if ((my $uts) = /=${stamp}->"((2\.6|3\.[0-9]+)\.[0-9].*)"<-/o) {
+          print "$uts\n";
+          exit 0;
+        }
+      }
+      close(F) || exit 1;
+    }
+    exit 1;
 
+_EOF_
+`
+    test $? = 0 || cr_tmp='no UTS_RELEASE could be extracted'
+    LINUX_VERSION_H=$cr_version_h
 
-   #include <linux/fdtable.h>
+  fi
 
-int
-main ()
-{
+      # Now trim EXTRAVERSION, or yield empty if no pattern match
+      cr_tmp=`echo $cr_tmp | sed -n -e '/^\(\(2\.6\|3\.[0-9][0-9]*\)\.[0-9]\+\).*$/ {s//\1/p;q;}'`
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_FDTABLE_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+      # Next try "asking" the Makefile
+      if test -z "$cr_tmp"; then
+        # If a dependency does not exist, then make may complain.
+        # The -k and 2>/dev/null take care of that.
+        cr_tmp=`(make -k echo_kver --no-print-directory -C $cr_linux_dir -f - 2>/dev/null | grep '^\(2\.6\|3\.[0-9][0-9]*\)\.') <<'_EOF_'
+echo_kver:
+	@echo '$(VERSION).$(PATCHLEVEL).$(SUBLEVEL)'
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_FDTABLE_H=no
-fi
+include Makefile
+_EOF_`
+        expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null || cr_tmp='' # Reject if not matched to pattern
+      fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+      # Finally try grepping the Makefile
+      if test -z "$cr_tmp"; then
+        # Note the use of [] for m4 quoting, since the pattern contains [ and ]
+        cr_linux_ver1=`sed -n -e '/^VERSION[ \t]*=[ \t]*\([0-9]\+\).*$/ {s//\1/p;q;}' "$cr_linux_dir/Makefile"`
+        cr_linux_ver2=`sed -n -e '/^PATCHLEVEL[ \t]*=[ \t]*\([0-9]\+\).*$/ {s//\1/p;q;}' "$cr_linux_dir/Makefile"`
+        cr_linux_ver3=`sed -n -e '/^SUBLEVEL[ \t]*=[ \t]*\([0-9]\+\).*$/ {s//\1/p;q;}' "$cr_linux_dir/Makefile"`
+        cr_tmp="${cr_linux_ver1}.${cr_linux_ver2}.${cr_linux_ver3}"
+        expr "$cr_tmp" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null || cr_tmp='' # Reject if not matched to pattern
+      fi
 
+      test -n "$cr_tmp" || cr_tmp='not found'
+    elif test -d "$cr_linux_dir"; then
+      cr_tmp='Makefile missing'
+    else
+      cr_tmp='not found'
+    fi
+    eval "$cr_cvname='$cr_tmp'"
+    unset cr_tmp
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_FDTABLE_H
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_FDTABLE_H 1
-_ACEOF
-
-     HAVE_LINUX_FDTABLE_H=1
+  eval "cr_result=\$$cr_cvname"
+  unset cr_cvname
+  if expr "$cr_result" : '\(2\.6\|3\.[0-9][0-9]*\)\.' >/dev/null; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: found version $cr_result" >&5
+$as_echo "found version $cr_result" >&6; }
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_FDTABLE_H 0
-_ACEOF
-
-     HAVE_LINUX_FDTABLE_H=''
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
+  fi
+  # Check that version is acceptible (exact match, or a prefix with the next char non-numeric)
+  case "$cr_linux_obj_ver" in
+    ${cr_result}|${cr_result}[!0-9]*)      # the outer [] is m4 quoting
+        cr_linux_src_ver="$cr_result";;
+    *)  cr_linux_src_ver='';;
+  esac
 
+      if test -n "$cr_linux_src_ver"; then
+	LINUX_SRC="$cr_linux_dir"
+	break
+      fi
+  done
 
+  if test -z "$cr_linux_src_ver"; then
+    as_fn_error $? "Could not locate source directory corresponding to build directory '${LINUX_OBJ}'.  Please use --with-linux-src=FULL_PATH_TO_KERNEL_SRC" "$LINENO" 5
+  else
+    :
+  fi
 
 
+  else
+    :
+  fi
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/utrace.h" >&5
-$as_echo_n "checking kernel for linux/utrace.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_LINUX_UTRACE_H+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
+  if test -n "$cr_linux_src_ver" -a -n "$cr_linux_obj_ver"; then
 
+    case "$cr_linux_obj_ver" in
+      2.6.*) HAVE_LINUX_2_6=yes;;
+      3.*.*) HAVE_LINUX_3=yes;;
+    esac
+    LINUX_VER="$cr_linux_obj_ver"
+    CR_KERNEL=`echo $cr_linux_obj_ver | tr - _`
+    CR_KERNEL_BASE=`echo $CR_KERNEL | sed -e 's:smp\|enterprise\|bigmem\|hugemem::g'`
+    test -n "$LINUX_SRC_ARG" && cr_cv_var_LINUX_SRC_ARG="$LINUX_SRC_ARG"
+    test -n "$LINUX_OBJ_ARG" && cr_cv_var_LINUX_OBJ_ARG="$LINUX_OBJ_ARG"
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+   if test -z "$cache_file" || \
+    test "$cache_file" = /dev/null || \
+    cmp "${LINUX_OBJ}/.config" .cached_kconfig >/dev/null 2>/dev/null; then
+   : # OK - either not caching or cached version still matches
+ else
+   if test -f .cached_kconfig; then
+     { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: kernel configuration has changed... discarding cached results." >&5
+$as_echo "$as_me: WARNING: kernel configuration has changed... discarding cached results." >&2;}
+     rm -f .cached_kconfig
+   fi
+   for cr_var in cr_cv_kconfig__NON_EMPTY_HACK `(set) | grep "^cr_cv_kconfig_" | cut -d= -f1`; do
+     unset $cr_var
+   done
+   cp "${LINUX_OBJ}/.config" .cached_kconfig
+ fi
 
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
 
+  else
+    :
+  fi
 
-   #include <linux/utrace.h>
 
-int
-main ()
-{
+if test -z "${HAVE_LINUX_2_6}" -a -z "${HAVE_LINUX_3}"; then :
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
-  ;
-  return 0;
-}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_UTRACE_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_UTRACE_H=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
 
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_UTRACE_H
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_UTRACE_H 1
-_ACEOF
-
-     HAVE_LINUX_UTRACE_H=1
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_UTRACE_H 0
-_ACEOF
-
-     HAVE_LINUX_UTRACE_H=''
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
+fi
+rm -f confcache
+   as_fn_error $? "required Linux 2.6.x or 3.x.y kernel headers and/or build not found." "$LINENO" 5
+fi
 
+# Module install dir
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking directory to install kernel modules" >&5
+$as_echo_n "checking directory to install kernel modules... " >&6; }
+if test -n "${CR_MODULE_DIR}"; then
+  cr_why='passed via --with-kmod-dir'
+elif test ${sysconfdir} = /etc; then
+  CR_MODULE_DIR="/lib/modules/${LINUX_VER}/extra"
+  cr_why='default when sysconfdir=/etc'
+else
+  CR_MODULE_DIR="${libdir}/${PACKAGE}/${LINUX_VER}"
+  cr_why='default'
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: ${CR_MODULE_DIR} ($cr_why)" >&5
+$as_echo "${CR_MODULE_DIR} ($cr_why)" >&6; }
 
+# Checks for matching (we hope) symbol table
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for Linux kernel symbol table" >&5
+$as_echo_n "checking for Linux kernel symbol table... " >&6; }
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/perf_event.h" >&5
-$as_echo_n "checking kernel for linux/perf_event.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
+    if test "${LINUX_SYSTEM_MAP+set}${cr_cv_var_LINUX_SYSTEM_MAP+set}" = setset; then
+    if test "$LINUX_SYSTEM_MAP" != "$cr_cv_var_LINUX_SYSTEM_MAP"; then
+      as_fn_error $? "Cached LINUX_SYSTEM_MAP ($cr_cv_var_LINUX_SYSTEM_MAP) does not match current value ($LINUX_SYSTEM_MAP).  Remove '$cache_file' before re-running configure." "$LINENO" 5
+    fi
+  elif test "${cr_cv_var_LINUX_SYSTEM_MAP+set}" = set; then
+    LINUX_SYSTEM_MAP="$cr_cv_var_LINUX_SYSTEM_MAP"
+  fi
 
 
+    if test "${LINUX_VMLINUX+set}${cr_cv_var_LINUX_VMLINUX+set}" = setset; then
+    if test "$LINUX_VMLINUX" != "$cr_cv_var_LINUX_VMLINUX"; then
+      as_fn_error $? "Cached LINUX_VMLINUX ($cr_cv_var_LINUX_VMLINUX) does not match current value ($LINUX_VMLINUX).  Remove '$cache_file' before re-running configure." "$LINENO" 5
+    fi
+  elif test "${cr_cv_var_LINUX_VMLINUX+set}" = set; then
+    LINUX_VMLINUX="$cr_cv_var_LINUX_VMLINUX"
+  fi
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+  LINUX_SYMTAB_CMD=""
+  # First try validating the user's (or cached) selection
+  if test -n "$LINUX_SYSTEM_MAP" ; then
 
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
+  if test -n ""$LINUX_SYSTEM_MAP"" -a -r ""$LINUX_SYSTEM_MAP"" && grep -e '[TD] sys_open' -e '[AB] _end' <""$LINUX_SYSTEM_MAP"" >/dev/null 2>/dev/null; then
+    if grep -B1 '[AB] _end' <""$LINUX_SYSTEM_MAP"" | grep _stext >/dev/null 2>/dev/null; then
+      # Reject "stripped" files (such as in FC2)
+      # Recognized (poorly) by _stext and _end as last two entries.
+      cr_stripped_maps="$cr_stripped_maps "$LINUX_SYSTEM_MAP""
+    else
+      LINUX_SYSTEM_MAP=""$LINUX_SYSTEM_MAP""
+      LINUX_SYMTAB_FILE=""$LINUX_SYSTEM_MAP""
+      LINUX_SYMTAB_CMD="cat "$LINUX_SYSTEM_MAP" 2>/dev/null"
+    fi
+  fi
 
+    if test -z "$LINUX_SYMTAB_CMD"; then
+      # The user specified a file, but we can't use it.  Abort.
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
+$as_echo "failed" >&6; }
+      as_fn_error $? "Failed to validate \"$LINUX_SYSTEM_MAP\"" "$LINENO" 5
+    fi
+  fi
+  if test -z "$LINUX_SYMTAB_CMD" -a -n "$LINUX_VMLINUX" ; then
 
-   #include <linux/perf_event.h>
 
-int
-main ()
-{
+  if test -n ""$LINUX_VMLINUX"" -a -r ""$LINUX_VMLINUX"" && ($NM ""$LINUX_VMLINUX"" | grep -e '[TD] sys_open' -e '[AB] _end') >/dev/null 2>/dev/null; then
+    LINUX_VMLINUX=""$LINUX_VMLINUX""
+    LINUX_SYMTAB_FILE=""$LINUX_VMLINUX""
+    LINUX_SYMTAB_CMD="$NM "$LINUX_VMLINUX" 2>/dev/null"
+  fi
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+    if test -z "$LINUX_SYMTAB_CMD"; then
+      # The user specified a file, but we can't use it.  Abort.
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
+$as_echo "failed" >&6; }
+      as_fn_error $? "Failed to validate \"$LINUX_VMLINUX\"" "$LINENO" 5
+    fi
+  fi
+  # Next try searching for System.map or vmlinux in standard locations
+  # Note we use the kernel version found in the headers, not `uname -r`
+  if test -z "$LINUX_SYMTAB_CMD" ; then
+    for cr_file_pattern in "$LINUX_OBJ/@-$LINUX_VER" \
+			   "/boot/@-$LINUX_VER"      \
+			   "/@-$LINUX_VER"           \
+			   "$LINUX_OBJ/@"            \
+			   "/usr/lib/debug/boot/@-$LINUX_VER" \
+			   "/usr/lib/debug/lib/modules/$LINUX_VER/@" \
+			; do
+      # Try System.map in the given location
+      cr_file=`echo $cr_file_pattern | sed -e 's|@|System.map|'`
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H=no
-fi
+  if test -n "$cr_file" -a -r "$cr_file" && grep -e '[TD] sys_open' -e '[AB] _end' <"$cr_file" >/dev/null 2>/dev/null; then
+    if grep -B1 '[AB] _end' <"$cr_file" | grep _stext >/dev/null 2>/dev/null; then
+      # Reject "stripped" files (such as in FC2)
+      # Recognized (poorly) by _stext and _end as last two entries.
+      cr_stripped_maps="$cr_stripped_maps $cr_file"
+    else
+      LINUX_SYSTEM_MAP="$cr_file"
+      LINUX_SYMTAB_FILE="$cr_file"
+      LINUX_SYMTAB_CMD="cat $cr_file 2>/dev/null"
+    fi
+  fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+      if test -n "$LINUX_SYMTAB_CMD"; then
+	break
+      fi
+      # Try vmlinux in the given location
+      cr_file=`echo $cr_file_pattern | sed -e 's|@|vmlinux|'`
 
 
-fi
+  if test -n "$cr_file" -a -r "$cr_file" && ($NM "$cr_file" | grep -e '[TD] sys_open' -e '[AB] _end') >/dev/null 2>/dev/null; then
+    LINUX_VMLINUX="$cr_file"
+    LINUX_SYMTAB_FILE="$cr_file"
+    LINUX_SYMTAB_CMD="$NM $cr_file 2>/dev/null"
+  fi
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H
+      if test -n "$LINUX_SYMTAB_CMD"; then
+	break
+      fi
+    done
+  fi
+  # Announce our result
+  if test -z "$LINUX_SYMTAB_CMD"; then
+    LINUX_SYMTAB_CMD="true"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
+$as_echo "failed" >&6; }
+    cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_PERF_EVENT_H 1
 _ACEOF
 
-     HAVE_LINUX_PERF_EVENT_H=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_PERF_EVENT_H 0
-_ACEOF
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
 
-     HAVE_LINUX_PERF_EVENT_H=''
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
+fi
+rm -f confcache
+    if test -n "$cr_stripped_maps"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Skipped stripped System.map file(s): $cr_stripped_maps" >&5
+$as_echo "$as_me: WARNING: Skipped stripped System.map file(s): $cr_stripped_maps" >&2;}
+      as_fn_error $? "Failed to locate kernel symbol table.  Try installing the kernel-debuginfo package matching your kernel, or using --with-system-map or --with-vmlinux." "$LINENO" 5
+    else
+      as_fn_error $? "Failed to locate kernel symbol table.  Try using --with-system-map or --with-vmlinux." "$LINENO" 5
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LINUX_SYMTAB_FILE" >&5
+$as_echo "$LINUX_SYMTAB_FILE" >&6; }
+    test -n "$LINUX_SYSTEM_MAP" && cr_cv_var_LINUX_SYSTEM_MAP="$LINUX_SYSTEM_MAP"
+    test -n "$LINUX_VMLINUX" && cr_cv_var_LINUX_VMLINUX="$LINUX_VMLINUX"
 
+   if test -z "$cache_file" || \
+    test "$cache_file" = /dev/null || \
+    cmp "${LINUX_SYMTAB_FILE}" .cached_ksymtab >/dev/null 2>/dev/null; then
+   : # OK - either not caching or cached version still matches
+ else
+   if test -f .cached_ksymtab; then
+     { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: kernel symbol table has changed... discarding cached results." >&5
+$as_echo "$as_me: WARNING: kernel symbol table has changed... discarding cached results." >&2;}
+     rm -f .cached_ksymtab
+   fi
+   for cr_var in cr_cv_ksymtab__NON_EMPTY_HACK `(set) | grep "^cr_cv_ksymtab_" | cut -d= -f1`; do
+     unset $cr_var
+   done
+   cp "${LINUX_SYMTAB_FILE}" .cached_ksymtab
+ fi
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-
-
-
+  fi
 
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/audit.h" >&5
-$as_echo_n "checking kernel for linux/audit.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_LINUX_AUDIT_H+set}" = set; then
+# Setup CR_KARCH to enable 32-bit user-space on 64-bit kernels
+CR_KARCH=$CR_ARCH
+if test $cr_wordsize = 4; then
+  # Count pointer hex digits in the System.map to id a 64-bit kernel
+  # Based on logic provided by Alan Woodland
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+$as_echo_n "checking for egrep... " >&6; }
+if ${ac_cv_path_EGREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-
-
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-
-
-   #include <linux/audit.h>
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
+  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
+   then ac_cv_path_EGREP="$GREP -E"
+   else
+     if test -z "$EGREP"; then
+  ac_path_EGREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in egrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_EGREP" || continue
+# Check for GNU ac_path_EGREP and select it if it is found.
+  # Check for GNU $ac_path_EGREP
+case `"$ac_path_EGREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'EGREP' >> "conftest.nl"
+    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_EGREP="$ac_path_EGREP"
+      ac_path_EGREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_AUDIT_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_AUDIT_H=no
+      $ac_path_EGREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_EGREP"; then
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_EGREP=$EGREP
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
+   fi
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
+$as_echo "$ac_cv_path_EGREP" >&6; }
+ EGREP="$ac_cv_path_EGREP"
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_AUDIT_H
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_AUDIT_H 1
-_ACEOF
 
-     HAVE_LINUX_AUDIT_H=1
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if kernel and user-space wordsize match" >&5
+$as_echo_n "checking if kernel and user-space wordsize match... " >&6; }
+  if eval $LINUX_SYMTAB_CMD | head | $EGREP '^[a-f0-9]{16}' >/dev/null 2>&1;then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no (32-bit user-space with 64-bit kernel)" >&5
+$as_echo "no (32-bit user-space with 64-bit kernel)" >&6; }
+    case $CR_KARCH in
+      i386)  CR_KARCH=x86_64;;
+      ppc)   CR_KARCH=ppc64;;
+      sparc) CR_KARCH=sparc64;;
+    esac
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_AUDIT_H 0
-_ACEOF
-
-     HAVE_LINUX_AUDIT_H=''
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
   fi
+fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
+# Configure automake/kbuild glue
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for parameters to interface GNU automake with Linux kbuild" >&5
+$as_echo_n "checking for parameters to interface GNU automake with Linux kbuild... " >&6; }
+if ${cr_cv_KBUILD_MAKE_ARGS+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
+    if grep KBUILD_EXTMOD ${LINUX_SRC}/Makefile >/dev/null 2>/dev/null; then
+      cr_cv_KBUILD_MAKE_ARGS='KBUILD_EXTMOD=$(builddir)'
+    else
+      cr_cv_KBUILD_MAKE_ARGS='SUBDIRS=$(builddir) modules'
+    fi
+    if test "${LINUX_OBJ}" != "${LINUX_SRC}"; then
+      cr_cv_KBUILD_MAKE_ARGS="${cr_cv_KBUILD_MAKE_ARGS} O=${LINUX_OBJ}"
+    fi
+    if test x$enable_kbuild_verbose = xyes; then
+      cr_cv_KBUILD_MAKE_ARGS="${cr_cv_KBUILD_MAKE_ARGS} V=1"
+    fi
+    if test x$cross_compiling = xyes; then
+      cr_cv_KBUILD_MAKE_ARGS="$cr_cv_KBUILD_MAKE_ARGS ARCH=$CR_KARCH CROSS_COMPILE=$host_alias-"
+    fi
 
-  { $as_echo "$as_me:$LINENO: checking kernel for asm/elf.h" >&5
-$as_echo_n "checking kernel for asm/elf.h... " >&6; }
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_KBUILD_MAKE_ARGS" >&5
+$as_echo "$cr_cv_KBUILD_MAKE_ARGS" >&6; }
+  KBUILD_MAKE_ARGS="$cr_cv_KBUILD_MAKE_ARGS"
+    # Note: we'll actually try the result in CR_SET_KCFLAGS
 
-    if test "${cr_cv_kconfig_HAVE_ASM_ELF_H+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
 
+# Configure module compile flags and perform a sanity check
 
+  case "$CR_KARCH" in
+    ppc64)
+      CR_KSYM_PATTERN_DATA='[bBdDgGrRsStTvV] '
+      CR_KSYM_PATTERN_CODE='[dD] '         ;;
+    *)
+      CR_KSYM_PATTERN_DATA='[bBdDgGrRsStTvV] '
+      CR_KSYM_PATTERN_CODE='[tT] '
+      ;;
+  esac
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
 
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
+CR_KSYM_IMPORT_DECLS="${TOP_BUILDDIR}/.import_decls"
 
+echo '/* This file is autogenerated - do not edit or remove */' > $CR_KSYM_IMPORT_DECLS
 
-   #include <asm/elf.h>
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_ELF_H=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+CR_KSYM_IMPORT_CALLS="${TOP_BUILDDIR}/.import_calls"
 
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_ELF_H=no
-fi
+echo '/* This file is autogenerated - do not edit or remove */' > $CR_KSYM_IMPORT_CALLS
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
-fi
 
-  cr_result=$cr_cv_kconfig_HAVE_ASM_ELF_H
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_ELF_H 1
-_ACEOF
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for flags to compile Linux kernel probes" >&5
+$as_echo_n "checking for flags to compile Linux kernel probes... " >&6; }
+if ${cr_cv_kconfig_kcflags+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
-     HAVE_ASM_ELF_H=1
+  rm -rf conftestdir
+  mkdir conftestdir
+  echo '#include <linux/sched.h>' > conftestdir/conftest.c
+  echo 'int foo = 0;' >> conftestdir/conftest.c
+  echo 'obj-m := conftest.o' >conftestdir/Makefile
+  unset cr_tmp
+  echo "make -C ${LINUX_SRC} builddir=\"`pwd`/conftestdir\" ${KBUILD_MAKE_ARGS} CC=\"${KCC}\" V=1" >&5
+  make -C ${LINUX_SRC} builddir="`pwd`/conftestdir" ${KBUILD_MAKE_ARGS} CC="${KCC}" V=1 >conftestdir/output 2>&1 </dev/null
+  if test $? = 0; then cr_tmp=`grep -m1 conftest\\.c conftestdir/output | sed -e "s:^[ 	]*${KCC}::"`; fi
+  cat conftestdir/output >&5
+  if test "${cr_tmp:+OK}" != OK; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: FAILED" >&5
+$as_echo "FAILED" >&6; }
+      cat conftestdir/output
+      if $EGREP 'include/(asm|linux)/[a-zA-Z0-9_-]+\.h:' conftestdir/output >/dev/null 2>&1; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Apparent compilation problem in ${LINUX_SRC}" >&5
+$as_echo "$as_me: WARNING: Apparent compilation problem in ${LINUX_SRC}" >&2;}
+	ver=`$KCC --version | head -1`
+        { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Perhaps KCC='$KCC' ($ver) is not compatible with this kernel source" >&5
+$as_echo "$as_me: WARNING: Perhaps KCC='$KCC' ($ver) is not compatible with this kernel source" >&2;}
+	if test $cr_wordsize -gt $ac_cv_sizeof_void_p; then
+	  echo "$KCC" | grep -e '-m64' >/dev/null 2>/dev/null
+	  if test $? != 0; then
+            { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: You might try setting KCC='$KCC -m64'" >&5
+$as_echo "$as_me: WARNING: You might try setting KCC='$KCC -m64'" >&2;}
+          fi
+        fi
+      fi
+      if grep -i 'permission denied' conftestdir/output >/dev/null 2>&1; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Apparent permissions problem in ${LINUX_SRC}" >&5
+$as_echo "$as_me: WARNING: Apparent permissions problem in ${LINUX_SRC}" >&2;}
+      fi
+      rm -rf conftestdir
+      as_fn_error $? "Failed test run of kernel make/kbuild failed (see above)" "$LINENO" 5
+  fi
+  rm -rf conftestdir
+  cr_cv_kconfig_kcflags=''
+  prev_del=''
+  prev_inc=''
+  for arg in ${cr_tmp}; do
+    if test -n "$prev_del"; then # skip this arg at request of prev arg
+      prev_del=''
+      continue
+    fi
+    arg=`echo $arg | tr -d "\"'"` # remove quote marks
+    if test -n "$prev_inc"; then # prev arg says this arg is an -include
+      prev_inc=''
+      case "$arg" in
+	*include/linux/modversions.h) continue;;
+	/*) arg="-include $arg";;
+	*) arg="-include ${LINUX_OBJ}/$arg";;
+      esac
+    else
+      case "$arg" in
+	-o) prev_del=1; continue;;
+	-include) prev_inc=1; continue;;
+	-c) continue;;
+	conftest.c) continue;;
+	/*/conftest.c) continue;;
+	-Wp,-MD,*) continue;;
+	-Wp,-MMD,*) continue;;
+	-I/*) ;;
+	-I*) arg=`echo $arg | sed -e "s:-I:-I${LINUX_OBJ}/:"`;;
+      esac
+    fi
+    cr_cv_kconfig_kcflags="$cr_cv_kconfig_kcflags $arg"
+  done
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_kconfig_kcflags" >&5
+$as_echo "$cr_cv_kconfig_kcflags" >&6; }
+  KCFLAGS="$cr_cv_kconfig_kcflags"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking if autoconf.h or kconfig.h is included implicitly" >&5
+$as_echo_n "checking if autoconf.h or kconfig.h is included implicitly... " >&6; }
+  if echo "$KCFLAGS" | grep -e 'include [^ ]*/autoconf\.h' -e 'include [^ ]*/kconfig\.h' >/dev/null 2>&1; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; };
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_ELF_H 0
-_ACEOF
-
-     HAVE_ASM_ELF_H=''
-  fi
-
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; };
+    $as_echo "#define CR_NEED_AUTOCONF_H 1" >>confdefs.h
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
 
+  fi
+  # Do these init steps early, in case first CR_FIND_KSYM is a conditional call
 
 
 
 
+# Now we can check if SYMTAB matches the kernel
 
-  { $as_echo "$as_me:$LINENO: checking kernel for asm/desc.h" >&5
-$as_echo_n "checking kernel for asm/desc.h... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SMP kernel source" >&5
+$as_echo_n "checking for SMP kernel source... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_ASM_DESC_H+set}" = set; then
+    if ${cr_cv_kconfig_smp_source+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25172,11 +20079,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25185,8 +20088,12 @@
 		 #endif
 		 #include <linux/types.h>
 
-   #include <linux/sched.h>
-   #include <asm/desc.h>
+	#ifdef CR_NEED_AUTOCONF_H
+	  #include <linux/autoconf.h>
+	#endif
+	#ifndef CONFIG_SMP
+	    choke me
+	#endif
 
 int
 main ()
@@ -25196,72 +20103,69 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_DESC_H=yes
+	 cr_cv_kconfig_smp_source=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_DESC_H=no
+	 cr_cv_kconfig_smp_source=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_ASM_DESC_H
+  cr_result=$cr_cv_kconfig_smp_source
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_DESC_H 1
-_ACEOF
-
-     HAVE_ASM_DESC_H=1
+    :
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_DESC_H 0
-_ACEOF
-
-     HAVE_ASM_DESC_H=''
+    :
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; };
+  cr_kernel_smp=$cr_result
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SMP kernel symbol table" >&5
+$as_echo_n "checking for SMP kernel symbol table... " >&6; }
+  cr_symtab_smp=no
+  if test -n "`eval $LINUX_SYMTAB_CMD | grep del_timer_sync 2>/dev/null | grep -v try_to_del_`"; then
+    cr_symtab_smp=yes
+  fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_symtab_smp" >&5
+$as_echo "$cr_symtab_smp" >&6; };
+  if test "$cr_kernel_smp" != "$cr_symtab_smp"; then
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
 
+    if test "$cr_kernel_smp" = yes; then
+      as_fn_error $? "Kernel source is configured SMP but the kernel symbol table is not.  Consider specifying a symbol table with --with-system-map or --with-vmlinux.  Or, if using kernel sources that are configured by /boot/kernel.h, you may try --with-kernel-type=UP to force a uni-processor interpretation of the sources." "$LINENO" 5
+    else
+      as_fn_error $? "Kernel source is configured uni-processor but the kernel symbol table is SMP.  Consider specifying a symbol table with --with-system-map or --with-vmlinux.  Or, if using kernel sources that are configured by /boot/kernel.h, you may try --with-kernel-type=SMP to force an SMP interpretation of the sources." "$LINENO" 5
+    fi
+  fi
 
 
+## Check for optional kernel headers...
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for asm/vsyscall32.h" >&5
-$as_echo_n "checking kernel for asm/vsyscall32.h... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/syscalls.h" >&5
+$as_echo_n "checking kernel for linux/syscalls.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25273,11 +20177,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25287,7 +20187,7 @@
 		 #include <linux/types.h>
 
 
-   #include <asm/vsyscall32.h>
+   #include <linux/syscalls.h>
 
 int
 main ()
@@ -25297,72 +20197,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H=yes
+	 cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H=no
+	 cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_SYSCALLS_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_VSYSCALL32_H 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_SYSCALLS_H 1" >>confdefs.h
 
-     HAVE_ASM_VSYSCALL32_H=1
+     HAVE_LINUX_SYSCALLS_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_VSYSCALL32_H 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_SYSCALLS_H 0" >>confdefs.h
 
-     HAVE_ASM_VSYSCALL32_H=''
+     HAVE_LINUX_SYSCALLS_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/pspace.h" >&5
+$as_echo_n "checking kernel for linux/pspace.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for asm/i387.h" >&5
-$as_echo_n "checking kernel for asm/i387.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_ASM_I387_H+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_PSPACE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25374,11 +20248,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25388,7 +20258,7 @@
 		 #include <linux/types.h>
 
 
-   #include <asm/i387.h>
+   #include <linux/pspace.h>
 
 int
 main ()
@@ -25398,72 +20268,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_I387_H=yes
+	 cr_cv_kconfig_HAVE_LINUX_PSPACE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_I387_H=no
+	 cr_cv_kconfig_HAVE_LINUX_PSPACE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_ASM_I387_H
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_PSPACE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_I387_H 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_PSPACE_H 1" >>confdefs.h
 
-     HAVE_ASM_I387_H=1
+     HAVE_LINUX_PSPACE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_I387_H 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_PSPACE_H 0" >>confdefs.h
 
-     HAVE_ASM_I387_H=''
+     HAVE_LINUX_PSPACE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/pid_namespace.h" >&5
+$as_echo_n "checking kernel for linux/pid_namespace.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for asm/switch_to.h" >&5
-$as_echo_n "checking kernel for asm/switch_to.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25475,11 +20319,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25489,7 +20329,7 @@
 		 #include <linux/types.h>
 
 
-   #include <asm/switch_to.h>
+   #include <linux/pid_namespace.h>
 
 int
 main ()
@@ -25499,72 +20339,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H=yes
+	 cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H=no
+	 cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_PID_NAMESPACE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_SWITCH_TO_H 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_PID_NAMESPACE_H 1" >>confdefs.h
 
-     HAVE_ASM_SWITCH_TO_H=1
+     HAVE_LINUX_PID_NAMESPACE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_SWITCH_TO_H 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_PID_NAMESPACE_H 0" >>confdefs.h
 
-     HAVE_ASM_SWITCH_TO_H=''
+     HAVE_LINUX_PID_NAMESPACE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/lockdep.h" >&5
+$as_echo_n "checking kernel for linux/lockdep.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for asm/tls.h" >&5
-$as_echo_n "checking kernel for asm/tls.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_ASM_TLS_H+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25576,11 +20390,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25590,7 +20400,7 @@
 		 #include <linux/types.h>
 
 
-   #include <asm/tls.h>
+   #include <linux/lockdep.h>
 
 int
 main ()
@@ -25600,73 +20410,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_TLS_H=yes
+	 cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ASM_TLS_H=no
+	 cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_ASM_TLS_H
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_LOCKDEP_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_TLS_H 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_LOCKDEP_H 1" >>confdefs.h
 
-     HAVE_ASM_TLS_H=1
+     HAVE_LINUX_LOCKDEP_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ASM_TLS_H 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_LOCKDEP_H 0" >>confdefs.h
 
-     HAVE_ASM_TLS_H=''
+     HAVE_LINUX_LOCKDEP_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/compile.h" >&5
+$as_echo_n "checking kernel for linux/compile.h... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for linux/utsrelease.h" >&5
-$as_echo_n "checking kernel for linux/utsrelease.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_COMPILE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25678,11 +20461,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25692,7 +20471,7 @@
 		 #include <linux/types.h>
 
 
-   #include <linux/utsrelease.h>
+   #include <linux/compile.h>
 
 int
 main ()
@@ -25702,72 +20481,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H=yes
+	 cr_cv_kconfig_HAVE_LINUX_COMPILE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H=no
+	 cr_cv_kconfig_HAVE_LINUX_COMPILE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_COMPILE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_UTSRELEASE_H 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_COMPILE_H 1" >>confdefs.h
 
-     HAVE_LINUX_UTSRELEASE_H=1
+     HAVE_LINUX_COMPILE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_LINUX_UTSRELEASE_H 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_COMPILE_H 0" >>confdefs.h
 
-     HAVE_LINUX_UTSRELEASE_H=''
+     HAVE_LINUX_COMPILE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/fdtable.h" >&5
+$as_echo_n "checking kernel for linux/fdtable.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for generated/utsrelease.h" >&5
-$as_echo_n "checking kernel for generated/utsrelease.h... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_FDTABLE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25779,11 +20532,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25793,7 +20542,7 @@
 		 #include <linux/types.h>
 
 
-   #include <generated/utsrelease.h>
+   #include <linux/fdtable.h>
 
 int
 main ()
@@ -25803,77 +20552,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H=yes
+	 cr_cv_kconfig_HAVE_LINUX_FDTABLE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H=no
+	 cr_cv_kconfig_HAVE_LINUX_FDTABLE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_FDTABLE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_GENERATED_UTSRELEASE_H 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_FDTABLE_H 1" >>confdefs.h
 
-     HAVE_GENERATED_UTSRELEASE_H=1
+     HAVE_LINUX_FDTABLE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_GENERATED_UTSRELEASE_H 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_FDTABLE_H 0" >>confdefs.h
 
-     HAVE_GENERATED_UTSRELEASE_H=''
+     HAVE_LINUX_FDTABLE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
-## Now we check for specific kernel features...
-
-
-  if test "$CR_ARCH" = 'arm'; then
-
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/utrace.h" >&5
+$as_echo_n "checking kernel for linux/utrace.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for CONFIG_THUMB2_KERNEL" >&5
-$as_echo_n "checking kernel for CONFIG_THUMB2_KERNEL... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_UTRACE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -25885,11 +20603,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -25898,101 +20612,60 @@
 		 #endif
 		 #include <linux/types.h>
 
+
+   #include <linux/utrace.h>
+
 int
 main ()
 {
 
-   #ifndef CONFIG_THUMB2_KERNEL
-     choke me
-   #endif
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL=yes
+	 cr_cv_kconfig_HAVE_LINUX_UTRACE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL=no
+	 cr_cv_kconfig_HAVE_LINUX_UTRACE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_UTRACE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CONFIG_THUMB2_KERNEL 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_UTRACE_H 1" >>confdefs.h
 
-     HAVE_CONFIG_THUMB2_KERNEL=1
+     HAVE_LINUX_UTRACE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CONFIG_THUMB2_KERNEL 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_UTRACE_H 0" >>confdefs.h
 
-     HAVE_CONFIG_THUMB2_KERNEL=''
+     HAVE_LINUX_UTRACE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-  fi
-
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/perf_event.h" >&5
+$as_echo_n "checking kernel for linux/perf_event.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for timeval_to_jiffies" >&5
-$as_echo_n "checking kernel symbol table for timeval_to_jiffies... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_timeval_to_jiffies+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_timeval_to_jiffies=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}timeval_to_jiffies$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_timeval_to_jiffies"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_timeval_to_jiffies\$" >/dev/null ; then
-        cr_cv_ksymtab_timeval_to_jiffies=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_timeval_to_jiffies=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_timeval_to_jiffies';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -26001,11 +20674,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26014,104 +20683,60 @@
 		 #endif
 		 #include <linux/types.h>
 
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
+   #include <linux/perf_event.h>
 
 int
 main ()
 {
-int x = sizeof(&timeval_to_jiffies);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_timeval_to_jiffies="Y$cr_cv_ksymtab_timeval_to_jiffies"
+	 cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_timeval_to_jiffies="N$cr_cv_ksymtab_timeval_to_jiffies"
+	 cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_timeval_to_jiffies"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_timeval_to_jiffies" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol timeval_to_jiffies but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol timeval_to_jiffies but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_timeval_to_jiffies | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(timeval_to_jiffies, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_PERF_EVENT_H
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_timeval_to_jiffies $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_LINUX_PERF_EVENT_H 1" >>confdefs.h
+
+     HAVE_LINUX_PERF_EVENT_H=1
+  else
+    $as_echo "#define HAVE_LINUX_PERF_EVENT_H 0" >>confdefs.h
 
+     HAVE_LINUX_PERF_EVENT_H=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for jiffies_to_timeval" >&5
-$as_echo_n "checking kernel symbol table for jiffies_to_timeval... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_jiffies_to_timeval+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/audit.h" >&5
+$as_echo_n "checking kernel for linux/audit.h... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_LINUX_AUDIT_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_jiffies_to_timeval=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}jiffies_to_timeval$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_jiffies_to_timeval"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_jiffies_to_timeval\$" >/dev/null ; then
-        cr_cv_ksymtab_jiffies_to_timeval=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_jiffies_to_timeval=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_jiffies_to_timeval';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -26120,11 +20745,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26133,90 +20754,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
+   #include <linux/audit.h>
 
 int
 main ()
 {
-int x = sizeof(&jiffies_to_timeval);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_jiffies_to_timeval="Y$cr_cv_ksymtab_jiffies_to_timeval"
+	 cr_cv_kconfig_HAVE_LINUX_AUDIT_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_jiffies_to_timeval="N$cr_cv_ksymtab_jiffies_to_timeval"
+	 cr_cv_kconfig_HAVE_LINUX_AUDIT_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_jiffies_to_timeval"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_jiffies_to_timeval" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol jiffies_to_timeval but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol jiffies_to_timeval but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_jiffies_to_timeval | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(jiffies_to_timeval, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_AUDIT_H
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_jiffies_to_timeval $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_LINUX_AUDIT_H 1" >>confdefs.h
+
+     HAVE_LINUX_AUDIT_H=1
+  else
+    $as_echo "#define HAVE_LINUX_AUDIT_H 0" >>confdefs.h
 
+     HAVE_LINUX_AUDIT_H=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for struct fdtable" >&5
-$as_echo_n "checking kernel for struct fdtable... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_STRUCT_FDTABLE+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for asm/elf.h" >&5
+$as_echo_n "checking kernel for asm/elf.h... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_ASM_ELF_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26228,11 +20816,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26241,91 +20825,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-    #include <linux/sched.h>
-    #include <linux/file.h>
-    #if HAVE_LINUX_FDTABLE_H
-      #include <linux/fdtable.h>
-    #endif
+
+   #include <asm/elf.h>
 
 int
 main ()
 {
 
-     struct fdtable y;
-     int x = sizeof(y);
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_FDTABLE=yes
+	 cr_cv_kconfig_HAVE_ASM_ELF_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_FDTABLE=no
+	 cr_cv_kconfig_HAVE_ASM_ELF_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_STRUCT_FDTABLE
+  cr_result=$cr_cv_kconfig_HAVE_ASM_ELF_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_FDTABLE 1
-_ACEOF
+    $as_echo "#define HAVE_ASM_ELF_H 1" >>confdefs.h
 
-     HAVE_STRUCT_FDTABLE=1
+     HAVE_ASM_ELF_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_FDTABLE 0
-_ACEOF
+    $as_echo "#define HAVE_ASM_ELF_H 0" >>confdefs.h
 
-     HAVE_STRUCT_FDTABLE=''
+     HAVE_ASM_ELF_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
-if test -n "${HAVE_STRUCT_FDTABLE}"; then
-
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for asm/desc.h" >&5
+$as_echo_n "checking kernel for asm/desc.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for open_fds.fds_bits" >&5
-$as_echo_n "checking kernel for open_fds.fds_bits... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_ASM_DESC_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26337,11 +20887,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26350,87 +20896,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/file.h>
-      #if HAVE_LINUX_FDTABLE_H
-        #include <linux/fdtable.h>
-      #endif
+   #include <linux/sched.h>
+   #include <asm/desc.h>
 
 int
 main ()
 {
-struct fdtable x;
-          unsigned long  tc_1 = *(x.open_fds->fds_bits);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=yes
+	 cr_cv_kconfig_HAVE_ASM_DESC_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=no
+	 cr_cv_kconfig_HAVE_ASM_DESC_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS
+  cr_result=$cr_cv_kconfig_HAVE_ASM_DESC_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_OPEN_FDS_FDS_BITS 1
-_ACEOF
+    $as_echo "#define HAVE_ASM_DESC_H 1" >>confdefs.h
 
-     HAVE_OPEN_FDS_FDS_BITS=1
+     HAVE_ASM_DESC_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_OPEN_FDS_FDS_BITS 0
-_ACEOF
+    $as_echo "#define HAVE_ASM_DESC_H 0" >>confdefs.h
 
-     HAVE_OPEN_FDS_FDS_BITS=''
+     HAVE_ASM_DESC_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for asm/vsyscall32.h" >&5
+$as_echo_n "checking kernel for asm/vsyscall32.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for fd_is_open" >&5
-$as_echo_n "checking kernel for fd_is_open... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_FD_IS_OPEN+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26442,11 +20958,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26455,93 +20967,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/file.h>
-      #if HAVE_LINUX_FDTABLE_H
-        #include <linux/fdtable.h>
-      #endif
+
+   #include <asm/vsyscall32.h>
 
 int
 main ()
 {
 
-   #ifdef fd_is_open
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&fd_is_open);
-   #endif
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FD_IS_OPEN=yes
+	 cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FD_IS_OPEN=no
+	 cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FD_IS_OPEN
+  cr_result=$cr_cv_kconfig_HAVE_ASM_VSYSCALL32_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FD_IS_OPEN 1
-_ACEOF
+    $as_echo "#define HAVE_ASM_VSYSCALL32_H 1" >>confdefs.h
 
-     HAVE_FD_IS_OPEN=1
+     HAVE_ASM_VSYSCALL32_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FD_IS_OPEN 0
-_ACEOF
+    $as_echo "#define HAVE_ASM_VSYSCALL32_H 0" >>confdefs.h
 
-     HAVE_FD_IS_OPEN=''
+     HAVE_ASM_VSYSCALL32_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for asm/i387.h" >&5
+$as_echo_n "checking kernel for asm/i387.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for __set_open_fd" >&5
-$as_echo_n "checking kernel for __set_open_fd... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE___SET_OPEN_FD+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_ASM_I387_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26553,11 +21029,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26566,93 +21038,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/file.h>
-      #if HAVE_LINUX_FDTABLE_H
-        #include <linux/fdtable.h>
-      #endif
+
+   #include <asm/i387.h>
 
 int
 main ()
 {
 
-   #ifdef __set_open_fd
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&__set_open_fd);
-   #endif
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE___SET_OPEN_FD=yes
+	 cr_cv_kconfig_HAVE_ASM_I387_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE___SET_OPEN_FD=no
+	 cr_cv_kconfig_HAVE_ASM_I387_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE___SET_OPEN_FD
+  cr_result=$cr_cv_kconfig_HAVE_ASM_I387_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___SET_OPEN_FD 1
-_ACEOF
+    $as_echo "#define HAVE_ASM_I387_H 1" >>confdefs.h
 
-     HAVE___SET_OPEN_FD=1
+     HAVE_ASM_I387_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___SET_OPEN_FD 0
-_ACEOF
+    $as_echo "#define HAVE_ASM_I387_H 0" >>confdefs.h
 
-     HAVE___SET_OPEN_FD=''
+     HAVE_ASM_I387_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for asm/switch_to.h" >&5
+$as_echo_n "checking kernel for asm/switch_to.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for close_on_exec" >&5
-$as_echo_n "checking kernel for close_on_exec... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_CLOSE_ON_EXEC+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26664,11 +21100,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26677,93 +21109,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/file.h>
-      #if HAVE_LINUX_FDTABLE_H
-        #include <linux/fdtable.h>
-      #endif
+
+   #include <asm/switch_to.h>
 
 int
 main ()
 {
 
-   #ifdef close_on_exec
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&close_on_exec);
-   #endif
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CLOSE_ON_EXEC=yes
+	 cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CLOSE_ON_EXEC=no
+	 cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_CLOSE_ON_EXEC
+  cr_result=$cr_cv_kconfig_HAVE_ASM_SWITCH_TO_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CLOSE_ON_EXEC 1
-_ACEOF
+    $as_echo "#define HAVE_ASM_SWITCH_TO_H 1" >>confdefs.h
 
-     HAVE_CLOSE_ON_EXEC=1
+     HAVE_ASM_SWITCH_TO_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CLOSE_ON_EXEC 0
-_ACEOF
+    $as_echo "#define HAVE_ASM_SWITCH_TO_H 0" >>confdefs.h
 
-     HAVE_CLOSE_ON_EXEC=''
+     HAVE_ASM_SWITCH_TO_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for asm/tls.h" >&5
+$as_echo_n "checking kernel for asm/tls.h... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for __set_close_on_exec" >&5
-$as_echo_n "checking kernel for __set_close_on_exec... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_ASM_TLS_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26775,11 +21171,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26788,95 +21180,58 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/file.h>
-      #if HAVE_LINUX_FDTABLE_H
-        #include <linux/fdtable.h>
-      #endif
+
+   #include <asm/tls.h>
 
 int
 main ()
 {
 
-   #ifdef __set_close_on_exec
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&__set_close_on_exec);
-   #endif
-
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC=yes
+	 cr_cv_kconfig_HAVE_ASM_TLS_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC=no
+	 cr_cv_kconfig_HAVE_ASM_TLS_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC
+  cr_result=$cr_cv_kconfig_HAVE_ASM_TLS_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___SET_CLOSE_ON_EXEC 1
-_ACEOF
+    $as_echo "#define HAVE_ASM_TLS_H 1" >>confdefs.h
 
-     HAVE___SET_CLOSE_ON_EXEC=1
+     HAVE_ASM_TLS_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___SET_CLOSE_ON_EXEC 0
-_ACEOF
+    $as_echo "#define HAVE_ASM_TLS_H 0" >>confdefs.h
 
-     HAVE___SET_CLOSE_ON_EXEC=''
+     HAVE_ASM_TLS_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-  # OK if those are missing
-else
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for open_fds.fds_bits" >&5
-$as_echo_n "checking kernel for open_fds.fds_bits... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for linux/utsrelease.h" >&5
+$as_echo_n "checking kernel for linux/utsrelease.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26888,11 +21243,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -26901,89 +21252,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/file.h>
-      #if HAVE_LINUX_FDTABLE_H
-        #include <linux/fdtable.h>
-      #endif
+
+   #include <linux/utsrelease.h>
 
 int
 main ()
 {
-struct files_struct x;
-          unsigned long  tc_1 = *(x.open_fds->fds_bits);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=yes
+	 cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=no
+	 cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS
+  cr_result=$cr_cv_kconfig_HAVE_LINUX_UTSRELEASE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_OPEN_FDS_FDS_BITS 1
-_ACEOF
+    $as_echo "#define HAVE_LINUX_UTSRELEASE_H 1" >>confdefs.h
 
-     HAVE_OPEN_FDS_FDS_BITS=1
+     HAVE_LINUX_UTSRELEASE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_OPEN_FDS_FDS_BITS 0
-_ACEOF
+    $as_echo "#define HAVE_LINUX_UTSRELEASE_H 0" >>confdefs.h
 
-     HAVE_OPEN_FDS_FDS_BITS=''
+     HAVE_LINUX_UTSRELEASE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-fi
-
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for files_struct.next_fd" >&5
-$as_echo_n "checking kernel for files_struct.next_fd... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for generated/utsrelease.h" >&5
+$as_echo_n "checking kernel for generated/utsrelease.h... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -26995,11 +21314,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27008,87 +21323,62 @@
 		 #endif
 		 #include <linux/types.h>
 
-    #include <linux/sched.h>
-    #include <linux/file.h>
-    #if HAVE_LINUX_FDTABLE_H
-      #include <linux/fdtable.h>
-    #endif
+
+   #include <generated/utsrelease.h>
 
 int
 main ()
 {
-struct files_struct x;
-          int tc_1 = x.next_fd;
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD=yes
+	 cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD=no
+	 cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD
+  cr_result=$cr_cv_kconfig_HAVE_GENERATED_UTSRELEASE_H
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILES_STRUCT_NEXT_FD 1
-_ACEOF
+    $as_echo "#define HAVE_GENERATED_UTSRELEASE_H 1" >>confdefs.h
 
-     HAVE_FILES_STRUCT_NEXT_FD=1
+     HAVE_GENERATED_UTSRELEASE_H=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILES_STRUCT_NEXT_FD 0
-_ACEOF
+    $as_echo "#define HAVE_GENERATED_UTSRELEASE_H 0" >>confdefs.h
 
-     HAVE_FILES_STRUCT_NEXT_FD=''
+     HAVE_GENERATED_UTSRELEASE_H=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
+## Now we check for specific kernel features...
+
+
+  if test "$CR_ARCH" = 'arm'; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for fdtable.next_fd" >&5
-$as_echo_n "checking kernel for fdtable.next_fd... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for CONFIG_THUMB2_KERNEL" >&5
+$as_echo_n "checking kernel for CONFIG_THUMB2_KERNEL... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -27100,11 +21390,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27113,183 +21399,76 @@
 		 #endif
 		 #include <linux/types.h>
 
-    #include <linux/sched.h>
-    #include <linux/file.h>
-    #if HAVE_LINUX_FDTABLE_H
-      #include <linux/fdtable.h>
-    #endif
-
 int
 main ()
 {
-struct fdtable x;
-          int tc_1 = x.next_fd;
+
+   #ifndef CONFIG_THUMB2_KERNEL
+     choke me
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD=yes
+	 cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD=no
+	 cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD
+  cr_result=$cr_cv_kconfig_HAVE_CONFIG_THUMB2_KERNEL
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FDTABLE_NEXT_FD 1
-_ACEOF
+    $as_echo "#define HAVE_CONFIG_THUMB2_KERNEL 1" >>confdefs.h
 
-     HAVE_FDTABLE_NEXT_FD=1
+     HAVE_CONFIG_THUMB2_KERNEL=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FDTABLE_NEXT_FD 0
-_ACEOF
+    $as_echo "#define HAVE_CONFIG_THUMB2_KERNEL 0" >>confdefs.h
 
-     HAVE_FDTABLE_NEXT_FD=''
+     HAVE_CONFIG_THUMB2_KERNEL=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# Allow only exactly one match
-if test "${HAVE_FILES_STRUCT_NEXT_FD}${HAVE_FDTABLE_NEXT_FD}" != "1"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine where to find next_fd" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine where to find next_fd" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
-
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for files_struct.max_fdset" >&5
-$as_echo_n "checking kernel for files_struct.max_fdset... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for timeval_to_jiffies" >&5
+$as_echo_n "checking kernel symbol table for timeval_to_jiffies... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_timeval_to_jiffies+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_timeval_to_jiffies=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}timeval_to_jiffies$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_timeval_to_jiffies"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_timeval_to_jiffies\$" >/dev/null ; then
+        cr_cv_ksymtab_timeval_to_jiffies=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_timeval_to_jiffies=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_timeval_to_jiffies';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -27298,11 +21477,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27311,91 +21486,81 @@
 		 #endif
 		 #include <linux/types.h>
 
-    #include <linux/sched.h>
-    #include <linux/file.h>
-    #if HAVE_LINUX_FDTABLE_H
-      #include <linux/fdtable.h>
-    #endif
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
 
 int
 main ()
 {
-struct files_struct x;
-          int tc_1 = x.max_fdset;
+int x = sizeof(&timeval_to_jiffies);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET=yes
+	 cr_cv_ksymtab_timeval_to_jiffies="Y$cr_cv_ksymtab_timeval_to_jiffies"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET=no
+	 cr_cv_ksymtab_timeval_to_jiffies="N$cr_cv_ksymtab_timeval_to_jiffies"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILES_STRUCT_MAX_FDSET 1
-_ACEOF
-
-     HAVE_FILES_STRUCT_MAX_FDSET=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_timeval_to_jiffies"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILES_STRUCT_MAX_FDSET 0
+    if expr "$cr_cv_ksymtab_timeval_to_jiffies" : N >/dev/null; then
+      as_fn_error $? "Found symbol timeval_to_jiffies but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_timeval_to_jiffies | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(timeval_to_jiffies, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_timeval_to_jiffies $cr_addr
 _ACEOF
 
-     HAVE_FILES_STRUCT_MAX_FDSET=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for struct path" >&5
-$as_echo_n "checking kernel for struct path... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_STRUCT_PATH+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for jiffies_to_timeval" >&5
+$as_echo_n "checking kernel symbol table for jiffies_to_timeval... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_jiffies_to_timeval+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_jiffies_to_timeval=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}jiffies_to_timeval$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_jiffies_to_timeval"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_jiffies_to_timeval\$" >/dev/null ; then
+        cr_cv_ksymtab_jiffies_to_timeval=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_jiffies_to_timeval=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_jiffies_to_timeval';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -27404,11 +21569,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27416,83 +21577,67 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fs.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-     struct path y;
-     int x = sizeof(y);
-
+int x = sizeof(&jiffies_to_timeval);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_PATH=yes
+	 cr_cv_ksymtab_jiffies_to_timeval="Y$cr_cv_ksymtab_jiffies_to_timeval"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_PATH=no
+	 cr_cv_ksymtab_jiffies_to_timeval="N$cr_cv_ksymtab_jiffies_to_timeval"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_STRUCT_PATH
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_PATH 1
-_ACEOF
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_jiffies_to_timeval"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_jiffies_to_timeval" : N >/dev/null; then
+      as_fn_error $? "Found symbol jiffies_to_timeval but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_jiffies_to_timeval | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(jiffies_to_timeval, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_STRUCT_PATH=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_PATH 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_jiffies_to_timeval $cr_addr
 _ACEOF
 
-     HAVE_STRUCT_PATH=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for nameidata.path" >&5
-$as_echo_n "checking kernel for nameidata.path... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for struct fdtable" >&5
+$as_echo_n "checking kernel for struct fdtable... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_NAMEIDATA_PATH+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_STRUCT_FDTABLE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -27504,11 +21649,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27518,95 +21659,64 @@
 		 #include <linux/types.h>
 
     #include <linux/sched.h>
-    #include <linux/fs.h>
-    #include <linux/dcache.h>
-    #include <linux/namei.h>
-    #include <linux/fs_struct.h>
+    #include <linux/file.h>
+    #if HAVE_LINUX_FDTABLE_H
+      #include <linux/fdtable.h>
+    #endif
 
 int
 main ()
 {
 
-    /* Expect "struct path pwd" in fs_struct */
-    struct fs_struct s1;
-    struct path t1 = s1.pwd;
-
-    /* Expect "struct path path" used in nameidata */
-    struct nameidata s2;
-    struct path t2 = s2.path;
-
-    /* Expect d_path() and set_fs_pwd() to pass path */
-    (void)d_path(&t1, NULL, 0);
-    (void)set_fs_pwd(&s1, &t2);
+     struct fdtable y;
+     int x = sizeof(y);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_NAMEIDATA_PATH=yes
+	 cr_cv_kconfig_HAVE_STRUCT_FDTABLE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_NAMEIDATA_PATH=no
+	 cr_cv_kconfig_HAVE_STRUCT_FDTABLE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_NAMEIDATA_PATH
+  cr_result=$cr_cv_kconfig_HAVE_STRUCT_FDTABLE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_NAMEIDATA_PATH 1
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_FDTABLE 1" >>confdefs.h
 
-     HAVE_NAMEIDATA_PATH=1
+     HAVE_STRUCT_FDTABLE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_NAMEIDATA_PATH 0
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_FDTABLE 0" >>confdefs.h
 
-     HAVE_NAMEIDATA_PATH=''
+     HAVE_STRUCT_FDTABLE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
+if test -n "${HAVE_STRUCT_FDTABLE}"; then
 
-  { $as_echo "$as_me:$LINENO: checking kernel for nameidata.dentry" >&5
-$as_echo_n "checking kernel for nameidata.dentry... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for open_fds.fds_bits" >&5
+$as_echo_n "checking kernel for open_fds.fds_bits... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -27618,11 +21728,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27631,189 +21737,61 @@
 		 #endif
 		 #include <linux/types.h>
 
-    #include <linux/sched.h>
-    #include <linux/fs.h>
-    #include <linux/dcache.h>
-    #include <linux/namei.h>
-    #include <linux/fs_struct.h>
+      #include <linux/sched.h>
+      #include <linux/file.h>
+      #if HAVE_LINUX_FDTABLE_H
+        #include <linux/fdtable.h>
+      #endif
 
 int
 main ()
 {
-
-    /* Expect "struct dentry *pwd" in fs_struct */
-    struct fs_struct s1;
-    struct dentry t1 = *s1.pwd;
-
-    /* Expect "struct dentry *dentry" in nameidata */
-    struct nameidata s2;
-    struct dentry t2 = *s2.dentry;
-
-    /* Expect d_path() and set_fs_pwd() to pass dentry */
-    (void)d_path(&t1, NULL, NULL, 0);
-    (void)set_fs_pwd(&s1, NULL, &t2);
-
+struct fdtable x;
+          unsigned long  tc_1 = *(x.open_fds->fds_bits);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY=yes
+	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY=no
+	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY
+  cr_result=$cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_NAMEIDATA_DENTRY 1
-_ACEOF
+    $as_echo "#define HAVE_OPEN_FDS_FDS_BITS 1" >>confdefs.h
 
-     HAVE_NAMEIDATA_DENTRY=1
+     HAVE_OPEN_FDS_FDS_BITS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_NAMEIDATA_DENTRY 0
-_ACEOF
+    $as_echo "#define HAVE_OPEN_FDS_FDS_BITS 0" >>confdefs.h
 
-     HAVE_NAMEIDATA_DENTRY=''
+     HAVE_OPEN_FDS_FDS_BITS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-if test "${HAVE_NAMEIDATA_PATH}${HAVE_NAMEIDATA_DENTRY}" != "1"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine composition of struct nameidata" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine composition of struct nameidata" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for fd_is_open" >&5
+$as_echo_n "checking kernel for fd_is_open... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for path_lookup" >&5
-$as_echo_n "checking kernel for path_lookup... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PATH_LOOKUP+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FD_IS_OPEN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -27825,11 +21803,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27837,88 +21811,68 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/namei.h>
+
+      #include <linux/sched.h>
+      #include <linux/file.h>
+      #if HAVE_LINUX_FDTABLE_H
+        #include <linux/fdtable.h>
+      #endif
+
 int
 main ()
 {
 
-   #ifdef path_lookup
+   #ifdef fd_is_open
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&path_lookup);
+     int x = sizeof(&fd_is_open);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PATH_LOOKUP=yes
+	 cr_cv_kconfig_HAVE_FD_IS_OPEN=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PATH_LOOKUP=no
+	 cr_cv_kconfig_HAVE_FD_IS_OPEN=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PATH_LOOKUP
+  cr_result=$cr_cv_kconfig_HAVE_FD_IS_OPEN
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PATH_LOOKUP 1
-_ACEOF
+    $as_echo "#define HAVE_FD_IS_OPEN 1" >>confdefs.h
 
-     HAVE_PATH_LOOKUP=1
+     HAVE_FD_IS_OPEN=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PATH_LOOKUP 0
-_ACEOF
+    $as_echo "#define HAVE_FD_IS_OPEN 0" >>confdefs.h
 
-     HAVE_PATH_LOOKUP=''
+     HAVE_FD_IS_OPEN=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for __set_open_fd" >&5
+$as_echo_n "checking kernel for __set_open_fd... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for kern_path" >&5
-$as_echo_n "checking kernel for kern_path... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_KERN_PATH+set}" = set; then
+    if ${cr_cv_kconfig_HAVE___SET_OPEN_FD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -27930,11 +21884,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -27942,181 +21892,68 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/namei.h>
+
+      #include <linux/sched.h>
+      #include <linux/file.h>
+      #if HAVE_LINUX_FDTABLE_H
+        #include <linux/fdtable.h>
+      #endif
+
 int
 main ()
 {
 
-   #ifdef kern_path
+   #ifdef __set_open_fd
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&kern_path);
+     int x = sizeof(&__set_open_fd);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KERN_PATH=yes
+	 cr_cv_kconfig_HAVE___SET_OPEN_FD=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KERN_PATH=no
+	 cr_cv_kconfig_HAVE___SET_OPEN_FD=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_KERN_PATH
+  cr_result=$cr_cv_kconfig_HAVE___SET_OPEN_FD
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KERN_PATH 1
-_ACEOF
+    $as_echo "#define HAVE___SET_OPEN_FD 1" >>confdefs.h
 
-     HAVE_KERN_PATH=1
+     HAVE___SET_OPEN_FD=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KERN_PATH 0
-_ACEOF
+    $as_echo "#define HAVE___SET_OPEN_FD 0" >>confdefs.h
 
-     HAVE_KERN_PATH=''
+     HAVE___SET_OPEN_FD=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# Require 1 or more match
-if test -z "${HAVE_PATH_LOOKUP}{HAVE_KERN_PATH}"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to find either path_lookup() or kern_path()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to find either path_lookup() or kern_path()" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
-
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for close_on_exec" >&5
+$as_echo_n "checking kernel for close_on_exec... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for __putname" >&5
-$as_echo_n "checking kernel for __putname... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE___PUTNAME+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CLOSE_ON_EXEC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28128,11 +21965,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28140,89 +21973,68 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fs.h>
+
+      #include <linux/sched.h>
+      #include <linux/file.h>
+      #if HAVE_LINUX_FDTABLE_H
+        #include <linux/fdtable.h>
+      #endif
+
 int
 main ()
 {
 
-   #ifdef __putname
+   #ifdef close_on_exec
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&__putname);
+     int x = sizeof(&close_on_exec);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE___PUTNAME=yes
+	 cr_cv_kconfig_HAVE_CLOSE_ON_EXEC=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE___PUTNAME=no
+	 cr_cv_kconfig_HAVE_CLOSE_ON_EXEC=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE___PUTNAME
+  cr_result=$cr_cv_kconfig_HAVE_CLOSE_ON_EXEC
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___PUTNAME 1
-_ACEOF
+    $as_echo "#define HAVE_CLOSE_ON_EXEC 1" >>confdefs.h
 
-     HAVE___PUTNAME=1
+     HAVE_CLOSE_ON_EXEC=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___PUTNAME 0
-_ACEOF
+    $as_echo "#define HAVE_CLOSE_ON_EXEC 0" >>confdefs.h
 
-     HAVE___PUTNAME=''
+     HAVE_CLOSE_ON_EXEC=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for __set_close_on_exec" >&5
+$as_echo_n "checking kernel for __set_close_on_exec... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for struct delayed_work" >&5
-$as_echo_n "checking kernel for struct delayed_work... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK+set}" = set; then
+    if ${cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28234,11 +22046,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28246,86 +22054,70 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/workqueue.h>
+
+      #include <linux/sched.h>
+      #include <linux/file.h>
+      #if HAVE_LINUX_FDTABLE_H
+        #include <linux/fdtable.h>
+      #endif
+
 int
 main ()
 {
 
-     struct delayed_work y;
-     int x = sizeof(y);
+   #ifdef __set_close_on_exec
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&__set_close_on_exec);
+   #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK=yes
+	 cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK=no
+	 cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK
+  cr_result=$cr_cv_kconfig_HAVE___SET_CLOSE_ON_EXEC
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_DELAYED_WORK 1
-_ACEOF
+    $as_echo "#define HAVE___SET_CLOSE_ON_EXEC 1" >>confdefs.h
 
-     HAVE_STRUCT_DELAYED_WORK=1
+     HAVE___SET_CLOSE_ON_EXEC=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_DELAYED_WORK 0
-_ACEOF
+    $as_echo "#define HAVE___SET_CLOSE_ON_EXEC 0" >>confdefs.h
 
-     HAVE_STRUCT_DELAYED_WORK=''
+     HAVE___SET_CLOSE_ON_EXEC=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-
-# Order for "best" match
-
+  # OK if those are missing
+else
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for do_each_pid_task" >&5
-$as_echo_n "checking kernel for do_each_pid_task... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for open_fds.fds_bits" >&5
+$as_echo_n "checking kernel for open_fds.fds_bits... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_DO_EACH_PID_TASK+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28337,11 +22129,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28349,85 +22137,64 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+      #include <linux/sched.h>
+      #include <linux/file.h>
+      #if HAVE_LINUX_FDTABLE_H
+        #include <linux/fdtable.h>
+      #endif
+
 int
 main ()
 {
-
-   #ifndef do_each_pid_task
-     choke me
-   #endif
-
+struct files_struct x;
+          unsigned long  tc_1 = *(x.open_fds->fds_bits);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_EACH_PID_TASK=yes
+	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_EACH_PID_TASK=no
+	 cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_DO_EACH_PID_TASK
+  cr_result=$cr_cv_kconfig_HAVE_OPEN_FDS_FDS_BITS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_EACH_PID_TASK 1
-_ACEOF
+    $as_echo "#define HAVE_OPEN_FDS_FDS_BITS 1" >>confdefs.h
 
-     HAVE_DO_EACH_PID_TASK=1
+     HAVE_OPEN_FDS_FDS_BITS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_EACH_PID_TASK 0
-_ACEOF
+    $as_echo "#define HAVE_OPEN_FDS_FDS_BITS 0" >>confdefs.h
 
-     HAVE_DO_EACH_PID_TASK=''
+     HAVE_OPEN_FDS_FDS_BITS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for do_each_task_pid" >&5
-$as_echo_n "checking kernel for do_each_task_pid... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for files_struct.next_fd" >&5
+$as_echo_n "checking kernel for files_struct.next_fd... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_DO_EACH_TASK_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28439,98 +22206,70 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+    #include <linux/sched.h>
+    #include <linux/file.h>
+    #if HAVE_LINUX_FDTABLE_H
+      #include <linux/fdtable.h>
+    #endif
+
 int
 main ()
 {
-
-   #ifndef do_each_task_pid
-     choke me
-   #endif
-
+struct files_struct x;
+          int tc_1 = x.next_fd;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_EACH_TASK_PID=yes
+	 cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_EACH_TASK_PID=no
+	 cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_DO_EACH_TASK_PID
+  cr_result=$cr_cv_kconfig_HAVE_FILES_STRUCT_NEXT_FD
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_EACH_TASK_PID 1
-_ACEOF
+    $as_echo "#define HAVE_FILES_STRUCT_NEXT_FD 1" >>confdefs.h
 
-     HAVE_DO_EACH_TASK_PID=1
+     HAVE_FILES_STRUCT_NEXT_FD=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_EACH_TASK_PID 0
-_ACEOF
+    $as_echo "#define HAVE_FILES_STRUCT_NEXT_FD 0" >>confdefs.h
 
-     HAVE_DO_EACH_TASK_PID=''
+     HAVE_FILES_STRUCT_NEXT_FD=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -z "${HAVE_DO_EACH_TASK_PID}"; then
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for for_each_task_pid" >&5
-$as_echo_n "checking kernel for for_each_task_pid... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for fdtable.next_fd" >&5
+$as_echo_n "checking kernel for fdtable.next_fd... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28542,11 +22281,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28554,80 +22289,57 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+    #include <linux/sched.h>
+    #include <linux/file.h>
+    #if HAVE_LINUX_FDTABLE_H
+      #include <linux/fdtable.h>
+    #endif
+
 int
 main ()
 {
-
-   #ifndef for_each_task_pid
-     choke me
-   #endif
-
+struct fdtable x;
+          int tc_1 = x.next_fd;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID=yes
+	 cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID=no
+	 cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID
+  cr_result=$cr_cv_kconfig_HAVE_FDTABLE_NEXT_FD
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FOR_EACH_TASK_PID 1
-_ACEOF
+    $as_echo "#define HAVE_FDTABLE_NEXT_FD 1" >>confdefs.h
 
-     HAVE_FOR_EACH_TASK_PID=1
+     HAVE_FDTABLE_NEXT_FD=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FOR_EACH_TASK_PID 0
-_ACEOF
+    $as_echo "#define HAVE_FDTABLE_NEXT_FD 0" >>confdefs.h
 
-     HAVE_FOR_EACH_TASK_PID=''
+     HAVE_FDTABLE_NEXT_FD=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-fi
-# Require 1 or more match
-if test -z "${HAVE_DO_EACH_PID_TASK}${HAVE_DO_EACH_TASK_PID}${HAVE_FOR_EACH_TASK_PID}"; then
+# Allow only exactly one match
+if test "${HAVE_FILES_STRUCT_NEXT_FD}${HAVE_FDTABLE_NEXT_FD}" != "1"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -28656,13 +22368,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -28670,8 +22382,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -28693,12 +22405,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -28713,20 +22436,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to find a task iterator" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to find a task iterator" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine where to find next_fd" "$LINENO" 5
 
 fi
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for files_struct.max_fdset" >&5
+$as_echo_n "checking kernel for files_struct.max_fdset... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.0 task ids" >&5
-$as_echo_n "checking kernel for 2.6.0 task ids... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_6_0_TASK_IDS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28738,11 +22458,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28750,71 +22466,52 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+    #include <linux/sched.h>
+    #include <linux/file.h>
+    #if HAVE_LINUX_FDTABLE_H
+      #include <linux/fdtable.h>
+    #endif
+
 int
 main ()
 {
-struct task_struct x;
-          int tc_1 = x.__pgrp;
+struct files_struct x;
+          int tc_1 = x.max_fdset;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_0_TASK_IDS=yes
+	 cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_0_TASK_IDS=no
+	 cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_0_TASK_IDS
+  cr_result=$cr_cv_kconfig_HAVE_FILES_STRUCT_MAX_FDSET
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_0_TASK_IDS 1
-_ACEOF
+    $as_echo "#define HAVE_FILES_STRUCT_MAX_FDSET 1" >>confdefs.h
 
-     HAVE_2_6_0_TASK_IDS=1
+     HAVE_FILES_STRUCT_MAX_FDSET=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_0_TASK_IDS 0
-_ACEOF
+    $as_echo "#define HAVE_FILES_STRUCT_MAX_FDSET 0" >>confdefs.h
 
-     HAVE_2_6_0_TASK_IDS=''
+     HAVE_FILES_STRUCT_MAX_FDSET=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -28822,10 +22519,10 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.6 task ids" >&5
-$as_echo_n "checking kernel for 2.6.6 task ids... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for struct path" >&5
+$as_echo_n "checking kernel for struct path... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_6_6_TASK_IDS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_STRUCT_PATH+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28837,11 +22534,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28849,82 +22542,57 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <linux/fs.h>
 int
 main ()
 {
-struct task_struct x;
-          int tc_1 = x.signal->session;
+
+     struct path y;
+     int x = sizeof(y);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_6_TASK_IDS=yes
+	 cr_cv_kconfig_HAVE_STRUCT_PATH=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_6_TASK_IDS=no
+	 cr_cv_kconfig_HAVE_STRUCT_PATH=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_6_TASK_IDS
+  cr_result=$cr_cv_kconfig_HAVE_STRUCT_PATH
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_6_TASK_IDS 1
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_PATH 1" >>confdefs.h
 
-     HAVE_2_6_6_TASK_IDS=1
+     HAVE_STRUCT_PATH=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_6_TASK_IDS 0
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_PATH 0" >>confdefs.h
 
-     HAVE_2_6_6_TASK_IDS=''
+     HAVE_STRUCT_PATH=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for nameidata.path" >&5
+$as_echo_n "checking kernel for nameidata.path... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.20 task ids" >&5
-$as_echo_n "checking kernel for 2.6.20 task ids... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_6_20_TASK_IDS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_NAMEIDATA_PATH+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -28936,11 +22604,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -28948,85 +22612,71 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+    #include <linux/sched.h>
+    #include <linux/fs.h>
+    #include <linux/dcache.h>
+    #include <linux/namei.h>
+    #include <linux/fs_struct.h>
+
 int
 main ()
 {
 
-	#ifndef process_session /* Must be macro or have a decl */
-	  int x = sizeof(&process_session);
-	#endif
-	    int tc_1 = process_session(NULL);
+    /* Expect "struct path pwd" in fs_struct */
+    struct fs_struct s1;
+    struct path t1 = s1.pwd;
+
+    /* Expect "struct path path" used in nameidata */
+    struct nameidata s2;
+    struct path t2 = s2.path;
+
+    /* Expect d_path() and set_fs_pwd() to pass path */
+    (void)d_path(&t1, NULL, 0);
+    (void)set_fs_pwd(&s1, &t2);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_20_TASK_IDS=yes
+	 cr_cv_kconfig_HAVE_NAMEIDATA_PATH=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_20_TASK_IDS=no
+	 cr_cv_kconfig_HAVE_NAMEIDATA_PATH=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_20_TASK_IDS
+  cr_result=$cr_cv_kconfig_HAVE_NAMEIDATA_PATH
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_20_TASK_IDS 1
-_ACEOF
+    $as_echo "#define HAVE_NAMEIDATA_PATH 1" >>confdefs.h
 
-     HAVE_2_6_20_TASK_IDS=1
+     HAVE_NAMEIDATA_PATH=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_20_TASK_IDS 0
-_ACEOF
+    $as_echo "#define HAVE_NAMEIDATA_PATH 0" >>confdefs.h
 
-     HAVE_2_6_20_TASK_IDS=''
+     HAVE_NAMEIDATA_PATH=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for nameidata.dentry" >&5
+$as_echo_n "checking kernel for nameidata.dentry... " >&6; }
 
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.24 task ids" >&5
-$as_echo_n "checking kernel for 2.6.24 task ids... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_6_24_TASK_IDS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29038,11 +22688,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29050,82 +22696,67 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+    #include <linux/sched.h>
+    #include <linux/fs.h>
+    #include <linux/dcache.h>
+    #include <linux/namei.h>
+    #include <linux/fs_struct.h>
+
 int
 main ()
 {
 
-	#ifndef task_session_vnr /* Must be macro or have a decl */
-	  int x = sizeof(&task_session_vnr);
-	#endif
-	    int tc_1 = task_session_vnr(NULL);
+    /* Expect "struct dentry *pwd" in fs_struct */
+    struct fs_struct s1;
+    struct dentry t1 = *s1.pwd;
+
+    /* Expect "struct dentry *dentry" in nameidata */
+    struct nameidata s2;
+    struct dentry t2 = *s2.dentry;
+
+    /* Expect d_path() and set_fs_pwd() to pass dentry */
+    (void)d_path(&t1, NULL, NULL, 0);
+    (void)set_fs_pwd(&s1, NULL, &t2);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_24_TASK_IDS=yes
+	 cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_24_TASK_IDS=no
+	 cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_24_TASK_IDS
+  cr_result=$cr_cv_kconfig_HAVE_NAMEIDATA_DENTRY
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_24_TASK_IDS 1
-_ACEOF
+    $as_echo "#define HAVE_NAMEIDATA_DENTRY 1" >>confdefs.h
 
-     HAVE_2_6_24_TASK_IDS=1
+     HAVE_NAMEIDATA_DENTRY=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_24_TASK_IDS 0
-_ACEOF
+    $as_echo "#define HAVE_NAMEIDATA_DENTRY 0" >>confdefs.h
 
-     HAVE_2_6_24_TASK_IDS=''
+     HAVE_NAMEIDATA_DENTRY=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+if test "${HAVE_NAMEIDATA_PATH}${HAVE_NAMEIDATA_DENTRY}" != "1"; then
 
-# Should allow only exactly one match, except that 2.6.6 and 2.6.20/24 overlap during transitional period
-case "${HAVE_2_6_0_TASK_IDS}X${HAVE_2_6_6_TASK_IDS}X${HAVE_2_6_20_TASK_IDS}${HAVE_2_6_24_TASK_IDS}" in
-    1XX|X1X|X1X1|XX1) # OK
-	;;
-    *)
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
@@ -29153,13 +22784,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -29167,8 +22798,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -29190,12 +22821,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -29210,20 +22852,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - can't find pgrp/session of a task_struct" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - can't find pgrp/session of a task_struct" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine composition of struct nameidata" "$LINENO" 5
 
-	;;
-esac
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for set_task_pgrp" >&5
-$as_echo_n "checking kernel for set_task_pgrp... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for path_lookup" >&5
+$as_echo_n "checking kernel for path_lookup... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_SET_TASK_PGRP+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PATH_LOOKUP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29235,11 +22874,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29247,88 +22882,62 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <linux/namei.h>
 int
 main ()
 {
 
-   #ifdef set_task_pgrp
+   #ifdef path_lookup
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&set_task_pgrp);
+     int x = sizeof(&path_lookup);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SET_TASK_PGRP=yes
+	 cr_cv_kconfig_HAVE_PATH_LOOKUP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SET_TASK_PGRP=no
+	 cr_cv_kconfig_HAVE_PATH_LOOKUP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_SET_TASK_PGRP
+  cr_result=$cr_cv_kconfig_HAVE_PATH_LOOKUP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SET_TASK_PGRP 1
-_ACEOF
+    $as_echo "#define HAVE_PATH_LOOKUP 1" >>confdefs.h
 
-     HAVE_SET_TASK_PGRP=1
+     HAVE_PATH_LOOKUP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SET_TASK_PGRP 0
-_ACEOF
+    $as_echo "#define HAVE_PATH_LOOKUP 0" >>confdefs.h
 
-     HAVE_SET_TASK_PGRP=''
+     HAVE_PATH_LOOKUP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kern_path" >&5
+$as_echo_n "checking kernel for kern_path... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for set_task_session" >&5
-$as_echo_n "checking kernel for set_task_session... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_SET_TASK_SESSION+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_KERN_PATH+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29340,11 +22949,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29352,89 +22957,164 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <linux/namei.h>
 int
 main ()
 {
 
-   #ifdef set_task_session
+   #ifdef kern_path
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&set_task_session);
+     int x = sizeof(&kern_path);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SET_TASK_SESSION=yes
+	 cr_cv_kconfig_HAVE_KERN_PATH=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SET_TASK_SESSION=no
+	 cr_cv_kconfig_HAVE_KERN_PATH=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_SET_TASK_SESSION
+  cr_result=$cr_cv_kconfig_HAVE_KERN_PATH
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SET_TASK_SESSION 1
-_ACEOF
+    $as_echo "#define HAVE_KERN_PATH 1" >>confdefs.h
 
-     HAVE_SET_TASK_SESSION=1
+     HAVE_KERN_PATH=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SET_TASK_SESSION 0
-_ACEOF
+    $as_echo "#define HAVE_KERN_PATH 0" >>confdefs.h
 
-     HAVE_SET_TASK_SESSION=''
+     HAVE_KERN_PATH=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# Require 1 or more match
+if test -z "${HAVE_PATH_LOOKUP}{HAVE_KERN_PATH}"; then
+
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to find either path_lookup() or kern_path()" "$LINENO" 5
 
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for valid_signal" >&5
-$as_echo_n "checking kernel for valid_signal... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for __putname" >&5
+$as_echo_n "checking kernel for __putname... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_VALID_SIGNAL+set}" = set; then
+    if ${cr_cv_kconfig_HAVE___PUTNAME+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29446,11 +23126,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29458,89 +23134,136 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <linux/fs.h>
 int
 main ()
 {
 
-   #ifdef valid_signal
+   #ifdef __putname
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&valid_signal);
+     int x = sizeof(&__putname);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE___PUTNAME=yes
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE___PUTNAME=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+fi
+
+  cr_result=$cr_cv_kconfig_HAVE___PUTNAME
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE___PUTNAME 1" >>confdefs.h
+
+     HAVE___PUTNAME=1
+  else
+    $as_echo "#define HAVE___PUTNAME 0" >>confdefs.h
+
+     HAVE___PUTNAME=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for struct delayed_work" >&5
+$as_echo_n "checking kernel for struct delayed_work... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/workqueue.h>
+int
+main ()
+{
+
+     struct delayed_work y;
+     int x = sizeof(y);
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_VALID_SIGNAL=yes
+	 cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_VALID_SIGNAL=no
+	 cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_VALID_SIGNAL
+  cr_result=$cr_cv_kconfig_HAVE_STRUCT_DELAYED_WORK
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_VALID_SIGNAL 1
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_DELAYED_WORK 1" >>confdefs.h
 
-     HAVE_VALID_SIGNAL=1
+     HAVE_STRUCT_DELAYED_WORK=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_VALID_SIGNAL 0
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_DELAYED_WORK 0" >>confdefs.h
 
-     HAVE_VALID_SIGNAL=''
+     HAVE_STRUCT_DELAYED_WORK=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
+# Order for "best" match
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for do_each_pid_task" >&5
+$as_echo_n "checking kernel for do_each_pid_task... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for REMOVE_LINKS" >&5
-$as_echo_n "checking kernel for REMOVE_LINKS... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_REMOVE_LINKS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_DO_EACH_PID_TASK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29552,11 +23275,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29569,7 +23288,7 @@
 main ()
 {
 
-   #ifndef REMOVE_LINKS
+   #ifndef do_each_pid_task
      choke me
    #endif
 
@@ -29577,73 +23296,46 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_REMOVE_LINKS=yes
+	 cr_cv_kconfig_HAVE_DO_EACH_PID_TASK=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_REMOVE_LINKS=no
+	 cr_cv_kconfig_HAVE_DO_EACH_PID_TASK=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_REMOVE_LINKS
+  cr_result=$cr_cv_kconfig_HAVE_DO_EACH_PID_TASK
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_REMOVE_LINKS 1
-_ACEOF
+    $as_echo "#define HAVE_DO_EACH_PID_TASK 1" >>confdefs.h
 
-     HAVE_REMOVE_LINKS=1
+     HAVE_DO_EACH_PID_TASK=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_REMOVE_LINKS 0
-_ACEOF
+    $as_echo "#define HAVE_DO_EACH_PID_TASK 0" >>confdefs.h
 
-     HAVE_REMOVE_LINKS=''
+     HAVE_DO_EACH_PID_TASK=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for do_each_task_pid" >&5
+$as_echo_n "checking kernel for do_each_task_pid... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for task.pids pid_link" >&5
-$as_echo_n "checking kernel for task.pids pid_link... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_DO_EACH_TASK_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29655,11 +23347,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29671,78 +23359,56 @@
 int
 main ()
 {
-struct task_struct x;
-          struct pid_link tc_1 = x.pids[0];
+
+   #ifndef do_each_task_pid
+     choke me
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK=yes
+	 cr_cv_kconfig_HAVE_DO_EACH_TASK_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK=no
+	 cr_cv_kconfig_HAVE_DO_EACH_TASK_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK
+  cr_result=$cr_cv_kconfig_HAVE_DO_EACH_TASK_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PIDS_PID_LINK 1
-_ACEOF
+    $as_echo "#define HAVE_DO_EACH_TASK_PID 1" >>confdefs.h
 
-     HAVE_TASK_PIDS_PID_LINK=1
+     HAVE_DO_EACH_TASK_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PIDS_PID_LINK 0
-_ACEOF
+    $as_echo "#define HAVE_DO_EACH_TASK_PID 0" >>confdefs.h
 
-     HAVE_TASK_PIDS_PID_LINK=''
+     HAVE_DO_EACH_TASK_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test -z "${HAVE_DO_EACH_TASK_PID}"; then
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for for_each_task_pid" >&5
+$as_echo_n "checking kernel for for_each_task_pid... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for task.pids pid" >&5
-$as_echo_n "checking kernel for task.pids pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_TASK_PIDS_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -29754,11 +23420,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29770,72 +23432,51 @@
 int
 main ()
 {
-struct task_struct x;
-          struct pid tc_1 = x.pids[0];
+
+   #ifndef for_each_task_pid
+     choke me
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_PIDS_PID=yes
+	 cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_PIDS_PID=no
+	 cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_PIDS_PID
+  cr_result=$cr_cv_kconfig_HAVE_FOR_EACH_TASK_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PIDS_PID 1
-_ACEOF
+    $as_echo "#define HAVE_FOR_EACH_TASK_PID 1" >>confdefs.h
 
-     HAVE_TASK_PIDS_PID=1
+     HAVE_FOR_EACH_TASK_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PIDS_PID 0
-_ACEOF
+    $as_echo "#define HAVE_FOR_EACH_TASK_PID 0" >>confdefs.h
 
-     HAVE_TASK_PIDS_PID=''
+     HAVE_FOR_EACH_TASK_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# Allow zero or one match
-if test "${HAVE_TASK_PIDS_PID_LINK}${HAVE_TASK_PIDS_PID}" = "11"; then
+fi
+# Require 1 or more match
+if test -z "${HAVE_DO_EACH_PID_TASK}${HAVE_DO_EACH_TASK_PID}${HAVE_FOR_EACH_TASK_PID}"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -29864,13 +23505,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -29878,8 +23519,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -29901,12 +23542,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -29921,36 +23573,20 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine type of task.pids array" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine type of task.pids array" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to find a task iterator" "$LINENO" 5
 
 fi
 
-# put_task_struct() requires one of these:
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.0 task ids" >&5
+$as_echo_n "checking kernel for 2.6.0 task ids... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for __put_task_struct" >&5
-$as_echo_n "checking kernel symbol table for __put_task_struct... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab___put_task_struct+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_0_TASK_IDS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab___put_task_struct=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__put_task_struct$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab___put_task_struct"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___put_task_struct\$" >/dev/null ; then
-        cr_cv_ksymtab___put_task_struct=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab___put_task_struct=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___put_task_struct';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -29959,11 +23595,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -29971,106 +23603,128 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&__put_task_struct);
+struct task_struct x;
+          int tc_1 = x.__pgrp;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___put_task_struct="Y$cr_cv_ksymtab___put_task_struct"
+	 cr_cv_kconfig_HAVE_2_6_0_TASK_IDS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___put_task_struct="N$cr_cv_ksymtab___put_task_struct"
+	 cr_cv_kconfig_HAVE_2_6_0_TASK_IDS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab___put_task_struct"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab___put_task_struct" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern void __put_task_struct(struct task_struct *);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_2_6_0_TASK_IDS
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab___put_task_struct | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(__put_task_struct, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_2_6_0_TASK_IDS 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE___put_task_struct $cr_addr
-_ACEOF
+     HAVE_2_6_0_TASK_IDS=1
+  else
+    $as_echo "#define HAVE_2_6_0_TASK_IDS 0" >>confdefs.h
 
+     HAVE_2_6_0_TASK_IDS=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for __put_task_struct_cb" >&5
-$as_echo_n "checking kernel symbol table for __put_task_struct_cb... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab___put_task_struct_cb+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.6 task ids" >&5
+$as_echo_n "checking kernel for 2.6.6 task ids... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_2_6_6_TASK_IDS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab___put_task_struct_cb=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__put_task_struct_cb$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab___put_task_struct_cb"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___put_task_struct_cb\$" >/dev/null ; then
-        cr_cv_ksymtab___put_task_struct_cb=0
-      else
 
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab___put_task_struct_cb=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___put_task_struct_cb';"`
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/sched.h>
+int
+main ()
+{
+struct task_struct x;
+          int tc_1 = x.signal->session;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_2_6_6_TASK_IDS=yes
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_2_6_6_TASK_IDS=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+fi
+
+  cr_result=$cr_cv_kconfig_HAVE_2_6_6_TASK_IDS
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_2_6_6_TASK_IDS 1" >>confdefs.h
+
+     HAVE_2_6_6_TASK_IDS=1
+  else
+    $as_echo "#define HAVE_2_6_6_TASK_IDS 0" >>confdefs.h
+
+     HAVE_2_6_6_TASK_IDS=''
   fi
 
-      fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.20 task ids" >&5
+$as_echo_n "checking kernel for 2.6.20 task ids... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_2_6_20_TASK_IDS+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
 
 
   SAVE_CC=$CC
@@ -30079,11 +23733,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30091,91 +23741,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&__put_task_struct_cb);
+
+	#ifndef process_session /* Must be macro or have a decl */
+	  int x = sizeof(&process_session);
+	#endif
+	    int tc_1 = process_session(NULL);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___put_task_struct_cb="Y$cr_cv_ksymtab___put_task_struct_cb"
+	 cr_cv_kconfig_HAVE_2_6_20_TASK_IDS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___put_task_struct_cb="N$cr_cv_ksymtab___put_task_struct_cb"
+	 cr_cv_kconfig_HAVE_2_6_20_TASK_IDS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab___put_task_struct_cb"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab___put_task_struct_cb" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol __put_task_struct_cb but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol __put_task_struct_cb but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab___put_task_struct_cb | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(__put_task_struct_cb, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_2_6_20_TASK_IDS
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE___put_task_struct_cb $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_2_6_20_TASK_IDS 1" >>confdefs.h
+
+     HAVE_2_6_20_TASK_IDS=1
+  else
+    $as_echo "#define HAVE_2_6_20_TASK_IDS 0" >>confdefs.h
 
+     HAVE_2_6_20_TASK_IDS=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.task_size" >&5
-$as_echo_n "checking kernel for mm.task_size... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.24 task ids" >&5
+$as_echo_n "checking kernel for 2.6.24 task ids... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_MM_TASK_SIZE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_24_TASK_IDS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30187,11 +23805,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30203,78 +23817,159 @@
 int
 main ()
 {
-struct mm_struct x;
-          unsigned long tc_1 = x.task_size;
+
+	#ifndef task_session_vnr /* Must be macro or have a decl */
+	  int x = sizeof(&task_session_vnr);
+	#endif
+	    int tc_1 = task_session_vnr(NULL);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_TASK_SIZE=yes
+	 cr_cv_kconfig_HAVE_2_6_24_TASK_IDS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_TASK_SIZE=no
+	 cr_cv_kconfig_HAVE_2_6_24_TASK_IDS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_TASK_SIZE
+  cr_result=$cr_cv_kconfig_HAVE_2_6_24_TASK_IDS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_TASK_SIZE 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_24_TASK_IDS 1" >>confdefs.h
 
-     HAVE_MM_TASK_SIZE=1
+     HAVE_2_6_24_TASK_IDS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_TASK_SIZE 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_24_TASK_IDS 0" >>confdefs.h
 
-     HAVE_MM_TASK_SIZE=''
+     HAVE_2_6_24_TASK_IDS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# Should allow only exactly one match, except that 2.6.6 and 2.6.20/24 overlap during transitional period
+case "${HAVE_2_6_0_TASK_IDS}X${HAVE_2_6_6_TASK_IDS}X${HAVE_2_6_20_TASK_IDS}${HAVE_2_6_24_TASK_IDS}" in
+    1XX|X1X|X1X1|XX1) # OK
+	;;
+    *)
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - can't find pgrp/session of a task_struct" "$LINENO" 5
 
+	;;
+esac
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.exe_file" >&5
-$as_echo_n "checking kernel for mm.exe_file... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for set_task_pgrp" >&5
+$as_echo_n "checking kernel for set_task_pgrp... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_MM_EXE_FILE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SET_TASK_PGRP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30286,11 +23981,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30298,84 +23989,62 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-	#include <linux/mm_types.h>
-	#include <linux/fs.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct mm_struct x;
-          struct file  tc_1 = *(x.exe_file);
+
+   #ifdef set_task_pgrp
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&set_task_pgrp);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_EXE_FILE=yes
+	 cr_cv_kconfig_HAVE_SET_TASK_PGRP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_EXE_FILE=no
+	 cr_cv_kconfig_HAVE_SET_TASK_PGRP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_EXE_FILE
+  cr_result=$cr_cv_kconfig_HAVE_SET_TASK_PGRP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_EXE_FILE 1
-_ACEOF
+    $as_echo "#define HAVE_SET_TASK_PGRP 1" >>confdefs.h
 
-     HAVE_MM_EXE_FILE=1
+     HAVE_SET_TASK_PGRP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_EXE_FILE 0
-_ACEOF
+    $as_echo "#define HAVE_SET_TASK_PGRP 0" >>confdefs.h
 
-     HAVE_MM_EXE_FILE=''
+     HAVE_SET_TASK_PGRP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for set_task_session" >&5
+$as_echo_n "checking kernel for set_task_session... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for vma.vm_mm" >&5
-$as_echo_n "checking kernel for vma.vm_mm... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_VMA_VM_MM+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SET_TASK_SESSION+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30387,11 +24056,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30399,71 +24064,52 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/mm_types.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct vm_area_struct x;
-          struct mm_struct  tc_1 = *(x.vm_mm);
+
+   #ifdef set_task_session
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&set_task_session);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_VMA_VM_MM=yes
+	 cr_cv_kconfig_HAVE_SET_TASK_SESSION=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_VMA_VM_MM=no
+	 cr_cv_kconfig_HAVE_SET_TASK_SESSION=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_VMA_VM_MM
+  cr_result=$cr_cv_kconfig_HAVE_SET_TASK_SESSION
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_VMA_VM_MM 1
-_ACEOF
+    $as_echo "#define HAVE_SET_TASK_SESSION 1" >>confdefs.h
 
-     HAVE_VMA_VM_MM=1
+     HAVE_SET_TASK_SESSION=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_VMA_VM_MM 0
-_ACEOF
+    $as_echo "#define HAVE_SET_TASK_SESSION 0" >>confdefs.h
 
-     HAVE_VMA_VM_MM=''
+     HAVE_SET_TASK_SESSION=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -30471,11 +24117,10 @@
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for valid_signal" >&5
+$as_echo_n "checking kernel for valid_signal... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for PageAnon" >&5
-$as_echo_n "checking kernel for PageAnon... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PAGEANON+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_VALID_SIGNAL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30487,11 +24132,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30499,90 +24140,63 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/mm.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
 
-   #ifdef PageAnon
+   #ifdef valid_signal
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&PageAnon);
+     int x = sizeof(&valid_signal);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PAGEANON=yes
+	 cr_cv_kconfig_HAVE_VALID_SIGNAL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PAGEANON=no
+	 cr_cv_kconfig_HAVE_VALID_SIGNAL=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PAGEANON
+  cr_result=$cr_cv_kconfig_HAVE_VALID_SIGNAL
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PAGEANON 1
-_ACEOF
+    $as_echo "#define HAVE_VALID_SIGNAL 1" >>confdefs.h
 
-     HAVE_PAGEANON=1
+     HAVE_VALID_SIGNAL=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PAGEANON 0
-_ACEOF
+    $as_echo "#define HAVE_VALID_SIGNAL 0" >>confdefs.h
 
-     HAVE_PAGEANON=''
+     HAVE_VALID_SIGNAL=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
-# Look for various VDSO-related bits (arch and version dependent)
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.vdso_base" >&5
-$as_echo_n "checking kernel for thread.vdso_base... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for REMOVE_LINKS" >&5
+$as_echo_n "checking kernel for REMOVE_LINKS... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_THREAD_VDSO_BASE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_REMOVE_LINKS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30594,11 +24208,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30606,71 +24216,49 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.vdso_base;
+
+   #ifndef REMOVE_LINKS
+     choke me
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_VDSO_BASE=yes
+	 cr_cv_kconfig_HAVE_REMOVE_LINKS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_VDSO_BASE=no
+	 cr_cv_kconfig_HAVE_REMOVE_LINKS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_VDSO_BASE
+  cr_result=$cr_cv_kconfig_HAVE_REMOVE_LINKS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_VDSO_BASE 1
-_ACEOF
+    $as_echo "#define HAVE_REMOVE_LINKS 1" >>confdefs.h
 
-     HAVE_THREAD_VDSO_BASE=1
+     HAVE_REMOVE_LINKS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_VDSO_BASE 0
-_ACEOF
+    $as_echo "#define HAVE_REMOVE_LINKS 0" >>confdefs.h
 
-     HAVE_THREAD_VDSO_BASE=''
+     HAVE_REMOVE_LINKS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -30678,10 +24266,10 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.context.vdso_base" >&5
-$as_echo_n "checking kernel for mm.context.vdso_base... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.pids pid_link" >&5
+$as_echo_n "checking kernel for task.pids pid_link... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30693,11 +24281,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30709,78 +24293,52 @@
 int
 main ()
 {
-mm_context_t x;
-          unsigned long tc_1 = x.vdso_base;
+struct task_struct x;
+          struct pid_link tc_1 = x.pids[0];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE=yes
+	 cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE=no
+	 cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE
+  cr_result=$cr_cv_kconfig_HAVE_TASK_PIDS_PID_LINK
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_CONTEXT_VDSO_BASE 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_PIDS_PID_LINK 1" >>confdefs.h
 
-     HAVE_MM_CONTEXT_VDSO_BASE=1
+     HAVE_TASK_PIDS_PID_LINK=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_CONTEXT_VDSO_BASE 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_PIDS_PID_LINK 0" >>confdefs.h
 
-     HAVE_MM_CONTEXT_VDSO_BASE=''
+     HAVE_TASK_PIDS_PID_LINK=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.pids pid" >&5
+$as_echo_n "checking kernel for task.pids pid... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.context.vdso" >&5
-$as_echo_n "checking kernel for mm.context.vdso... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_PIDS_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -30792,11 +24350,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30808,81 +24362,170 @@
 int
 main ()
 {
-mm_context_t x;
-          unsigned long tc_1 = x.vdso;
+struct task_struct x;
+          struct pid tc_1 = x.pids[0];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO=yes
+	 cr_cv_kconfig_HAVE_TASK_PIDS_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO=no
+	 cr_cv_kconfig_HAVE_TASK_PIDS_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO
+  cr_result=$cr_cv_kconfig_HAVE_TASK_PIDS_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_CONTEXT_VDSO 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_PIDS_PID 1" >>confdefs.h
 
-     HAVE_MM_CONTEXT_VDSO=1
+     HAVE_TASK_PIDS_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_CONTEXT_VDSO 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_PIDS_PID 0" >>confdefs.h
 
-     HAVE_MM_CONTEXT_VDSO=''
+     HAVE_TASK_PIDS_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# Allow zero or one match
+if test "${HAVE_TASK_PIDS_PID_LINK}${HAVE_TASK_PIDS_PID}" = "11"; then
+
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
+_ACEOF
 
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
 
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread_info.sysenter_return" >&5
-$as_echo_n "checking kernel for thread_info.sysenter_return... " >&6; }
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
 
-    if test "${cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN+set}" = set; then
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine type of task.pids array" "$LINENO" 5
+
+fi
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for signal_wake_up" >&5
+$as_echo_n "checking kernel symbol table for signal_wake_up... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_signal_wake_up+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_signal_wake_up=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}signal_wake_up$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_signal_wake_up"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_signal_wake_up\$" >/dev/null ; then
+        cr_cv_ksymtab_signal_wake_up=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_signal_wake_up=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_signal_wake_up';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -30891,11 +24534,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -30903,86 +24542,85 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/thread_info.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_info x;
-          void * tc_1 = x.sysenter_return;
+int x = sizeof(&signal_wake_up);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN=yes
+	 cr_cv_ksymtab_signal_wake_up="Y$cr_cv_ksymtab_signal_wake_up"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN=no
+	 cr_cv_ksymtab_signal_wake_up="N$cr_cv_ksymtab_signal_wake_up"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_signal_wake_up"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_signal_wake_up" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern void signal_wake_up(struct task_struct *, int);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_INFO_SYSENTER_RETURN 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_signal_wake_up | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(signal_wake_up, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_THREAD_INFO_SYSENTER_RETURN=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_INFO_SYSENTER_RETURN 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_signal_wake_up $cr_addr
 _ACEOF
 
-     HAVE_THREAD_INFO_SYSENTER_RETURN=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test $CR_KARCH = arm; then
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread_info.tp_value" >&5
-$as_echo_n "checking kernel for thread_info.tp_value... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for signal_wake_up_state" >&5
+$as_echo_n "checking kernel symbol table for signal_wake_up_state... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_signal_wake_up_state+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_signal_wake_up_state=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}signal_wake_up_state$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_signal_wake_up_state"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_signal_wake_up_state\$" >/dev/null ; then
+        cr_cv_ksymtab_signal_wake_up_state=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_signal_wake_up_state=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_signal_wake_up_state';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -30991,11 +24629,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31003,94 +24637,84 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/thread_info.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_info x;
-          unsigned long tc_1 = x.tp_value;
+int x = sizeof(&signal_wake_up_state);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE=yes
+	 cr_cv_ksymtab_signal_wake_up_state="Y$cr_cv_ksymtab_signal_wake_up_state"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE=no
+	 cr_cv_ksymtab_signal_wake_up_state="N$cr_cv_ksymtab_signal_wake_up_state"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_signal_wake_up_state"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_signal_wake_up_state" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern void signal_wake_up_state(struct task_struct *, int);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_INFO_TP_VALUE 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_signal_wake_up_state | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(signal_wake_up_state, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_THREAD_INFO_TP_VALUE=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_INFO_TP_VALUE 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_signal_wake_up_state $cr_addr
 _ACEOF
 
-     HAVE_THREAD_INFO_TP_VALUE=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# put_task_struct() requires one of these:
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for __kuser_helper_start" >&5
-$as_echo_n "checking kernel symbol table for __kuser_helper_start... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for __put_task_struct" >&5
+$as_echo_n "checking kernel symbol table for __put_task_struct... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab___kuser_helper_start+set}" = set; then
+    if ${cr_cv_ksymtab___put_task_struct+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab___kuser_helper_start=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__kuser_helper_start$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab___kuser_helper_start"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___kuser_helper_start\$" >/dev/null ; then
-        cr_cv_ksymtab___kuser_helper_start=0
+    cr_cv_ksymtab___put_task_struct=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__put_task_struct$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab___put_task_struct"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___put_task_struct\$" >/dev/null ; then
+        cr_cv_ksymtab___put_task_struct=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab___kuser_helper_start=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___kuser_helper_start';"`
+    cr_cv_ksymtab___put_task_struct=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___put_task_struct';"`
   fi
 
       fi
@@ -31102,11 +24726,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31121,43 +24741,22 @@
 int
 main ()
 {
-int x = sizeof(&__kuser_helper_start);
+int x = sizeof(&__put_task_struct);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___kuser_helper_start="Y$cr_cv_ksymtab___kuser_helper_start"
+	 cr_cv_ksymtab___put_task_struct="Y$cr_cv_ksymtab___put_task_struct"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___kuser_helper_start="N$cr_cv_ksymtab___kuser_helper_start"
+	 cr_cv_ksymtab___put_task_struct="N$cr_cv_ksymtab___put_task_struct"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -31165,52 +24764,52 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab___kuser_helper_start"; then
+  if test -z "$cr_cv_ksymtab___put_task_struct"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab___kuser_helper_start" : N >/dev/null; then
+    if expr "$cr_cv_ksymtab___put_task_struct" : N >/dev/null; then
       cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int __kuser_helper_start(void);
+extern void __put_task_struct(struct task_struct *);
 _EOF
 
     fi
-    cr_result=`echo $cr_cv_ksymtab___kuser_helper_start | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab___put_task_struct | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(__kuser_helper_start, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(__put_task_struct, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE___kuser_helper_start $cr_addr
+#define CR_KCODE___put_task_struct $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for __kuser_cmpxchg" >&5
-$as_echo_n "checking kernel symbol table for __kuser_cmpxchg... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for __put_task_struct_cb" >&5
+$as_echo_n "checking kernel symbol table for __put_task_struct_cb... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab___kuser_cmpxchg+set}" = set; then
+    if ${cr_cv_ksymtab___put_task_struct_cb+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab___kuser_cmpxchg=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__kuser_cmpxchg$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab___kuser_cmpxchg"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___kuser_cmpxchg\$" >/dev/null ; then
-        cr_cv_ksymtab___kuser_cmpxchg=0
+    cr_cv_ksymtab___put_task_struct_cb=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__put_task_struct_cb$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab___put_task_struct_cb"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___put_task_struct_cb\$" >/dev/null ; then
+        cr_cv_ksymtab___put_task_struct_cb=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab___kuser_cmpxchg=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___kuser_cmpxchg';"`
+    cr_cv_ksymtab___put_task_struct_cb=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___put_task_struct_cb';"`
   fi
 
       fi
@@ -31222,11 +24821,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31241,43 +24836,22 @@
 int
 main ()
 {
-int x = sizeof(&__kuser_cmpxchg);
+int x = sizeof(&__put_task_struct_cb);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___kuser_cmpxchg="Y$cr_cv_ksymtab___kuser_cmpxchg"
+	 cr_cv_ksymtab___put_task_struct_cb="Y$cr_cv_ksymtab___put_task_struct_cb"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab___kuser_cmpxchg="N$cr_cv_ksymtab___kuser_cmpxchg"
+	 cr_cv_ksymtab___put_task_struct_cb="N$cr_cv_ksymtab___put_task_struct_cb"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -31285,41 +24859,37 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab___kuser_cmpxchg"; then
+  if test -z "$cr_cv_ksymtab___put_task_struct_cb"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab___kuser_cmpxchg" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int __kuser_cmpxchg(void);
-_EOF
-
+    if expr "$cr_cv_ksymtab___put_task_struct_cb" : N >/dev/null; then
+      as_fn_error $? "Found symbol __put_task_struct_cb but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab___kuser_cmpxchg | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab___put_task_struct_cb | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(__kuser_cmpxchg, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(__put_task_struct_cb, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE___kuser_cmpxchg $cr_addr
+#define CR_KCODE___put_task_struct_cb $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for VSYSCALL_BASE" >&5
-$as_echo_n "checking kernel for VSYSCALL_BASE... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.task_size" >&5
+$as_echo_n "checking kernel for mm.task_size... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_VSYSCALL_BASE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_MM_TASK_SIZE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -31331,11 +24901,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31343,87 +24909,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/elf.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
-
-     typeof(VSYSCALL_BASE) y;
-     int x = sizeof(y);
-
+struct mm_struct x;
+          unsigned long tc_1 = x.task_size;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_VSYSCALL_BASE=yes
+	 cr_cv_kconfig_HAVE_MM_TASK_SIZE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_VSYSCALL_BASE=no
+	 cr_cv_kconfig_HAVE_MM_TASK_SIZE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_VSYSCALL_BASE
+  cr_result=$cr_cv_kconfig_HAVE_MM_TASK_SIZE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_VSYSCALL_BASE 1
-_ACEOF
+    $as_echo "#define HAVE_MM_TASK_SIZE 1" >>confdefs.h
 
-     HAVE_VSYSCALL_BASE=1
+     HAVE_MM_TASK_SIZE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_VSYSCALL_BASE 0
-_ACEOF
+    $as_echo "#define HAVE_MM_TASK_SIZE 0" >>confdefs.h
 
-     HAVE_VSYSCALL_BASE=''
+     HAVE_MM_TASK_SIZE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.exe_file" >&5
+$as_echo_n "checking kernel for mm.exe_file... " >&6; }
 
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2-arg arch_setup_additional_pages" >&5
-$as_echo_n "checking kernel for 2-arg arch_setup_additional_pages... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_MM_EXE_FILE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -31435,11 +24970,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31448,91 +24979,57 @@
 		 #endif
 		 #include <linux/types.h>
 
-    #include <linux/sched.h>
-    #include <asm/elf.h>
-
+	#include <linux/mm_types.h>
+	#include <linux/fs.h>
 int
 main ()
 {
-
-	#ifndef arch_setup_additional_pages /* Must be macro or have a decl */
-	  int x = sizeof(&arch_setup_additional_pages);
-	#endif
-	    arch_setup_additional_pages(NULL,0);
+struct mm_struct x;
+          struct file  tc_1 = *(x.exe_file);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=yes
+	 cr_cv_kconfig_HAVE_MM_EXE_FILE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=no
+	 cr_cv_kconfig_HAVE_MM_EXE_FILE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES
+  cr_result=$cr_cv_kconfig_HAVE_MM_EXE_FILE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES 1
-_ACEOF
+    $as_echo "#define HAVE_MM_EXE_FILE 1" >>confdefs.h
 
-     HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=1
+     HAVE_MM_EXE_FILE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES 0
-_ACEOF
+    $as_echo "#define HAVE_MM_EXE_FILE 0" >>confdefs.h
 
-     HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=''
+     HAVE_MM_EXE_FILE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for vma.vm_mm" >&5
+$as_echo_n "checking kernel for vma.vm_mm... " >&6; }
 
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 4-arg arch_setup_additional_pages" >&5
-$as_echo_n "checking kernel for 4-arg arch_setup_additional_pages... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_VMA_VM_MM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -31544,11 +25041,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31556,106 +25049,60 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <asm/elf.h>
-
+		 #include <linux/mm_types.h>
 int
 main ()
 {
-
-	#ifndef arch_setup_additional_pages /* Must be macro or have a decl */
-	  int x = sizeof(&arch_setup_additional_pages);
-	#endif
-	    arch_setup_additional_pages(NULL,0,0,0);
+struct vm_area_struct x;
+          struct mm_struct  tc_1 = *(x.vm_mm);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=yes
+	 cr_cv_kconfig_HAVE_VMA_VM_MM=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=no
+	 cr_cv_kconfig_HAVE_VMA_VM_MM=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES
+  cr_result=$cr_cv_kconfig_HAVE_VMA_VM_MM
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES 1
-_ACEOF
+    $as_echo "#define HAVE_VMA_VM_MM 1" >>confdefs.h
 
-     HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=1
+     HAVE_VMA_VM_MM=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES 0
-_ACEOF
+    $as_echo "#define HAVE_VMA_VM_MM 0" >>confdefs.h
 
-     HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=''
+     HAVE_VMA_VM_MM=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
-if test -n "${HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES}${HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES}"; then
-
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for PageAnon" >&5
+$as_echo_n "checking kernel for PageAnon... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for arch_setup_additional_pages" >&5
-$as_echo_n "checking kernel symbol table for arch_setup_additional_pages... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_arch_setup_additional_pages+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PAGEANON+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_arch_setup_additional_pages=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_setup_additional_pages$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_arch_setup_additional_pages"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_setup_additional_pages\$" >/dev/null ; then
-        cr_cv_ksymtab_arch_setup_additional_pages=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_arch_setup_additional_pages=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_setup_additional_pages';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -31664,11 +25111,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31676,91 +25119,64 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/mm.h>
 int
 main ()
 {
-int x = sizeof(&arch_setup_additional_pages);
+
+   #ifdef PageAnon
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&PageAnon);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_setup_additional_pages="Y$cr_cv_ksymtab_arch_setup_additional_pages"
+	 cr_cv_kconfig_HAVE_PAGEANON=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_setup_additional_pages="N$cr_cv_ksymtab_arch_setup_additional_pages"
+	 cr_cv_kconfig_HAVE_PAGEANON=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_arch_setup_additional_pages"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_arch_setup_additional_pages" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol arch_setup_additional_pages but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol arch_setup_additional_pages but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_arch_setup_additional_pages | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(arch_setup_additional_pages, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_PAGEANON
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_arch_setup_additional_pages $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_PAGEANON 1" >>confdefs.h
+
+     HAVE_PAGEANON=1
+  else
+    $as_echo "#define HAVE_PAGEANON 0" >>confdefs.h
 
+     HAVE_PAGEANON=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
 
 
+# Look for various VDSO-related bits (arch and version dependent)
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for map_vsyscall" >&5
-$as_echo_n "checking kernel for map_vsyscall... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_MAP_VSYSCALL+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.vdso_base" >&5
+$as_echo_n "checking kernel for thread.vdso_base... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_THREAD_VDSO_BASE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -31772,11 +25188,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31784,109 +25196,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <asm/elf.h>
-    #ifndef __HAVE_ARCH_VSYSCALL
-      choke me
-    #endif
+		 #include <asm/processor.h>
 int
 main ()
 {
-
-   #ifdef map_vsyscall
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&map_vsyscall);
-   #endif
-
+struct thread_struct x;
+          unsigned long tc_1 = x.vdso_base;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MAP_VSYSCALL=yes
+	 cr_cv_kconfig_HAVE_THREAD_VDSO_BASE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MAP_VSYSCALL=no
+	 cr_cv_kconfig_HAVE_THREAD_VDSO_BASE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MAP_VSYSCALL
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_VDSO_BASE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MAP_VSYSCALL 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_VDSO_BASE 1" >>confdefs.h
 
-     HAVE_MAP_VSYSCALL=1
+     HAVE_THREAD_VDSO_BASE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MAP_VSYSCALL 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_VDSO_BASE 0" >>confdefs.h
 
-     HAVE_MAP_VSYSCALL=''
+     HAVE_THREAD_VDSO_BASE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -n "${HAVE_MAP_VSYSCALL}"; then
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.context.vdso_base" >&5
+$as_echo_n "checking kernel for mm.context.vdso_base... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for map_vsyscall" >&5
-$as_echo_n "checking kernel symbol table for map_vsyscall... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_map_vsyscall+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_map_vsyscall=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}map_vsyscall$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_map_vsyscall"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_map_vsyscall\$" >/dev/null ; then
-        cr_cv_ksymtab_map_vsyscall=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_map_vsyscall=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_map_vsyscall';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -31895,11 +25257,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -31907,107 +25265,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&map_vsyscall);
+mm_context_t x;
+          unsigned long tc_1 = x.vdso_base;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_map_vsyscall="Y$cr_cv_ksymtab_map_vsyscall"
+	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_map_vsyscall="N$cr_cv_ksymtab_map_vsyscall"
+	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_map_vsyscall"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_map_vsyscall" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol map_vsyscall but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol map_vsyscall but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_map_vsyscall | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(map_vsyscall, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO_BASE
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_map_vsyscall $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_MM_CONTEXT_VDSO_BASE 1" >>confdefs.h
+
+     HAVE_MM_CONTEXT_VDSO_BASE=1
+  else
+    $as_echo "#define HAVE_MM_CONTEXT_VDSO_BASE 0" >>confdefs.h
 
+     HAVE_MM_CONTEXT_VDSO_BASE=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
-if test $CR_KARCH = x86_64; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for syscall32_setup_pages" >&5
-$as_echo_n "checking kernel symbol table for syscall32_setup_pages... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_syscall32_setup_pages+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.context.vdso" >&5
+$as_echo_n "checking kernel for mm.context.vdso... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_syscall32_setup_pages=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}syscall32_setup_pages$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_syscall32_setup_pages"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_syscall32_setup_pages\$" >/dev/null ; then
-        cr_cv_ksymtab_syscall32_setup_pages=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_syscall32_setup_pages=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_syscall32_setup_pages';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -32016,11 +25326,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32028,108 +25334,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&syscall32_setup_pages);
+mm_context_t x;
+          unsigned long tc_1 = x.vdso;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_syscall32_setup_pages="Y$cr_cv_ksymtab_syscall32_setup_pages"
+	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_syscall32_setup_pages="N$cr_cv_ksymtab_syscall32_setup_pages"
+	 cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_syscall32_setup_pages"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_syscall32_setup_pages" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int syscall32_setup_pages(void *, int);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_MM_CONTEXT_VDSO
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_syscall32_setup_pages | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(syscall32_setup_pages, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_MM_CONTEXT_VDSO 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_syscall32_setup_pages $cr_addr
-_ACEOF
+     HAVE_MM_CONTEXT_VDSO=1
+  else
+    $as_echo "#define HAVE_MM_CONTEXT_VDSO 0" >>confdefs.h
 
+     HAVE_MM_CONTEXT_VDSO=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
-if test $CR_KARCH = arm; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for vectors_user_mapping" >&5
-$as_echo_n "checking kernel symbol table for vectors_user_mapping... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_vectors_user_mapping+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread_info.sysenter_return" >&5
+$as_echo_n "checking kernel for thread_info.sysenter_return... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_vectors_user_mapping=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}vectors_user_mapping$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_vectors_user_mapping"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_vectors_user_mapping\$" >/dev/null ; then
-        cr_cv_ksymtab_vectors_user_mapping=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_vectors_user_mapping=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_vectors_user_mapping';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -32138,11 +25395,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32150,108 +25403,60 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/thread_info.h>
 int
 main ()
 {
-int x = sizeof(&vectors_user_mapping);
+struct thread_info x;
+          void * tc_1 = x.sysenter_return;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_vectors_user_mapping="Y$cr_cv_ksymtab_vectors_user_mapping"
+	 cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_vectors_user_mapping="N$cr_cv_ksymtab_vectors_user_mapping"
+	 cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_vectors_user_mapping"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_vectors_user_mapping" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int vectors_user_mapping(void);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_INFO_SYSENTER_RETURN
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_vectors_user_mapping | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(vectors_user_mapping, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_THREAD_INFO_SYSENTER_RETURN 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_vectors_user_mapping $cr_addr
-_ACEOF
+     HAVE_THREAD_INFO_SYSENTER_RETURN=1
+  else
+    $as_echo "#define HAVE_THREAD_INFO_SYSENTER_RETURN 0" >>confdefs.h
 
+     HAVE_THREAD_INFO_SYSENTER_RETURN=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
 
+if test $CR_KARCH = arm; then
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread_info.tp_value" >&5
+$as_echo_n "checking kernel for thread_info.tp_value... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for arch_pick_mmap_layout" >&5
-$as_echo_n "checking kernel symbol table for arch_pick_mmap_layout... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_arch_pick_mmap_layout+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_arch_pick_mmap_layout=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_pick_mmap_layout$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_arch_pick_mmap_layout"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_pick_mmap_layout\$" >/dev/null ; then
-        cr_cv_ksymtab_arch_pick_mmap_layout=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_arch_pick_mmap_layout=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_pick_mmap_layout';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -32260,11 +25465,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32272,102 +25473,69 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/thread_info.h>
 int
 main ()
 {
-int x = sizeof(&arch_pick_mmap_layout);
+struct thread_info x;
+          unsigned long tc_1 = x.tp_value;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_pick_mmap_layout="Y$cr_cv_ksymtab_arch_pick_mmap_layout"
+	 cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_pick_mmap_layout="N$cr_cv_ksymtab_arch_pick_mmap_layout"
+	 cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_arch_pick_mmap_layout"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_arch_pick_mmap_layout" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol arch_pick_mmap_layout but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol arch_pick_mmap_layout but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_arch_pick_mmap_layout | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(arch_pick_mmap_layout, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_INFO_TP_VALUE
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_arch_pick_mmap_layout $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_THREAD_INFO_TP_VALUE 1" >>confdefs.h
 
+     HAVE_THREAD_INFO_TP_VALUE=1
+  else
+    $as_echo "#define HAVE_THREAD_INFO_TP_VALUE 0" >>confdefs.h
+
+     HAVE_THREAD_INFO_TP_VALUE=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for arch_get_unmaped_area" >&5
-$as_echo_n "checking kernel symbol table for arch_get_unmaped_area... " >&6; }
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for __kuser_helper_start" >&5
+$as_echo_n "checking kernel symbol table for __kuser_helper_start... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_arch_get_unmaped_area+set}" = set; then
+    if ${cr_cv_ksymtab___kuser_helper_start+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_arch_get_unmaped_area=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_get_unmaped_area$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_arch_get_unmaped_area"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_get_unmaped_area\$" >/dev/null ; then
-        cr_cv_ksymtab_arch_get_unmaped_area=0
+    cr_cv_ksymtab___kuser_helper_start=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__kuser_helper_start$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab___kuser_helper_start"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___kuser_helper_start\$" >/dev/null ; then
+        cr_cv_ksymtab___kuser_helper_start=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_arch_get_unmaped_area=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_get_unmaped_area';"`
+    cr_cv_ksymtab___kuser_helper_start=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___kuser_helper_start';"`
   fi
 
       fi
@@ -32379,11 +25547,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32398,43 +25562,22 @@
 int
 main ()
 {
-int x = sizeof(&arch_get_unmaped_area);
+int x = sizeof(&__kuser_helper_start);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_get_unmaped_area="Y$cr_cv_ksymtab_arch_get_unmaped_area"
+	 cr_cv_ksymtab___kuser_helper_start="Y$cr_cv_ksymtab___kuser_helper_start"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_get_unmaped_area="N$cr_cv_ksymtab_arch_get_unmaped_area"
+	 cr_cv_ksymtab___kuser_helper_start="N$cr_cv_ksymtab___kuser_helper_start"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -32442,51 +25585,52 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_arch_get_unmaped_area"; then
+  if test -z "$cr_cv_ksymtab___kuser_helper_start"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_arch_get_unmaped_area" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol arch_get_unmaped_area but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol arch_get_unmaped_area but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab___kuser_helper_start" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int __kuser_helper_start(void);
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_arch_get_unmaped_area | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab___kuser_helper_start | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(arch_get_unmaped_area, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(__kuser_helper_start, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_arch_get_unmaped_area $cr_addr
+#define CR_KCODE___kuser_helper_start $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for arch_unmap_area" >&5
-$as_echo_n "checking kernel symbol table for arch_unmap_area... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for __kuser_cmpxchg" >&5
+$as_echo_n "checking kernel symbol table for __kuser_cmpxchg... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_arch_unmap_area+set}" = set; then
+    if ${cr_cv_ksymtab___kuser_cmpxchg+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_arch_unmap_area=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_unmap_area$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_arch_unmap_area"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_unmap_area\$" >/dev/null ; then
-        cr_cv_ksymtab_arch_unmap_area=0
+    cr_cv_ksymtab___kuser_cmpxchg=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}__kuser_cmpxchg$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab___kuser_cmpxchg"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab___kuser_cmpxchg\$" >/dev/null ; then
+        cr_cv_ksymtab___kuser_cmpxchg=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_arch_unmap_area=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_unmap_area';"`
+    cr_cv_ksymtab___kuser_cmpxchg=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab___kuser_cmpxchg';"`
   fi
 
       fi
@@ -32498,11 +25642,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32517,43 +25657,22 @@
 int
 main ()
 {
-int x = sizeof(&arch_unmap_area);
+int x = sizeof(&__kuser_cmpxchg);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_unmap_area="Y$cr_cv_ksymtab_arch_unmap_area"
+	 cr_cv_ksymtab___kuser_cmpxchg="Y$cr_cv_ksymtab___kuser_cmpxchg"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_arch_unmap_area="N$cr_cv_ksymtab_arch_unmap_area"
+	 cr_cv_ksymtab___kuser_cmpxchg="N$cr_cv_ksymtab___kuser_cmpxchg"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -32561,39 +25680,40 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_arch_unmap_area"; then
+  if test -z "$cr_cv_ksymtab___kuser_cmpxchg"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_arch_unmap_area" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol arch_unmap_area but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol arch_unmap_area but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab___kuser_cmpxchg" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int __kuser_cmpxchg(void);
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_arch_unmap_area | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab___kuser_cmpxchg | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(arch_unmap_area, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(__kuser_cmpxchg, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_arch_unmap_area $cr_addr
+#define CR_KCODE___kuser_cmpxchg $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+fi
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for VSYSCALL_BASE" >&5
+$as_echo_n "checking kernel for VSYSCALL_BASE... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.mmap_base" >&5
-$as_echo_n "checking kernel for mm.mmap_base... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_MM_MMAP_BASE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_VSYSCALL_BASE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -32605,11 +25725,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32617,71 +25733,48 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <asm/elf.h>
 int
 main ()
 {
-struct mm_struct x;
-          unsigned long tc_1 = x.mmap_base;
+
+     typeof(VSYSCALL_BASE) y;
+     int x = sizeof(y);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_MMAP_BASE=yes
+	 cr_cv_kconfig_HAVE_VSYSCALL_BASE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_MMAP_BASE=no
+	 cr_cv_kconfig_HAVE_VSYSCALL_BASE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_MMAP_BASE
+  cr_result=$cr_cv_kconfig_HAVE_VSYSCALL_BASE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_MMAP_BASE 1
-_ACEOF
+    $as_echo "#define HAVE_VSYSCALL_BASE 1" >>confdefs.h
 
-     HAVE_MM_MMAP_BASE=1
+     HAVE_VSYSCALL_BASE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_MMAP_BASE 0
-_ACEOF
+    $as_echo "#define HAVE_VSYSCALL_BASE 0" >>confdefs.h
 
-     HAVE_MM_MMAP_BASE=''
+     HAVE_VSYSCALL_BASE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -32689,10 +25782,12 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.cached_hole_size" >&5
-$as_echo_n "checking kernel for mm.cached_hole_size... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2-arg arch_setup_additional_pages" >&5
+$as_echo_n "checking kernel for 2-arg arch_setup_additional_pages... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -32704,11 +25799,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32716,71 +25807,52 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+    #include <linux/sched.h>
+    #include <asm/elf.h>
+
 int
 main ()
 {
-struct mm_struct x;
-          unsigned long tc_1 = x.cached_hole_size;
+
+	#ifndef arch_setup_additional_pages /* Must be macro or have a decl */
+	  int x = sizeof(&arch_setup_additional_pages);
+	#endif
+	    arch_setup_additional_pages(NULL,0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE=yes
+	 cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE=no
+	 cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE
+  cr_result=$cr_cv_kconfig_HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_CACHED_HOLE_SIZE 1
-_ACEOF
+    $as_echo "#define HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES 1" >>confdefs.h
 
-     HAVE_MM_CACHED_HOLE_SIZE=1
+     HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_CACHED_HOLE_SIZE 0
-_ACEOF
+    $as_echo "#define HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES 0" >>confdefs.h
 
-     HAVE_MM_CACHED_HOLE_SIZE=''
+     HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -32789,25 +25861,15 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_munmap" >&5
-$as_echo_n "checking kernel symbol table for do_munmap... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_munmap+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
 
-    cr_cv_ksymtab_do_munmap=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_munmap$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_do_munmap"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_munmap\$" >/dev/null ; then
-        cr_cv_ksymtab_do_munmap=0
-      else
 
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_do_munmap=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_munmap';"`
-  fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 4-arg arch_setup_additional_pages" >&5
+$as_echo_n "checking kernel for 4-arg arch_setup_additional_pages... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
-      fi
 
 
   SAVE_CC=$CC
@@ -32816,11 +25878,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32829,92 +25887,80 @@
 		 #endif
 		 #include <linux/types.h>
 
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+    #include <linux/sched.h>
+    #include <asm/elf.h>
 
 int
 main ()
 {
-int x = sizeof(&do_munmap);
+
+	#ifndef arch_setup_additional_pages /* Must be macro or have a decl */
+	  int x = sizeof(&arch_setup_additional_pages);
+	#endif
+	    arch_setup_additional_pages(NULL,0,0,0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_munmap="Y$cr_cv_ksymtab_do_munmap"
+	 cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_munmap="N$cr_cv_ksymtab_do_munmap"
+	 cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_do_munmap"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_do_munmap" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol do_munmap but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol do_munmap but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_do_munmap | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(do_munmap, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_do_munmap $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES 1" >>confdefs.h
+
+     HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=1
+  else
+    $as_echo "#define HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES 0" >>confdefs.h
 
+     HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
+if test -n "${HAVE_2_ARG_ARCH_SETUP_ADDITIONAL_PAGES}${HAVE_4_ARG_ARCH_SETUP_ADDITIONAL_PAGES}"; then
+
 
-  { $as_echo "$as_me:$LINENO: checking kernel for do_mmap" >&5
-$as_echo_n "checking kernel for do_mmap... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_DO_MMAP+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for arch_setup_additional_pages" >&5
+$as_echo_n "checking kernel symbol table for arch_setup_additional_pages... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_arch_setup_additional_pages+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_arch_setup_additional_pages=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_setup_additional_pages$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_arch_setup_additional_pages"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_setup_additional_pages\$" >/dev/null ; then
+        cr_cv_ksymtab_arch_setup_additional_pages=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_arch_setup_additional_pages=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_setup_additional_pages';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -32923,11 +25969,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -32935,88 +25977,67 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/mm.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifdef do_mmap
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&do_mmap);
-   #endif
-
+int x = sizeof(&arch_setup_additional_pages);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_MMAP=yes
+	 cr_cv_ksymtab_arch_setup_additional_pages="Y$cr_cv_ksymtab_arch_setup_additional_pages"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_MMAP=no
+	 cr_cv_ksymtab_arch_setup_additional_pages="N$cr_cv_ksymtab_arch_setup_additional_pages"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_DO_MMAP
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_MMAP 1
-_ACEOF
-
-     HAVE_DO_MMAP=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_arch_setup_additional_pages"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_MMAP 0
+    if expr "$cr_cv_ksymtab_arch_setup_additional_pages" : N >/dev/null; then
+      as_fn_error $? "Found symbol arch_setup_additional_pages but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_arch_setup_additional_pages | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(arch_setup_additional_pages, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_arch_setup_additional_pages $cr_addr
 _ACEOF
 
-     HAVE_DO_MMAP=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+fi
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for map_vsyscall" >&5
+$as_echo_n "checking kernel for map_vsyscall... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for do_mmap_pgoff" >&5
-$as_echo_n "checking kernel for do_mmap_pgoff... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_DO_MMAP_PGOFF+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_MAP_VSYSCALL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -33028,11 +26049,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33040,101 +26057,81 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/mm.h>
+
+    #include <linux/sched.h>
+    #include <asm/elf.h>
+    #ifndef __HAVE_ARCH_VSYSCALL
+      choke me
+    #endif
 int
 main ()
 {
 
-   #ifdef do_mmap_pgoff
+   #ifdef map_vsyscall
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&do_mmap_pgoff);
+     int x = sizeof(&map_vsyscall);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_MMAP_PGOFF=yes
+	 cr_cv_kconfig_HAVE_MAP_VSYSCALL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_DO_MMAP_PGOFF=no
+	 cr_cv_kconfig_HAVE_MAP_VSYSCALL=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_DO_MMAP_PGOFF
+  cr_result=$cr_cv_kconfig_HAVE_MAP_VSYSCALL
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_MMAP_PGOFF 1
-_ACEOF
+    $as_echo "#define HAVE_MAP_VSYSCALL 1" >>confdefs.h
 
-     HAVE_DO_MMAP_PGOFF=1
+     HAVE_MAP_VSYSCALL=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_DO_MMAP_PGOFF 0
-_ACEOF
+    $as_echo "#define HAVE_MAP_VSYSCALL 0" >>confdefs.h
 
-     HAVE_DO_MMAP_PGOFF=''
+     HAVE_MAP_VSYSCALL=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -n "${HAVE_DO_MMAP_PGOFF}"; then
+if test -n "${HAVE_MAP_VSYSCALL}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_mmap_pgoff" >&5
-$as_echo_n "checking kernel symbol table for do_mmap_pgoff... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for map_vsyscall" >&5
+$as_echo_n "checking kernel symbol table for map_vsyscall... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_mmap_pgoff+set}" = set; then
+    if ${cr_cv_ksymtab_map_vsyscall+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_do_mmap_pgoff=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_mmap_pgoff$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_do_mmap_pgoff"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_mmap_pgoff\$" >/dev/null ; then
-        cr_cv_ksymtab_do_mmap_pgoff=0
+    cr_cv_ksymtab_map_vsyscall=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}map_vsyscall$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_map_vsyscall"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_map_vsyscall\$" >/dev/null ; then
+        cr_cv_ksymtab_map_vsyscall=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_do_mmap_pgoff=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_mmap_pgoff';"`
+    cr_cv_ksymtab_map_vsyscall=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_map_vsyscall';"`
   fi
 
       fi
@@ -33146,11 +26143,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33165,43 +26158,22 @@
 int
 main ()
 {
-int x = sizeof(&do_mmap_pgoff);
+int x = sizeof(&map_vsyscall);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_mmap_pgoff="Y$cr_cv_ksymtab_do_mmap_pgoff"
+	 cr_cv_ksymtab_map_vsyscall="Y$cr_cv_ksymtab_map_vsyscall"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_mmap_pgoff="N$cr_cv_ksymtab_do_mmap_pgoff"
+	 cr_cv_ksymtab_map_vsyscall="N$cr_cv_ksymtab_map_vsyscall"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -33209,52 +26181,51 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_do_mmap_pgoff"; then
+  if test -z "$cr_cv_ksymtab_map_vsyscall"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_do_mmap_pgoff" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol do_mmap_pgoff but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol do_mmap_pgoff but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_map_vsyscall" : N >/dev/null; then
+      as_fn_error $? "Found symbol map_vsyscall but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_do_mmap_pgoff | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_map_vsyscall | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(do_mmap_pgoff, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(map_vsyscall, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_do_mmap_pgoff $cr_addr
+#define CR_KCODE_map_vsyscall $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-elif test -n "${HAVE_DO_MMAP}"; then
+fi
+if test $CR_KARCH = x86_64; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_mmap" >&5
-$as_echo_n "checking kernel symbol table for do_mmap... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for syscall32_setup_pages" >&5
+$as_echo_n "checking kernel symbol table for syscall32_setup_pages... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_mmap+set}" = set; then
+    if ${cr_cv_ksymtab_syscall32_setup_pages+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_do_mmap=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_mmap$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_do_mmap"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_mmap\$" >/dev/null ; then
-        cr_cv_ksymtab_do_mmap=0
+    cr_cv_ksymtab_syscall32_setup_pages=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}syscall32_setup_pages$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_syscall32_setup_pages"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_syscall32_setup_pages\$" >/dev/null ; then
+        cr_cv_ksymtab_syscall32_setup_pages=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_do_mmap=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_mmap';"`
+    cr_cv_ksymtab_syscall32_setup_pages=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_syscall32_setup_pages';"`
   fi
 
       fi
@@ -33266,11 +26237,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33285,43 +26252,22 @@
 int
 main ()
 {
-int x = sizeof(&do_mmap);
+int x = sizeof(&syscall32_setup_pages);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_mmap="Y$cr_cv_ksymtab_do_mmap"
+	 cr_cv_ksymtab_syscall32_setup_pages="Y$cr_cv_ksymtab_syscall32_setup_pages"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_mmap="N$cr_cv_ksymtab_do_mmap"
+	 cr_cv_ksymtab_syscall32_setup_pages="N$cr_cv_ksymtab_syscall32_setup_pages"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -33329,134 +26275,57 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_do_mmap"; then
+  if test -z "$cr_cv_ksymtab_syscall32_setup_pages"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_do_mmap" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol do_mmap but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol do_mmap but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_syscall32_setup_pages" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int syscall32_setup_pages(void *, int);
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_do_mmap | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_syscall32_setup_pages | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(do_mmap, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(syscall32_setup_pages, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_do_mmap $cr_addr
+#define CR_KCODE_syscall32_setup_pages $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-else
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - could not locate either do_mmap() or do_mmap_pgoff()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - could not locate either do_mmap() or do_mmap_pgoff()" >&2;}
-   { (exit 1); exit 1; }; }
-
 fi
+if test $CR_KARCH = arm; then
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for CONFIG_HUGETLBFS" >&5
-$as_echo_n "checking kernel for CONFIG_HUGETLBFS... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for vectors_user_mapping" >&5
+$as_echo_n "checking kernel symbol table for vectors_user_mapping... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_vectors_user_mapping+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_vectors_user_mapping=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}vectors_user_mapping$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_vectors_user_mapping"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_vectors_user_mapping\$" >/dev/null ; then
+        cr_cv_ksymtab_vectors_user_mapping=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_vectors_user_mapping=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_vectors_user_mapping';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -33465,11 +26334,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33478,97 +26343,83 @@
 		 #endif
 		 #include <linux/types.h>
 
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifndef CONFIG_HUGETLBFS
-     choke me
-   #endif
-
+int x = sizeof(&vectors_user_mapping);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS=yes
+	 cr_cv_ksymtab_vectors_user_mapping="Y$cr_cv_ksymtab_vectors_user_mapping"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS=no
+	 cr_cv_ksymtab_vectors_user_mapping="N$cr_cv_ksymtab_vectors_user_mapping"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_vectors_user_mapping"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_vectors_user_mapping" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int vectors_user_mapping(void);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CONFIG_HUGETLBFS 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_vectors_user_mapping | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(vectors_user_mapping, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_CONFIG_HUGETLBFS=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CONFIG_HUGETLBFS 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_vectors_user_mapping $cr_addr
 _ACEOF
 
-     HAVE_CONFIG_HUGETLBFS=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+fi
 
-if test -n "${HAVE_CONFIG_HUGETLBFS}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for hugetlbfs_file_operations" >&5
-$as_echo_n "checking kernel symbol table for hugetlbfs_file_operations... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for arch_pick_mmap_layout" >&5
+$as_echo_n "checking kernel symbol table for arch_pick_mmap_layout... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_hugetlbfs_file_operations+set}" = set; then
+    if ${cr_cv_ksymtab_arch_pick_mmap_layout+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_hugetlbfs_file_operations=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}hugetlbfs_file_operations$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_hugetlbfs_file_operations"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_hugetlbfs_file_operations\$" >/dev/null ; then
-        cr_cv_ksymtab_hugetlbfs_file_operations=0
+    cr_cv_ksymtab_arch_pick_mmap_layout=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_pick_mmap_layout$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_arch_pick_mmap_layout"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_pick_mmap_layout\$" >/dev/null ; then
+        cr_cv_ksymtab_arch_pick_mmap_layout=0
       else
 
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_hugetlbfs_file_operations=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_hugetlbfs_file_operations';"`
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_arch_pick_mmap_layout=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_pick_mmap_layout';"`
   fi
 
       fi
@@ -33580,11 +26431,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33599,43 +26446,22 @@
 int
 main ()
 {
-int x = sizeof(&hugetlbfs_file_operations);
+int x = sizeof(&arch_pick_mmap_layout);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_hugetlbfs_file_operations="Y$cr_cv_ksymtab_hugetlbfs_file_operations"
+	 cr_cv_ksymtab_arch_pick_mmap_layout="Y$cr_cv_ksymtab_arch_pick_mmap_layout"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_hugetlbfs_file_operations="N$cr_cv_ksymtab_hugetlbfs_file_operations"
+	 cr_cv_ksymtab_arch_pick_mmap_layout="N$cr_cv_ksymtab_arch_pick_mmap_layout"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -33643,52 +26469,49 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_hugetlbfs_file_operations"; then
+  if test -z "$cr_cv_ksymtab_arch_pick_mmap_layout"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_hugetlbfs_file_operations" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern const struct file_operations hugetlbfs_file_operations;
-_EOF
-
+    if expr "$cr_cv_ksymtab_arch_pick_mmap_layout" : N >/dev/null; then
+      as_fn_error $? "Found symbol arch_pick_mmap_layout but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_hugetlbfs_file_operations | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_arch_pick_mmap_layout | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(hugetlbfs_file_operations, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(arch_pick_mmap_layout, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_hugetlbfs_file_operations $cr_addr
+#define CR_KCODE_arch_pick_mmap_layout $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for is_file_shm_hugepages" >&5
-$as_echo_n "checking kernel symbol table for is_file_shm_hugepages... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for arch_get_unmaped_area" >&5
+$as_echo_n "checking kernel symbol table for arch_get_unmaped_area... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_is_file_shm_hugepages+set}" = set; then
+    if ${cr_cv_ksymtab_arch_get_unmaped_area+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_is_file_shm_hugepages=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}is_file_shm_hugepages$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_is_file_shm_hugepages"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_is_file_shm_hugepages\$" >/dev/null ; then
-        cr_cv_ksymtab_is_file_shm_hugepages=0
+    cr_cv_ksymtab_arch_get_unmaped_area=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_get_unmaped_area$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_arch_get_unmaped_area"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_get_unmaped_area\$" >/dev/null ; then
+        cr_cv_ksymtab_arch_get_unmaped_area=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_is_file_shm_hugepages=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_is_file_shm_hugepages';"`
+    cr_cv_ksymtab_arch_get_unmaped_area=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_get_unmaped_area';"`
   fi
 
       fi
@@ -33700,11 +26523,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33719,43 +26538,22 @@
 int
 main ()
 {
-int x = sizeof(&is_file_shm_hugepages);
+int x = sizeof(&arch_get_unmaped_area);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_is_file_shm_hugepages="Y$cr_cv_ksymtab_is_file_shm_hugepages"
+	 cr_cv_ksymtab_arch_get_unmaped_area="Y$cr_cv_ksymtab_arch_get_unmaped_area"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_is_file_shm_hugepages="N$cr_cv_ksymtab_is_file_shm_hugepages"
+	 cr_cv_ksymtab_arch_get_unmaped_area="N$cr_cv_ksymtab_arch_get_unmaped_area"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -33763,52 +26561,49 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_is_file_shm_hugepages"; then
+  if test -z "$cr_cv_ksymtab_arch_get_unmaped_area"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_is_file_shm_hugepages" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int is_file_shm_hugepages(struct file *file);
-_EOF
-
+    if expr "$cr_cv_ksymtab_arch_get_unmaped_area" : N >/dev/null; then
+      as_fn_error $? "Found symbol arch_get_unmaped_area but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_is_file_shm_hugepages | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_arch_get_unmaped_area | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(is_file_shm_hugepages, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(arch_get_unmaped_area, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_is_file_shm_hugepages $cr_addr
+#define CR_KCODE_arch_get_unmaped_area $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for hugepage_vma" >&5
-$as_echo_n "checking kernel symbol table for hugepage_vma... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for arch_unmap_area" >&5
+$as_echo_n "checking kernel symbol table for arch_unmap_area... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_hugepage_vma+set}" = set; then
+    if ${cr_cv_ksymtab_arch_unmap_area+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_hugepage_vma=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}hugepage_vma$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_hugepage_vma"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_hugepage_vma\$" >/dev/null ; then
-        cr_cv_ksymtab_hugepage_vma=0
+    cr_cv_ksymtab_arch_unmap_area=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}arch_unmap_area$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_arch_unmap_area"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_arch_unmap_area\$" >/dev/null ; then
+        cr_cv_ksymtab_arch_unmap_area=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_hugepage_vma=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_hugepage_vma';"`
+    cr_cv_ksymtab_arch_unmap_area=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_arch_unmap_area';"`
   fi
 
       fi
@@ -33820,11 +26615,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33839,43 +26630,22 @@
 int
 main ()
 {
-int x = sizeof(&hugepage_vma);
+int x = sizeof(&arch_unmap_area);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_hugepage_vma="Y$cr_cv_ksymtab_hugepage_vma"
+	 cr_cv_ksymtab_arch_unmap_area="Y$cr_cv_ksymtab_arch_unmap_area"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_hugepage_vma="N$cr_cv_ksymtab_hugepage_vma"
+	 cr_cv_ksymtab_arch_unmap_area="N$cr_cv_ksymtab_arch_unmap_area"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -33883,55 +26653,108 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_hugepage_vma"; then
+  if test -z "$cr_cv_ksymtab_arch_unmap_area"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_hugepage_vma" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern struct vm_area_struct *hugepage_vma(struct mm_struct *, unsigned long);
-_EOF
-
+    if expr "$cr_cv_ksymtab_arch_unmap_area" : N >/dev/null; then
+      as_fn_error $? "Found symbol arch_unmap_area but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_hugepage_vma | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_arch_unmap_area | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(hugepage_vma, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(arch_unmap_area, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_hugepage_vma $cr_addr
+#define CR_KCODE_arch_unmap_area $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.mmap_base" >&5
+$as_echo_n "checking kernel for mm.mmap_base... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pmd_huge" >&5
-$as_echo_n "checking kernel symbol table for pmd_huge... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pmd_huge+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_MM_MMAP_BASE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_pmd_huge=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}pmd_huge$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pmd_huge"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pmd_huge\$" >/dev/null ; then
-        cr_cv_ksymtab_pmd_huge=0
-      else
 
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pmd_huge=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pmd_huge';"`
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/sched.h>
+int
+main ()
+{
+struct mm_struct x;
+          unsigned long tc_1 = x.mmap_base;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_MM_MMAP_BASE=yes
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_MM_MMAP_BASE=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+fi
+
+  cr_result=$cr_cv_kconfig_HAVE_MM_MMAP_BASE
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_MM_MMAP_BASE 1" >>confdefs.h
+
+     HAVE_MM_MMAP_BASE=1
+  else
+    $as_echo "#define HAVE_MM_MMAP_BASE 0" >>confdefs.h
+
+     HAVE_MM_MMAP_BASE=''
   fi
 
-      fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.cached_hole_size" >&5
+$as_echo_n "checking kernel for mm.cached_hole_size... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
 
 
   SAVE_CC=$CC
@@ -33940,11 +26763,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -33952,103 +26771,70 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&pmd_huge);
+struct mm_struct x;
+          unsigned long tc_1 = x.cached_hole_size;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pmd_huge="Y$cr_cv_ksymtab_pmd_huge"
+	 cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pmd_huge="N$cr_cv_ksymtab_pmd_huge"
+	 cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_pmd_huge"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_pmd_huge" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int pmd_huge(pmd_t pmd);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_MM_CACHED_HOLE_SIZE
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_pmd_huge | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(pmd_huge, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_MM_CACHED_HOLE_SIZE 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_pmd_huge $cr_addr
-_ACEOF
+     HAVE_MM_CACHED_HOLE_SIZE=1
+  else
+    $as_echo "#define HAVE_MM_CACHED_HOLE_SIZE 0" >>confdefs.h
 
+     HAVE_MM_CACHED_HOLE_SIZE=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for follow_huge_pmd" >&5
-$as_echo_n "checking kernel symbol table for follow_huge_pmd... " >&6; }
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_munmap" >&5
+$as_echo_n "checking kernel symbol table for do_munmap... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_follow_huge_pmd+set}" = set; then
+    if ${cr_cv_ksymtab_do_munmap+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_follow_huge_pmd=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}follow_huge_pmd$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_follow_huge_pmd"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_follow_huge_pmd\$" >/dev/null ; then
-        cr_cv_ksymtab_follow_huge_pmd=0
+    cr_cv_ksymtab_do_munmap=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_munmap$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_do_munmap"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_munmap\$" >/dev/null ; then
+        cr_cv_ksymtab_do_munmap=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_follow_huge_pmd=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_follow_huge_pmd';"`
+    cr_cv_ksymtab_do_munmap=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_munmap';"`
   fi
 
       fi
@@ -34060,11 +26846,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34079,43 +26861,22 @@
 int
 main ()
 {
-int x = sizeof(&follow_huge_pmd);
+int x = sizeof(&do_munmap);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_follow_huge_pmd="Y$cr_cv_ksymtab_follow_huge_pmd"
+	 cr_cv_ksymtab_do_munmap="Y$cr_cv_ksymtab_do_munmap"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_follow_huge_pmd="N$cr_cv_ksymtab_follow_huge_pmd"
+	 cr_cv_ksymtab_do_munmap="N$cr_cv_ksymtab_do_munmap"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -34123,52 +26884,200 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_follow_huge_pmd"; then
+  if test -z "$cr_cv_ksymtab_do_munmap"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_follow_huge_pmd" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern struct page * follow_huge_pmd(struct mm_struct *, unsigned long  pmd_t *, int);
-_EOF
-
+    if expr "$cr_cv_ksymtab_do_munmap" : N >/dev/null; then
+      as_fn_error $? "Found symbol do_munmap but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_follow_huge_pmd | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_do_munmap | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(follow_huge_pmd, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(do_munmap, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_follow_huge_pmd $cr_addr
+#define CR_KCODE_do_munmap $cr_addr
+_ACEOF
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for do_mmap" >&5
+$as_echo_n "checking kernel for do_mmap... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_DO_MMAP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/mm.h>
+int
+main ()
+{
+
+   #ifdef do_mmap
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&do_mmap);
+   #endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_DO_MMAP=yes
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_DO_MMAP=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+fi
+
+  cr_result=$cr_cv_kconfig_HAVE_DO_MMAP
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_DO_MMAP 1" >>confdefs.h
+
+     HAVE_DO_MMAP=1
+  else
+    $as_echo "#define HAVE_DO_MMAP 0" >>confdefs.h
+
+     HAVE_DO_MMAP=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for do_mmap_pgoff" >&5
+$as_echo_n "checking kernel for do_mmap_pgoff... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_DO_MMAP_PGOFF+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/mm.h>
+int
+main ()
+{
+
+   #ifdef do_mmap_pgoff
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&do_mmap_pgoff);
+   #endif
+
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_DO_MMAP_PGOFF=yes
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_DO_MMAP_PGOFF=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+fi
+
+  cr_result=$cr_cv_kconfig_HAVE_DO_MMAP_PGOFF
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_DO_MMAP_PGOFF 1" >>confdefs.h
+
+     HAVE_DO_MMAP_PGOFF=1
+  else
+    $as_echo "#define HAVE_DO_MMAP_PGOFF 0" >>confdefs.h
 
+     HAVE_DO_MMAP_PGOFF=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test -n "${HAVE_DO_MMAP_PGOFF}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for follow_huge_addr" >&5
-$as_echo_n "checking kernel symbol table for follow_huge_addr... " >&6; }
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_mmap_pgoff" >&5
+$as_echo_n "checking kernel symbol table for do_mmap_pgoff... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_follow_huge_addr+set}" = set; then
+    if ${cr_cv_ksymtab_do_mmap_pgoff+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_follow_huge_addr=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}follow_huge_addr$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_follow_huge_addr"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_follow_huge_addr\$" >/dev/null ; then
-        cr_cv_ksymtab_follow_huge_addr=0
+    cr_cv_ksymtab_do_mmap_pgoff=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_mmap_pgoff$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_do_mmap_pgoff"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_mmap_pgoff\$" >/dev/null ; then
+        cr_cv_ksymtab_do_mmap_pgoff=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_follow_huge_addr=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_follow_huge_addr';"`
+    cr_cv_ksymtab_do_mmap_pgoff=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_mmap_pgoff';"`
   fi
 
       fi
@@ -34180,11 +27089,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34199,43 +27104,22 @@
 int
 main ()
 {
-int x = sizeof(&follow_huge_addr);
+int x = sizeof(&do_mmap_pgoff);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_follow_huge_addr="Y$cr_cv_ksymtab_follow_huge_addr"
+	 cr_cv_ksymtab_do_mmap_pgoff="Y$cr_cv_ksymtab_do_mmap_pgoff"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_follow_huge_addr="N$cr_cv_ksymtab_follow_huge_addr"
+	 cr_cv_ksymtab_do_mmap_pgoff="N$cr_cv_ksymtab_do_mmap_pgoff"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -34243,152 +27127,53 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_follow_huge_addr"; then
+  if test -z "$cr_cv_ksymtab_do_mmap_pgoff"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_follow_huge_addr" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol follow_huge_addr but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol follow_huge_addr but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_do_mmap_pgoff" : N >/dev/null; then
+      as_fn_error $? "Found symbol do_mmap_pgoff but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_follow_huge_addr | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_do_mmap_pgoff | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(follow_huge_addr, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(do_mmap_pgoff, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_follow_huge_addr $cr_addr
+#define CR_KCODE_do_mmap_pgoff $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
- # Must have prototype, or NARGS probe will fail
-
-
-
 
+elif test -n "${HAVE_DO_MMAP}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 3-arg follow_huge_addr" >&5
-$as_echo_n "checking kernel for 3-arg follow_huge_addr... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_mmap" >&5
+$as_echo_n "checking kernel symbol table for do_mmap... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_do_mmap+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_do_mmap=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_mmap$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_do_mmap"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_mmap\$" >/dev/null ; then
+        cr_cv_ksymtab_do_mmap=0
+      else
 
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-		 #include <linux/mm.h>
-						 #include <linux/hugetlb.h>
-int
-main ()
-{
-
-	#ifndef follow_huge_addr /* Must be macro or have a decl */
-	  int x = sizeof(&follow_huge_addr);
-	#endif
-	    follow_huge_addr(NULL,0,0);
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_FOLLOW_HUGE_ADDR 1
-_ACEOF
-
-     HAVE_3_ARG_FOLLOW_HUGE_ADDR=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_FOLLOW_HUGE_ADDR 0
-_ACEOF
-
-     HAVE_3_ARG_FOLLOW_HUGE_ADDR=''
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_do_mmap=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_mmap';"`
   fi
 
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-
-
-
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 4-arg follow_huge_addr" >&5
-$as_echo_n "checking kernel for 4-arg follow_huge_addr... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
+      fi
 
 
   SAVE_CC=$CC
@@ -34397,11 +27182,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34409,81 +27190,60 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/mm.h>
-						 #include <linux/hugetlb.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-	#ifndef follow_huge_addr /* Must be macro or have a decl */
-	  int x = sizeof(&follow_huge_addr);
-	#endif
-	    follow_huge_addr(NULL,NULL,0,0);
+int x = sizeof(&do_mmap);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR=yes
+	 cr_cv_ksymtab_do_mmap="Y$cr_cv_ksymtab_do_mmap"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR=no
+	 cr_cv_ksymtab_do_mmap="N$cr_cv_ksymtab_do_mmap"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_FOLLOW_HUGE_ADDR 1
-_ACEOF
-
-     HAVE_4_ARG_FOLLOW_HUGE_ADDR=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_do_mmap"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_FOLLOW_HUGE_ADDR 0
+    if expr "$cr_cv_ksymtab_do_mmap" : N >/dev/null; then
+      as_fn_error $? "Found symbol do_mmap but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_do_mmap | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(do_mmap, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_do_mmap $cr_addr
 _ACEOF
 
-     HAVE_4_ARG_FOLLOW_HUGE_ADDR=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-
-
-
-  if test "${HAVE_3_ARG_FOLLOW_HUGE_ADDR}${HAVE_4_ARG_FOLLOW_HUGE_ADDR}" != "1"; then
+else
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -34512,13 +27272,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -34526,8 +27286,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -34549,12 +27309,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -34569,52 +27340,20 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - CONFIG_HUGETLBFS set, but unable to determine how invoke follow_huge_addr()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - CONFIG_HUGETLBFS set, but unable to determine how invoke follow_huge_addr()" >&2;}
-   { (exit 1); exit 1; }; }
-
-  fi
-else
-  # Avoid gripes from gcc
-  cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_FOLLOW_HUGE_ADDR 0
-_ACEOF
-
-  cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_FOLLOW_HUGE_ADDR 0
-_ACEOF
+   as_fn_error $? "Unable to use kernel $LINUX_VER - could not locate either do_mmap() or do_mmap_pgoff()" "$LINENO" 5
 
 fi
 
-# Import the correct symbol for arch-specific ZERO_PAGE(),
-# which must have a prototype in asm/pgtable.h (arch-specific)
-# If we support ia64 or mips in the future we'll need to add more cases here.
-# NOTE: don't try to factor the CR_FIND_KSYM() call; it requires a literal.
-case $CR_KARCH in
-  sparc*)
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for CONFIG_HUGETLBFS" >&5
+$as_echo_n "checking kernel for CONFIG_HUGETLBFS... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for mem_map_zero" >&5
-$as_echo_n "checking kernel symbol table for mem_map_zero... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_mem_map_zero+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_mem_map_zero=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}mem_map_zero$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_mem_map_zero"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_mem_map_zero\$" >/dev/null ; then
-        cr_cv_ksymtab_mem_map_zero=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_mem_map_zero=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_mem_map_zero';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -34623,11 +27362,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34636,104 +27371,72 @@
 		 #endif
 		 #include <linux/types.h>
 
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
 int
 main ()
 {
-int x = sizeof(&mem_map_zero);
+
+   #ifndef CONFIG_HUGETLBFS
+     choke me
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_mem_map_zero="Y$cr_cv_ksymtab_mem_map_zero"
+	 cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_mem_map_zero="N$cr_cv_ksymtab_mem_map_zero"
+	 cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_mem_map_zero"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_mem_map_zero" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol mem_map_zero but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol mem_map_zero but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_mem_map_zero | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(mem_map_zero, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_CONFIG_HUGETLBFS
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_mem_map_zero $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_CONFIG_HUGETLBFS 1" >>confdefs.h
+
+     HAVE_CONFIG_HUGETLBFS=1
+  else
+    $as_echo "#define HAVE_CONFIG_HUGETLBFS 0" >>confdefs.h
 
+     HAVE_CONFIG_HUGETLBFS=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-    ZERO_PAGE_SYMBOL=mem_map_zero
-    ;;
-  *)
 
+if test -n "${HAVE_CONFIG_HUGETLBFS}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for empty_zero_page" >&5
-$as_echo_n "checking kernel symbol table for empty_zero_page... " >&6; }
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for hugetlbfs_file_operations" >&5
+$as_echo_n "checking kernel symbol table for hugetlbfs_file_operations... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_empty_zero_page+set}" = set; then
+    if ${cr_cv_ksymtab_hugetlbfs_file_operations+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_empty_zero_page=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}empty_zero_page$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_empty_zero_page"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_empty_zero_page\$" >/dev/null ; then
-        cr_cv_ksymtab_empty_zero_page=0
+    cr_cv_ksymtab_hugetlbfs_file_operations=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}hugetlbfs_file_operations$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_hugetlbfs_file_operations"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_hugetlbfs_file_operations\$" >/dev/null ; then
+        cr_cv_ksymtab_hugetlbfs_file_operations=0
       else
 
   if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_empty_zero_page=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_empty_zero_page';"`
+    cr_cv_ksymtab_hugetlbfs_file_operations=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_hugetlbfs_file_operations';"`
   fi
 
       fi
@@ -34745,11 +27448,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34764,43 +27463,22 @@
 int
 main ()
 {
-int x = sizeof(&empty_zero_page);
+int x = sizeof(&hugetlbfs_file_operations);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_empty_zero_page="Y$cr_cv_ksymtab_empty_zero_page"
+	 cr_cv_ksymtab_hugetlbfs_file_operations="Y$cr_cv_ksymtab_hugetlbfs_file_operations"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_empty_zero_page="N$cr_cv_ksymtab_empty_zero_page"
+	 cr_cv_ksymtab_hugetlbfs_file_operations="N$cr_cv_ksymtab_hugetlbfs_file_operations"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -34808,52 +27486,55 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_empty_zero_page"; then
+  if test -z "$cr_cv_ksymtab_hugetlbfs_file_operations"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_empty_zero_page" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol empty_zero_page but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol empty_zero_page but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_hugetlbfs_file_operations" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern const struct file_operations hugetlbfs_file_operations;
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_empty_zero_page | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_hugetlbfs_file_operations | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(empty_zero_page, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KDATA(hugetlbfs_file_operations, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_empty_zero_page $cr_addr
+#define CR_KDATA_hugetlbfs_file_operations $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-    ZERO_PAGE_SYMBOL=empty_zero_page
-    ;;
-esac
-if test -z "$cr_addr"; then
-  { { $as_echo "$as_me:$LINENO: error: failed to find symbol $ZERO_PAGE_SYMBOL" >&5
-$as_echo "$as_me: error: failed to find symbol $ZERO_PAGE_SYMBOL" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-# How to check for permission
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for inode_permission" >&5
-$as_echo_n "checking kernel for inode_permission... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_INODE_PERMISSION+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for is_file_shm_hugepages" >&5
+$as_echo_n "checking kernel symbol table for is_file_shm_hugepages... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_is_file_shm_hugepages+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_is_file_shm_hugepages=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}is_file_shm_hugepages$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_is_file_shm_hugepages"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_is_file_shm_hugepages\$" >/dev/null ; then
+        cr_cv_ksymtab_is_file_shm_hugepages=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_is_file_shm_hugepages=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_is_file_shm_hugepages';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -34862,11 +27543,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34874,91 +27551,85 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fs.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifdef inode_permission
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&inode_permission);
-   #endif
-
+int x = sizeof(&is_file_shm_hugepages);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_INODE_PERMISSION=yes
+	 cr_cv_ksymtab_is_file_shm_hugepages="Y$cr_cv_ksymtab_is_file_shm_hugepages"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_INODE_PERMISSION=no
+	 cr_cv_ksymtab_is_file_shm_hugepages="N$cr_cv_ksymtab_is_file_shm_hugepages"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_INODE_PERMISSION
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_is_file_shm_hugepages"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_is_file_shm_hugepages" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int is_file_shm_hugepages(struct file *file);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_PERMISSION 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_is_file_shm_hugepages | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(is_file_shm_hugepages, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_INODE_PERMISSION=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_PERMISSION 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_is_file_shm_hugepages $cr_addr
 _ACEOF
 
-     HAVE_INODE_PERMISSION=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for permission" >&5
-$as_echo_n "checking kernel for permission... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PERMISSION+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for hugepage_vma" >&5
+$as_echo_n "checking kernel symbol table for hugepage_vma... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_hugepage_vma+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_hugepage_vma=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}hugepage_vma$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_hugepage_vma"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_hugepage_vma\$" >/dev/null ; then
+        cr_cv_ksymtab_hugepage_vma=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_hugepage_vma=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_hugepage_vma';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -34967,11 +27638,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -34979,193 +27646,82 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fs.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifdef permission
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&permission);
-   #endif
-
+int x = sizeof(&hugepage_vma);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PERMISSION=yes
+	 cr_cv_ksymtab_hugepage_vma="Y$cr_cv_ksymtab_hugepage_vma"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PERMISSION=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_PERMISSION
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERMISSION 1
-_ACEOF
-
-     HAVE_PERMISSION=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERMISSION 0
-_ACEOF
-
-     HAVE_PERMISSION=''
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-if test -z "${HAVE_INODE_PERMISSION}${HAVE_PERMISSION}"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
+	 cr_cv_ksymtab_hugepage_vma="N$cr_cv_ksymtab_hugepage_vma"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-_ACEOF
+    fi
 
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
+fi
 
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_hugepage_vma"; then
+    cr_result='not found'
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
+    if expr "$cr_cv_ksymtab_hugepage_vma" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern struct vm_area_struct *hugepage_vma(struct mm_struct *, unsigned long);
+_EOF
 
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
+    fi
+    cr_result=`echo $cr_cv_ksymtab_hugepage_vma | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(hugepage_vma, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to invoke permission() or inode_permission" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to invoke permission() or inode_permission" >&2;}
-   { (exit 1); exit 1; }; }
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_hugepage_vma $cr_addr
+_ACEOF
 
-fi
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
-# Bits for save/restore of pending signals
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for copy_siginfo_to_user" >&5
-$as_echo_n "checking kernel symbol table for copy_siginfo_to_user... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pmd_huge" >&5
+$as_echo_n "checking kernel symbol table for pmd_huge... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_copy_siginfo_to_user+set}" = set; then
+    if ${cr_cv_ksymtab_pmd_huge+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_copy_siginfo_to_user=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}copy_siginfo_to_user$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_copy_siginfo_to_user"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_copy_siginfo_to_user\$" >/dev/null ; then
-        cr_cv_ksymtab_copy_siginfo_to_user=0
+    cr_cv_ksymtab_pmd_huge=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}pmd_huge$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pmd_huge"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pmd_huge\$" >/dev/null ; then
+        cr_cv_ksymtab_pmd_huge=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_copy_siginfo_to_user=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_copy_siginfo_to_user';"`
+    cr_cv_ksymtab_pmd_huge=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pmd_huge';"`
   fi
 
       fi
@@ -35177,11 +27733,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35196,43 +27748,22 @@
 int
 main ()
 {
-int x = sizeof(&copy_siginfo_to_user);
+int x = sizeof(&pmd_huge);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_copy_siginfo_to_user="Y$cr_cv_ksymtab_copy_siginfo_to_user"
+	 cr_cv_ksymtab_pmd_huge="Y$cr_cv_ksymtab_pmd_huge"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_copy_siginfo_to_user="N$cr_cv_ksymtab_copy_siginfo_to_user"
+	 cr_cv_ksymtab_pmd_huge="N$cr_cv_ksymtab_pmd_huge"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -35240,52 +27771,52 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_copy_siginfo_to_user"; then
+  if test -z "$cr_cv_ksymtab_pmd_huge"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_copy_siginfo_to_user" : N >/dev/null; then
+    if expr "$cr_cv_ksymtab_pmd_huge" : N >/dev/null; then
       cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int copy_siginfo_to_user(siginfo_t *to, siginfo_t *from);
+extern int pmd_huge(pmd_t pmd);
 _EOF
 
     fi
-    cr_result=`echo $cr_cv_ksymtab_copy_siginfo_to_user | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_pmd_huge | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(copy_siginfo_to_user, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(pmd_huge, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_copy_siginfo_to_user $cr_addr
+#define CR_KCODE_pmd_huge $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for group_send_sig_info" >&5
-$as_echo_n "checking kernel symbol table for group_send_sig_info... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for follow_huge_pmd" >&5
+$as_echo_n "checking kernel symbol table for follow_huge_pmd... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_group_send_sig_info+set}" = set; then
+    if ${cr_cv_ksymtab_follow_huge_pmd+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_group_send_sig_info=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}group_send_sig_info$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_group_send_sig_info"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_group_send_sig_info\$" >/dev/null ; then
-        cr_cv_ksymtab_group_send_sig_info=0
+    cr_cv_ksymtab_follow_huge_pmd=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}follow_huge_pmd$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_follow_huge_pmd"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_follow_huge_pmd\$" >/dev/null ; then
+        cr_cv_ksymtab_follow_huge_pmd=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_group_send_sig_info=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_group_send_sig_info';"`
+    cr_cv_ksymtab_follow_huge_pmd=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_follow_huge_pmd';"`
   fi
 
       fi
@@ -35297,11 +27828,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35316,43 +27843,22 @@
 int
 main ()
 {
-int x = sizeof(&group_send_sig_info);
+int x = sizeof(&follow_huge_pmd);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_group_send_sig_info="Y$cr_cv_ksymtab_group_send_sig_info"
+	 cr_cv_ksymtab_follow_huge_pmd="Y$cr_cv_ksymtab_follow_huge_pmd"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_group_send_sig_info="N$cr_cv_ksymtab_group_send_sig_info"
+	 cr_cv_ksymtab_follow_huge_pmd="N$cr_cv_ksymtab_follow_huge_pmd"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -35360,54 +27866,52 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_group_send_sig_info"; then
+  if test -z "$cr_cv_ksymtab_follow_huge_pmd"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_group_send_sig_info" : N >/dev/null; then
+    if expr "$cr_cv_ksymtab_follow_huge_pmd" : N >/dev/null; then
       cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int group_send_sig_info(int, struct siginfo *, struct task_struct *);
+extern struct page * follow_huge_pmd(struct mm_struct *, unsigned long  pmd_t *, int);
 _EOF
 
     fi
-    cr_result=`echo $cr_cv_ksymtab_group_send_sig_info | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_follow_huge_pmd | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(group_send_sig_info, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(follow_huge_pmd, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_group_send_sig_info $cr_addr
+#define CR_KCODE_follow_huge_pmd $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# For save/restore of sigaltstack
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_sigaltstack" >&5
-$as_echo_n "checking kernel symbol table for do_sigaltstack... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for follow_huge_addr" >&5
+$as_echo_n "checking kernel symbol table for follow_huge_addr... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_sigaltstack+set}" = set; then
+    if ${cr_cv_ksymtab_follow_huge_addr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_do_sigaltstack=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_sigaltstack$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_do_sigaltstack"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_sigaltstack\$" >/dev/null ; then
-        cr_cv_ksymtab_do_sigaltstack=0
+    cr_cv_ksymtab_follow_huge_addr=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}follow_huge_addr$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_follow_huge_addr"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_follow_huge_addr\$" >/dev/null ; then
+        cr_cv_ksymtab_follow_huge_addr=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_do_sigaltstack=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_sigaltstack';"`
+    cr_cv_ksymtab_follow_huge_addr=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_follow_huge_addr';"`
   fi
 
       fi
@@ -35419,11 +27923,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35438,43 +27938,22 @@
 int
 main ()
 {
-int x = sizeof(&do_sigaltstack);
+int x = sizeof(&follow_huge_addr);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_sigaltstack="Y$cr_cv_ksymtab_do_sigaltstack"
+	 cr_cv_ksymtab_follow_huge_addr="Y$cr_cv_ksymtab_follow_huge_addr"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_do_sigaltstack="N$cr_cv_ksymtab_do_sigaltstack"
+	 cr_cv_ksymtab_follow_huge_addr="N$cr_cv_ksymtab_follow_huge_addr"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -35482,42 +27961,39 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_do_sigaltstack"; then
+  if test -z "$cr_cv_ksymtab_follow_huge_addr"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_do_sigaltstack" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int do_sigaltstack(const stack_t *, stack_t *, unsigned long);
-_EOF
-
+    if expr "$cr_cv_ksymtab_follow_huge_addr" : N >/dev/null; then
+      as_fn_error $? "Found symbol follow_huge_addr but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_do_sigaltstack | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_follow_huge_addr | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(do_sigaltstack, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(follow_huge_addr, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_do_sigaltstack $cr_addr
+#define CR_KCODE_follow_huge_addr $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
+ # Must have prototype, or NARGS probe will fail
 
 
-if test $CR_KARCH = i386 -o $CR_KARCH = x86_64; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for struct n_desc_struct" >&5
-$as_echo_n "checking kernel for struct n_desc_struct... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 3-arg follow_huge_addr" >&5
+$as_echo_n "checking kernel for 3-arg follow_huge_addr... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -35529,11 +28005,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35541,75 +28013,50 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-	#include <linux/sched.h>
-	#include <asm/desc.h>
+		 #include <linux/mm.h>
+						 #include <linux/hugetlb.h>
 int
 main ()
 {
 
-     struct n_desc_struct y;
-     int x = sizeof(y);
-
+	#ifndef follow_huge_addr /* Must be macro or have a decl */
+	  int x = sizeof(&follow_huge_addr);
+	#endif
+	    follow_huge_addr(NULL,0,0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT=yes
+	 cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT=no
+	 cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT
+  cr_result=$cr_cv_kconfig_HAVE_3_ARG_FOLLOW_HUGE_ADDR
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_N_DESC_STRUCT 1
-_ACEOF
+    $as_echo "#define HAVE_3_ARG_FOLLOW_HUGE_ADDR 1" >>confdefs.h
 
-     HAVE_STRUCT_N_DESC_STRUCT=1
+     HAVE_3_ARG_FOLLOW_HUGE_ADDR=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_N_DESC_STRUCT 0
-_ACEOF
+    $as_echo "#define HAVE_3_ARG_FOLLOW_HUGE_ADDR 0" >>confdefs.h
 
-     HAVE_STRUCT_N_DESC_STRUCT=''
+     HAVE_3_ARG_FOLLOW_HUGE_ADDR=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -35617,10 +28064,13 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for cpu_gdt_descr" >&5
-$as_echo_n "checking kernel for cpu_gdt_descr... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_CPU_GDT_DESCR+set}" = set; then
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 4-arg follow_huge_addr" >&5
+$as_echo_n "checking kernel for 4-arg follow_huge_addr... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -35632,11 +28082,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35644,97 +28090,189 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
-					  #include <asm/desc.h>
+		 #include <linux/mm.h>
+						 #include <linux/hugetlb.h>
 int
 main ()
 {
 
-     int x = sizeof(&cpu_gdt_descr);
-
+	#ifndef follow_huge_addr /* Must be macro or have a decl */
+	  int x = sizeof(&follow_huge_addr);
+	#endif
+	    follow_huge_addr(NULL,NULL,0,0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CPU_GDT_DESCR=yes
+	 cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CPU_GDT_DESCR=no
+	 cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_CPU_GDT_DESCR
+  cr_result=$cr_cv_kconfig_HAVE_4_ARG_FOLLOW_HUGE_ADDR
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CPU_GDT_DESCR 1
-_ACEOF
+    $as_echo "#define HAVE_4_ARG_FOLLOW_HUGE_ADDR 1" >>confdefs.h
 
-     HAVE_CPU_GDT_DESCR=1
+     HAVE_4_ARG_FOLLOW_HUGE_ADDR=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CPU_GDT_DESCR 0
-_ACEOF
+    $as_echo "#define HAVE_4_ARG_FOLLOW_HUGE_ADDR 0" >>confdefs.h
 
-     HAVE_CPU_GDT_DESCR=''
+     HAVE_4_ARG_FOLLOW_HUGE_ADDR=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-  if test -n "${HAVE_CPU_GDT_DESCR}"; then
 
 
+  if test "${HAVE_3_ARG_FOLLOW_HUGE_ADDR}${HAVE_4_ARG_FOLLOW_HUGE_ADDR}" != "1"; then
 
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for cpu_gdt_descr" >&5
-$as_echo_n "checking kernel symbol table for cpu_gdt_descr... " >&6; }
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - CONFIG_HUGETLBFS set, but unable to determine how invoke follow_huge_addr()" "$LINENO" 5
+
+  fi
+else
+  # Avoid gripes from gcc
+  $as_echo "#define HAVE_3_ARG_FOLLOW_HUGE_ADDR 0" >>confdefs.h
+
+  $as_echo "#define HAVE_4_ARG_FOLLOW_HUGE_ADDR 0" >>confdefs.h
+
+fi
+
+# Import the correct symbol for arch-specific ZERO_PAGE(),
+# which must have a prototype in asm/pgtable.h (arch-specific)
+# If we support ia64 or mips in the future we'll need to add more cases here.
+# NOTE: don't try to factor the CR_FIND_KSYM() call; it requires a literal.
+case $CR_KARCH in
+  sparc*)
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for mem_map_zero" >&5
+$as_echo_n "checking kernel symbol table for mem_map_zero... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_cpu_gdt_descr+set}" = set; then
+    if ${cr_cv_ksymtab_mem_map_zero+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_cpu_gdt_descr=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}cpu_gdt_descr$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_cpu_gdt_descr"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_cpu_gdt_descr\$" >/dev/null ; then
-        cr_cv_ksymtab_cpu_gdt_descr=0
+    cr_cv_ksymtab_mem_map_zero=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}mem_map_zero$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_mem_map_zero"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_mem_map_zero\$" >/dev/null ; then
+        cr_cv_ksymtab_mem_map_zero=0
       else
 
   if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_cpu_gdt_descr=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_cpu_gdt_descr';"`
+    cr_cv_ksymtab_mem_map_zero=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_mem_map_zero';"`
   fi
 
       fi
@@ -35746,11 +28284,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35765,43 +28299,117 @@
 int
 main ()
 {
-int x = sizeof(&cpu_gdt_descr);
+int x = sizeof(&mem_map_zero);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_mem_map_zero="Y$cr_cv_ksymtab_mem_map_zero"
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_mem_map_zero="N$cr_cv_ksymtab_mem_map_zero"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+    fi
+
+fi
+
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_mem_map_zero"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_mem_map_zero" : N >/dev/null; then
+      as_fn_error $? "Found symbol mem_map_zero but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_mem_map_zero | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(mem_map_zero, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_mem_map_zero $cr_addr
+_ACEOF
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+    ZERO_PAGE_SYMBOL=mem_map_zero
+    ;;
+  *)
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for empty_zero_page" >&5
+$as_echo_n "checking kernel symbol table for empty_zero_page... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_empty_zero_page+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    cr_cv_ksymtab_empty_zero_page=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}empty_zero_page$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_empty_zero_page"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_empty_zero_page\$" >/dev/null ; then
+        cr_cv_ksymtab_empty_zero_page=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_empty_zero_page=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_empty_zero_page';"`
+  fi
+
+      fi
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
+int
+main ()
+{
+int x = sizeof(&empty_zero_page);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_cpu_gdt_descr="Y$cr_cv_ksymtab_cpu_gdt_descr"
+	 cr_cv_ksymtab_empty_zero_page="Y$cr_cv_ksymtab_empty_zero_page"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_cpu_gdt_descr="N$cr_cv_ksymtab_cpu_gdt_descr"
+	 cr_cv_ksymtab_empty_zero_page="N$cr_cv_ksymtab_empty_zero_page"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -35809,55 +28417,47 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_cpu_gdt_descr"; then
+  if test -z "$cr_cv_ksymtab_empty_zero_page"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_cpu_gdt_descr" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol cpu_gdt_descr but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol cpu_gdt_descr but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_empty_zero_page" : N >/dev/null; then
+      as_fn_error $? "Found symbol empty_zero_page but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_cpu_gdt_descr | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_empty_zero_page | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(cpu_gdt_descr, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KDATA(empty_zero_page, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_cpu_gdt_descr $cr_addr
+#define CR_KDATA_empty_zero_page $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-  fi
+    ZERO_PAGE_SYMBOL=empty_zero_page
+    ;;
+esac
+if test -z "$cr_addr"; then
+  as_fn_error $? "failed to find symbol $ZERO_PAGE_SYMBOL" "$LINENO" 5
+fi
 
+# How to check for permission
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for cpu_gdt_table" >&5
-$as_echo_n "checking kernel symbol table for cpu_gdt_table... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_cpu_gdt_table+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for inode_permission" >&5
+$as_echo_n "checking kernel for inode_permission... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_INODE_PERMISSION+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_cpu_gdt_table=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}cpu_gdt_table$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_cpu_gdt_table"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_cpu_gdt_table\$" >/dev/null ; then
-        cr_cv_ksymtab_cpu_gdt_table=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_cpu_gdt_table=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_cpu_gdt_table';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -35866,11 +28466,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35878,105 +28474,65 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/fs.h>
 int
 main ()
 {
-int x = sizeof(&cpu_gdt_table);
+
+   #ifdef inode_permission
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&inode_permission);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_cpu_gdt_table="Y$cr_cv_ksymtab_cpu_gdt_table"
+	 cr_cv_kconfig_HAVE_INODE_PERMISSION=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_cpu_gdt_table="N$cr_cv_ksymtab_cpu_gdt_table"
+	 cr_cv_kconfig_HAVE_INODE_PERMISSION=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_cpu_gdt_table"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_cpu_gdt_table" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol cpu_gdt_table but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol cpu_gdt_table but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_cpu_gdt_table | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(cpu_gdt_table, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_INODE_PERMISSION
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_cpu_gdt_table $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_INODE_PERMISSION 1" >>confdefs.h
+
+     HAVE_INODE_PERMISSION=1
+  else
+    $as_echo "#define HAVE_INODE_PERMISSION 0" >>confdefs.h
 
+     HAVE_INODE_PERMISSION=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for per_cpu__cpu_gdt_descr" >&5
-$as_echo_n "checking kernel symbol table for per_cpu__cpu_gdt_descr... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_per_cpu__cpu_gdt_descr+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for permission" >&5
+$as_echo_n "checking kernel for permission... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_PERMISSION+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_per_cpu__cpu_gdt_descr=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}per_cpu__cpu_gdt_descr$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_per_cpu__cpu_gdt_descr\$" >/dev/null ; then
-        cr_cv_ksymtab_per_cpu__cpu_gdt_descr=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_per_cpu__cpu_gdt_descr=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_per_cpu__cpu_gdt_descr';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -35985,11 +28541,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -35997,94 +28549,180 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/fs.h>
 int
 main ()
 {
-int x = sizeof(&per_cpu__cpu_gdt_descr);
+
+   #ifdef permission
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&permission);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_per_cpu__cpu_gdt_descr="Y$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"
+	 cr_cv_kconfig_HAVE_PERMISSION=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_per_cpu__cpu_gdt_descr="N$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"
+	 cr_cv_kconfig_HAVE_PERMISSION=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"; then
-    cr_result='not found'
+  cr_result=$cr_cv_kconfig_HAVE_PERMISSION
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_PERMISSION 1" >>confdefs.h
+
+     HAVE_PERMISSION=1
   else
-    if expr "$cr_cv_ksymtab_per_cpu__cpu_gdt_descr" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol per_cpu__cpu_gdt_descr but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol per_cpu__cpu_gdt_descr but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_per_cpu__cpu_gdt_descr | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(per_cpu__cpu_gdt_descr, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+    $as_echo "#define HAVE_PERMISSION 0" >>confdefs.h
+
+     HAVE_PERMISSION=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+if test -z "${HAVE_INODE_PERMISSION}${HAVE_PERMISSION}"; then
+
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_per_cpu__cpu_gdt_descr $cr_addr
 _ACEOF
 
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
 
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to invoke permission() or inode_permission" "$LINENO" 5
 
+fi
 
+# Bits for save/restore of pending signals
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.sp0" >&5
-$as_echo_n "checking kernel for thread.sp0... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_THREAD_SP0+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for copy_siginfo_to_user" >&5
+$as_echo_n "checking kernel symbol table for copy_siginfo_to_user... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_copy_siginfo_to_user+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_copy_siginfo_to_user=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}copy_siginfo_to_user$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_copy_siginfo_to_user"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_copy_siginfo_to_user\$" >/dev/null ; then
+        cr_cv_ksymtab_copy_siginfo_to_user=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_copy_siginfo_to_user=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_copy_siginfo_to_user';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -36093,11 +28731,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36105,85 +28739,85 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.sp0;
+int x = sizeof(&copy_siginfo_to_user);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_SP0=yes
+	 cr_cv_ksymtab_copy_siginfo_to_user="Y$cr_cv_ksymtab_copy_siginfo_to_user"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_SP0=no
+	 cr_cv_ksymtab_copy_siginfo_to_user="N$cr_cv_ksymtab_copy_siginfo_to_user"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_SP0
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_copy_siginfo_to_user"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_copy_siginfo_to_user" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int copy_siginfo_to_user(siginfo_t *to, siginfo_t *from);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_SP0 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_copy_siginfo_to_user | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(copy_siginfo_to_user, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_THREAD_SP0=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_SP0 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_copy_siginfo_to_user $cr_addr
 _ACEOF
 
-     HAVE_THREAD_SP0=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.esp0" >&5
-$as_echo_n "checking kernel for thread.esp0... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_ESP0+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for group_send_sig_info" >&5
+$as_echo_n "checking kernel symbol table for group_send_sig_info... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_group_send_sig_info+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_group_send_sig_info=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}group_send_sig_info$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_group_send_sig_info"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_group_send_sig_info\$" >/dev/null ; then
+        cr_cv_ksymtab_group_send_sig_info=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_group_send_sig_info=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_group_send_sig_info';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -36192,11 +28826,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36204,85 +28834,87 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.esp0;
+int x = sizeof(&group_send_sig_info);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_ESP0=yes
+	 cr_cv_ksymtab_group_send_sig_info="Y$cr_cv_ksymtab_group_send_sig_info"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_ESP0=no
+	 cr_cv_ksymtab_group_send_sig_info="N$cr_cv_ksymtab_group_send_sig_info"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_ESP0
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_group_send_sig_info"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_group_send_sig_info" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int group_send_sig_info(int, struct siginfo *, struct task_struct *);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_ESP0 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_group_send_sig_info | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(group_send_sig_info, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_THREAD_ESP0=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_ESP0 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_group_send_sig_info $cr_addr
 _ACEOF
 
-     HAVE_THREAD_ESP0=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# For save/restore of sigaltstack
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.rsp0" >&5
-$as_echo_n "checking kernel for thread.rsp0... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_RSP0+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_sigaltstack" >&5
+$as_echo_n "checking kernel symbol table for do_sigaltstack... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_do_sigaltstack+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_do_sigaltstack=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}do_sigaltstack$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_do_sigaltstack"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_do_sigaltstack\$" >/dev/null ; then
+        cr_cv_ksymtab_do_sigaltstack=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_do_sigaltstack=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_do_sigaltstack';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -36291,11 +28923,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36303,82 +28931,71 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.rsp0;
+int x = sizeof(&do_sigaltstack);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_RSP0=yes
+	 cr_cv_ksymtab_do_sigaltstack="Y$cr_cv_ksymtab_do_sigaltstack"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_RSP0=no
+	 cr_cv_ksymtab_do_sigaltstack="N$cr_cv_ksymtab_do_sigaltstack"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_RSP0
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_do_sigaltstack"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_do_sigaltstack" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int do_sigaltstack(const stack_t *, stack_t *, unsigned long);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_RSP0 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_do_sigaltstack | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(do_sigaltstack, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_THREAD_RSP0=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_RSP0 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_do_sigaltstack $cr_addr
 _ACEOF
 
-     HAVE_THREAD_RSP0=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test $CR_KARCH = i386 -o $CR_KARCH = x86_64; then
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for struct n_desc_struct" >&5
+$as_echo_n "checking kernel for struct n_desc_struct... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.usersp" >&5
-$as_echo_n "checking kernel for thread.usersp... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_USERSP+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -36390,11 +29007,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36402,82 +29015,60 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+
+	#include <linux/sched.h>
+	#include <asm/desc.h>
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.usersp;
+
+     struct n_desc_struct y;
+     int x = sizeof(y);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_USERSP=yes
+	 cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_USERSP=no
+	 cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_USERSP
+  cr_result=$cr_cv_kconfig_HAVE_STRUCT_N_DESC_STRUCT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_USERSP 1
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_N_DESC_STRUCT 1" >>confdefs.h
 
-     HAVE_THREAD_USERSP=1
+     HAVE_STRUCT_N_DESC_STRUCT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_USERSP 0
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_N_DESC_STRUCT 0" >>confdefs.h
 
-     HAVE_THREAD_USERSP=''
+     HAVE_STRUCT_N_DESC_STRUCT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for cpu_gdt_descr" >&5
+$as_echo_n "checking kernel for cpu_gdt_descr... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.userrsp" >&5
-$as_echo_n "checking kernel for thread.userrsp... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_USERRSP+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CPU_GDT_DESCR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -36489,11 +29080,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36501,85 +29088,75 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+		 #include <linux/sched.h>
+					  #include <asm/desc.h>
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.userrsp;
+
+     int x = sizeof(&cpu_gdt_descr);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_USERRSP=yes
+	 cr_cv_kconfig_HAVE_CPU_GDT_DESCR=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_USERRSP=no
+	 cr_cv_kconfig_HAVE_CPU_GDT_DESCR=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_USERRSP
+  cr_result=$cr_cv_kconfig_HAVE_CPU_GDT_DESCR
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_USERRSP 1
-_ACEOF
+    $as_echo "#define HAVE_CPU_GDT_DESCR 1" >>confdefs.h
 
-     HAVE_THREAD_USERRSP=1
+     HAVE_CPU_GDT_DESCR=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_USERRSP 0
-_ACEOF
+    $as_echo "#define HAVE_CPU_GDT_DESCR 0" >>confdefs.h
 
-     HAVE_THREAD_USERRSP=''
+     HAVE_CPU_GDT_DESCR=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+  if test -n "${HAVE_CPU_GDT_DESCR}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.debugreg0" >&5
-$as_echo_n "checking kernel for thread.debugreg0... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_DEBUGREG0+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for cpu_gdt_descr" >&5
+$as_echo_n "checking kernel symbol table for cpu_gdt_descr... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_cpu_gdt_descr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_cpu_gdt_descr=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}cpu_gdt_descr$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_cpu_gdt_descr"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_cpu_gdt_descr\$" >/dev/null ; then
+        cr_cv_ksymtab_cpu_gdt_descr=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_cpu_gdt_descr=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_cpu_gdt_descr';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -36588,11 +29165,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36600,85 +29173,83 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.debugreg0;
+int x = sizeof(&cpu_gdt_descr);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_DEBUGREG0=yes
+	 cr_cv_ksymtab_cpu_gdt_descr="Y$cr_cv_ksymtab_cpu_gdt_descr"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_DEBUGREG0=no
+	 cr_cv_ksymtab_cpu_gdt_descr="N$cr_cv_ksymtab_cpu_gdt_descr"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_DEBUGREG0
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_DEBUGREG0 1
-_ACEOF
-
-     HAVE_THREAD_DEBUGREG0=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_cpu_gdt_descr"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_DEBUGREG0 0
+    if expr "$cr_cv_ksymtab_cpu_gdt_descr" : N >/dev/null; then
+      as_fn_error $? "Found symbol cpu_gdt_descr but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_cpu_gdt_descr | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(cpu_gdt_descr, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_cpu_gdt_descr $cr_addr
 _ACEOF
 
-     HAVE_THREAD_DEBUGREG0=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+  fi
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.debugregs" >&5
-$as_echo_n "checking kernel for thread.debugregs... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_DEBUGREGS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for cpu_gdt_table" >&5
+$as_echo_n "checking kernel symbol table for cpu_gdt_table... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_cpu_gdt_table+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_cpu_gdt_table=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}cpu_gdt_table$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_cpu_gdt_table"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_cpu_gdt_table\$" >/dev/null ; then
+        cr_cv_ksymtab_cpu_gdt_table=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_cpu_gdt_table=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_cpu_gdt_table';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -36687,11 +29258,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36699,85 +29266,82 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/processor.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_struct x;
-          unsigned long tc_1 = x.debugreg[1];
+int x = sizeof(&cpu_gdt_table);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_DEBUGREGS=yes
+	 cr_cv_ksymtab_cpu_gdt_table="Y$cr_cv_ksymtab_cpu_gdt_table"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_DEBUGREGS=no
+	 cr_cv_ksymtab_cpu_gdt_table="N$cr_cv_ksymtab_cpu_gdt_table"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_DEBUGREGS
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_DEBUGREGS 1
-_ACEOF
-
-     HAVE_THREAD_DEBUGREGS=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_cpu_gdt_table"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_DEBUGREGS 0
+    if expr "$cr_cv_ksymtab_cpu_gdt_table" : N >/dev/null; then
+      as_fn_error $? "Found symbol cpu_gdt_table but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_cpu_gdt_table | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(cpu_gdt_table, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_cpu_gdt_table $cr_addr
 _ACEOF
 
-     HAVE_THREAD_DEBUGREGS=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.ptrace_bps" >&5
-$as_echo_n "checking kernel for thread.ptrace_bps... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for per_cpu__cpu_gdt_descr" >&5
+$as_echo_n "checking kernel symbol table for per_cpu__cpu_gdt_descr... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_per_cpu__cpu_gdt_descr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_per_cpu__cpu_gdt_descr=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}per_cpu__cpu_gdt_descr$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_per_cpu__cpu_gdt_descr\$" >/dev/null ; then
+        cr_cv_ksymtab_per_cpu__cpu_gdt_descr=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_per_cpu__cpu_gdt_descr=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_per_cpu__cpu_gdt_descr';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -36786,11 +29350,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36799,83 +29359,66 @@
 		 #endif
 		 #include <linux/types.h>
 
-	#include <linux/perf_event.h>
-	#include <asm/processor.h>
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct thread_struct x;
-          struct perf_event  tc_1 = *(x.ptrace_bps[1]);
+int x = sizeof(&per_cpu__cpu_gdt_descr);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS=yes
+	 cr_cv_ksymtab_per_cpu__cpu_gdt_descr="Y$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS=no
+	 cr_cv_ksymtab_per_cpu__cpu_gdt_descr="N$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_PTRACE_BPS 1
-_ACEOF
-
-     HAVE_THREAD_PTRACE_BPS=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_per_cpu__cpu_gdt_descr"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_PTRACE_BPS 0
+    if expr "$cr_cv_ksymtab_per_cpu__cpu_gdt_descr" : N >/dev/null; then
+      as_fn_error $? "Found symbol per_cpu__cpu_gdt_descr but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_per_cpu__cpu_gdt_descr | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(per_cpu__cpu_gdt_descr, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_per_cpu__cpu_gdt_descr $cr_addr
 _ACEOF
 
-     HAVE_THREAD_PTRACE_BPS=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.sp0" >&5
+$as_echo_n "checking kernel for thread.sp0... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.i387" >&5
-$as_echo_n "checking kernel for thread.i387... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_I387+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_SP0+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -36887,11 +29430,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -36904,77 +29443,51 @@
 main ()
 {
 struct thread_struct x;
-          union i387_union tc_1 = x.i387;
+          unsigned long tc_1 = x.sp0;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_I387=yes
+	 cr_cv_kconfig_HAVE_THREAD_SP0=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_I387=no
+	 cr_cv_kconfig_HAVE_THREAD_SP0=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_I387
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_SP0
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_I387 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_SP0 1" >>confdefs.h
 
-     HAVE_THREAD_I387=1
+     HAVE_THREAD_SP0=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_I387 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_SP0 0" >>confdefs.h
 
-     HAVE_THREAD_I387=''
+     HAVE_THREAD_SP0=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.esp0" >&5
+$as_echo_n "checking kernel for thread.esp0... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.xstate" >&5
-$as_echo_n "checking kernel for thread.xstate... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_XSTATE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_ESP0+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -36986,11 +29499,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37003,77 +29512,51 @@
 main ()
 {
 struct thread_struct x;
-          union thread_xstate  tc_1 = *(x.xstate);
+          unsigned long tc_1 = x.esp0;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_XSTATE=yes
+	 cr_cv_kconfig_HAVE_THREAD_ESP0=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_XSTATE=no
+	 cr_cv_kconfig_HAVE_THREAD_ESP0=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_XSTATE
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_ESP0
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_XSTATE 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_ESP0 1" >>confdefs.h
 
-     HAVE_THREAD_XSTATE=1
+     HAVE_THREAD_ESP0=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_XSTATE 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_ESP0 0" >>confdefs.h
 
-     HAVE_THREAD_XSTATE=''
+     HAVE_THREAD_ESP0=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.rsp0" >&5
+$as_echo_n "checking kernel for thread.rsp0... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for thread.fpu" >&5
-$as_echo_n "checking kernel for thread.fpu... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_THREAD_FPU+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_RSP0+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -37085,11 +29568,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37102,78 +29581,51 @@
 main ()
 {
 struct thread_struct x;
-          struct fpu tc_1 = x.fpu;
+          unsigned long tc_1 = x.rsp0;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_FPU=yes
+	 cr_cv_kconfig_HAVE_THREAD_RSP0=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_THREAD_FPU=no
+	 cr_cv_kconfig_HAVE_THREAD_RSP0=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_THREAD_FPU
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_RSP0
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_FPU 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_RSP0 1" >>confdefs.h
 
-     HAVE_THREAD_FPU=1
+     HAVE_THREAD_RSP0=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THREAD_FPU 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_RSP0 0" >>confdefs.h
 
-     HAVE_THREAD_FPU=''
+     HAVE_THREAD_RSP0=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.usersp" >&5
+$as_echo_n "checking kernel for thread.usersp... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.eflags" >&5
-$as_echo_n "checking kernel for pt_regs.eflags... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_EFLAGS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_USERSP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -37185,11 +29637,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37197,82 +29645,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/ptrace.h>
+		 #include <asm/processor.h>
 int
 main ()
 {
-struct pt_regs x;
-          unsigned long tc_1 = x.eflags;
+struct thread_struct x;
+          unsigned long tc_1 = x.usersp;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_EFLAGS=yes
+	 cr_cv_kconfig_HAVE_THREAD_USERSP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_EFLAGS=no
+	 cr_cv_kconfig_HAVE_THREAD_USERSP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_EFLAGS
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_USERSP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_EFLAGS 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_USERSP 1" >>confdefs.h
 
-     HAVE_PT_REGS_EFLAGS=1
+     HAVE_THREAD_USERSP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_EFLAGS 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_USERSP 0" >>confdefs.h
 
-     HAVE_PT_REGS_EFLAGS=''
+     HAVE_THREAD_USERSP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.userrsp" >&5
+$as_echo_n "checking kernel for thread.userrsp... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.flags" >&5
-$as_echo_n "checking kernel for pt_regs.flags... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_FLAGS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_USERRSP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -37284,11 +29706,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37296,98 +29714,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/ptrace.h>
+		 #include <asm/processor.h>
 int
 main ()
 {
-struct pt_regs x;
-          unsigned long tc_1 = x.flags;
+struct thread_struct x;
+          unsigned long tc_1 = x.userrsp;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_FLAGS=yes
+	 cr_cv_kconfig_HAVE_THREAD_USERRSP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_FLAGS=no
+	 cr_cv_kconfig_HAVE_THREAD_USERRSP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_FLAGS
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_USERRSP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_FLAGS 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_USERRSP 1" >>confdefs.h
 
-     HAVE_PT_REGS_FLAGS=1
+     HAVE_THREAD_USERRSP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_FLAGS 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_USERRSP 0" >>confdefs.h
 
-     HAVE_PT_REGS_FLAGS=''
+     HAVE_THREAD_USERRSP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.debugreg0" >&5
+$as_echo_n "checking kernel for thread.debugreg0... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for init_fpu" >&5
-$as_echo_n "checking kernel symbol table for init_fpu... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_init_fpu+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_DEBUGREG0+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_init_fpu=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}init_fpu$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_init_fpu"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_init_fpu\$" >/dev/null ; then
-        cr_cv_ksymtab_init_fpu=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_init_fpu=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_init_fpu';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -37396,11 +29775,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37408,106 +29783,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <asm/processor.h>
 int
 main ()
 {
-int x = sizeof(&init_fpu);
+struct thread_struct x;
+          unsigned long tc_1 = x.debugreg0;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_init_fpu="Y$cr_cv_ksymtab_init_fpu"
+	 cr_cv_kconfig_HAVE_THREAD_DEBUGREG0=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_init_fpu="N$cr_cv_ksymtab_init_fpu"
+	 cr_cv_kconfig_HAVE_THREAD_DEBUGREG0=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_init_fpu"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_init_fpu" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern void init_fpu(struct task_struct *);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_DEBUGREG0
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_init_fpu | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(init_fpu, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_THREAD_DEBUGREG0 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_init_fpu $cr_addr
-_ACEOF
+     HAVE_THREAD_DEBUGREG0=1
+  else
+    $as_echo "#define HAVE_THREAD_DEBUGREG0 0" >>confdefs.h
 
+     HAVE_THREAD_DEBUGREG0=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for xstate_size" >&5
-$as_echo_n "checking kernel symbol table for xstate_size... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_xstate_size+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.debugregs" >&5
+$as_echo_n "checking kernel for thread.debugregs... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_THREAD_DEBUGREGS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_xstate_size=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}xstate_size$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_xstate_size"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_xstate_size\$" >/dev/null ; then
-        cr_cv_ksymtab_xstate_size=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_xstate_size=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_xstate_size';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -37516,11 +29844,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37528,92 +29852,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <asm/processor.h>
 int
 main ()
 {
-int x = sizeof(&xstate_size);
+struct thread_struct x;
+          unsigned long tc_1 = x.debugreg[1];
   ;
   return 0;
 }
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_xstate_size="Y$cr_cv_ksymtab_xstate_size"
+	 cr_cv_kconfig_HAVE_THREAD_DEBUGREGS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_xstate_size="N$cr_cv_ksymtab_xstate_size"
+	 cr_cv_kconfig_HAVE_THREAD_DEBUGREGS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_xstate_size"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_xstate_size" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern unsigned int xstate_size;
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_DEBUGREGS
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_xstate_size | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(xstate_size, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_THREAD_DEBUGREGS 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_xstate_size $cr_addr
-_ACEOF
+     HAVE_THREAD_DEBUGREGS=1
+  else
+    $as_echo "#define HAVE_THREAD_DEBUGREGS 0" >>confdefs.h
 
+     HAVE_THREAD_DEBUGREGS=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for restore_fpu_checking" >&5
-$as_echo_n "checking kernel for restore_fpu_checking... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.ptrace_bps" >&5
+$as_echo_n "checking kernel for thread.ptrace_bps... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -37625,11 +29913,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37637,89 +29921,58 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/i387.h>
+
+	#include <linux/perf_event.h>
+	#include <asm/processor.h>
 int
 main ()
 {
-
-   #ifdef restore_fpu_checking
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&restore_fpu_checking);
-   #endif
-
+struct thread_struct x;
+          struct perf_event  tc_1 = *(x.ptrace_bps[1]);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING=yes
+	 cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING=no
+	 cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_PTRACE_BPS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_RESTORE_FPU_CHECKING 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_PTRACE_BPS 1" >>confdefs.h
 
-     HAVE_RESTORE_FPU_CHECKING=1
+     HAVE_THREAD_PTRACE_BPS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_RESTORE_FPU_CHECKING 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_PTRACE_BPS 0" >>confdefs.h
 
-     HAVE_RESTORE_FPU_CHECKING=''
+     HAVE_THREAD_PTRACE_BPS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-  if test -n "${HAVE_RESTORE_FPU_CHECKING}"; then
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.0 restore_fpu_checking" >&5
-$as_echo_n "checking kernel for 2.6.0 restore_fpu_checking... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.i387" >&5
+$as_echo_n "checking kernel for thread.i387... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_I387+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -37731,11 +29984,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37743,82 +29992,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/i387.h>
-   int restore_fpu_checking(struct i387_fxsave_struct *);
+		 #include <asm/processor.h>
 int
 main ()
 {
-int x = sizeof(&restore_fpu_checking)
+struct thread_struct x;
+          union i387_union tc_1 = x.i387;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING=yes
+	 cr_cv_kconfig_HAVE_THREAD_I387=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING=no
+	 cr_cv_kconfig_HAVE_THREAD_I387=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_I387
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_0_RESTORE_FPU_CHECKING 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_I387 1" >>confdefs.h
 
-     HAVE_2_6_0_RESTORE_FPU_CHECKING=1
+     HAVE_THREAD_I387=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_0_RESTORE_FPU_CHECKING 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_I387 0" >>confdefs.h
 
-     HAVE_2_6_0_RESTORE_FPU_CHECKING=''
+     HAVE_THREAD_I387=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.xstate" >&5
+$as_echo_n "checking kernel for thread.xstate... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.28 restore_fpu_checking" >&5
-$as_echo_n "checking kernel for 2.6.28 restore_fpu_checking... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_XSTATE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -37830,11 +30053,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -37842,177 +30061,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/i387.h>
-   int restore_fpu_checking(struct task_struct *);
+		 #include <asm/processor.h>
 int
 main ()
 {
-int x = sizeof(&restore_fpu_checking)
+struct thread_struct x;
+          union thread_xstate  tc_1 = *(x.xstate);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING=yes
+	 cr_cv_kconfig_HAVE_THREAD_XSTATE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING=no
+	 cr_cv_kconfig_HAVE_THREAD_XSTATE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_XSTATE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_28_RESTORE_FPU_CHECKING 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_XSTATE 1" >>confdefs.h
 
-     HAVE_2_6_28_RESTORE_FPU_CHECKING=1
+     HAVE_THREAD_XSTATE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_28_RESTORE_FPU_CHECKING 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_XSTATE 0" >>confdefs.h
 
-     HAVE_2_6_28_RESTORE_FPU_CHECKING=''
+     HAVE_THREAD_XSTATE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-    if test "${HAVE_2_6_0_RESTORE_FPU_CHECKING}${HAVE_2_6_28_RESTORE_FPU_CHECKING}" != "1"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to call restore_fpu_checking()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to call restore_fpu_checking()" >&2;}
-   { (exit 1); exit 1; }; }
-
-    fi
-  fi
-fi
-
-if test $CR_KARCH = i386; then
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.xcs" >&5
-$as_echo_n "checking kernel for pt_regs.xcs... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for thread.fpu" >&5
+$as_echo_n "checking kernel for thread.fpu... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_XCS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THREAD_FPU+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38024,11 +30122,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38036,71 +30130,46 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/ptrace.h>
+		 #include <asm/processor.h>
 int
 main ()
 {
-struct pt_regs x;
-          int tc_1 = x.xcs;
+struct thread_struct x;
+          struct fpu tc_1 = x.fpu;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_XCS=yes
+	 cr_cv_kconfig_HAVE_THREAD_FPU=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_XCS=no
+	 cr_cv_kconfig_HAVE_THREAD_FPU=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_XCS
+  cr_result=$cr_cv_kconfig_HAVE_THREAD_FPU
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_XCS 1
-_ACEOF
+    $as_echo "#define HAVE_THREAD_FPU 1" >>confdefs.h
 
-     HAVE_PT_REGS_XCS=1
+     HAVE_THREAD_FPU=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_XCS 0
-_ACEOF
+    $as_echo "#define HAVE_THREAD_FPU 0" >>confdefs.h
 
-     HAVE_PT_REGS_XCS=''
+     HAVE_THREAD_FPU=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -38108,10 +30177,10 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.xfs" >&5
-$as_echo_n "checking kernel for pt_regs.xfs... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.eflags" >&5
+$as_echo_n "checking kernel for pt_regs.eflags... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_XFS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_EFLAGS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38123,11 +30192,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38140,77 +30205,51 @@
 main ()
 {
 struct pt_regs x;
-          int tc_1 = x.xfs;
+          unsigned long tc_1 = x.eflags;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_XFS=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_EFLAGS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_XFS=no
+	 cr_cv_kconfig_HAVE_PT_REGS_EFLAGS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_XFS
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_EFLAGS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_XFS 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_EFLAGS 1" >>confdefs.h
 
-     HAVE_PT_REGS_XFS=1
+     HAVE_PT_REGS_EFLAGS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_XFS 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_EFLAGS 0" >>confdefs.h
 
-     HAVE_PT_REGS_XFS=''
+     HAVE_PT_REGS_EFLAGS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.flags" >&5
+$as_echo_n "checking kernel for pt_regs.flags... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.xgs" >&5
-$as_echo_n "checking kernel for pt_regs.xgs... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_XGS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_FLAGS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38222,11 +30261,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38239,66 +30274,41 @@
 main ()
 {
 struct pt_regs x;
-          int tc_1 = x.xgs;
+          unsigned long tc_1 = x.flags;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_XGS=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_FLAGS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_XGS=no
+	 cr_cv_kconfig_HAVE_PT_REGS_FLAGS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_XGS
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_FLAGS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_XGS 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_FLAGS 1" >>confdefs.h
 
-     HAVE_PT_REGS_XGS=1
+     HAVE_PT_REGS_FLAGS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_XGS 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_FLAGS 0" >>confdefs.h
 
-     HAVE_PT_REGS_XGS=''
+     HAVE_PT_REGS_FLAGS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -38306,13 +30316,26 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.cs" >&5
-$as_echo_n "checking kernel for pt_regs.cs... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_CS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for init_fpu" >&5
+$as_echo_n "checking kernel symbol table for init_fpu... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_init_fpu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_init_fpu=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}init_fpu$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_init_fpu"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_init_fpu\$" >/dev/null ; then
+        cr_cv_ksymtab_init_fpu=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_init_fpu=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_init_fpu';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -38321,11 +30344,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38333,85 +30352,85 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/ptrace.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct pt_regs x;
-          int tc_1 = x.cs;
+int x = sizeof(&init_fpu);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_CS=yes
+	 cr_cv_ksymtab_init_fpu="Y$cr_cv_ksymtab_init_fpu"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_CS=no
+	 cr_cv_ksymtab_init_fpu="N$cr_cv_ksymtab_init_fpu"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_CS
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_init_fpu"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_init_fpu" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern void init_fpu(struct task_struct *);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_CS 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_init_fpu | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(init_fpu, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_PT_REGS_CS=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_CS 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_init_fpu $cr_addr
 _ACEOF
 
-     HAVE_PT_REGS_CS=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.fs" >&5
-$as_echo_n "checking kernel for pt_regs.fs... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_FS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for xstate_size" >&5
+$as_echo_n "checking kernel symbol table for xstate_size... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_xstate_size+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_xstate_size=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}xstate_size$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_xstate_size"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_xstate_size\$" >/dev/null ; then
+        cr_cv_ksymtab_xstate_size=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_xstate_size=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_xstate_size';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -38420,11 +30439,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38432,82 +30447,70 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/ptrace.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-struct pt_regs x;
-          int tc_1 = x.fs;
+int x = sizeof(&xstate_size);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_FS=yes
+	 cr_cv_ksymtab_xstate_size="Y$cr_cv_ksymtab_xstate_size"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_FS=no
+	 cr_cv_ksymtab_xstate_size="N$cr_cv_ksymtab_xstate_size"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_FS
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_xstate_size"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_xstate_size" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern unsigned int xstate_size;
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_FS 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_xstate_size | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(xstate_size, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_PT_REGS_FS=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_FS 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_xstate_size $cr_addr
 _ACEOF
 
-     HAVE_PT_REGS_FS=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for restore_fpu_checking" >&5
+$as_echo_n "checking kernel for restore_fpu_checking... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pt_regs.gs" >&5
-$as_echo_n "checking kernel for pt_regs.gs... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PT_REGS_GS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38519,11 +30522,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38531,84 +30530,63 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <asm/ptrace.h>
+		 #include <asm/i387.h>
 int
 main ()
 {
-struct pt_regs x;
-          int tc_1 = x.gs;
+
+   #ifdef restore_fpu_checking
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&restore_fpu_checking);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_GS=yes
+	 cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PT_REGS_GS=no
+	 cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_GS
+  cr_result=$cr_cv_kconfig_HAVE_RESTORE_FPU_CHECKING
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_GS 1
-_ACEOF
+    $as_echo "#define HAVE_RESTORE_FPU_CHECKING 1" >>confdefs.h
 
-     HAVE_PT_REGS_GS=1
+     HAVE_RESTORE_FPU_CHECKING=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PT_REGS_GS 0
-_ACEOF
+    $as_echo "#define HAVE_RESTORE_FPU_CHECKING 0" >>confdefs.h
 
-     HAVE_PT_REGS_GS=''
+     HAVE_RESTORE_FPU_CHECKING=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-fi
-
-
+  if test -n "${HAVE_RESTORE_FPU_CHECKING}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for inode sem" >&5
-$as_echo_n "checking kernel for inode sem... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.0 restore_fpu_checking" >&5
+$as_echo_n "checking kernel for 2.6.0 restore_fpu_checking... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_INODE_SEM+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38620,11 +30598,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38632,85 +30606,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/fs.h>
-
+		 #include <asm/i387.h>
+   int restore_fpu_checking(struct i387_fxsave_struct *);
 int
 main ()
 {
-struct inode x;
-          struct semaphore tc_1 = x.i_sem;
+int x = sizeof(&restore_fpu_checking)
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_INODE_SEM=yes
+	 cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_INODE_SEM=no
+	 cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_INODE_SEM
+  cr_result=$cr_cv_kconfig_HAVE_2_6_0_RESTORE_FPU_CHECKING
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_SEM 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_0_RESTORE_FPU_CHECKING 1" >>confdefs.h
 
-     HAVE_INODE_SEM=1
+     HAVE_2_6_0_RESTORE_FPU_CHECKING=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_SEM 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_0_RESTORE_FPU_CHECKING 0" >>confdefs.h
 
-     HAVE_INODE_SEM=''
+     HAVE_2_6_0_RESTORE_FPU_CHECKING=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.28 restore_fpu_checking" >&5
+$as_echo_n "checking kernel for 2.6.28 restore_fpu_checking... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for inode mutex" >&5
-$as_echo_n "checking kernel for inode mutex... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_INODE_MUTEX+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38722,11 +30667,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38734,80 +30675,50 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/fs.h>
-    #include <linux/mutex.h>
-
+		 #include <asm/i387.h>
+   int restore_fpu_checking(struct task_struct *);
 int
 main ()
 {
-struct inode x;
-          struct mutex tc_1 = x.i_mutex;
+int x = sizeof(&restore_fpu_checking)
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_INODE_MUTEX=yes
+	 cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_INODE_MUTEX=no
+	 cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_INODE_MUTEX
+  cr_result=$cr_cv_kconfig_HAVE_2_6_28_RESTORE_FPU_CHECKING
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_MUTEX 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_28_RESTORE_FPU_CHECKING 1" >>confdefs.h
 
-     HAVE_INODE_MUTEX=1
+     HAVE_2_6_28_RESTORE_FPU_CHECKING=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_MUTEX 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_28_RESTORE_FPU_CHECKING 0" >>confdefs.h
 
-     HAVE_INODE_MUTEX=''
+     HAVE_2_6_28_RESTORE_FPU_CHECKING=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# Allow exactly one match
-if test "${HAVE_INODE_SEM}${HAVE_INODE_MUTEX}" != "1"; then
+    if test "${HAVE_2_6_0_RESTORE_FPU_CHECKING}${HAVE_2_6_28_RESTORE_FPU_CHECKING}" != "1"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -38836,13 +30747,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -38850,8 +30761,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -38873,12 +30784,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -38893,20 +30815,20 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unrecognized lock type for struct inode" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unrecognized lock type for struct inode" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to call restore_fpu_checking()" "$LINENO" 5
 
+    fi
+  fi
 fi
 
+if test $CR_KARCH = i386; then
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.xcs" >&5
+$as_echo_n "checking kernel for pt_regs.xcs... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for mm.dumpable" >&5
-$as_echo_n "checking kernel for mm.dumpable... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_MM_DUMPABLE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_XCS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -38918,11 +30840,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -38930,97 +30848,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <asm/ptrace.h>
 int
 main ()
 {
-struct mm_struct x;
-          int tc_1 = x.dumpable;
+struct pt_regs x;
+          int tc_1 = x.xcs;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_DUMPABLE=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_XCS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_MM_DUMPABLE=no
+	 cr_cv_kconfig_HAVE_PT_REGS_XCS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_MM_DUMPABLE
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_XCS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_DUMPABLE 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_XCS 1" >>confdefs.h
 
-     HAVE_MM_DUMPABLE=1
+     HAVE_PT_REGS_XCS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_MM_DUMPABLE 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_XCS 0" >>confdefs.h
 
-     HAVE_MM_DUMPABLE=''
+     HAVE_PT_REGS_XCS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.xfs" >&5
+$as_echo_n "checking kernel for pt_regs.xfs... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for get_dumpable" >&5
-$as_echo_n "checking kernel symbol table for get_dumpable... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_get_dumpable+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_XFS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_get_dumpable=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}get_dumpable$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_get_dumpable"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_get_dumpable\$" >/dev/null ; then
-        cr_cv_ksymtab_get_dumpable=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_get_dumpable=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_get_dumpable';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -39029,11 +30909,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39041,184 +30917,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <asm/ptrace.h>
 int
 main ()
 {
-int x = sizeof(&get_dumpable);
+struct pt_regs x;
+          int tc_1 = x.xfs;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_get_dumpable="Y$cr_cv_ksymtab_get_dumpable"
+	 cr_cv_kconfig_HAVE_PT_REGS_XFS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_get_dumpable="N$cr_cv_ksymtab_get_dumpable"
+	 cr_cv_kconfig_HAVE_PT_REGS_XFS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_get_dumpable"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_get_dumpable" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int get_dumpable(struct mm_struct *mm);
-_EOF
-
-    fi
-    cr_result=`echo $cr_cv_ksymtab_get_dumpable | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(get_dumpable, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
-
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_get_dumpable $cr_addr
-_ACEOF
-
-  fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-# Allow one or more match(es)
-if test -z "${HAVE_MM_DUMPABLE}${cr_addr}"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_XFS
 
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_PT_REGS_XFS 1" >>confdefs.h
 
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+     HAVE_PT_REGS_XFS=1
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
+    $as_echo "#define HAVE_PT_REGS_XFS 0" >>confdefs.h
 
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
+     HAVE_PT_REGS_XFS=''
+  fi
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to identify non-dumpable tasks" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to identify non-dumpable tasks" >&2;}
-   { (exit 1); exit 1; }; }
 
-fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for task.rlim" >&5
-$as_echo_n "checking kernel for task.rlim... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.xgs" >&5
+$as_echo_n "checking kernel for pt_regs.xgs... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_RLIM+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_XGS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39230,11 +30978,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39242,82 +30986,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <asm/ptrace.h>
 int
 main ()
 {
-struct task_struct x;
-          struct rlimit tc_1 = x.rlim[0];
+struct pt_regs x;
+          int tc_1 = x.xgs;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_RLIM=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_XGS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_RLIM=no
+	 cr_cv_kconfig_HAVE_PT_REGS_XGS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_RLIM
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_XGS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_RLIM 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_XGS 1" >>confdefs.h
 
-     HAVE_TASK_RLIM=1
+     HAVE_PT_REGS_XGS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_RLIM 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_XGS 0" >>confdefs.h
 
-     HAVE_TASK_RLIM=''
+     HAVE_PT_REGS_XGS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.cs" >&5
+$as_echo_n "checking kernel for pt_regs.cs... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for signal.rlim" >&5
-$as_echo_n "checking kernel for signal.rlim... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_SIGNAL_RLIM+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_CS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39329,11 +31047,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39341,175 +31055,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <asm/ptrace.h>
 int
 main ()
 {
-struct task_struct x;
-          struct rlimit tc_1 = x.signal->rlim[0];
+struct pt_regs x;
+          int tc_1 = x.cs;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SIGNAL_RLIM=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_CS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SIGNAL_RLIM=no
+	 cr_cv_kconfig_HAVE_PT_REGS_CS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_SIGNAL_RLIM
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_CS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SIGNAL_RLIM 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_CS 1" >>confdefs.h
 
-     HAVE_SIGNAL_RLIM=1
+     HAVE_PT_REGS_CS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SIGNAL_RLIM 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_CS 0" >>confdefs.h
 
-     HAVE_SIGNAL_RLIM=''
+     HAVE_PT_REGS_CS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# Allow exactly one match
-if test "${HAVE_TASK_RLIM}${HAVE_SIGNAL_RLIM}" != "1"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine location of rlim structure" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine location of rlim structure" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
-
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.fs" >&5
+$as_echo_n "checking kernel for pt_regs.fs... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for task.cred" >&5
-$as_echo_n "checking kernel for task.cred... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_TASK_CRED+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_FS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39521,11 +31116,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39533,86 +31124,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <asm/ptrace.h>
 int
 main ()
 {
-struct task_struct x;
-          const struct cred  tc_1 = *(x.cred);
+struct pt_regs x;
+          int tc_1 = x.fs;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_CRED=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_FS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_CRED=no
+	 cr_cv_kconfig_HAVE_PT_REGS_FS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_CRED
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_FS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_CRED 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_FS 1" >>confdefs.h
 
-     HAVE_TASK_CRED=1
+     HAVE_PT_REGS_FS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_CRED 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_FS 0" >>confdefs.h
 
-     HAVE_TASK_CRED=''
+     HAVE_PT_REGS_FS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -n "${HAVE_TASK_CRED}"; then
-
-
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pt_regs.gs" >&5
+$as_echo_n "checking kernel for pt_regs.gs... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 3-arg dentry_open" >&5
-$as_echo_n "checking kernel for 3-arg dentry_open... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PT_REGS_GS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39624,11 +31185,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39636,89 +31193,58 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fs.h>
+		 #include <asm/ptrace.h>
 int
 main ()
 {
-
-	#ifndef dentry_open /* Must be macro or have a decl */
-	  int x = sizeof(&dentry_open);
-	#endif
-	    dentry_open(NULL,0,NULL);
+struct pt_regs x;
+          int tc_1 = x.gs;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN=yes
+	 cr_cv_kconfig_HAVE_PT_REGS_GS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN=no
+	 cr_cv_kconfig_HAVE_PT_REGS_GS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN
+  cr_result=$cr_cv_kconfig_HAVE_PT_REGS_GS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_DENTRY_OPEN 1
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_GS 1" >>confdefs.h
 
-     HAVE_3_ARG_DENTRY_OPEN=1
+     HAVE_PT_REGS_GS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_DENTRY_OPEN 0
-_ACEOF
+    $as_echo "#define HAVE_PT_REGS_GS 0" >>confdefs.h
 
-     HAVE_3_ARG_DENTRY_OPEN=''
+     HAVE_PT_REGS_GS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+fi
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for inode sem" >&5
+$as_echo_n "checking kernel for inode sem... " >&6; }
 
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 4-arg dentry_open" >&5
-$as_echo_n "checking kernel for 4-arg dentry_open... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_INODE_SEM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39730,11 +31256,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39742,89 +31264,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fs.h>
+
+    #include <linux/sched.h>
+    #include <linux/fs.h>
+
 int
 main ()
 {
-
-	#ifndef dentry_open /* Must be macro or have a decl */
-	  int x = sizeof(&dentry_open);
-	#endif
-	    dentry_open(NULL,NULL,0,NULL);
+struct inode x;
+          struct semaphore tc_1 = x.i_sem;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN=yes
+	 cr_cv_kconfig_HAVE_INODE_SEM=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN=no
+	 cr_cv_kconfig_HAVE_INODE_SEM=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN
+  cr_result=$cr_cv_kconfig_HAVE_INODE_SEM
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_DENTRY_OPEN 1
-_ACEOF
+    $as_echo "#define HAVE_INODE_SEM 1" >>confdefs.h
 
-     HAVE_4_ARG_DENTRY_OPEN=1
+     HAVE_INODE_SEM=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_DENTRY_OPEN 0
-_ACEOF
+    $as_echo "#define HAVE_INODE_SEM 0" >>confdefs.h
 
-     HAVE_4_ARG_DENTRY_OPEN=''
+     HAVE_INODE_SEM=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
-fi
-
-
-
-
 
-  { $as_echo "$as_me:$LINENO: checking kernel for task.group_info" >&5
-$as_echo_n "checking kernel for task.group_info... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for inode mutex" >&5
+$as_echo_n "checking kernel for inode mutex... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_GROUP_INFO+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_INODE_MUTEX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39836,11 +31328,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39848,82 +31336,162 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+    #include <linux/sched.h>
+    #include <linux/fs.h>
+    #include <linux/mutex.h>
+
 int
 main ()
 {
-struct task_struct x;
-          struct group_info  tc_1 = *(x.group_info);
+struct inode x;
+          struct mutex tc_1 = x.i_mutex;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_GROUP_INFO=yes
+	 cr_cv_kconfig_HAVE_INODE_MUTEX=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_GROUP_INFO=no
+	 cr_cv_kconfig_HAVE_INODE_MUTEX=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_GROUP_INFO
+  cr_result=$cr_cv_kconfig_HAVE_INODE_MUTEX
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_GROUP_INFO 1
-_ACEOF
+    $as_echo "#define HAVE_INODE_MUTEX 1" >>confdefs.h
 
-     HAVE_TASK_GROUP_INFO=1
+     HAVE_INODE_MUTEX=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_GROUP_INFO 0
-_ACEOF
+    $as_echo "#define HAVE_INODE_MUTEX 0" >>confdefs.h
 
-     HAVE_TASK_GROUP_INFO=''
+     HAVE_INODE_MUTEX=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# Allow exactly one match
+if test "${HAVE_INODE_SEM}${HAVE_INODE_MUTEX}" != "1"; then
 
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unrecognized lock type for struct inode" "$LINENO" 5
+
+fi
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for suid_dumpable" >&5
-$as_echo_n "checking kernel for suid_dumpable... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_SUID_DUMPABLE+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for mm.dumpable" >&5
+$as_echo_n "checking kernel for mm.dumpable... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_MM_DUMPABLE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -39935,11 +31503,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -39947,96 +31511,69 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/binfmts.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
-
-     int x = sizeof(&suid_dumpable);
-
+struct mm_struct x;
+          int tc_1 = x.dumpable;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SUID_DUMPABLE=yes
+	 cr_cv_kconfig_HAVE_MM_DUMPABLE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SUID_DUMPABLE=no
+	 cr_cv_kconfig_HAVE_MM_DUMPABLE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_SUID_DUMPABLE
+  cr_result=$cr_cv_kconfig_HAVE_MM_DUMPABLE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SUID_DUMPABLE 1
-_ACEOF
+    $as_echo "#define HAVE_MM_DUMPABLE 1" >>confdefs.h
 
-     HAVE_SUID_DUMPABLE=1
+     HAVE_MM_DUMPABLE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SUID_DUMPABLE 0
-_ACEOF
+    $as_echo "#define HAVE_MM_DUMPABLE 0" >>confdefs.h
 
-     HAVE_SUID_DUMPABLE=''
+     HAVE_MM_DUMPABLE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -n "${HAVE_SUID_DUMPABLE}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for suid_dumpable" >&5
-$as_echo_n "checking kernel symbol table for suid_dumpable... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for get_dumpable" >&5
+$as_echo_n "checking kernel symbol table for get_dumpable... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_suid_dumpable+set}" = set; then
+    if ${cr_cv_ksymtab_get_dumpable+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_suid_dumpable=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}suid_dumpable$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_suid_dumpable"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_suid_dumpable\$" >/dev/null ; then
-        cr_cv_ksymtab_suid_dumpable=0
+    cr_cv_ksymtab_get_dumpable=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}get_dumpable$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_get_dumpable"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_get_dumpable\$" >/dev/null ; then
+        cr_cv_ksymtab_get_dumpable=0
       else
 
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_suid_dumpable=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_suid_dumpable';"`
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_get_dumpable=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_get_dumpable';"`
   fi
 
       fi
@@ -40048,11 +31585,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40067,43 +31600,22 @@
 int
 main ()
 {
-int x = sizeof(&suid_dumpable);
+int x = sizeof(&get_dumpable);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_suid_dumpable="Y$cr_cv_ksymtab_suid_dumpable"
+	 cr_cv_ksymtab_get_dumpable="Y$cr_cv_ksymtab_get_dumpable"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_suid_dumpable="N$cr_cv_ksymtab_suid_dumpable"
+	 cr_cv_ksymtab_get_dumpable="N$cr_cv_ksymtab_get_dumpable"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -40111,40 +31623,141 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_suid_dumpable"; then
+  if test -z "$cr_cv_ksymtab_get_dumpable"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_suid_dumpable" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol suid_dumpable but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol suid_dumpable but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_get_dumpable" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int get_dumpable(struct mm_struct *mm);
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_suid_dumpable | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_get_dumpable | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(suid_dumpable, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(get_dumpable, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_suid_dumpable $cr_addr
+#define CR_KCODE_get_dumpable $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+# Allow one or more match(es)
+if test -z "${HAVE_MM_DUMPABLE}${cr_addr}"; then
+
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to identify non-dumpable tasks" "$LINENO" 5
+
 fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for set_dumpable" >&5
-$as_echo_n "checking kernel for set_dumpable... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.rlim" >&5
+$as_echo_n "checking kernel for task.rlim... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_SET_DUMPABLE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_RLIM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -40156,11 +31769,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40172,100 +31781,55 @@
 int
 main ()
 {
-
-   #ifdef set_dumpable
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&set_dumpable);
-   #endif
-
+struct task_struct x;
+          struct rlimit tc_1 = x.rlim[0];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SET_DUMPABLE=yes
+	 cr_cv_kconfig_HAVE_TASK_RLIM=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_SET_DUMPABLE=no
+	 cr_cv_kconfig_HAVE_TASK_RLIM=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_SET_DUMPABLE
+  cr_result=$cr_cv_kconfig_HAVE_TASK_RLIM
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SET_DUMPABLE 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_RLIM 1" >>confdefs.h
 
-     HAVE_SET_DUMPABLE=1
+     HAVE_TASK_RLIM=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SET_DUMPABLE 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_RLIM 0" >>confdefs.h
 
-     HAVE_SET_DUMPABLE=''
+     HAVE_TASK_RLIM=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -n "${HAVE_SET_DUMPABLE}"; then
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for signal.rlim" >&5
+$as_echo_n "checking kernel for signal.rlim... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for set_dumpable" >&5
-$as_echo_n "checking kernel symbol table for set_dumpable... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_set_dumpable+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SIGNAL_RLIM+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_set_dumpable=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}set_dumpable$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_set_dumpable"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_set_dumpable\$" >/dev/null ; then
-        cr_cv_ksymtab_set_dumpable=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_set_dumpable=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_set_dumpable';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -40274,11 +31838,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40286,106 +31846,161 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&set_dumpable);
+struct task_struct x;
+          struct rlimit tc_1 = x.signal->rlim[0];
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_set_dumpable="Y$cr_cv_ksymtab_set_dumpable"
+	 cr_cv_kconfig_HAVE_SIGNAL_RLIM=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_set_dumpable="N$cr_cv_ksymtab_set_dumpable"
+	 cr_cv_kconfig_HAVE_SIGNAL_RLIM=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_set_dumpable"; then
-    cr_result='not found'
+  cr_result=$cr_cv_kconfig_HAVE_SIGNAL_RLIM
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_SIGNAL_RLIM 1" >>confdefs.h
+
+     HAVE_SIGNAL_RLIM=1
   else
-    if expr "$cr_cv_ksymtab_set_dumpable" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol set_dumpable but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol set_dumpable but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_set_dumpable | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(set_dumpable, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+    $as_echo "#define HAVE_SIGNAL_RLIM 0" >>confdefs.h
+
+     HAVE_SIGNAL_RLIM=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+# Allow exactly one match
+if test "${HAVE_TASK_RLIM}${HAVE_SIGNAL_RLIM}" != "1"; then
+
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_set_dumpable $cr_addr
 _ACEOF
 
-  fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine location of rlim structure" "$LINENO" 5
 
 fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for groups_search" >&5
-$as_echo_n "checking kernel symbol table for groups_search... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_groups_search+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.cred" >&5
+$as_echo_n "checking kernel for task.cred... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_TASK_CRED+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_groups_search=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}groups_search$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_groups_search"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_groups_search\$" >/dev/null ; then
-        cr_cv_ksymtab_groups_search=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_groups_search=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_groups_search';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -40394,11 +32009,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40406,106 +32017,63 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&groups_search);
+struct task_struct x;
+          const struct cred  tc_1 = *(x.cred);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_groups_search="Y$cr_cv_ksymtab_groups_search"
+	 cr_cv_kconfig_HAVE_TASK_CRED=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_groups_search="N$cr_cv_ksymtab_groups_search"
+	 cr_cv_kconfig_HAVE_TASK_CRED=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_groups_search"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_groups_search" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int groups_search(struct group_info *, gid_t);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_TASK_CRED
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_groups_search | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(groups_search, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_TASK_CRED 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_groups_search $cr_addr
-_ACEOF
+     HAVE_TASK_CRED=1
+  else
+    $as_echo "#define HAVE_TASK_CRED 0" >>confdefs.h
 
+     HAVE_TASK_CRED=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test -n "${HAVE_TASK_CRED}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for supplemental_group_member" >&5
-$as_echo_n "checking kernel symbol table for supplemental_group_member... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_supplemental_group_member+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
 
-    cr_cv_ksymtab_supplemental_group_member=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}supplemental_group_member$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_supplemental_group_member"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_supplemental_group_member\$" >/dev/null ; then
-        cr_cv_ksymtab_supplemental_group_member=0
-      else
 
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_supplemental_group_member=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_supplemental_group_member';"`
-  fi
 
-      fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 3-arg dentry_open" >&5
+$as_echo_n "checking kernel for 3-arg dentry_open... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
 
 
   SAVE_CC=$CC
@@ -40514,11 +32082,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40526,81 +32090,49 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/fs.h>
 int
 main ()
 {
-int x = sizeof(&supplemental_group_member);
+
+	#ifndef dentry_open /* Must be macro or have a decl */
+	  int x = sizeof(&dentry_open);
+	#endif
+	    dentry_open(NULL,0,NULL);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_supplemental_group_member="Y$cr_cv_ksymtab_supplemental_group_member"
+	 cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_supplemental_group_member="N$cr_cv_ksymtab_supplemental_group_member"
+	 cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_supplemental_group_member"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_supplemental_group_member" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int supplemental_group_member(gid_t);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_3_ARG_DENTRY_OPEN
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_supplemental_group_member | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(supplemental_group_member, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_3_ARG_DENTRY_OPEN 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_supplemental_group_member $cr_addr
-_ACEOF
+     HAVE_3_ARG_DENTRY_OPEN=1
+  else
+    $as_echo "#define HAVE_3_ARG_DENTRY_OPEN 0" >>confdefs.h
 
+     HAVE_3_ARG_DENTRY_OPEN=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -40608,10 +32140,13 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for PIDTYPE_TGID" >&5
-$as_echo_n "checking kernel for PIDTYPE_TGID... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PIDTYPE_TGID+set}" = set; then
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 4-arg dentry_open" >&5
+$as_echo_n "checking kernel for 4-arg dentry_open... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -40623,11 +32158,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40635,84 +32166,63 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+		 #include <linux/fs.h>
 int
 main ()
 {
 
-     typeof(PIDTYPE_TGID) y;
-     int x = sizeof(y);
-
+	#ifndef dentry_open /* Must be macro or have a decl */
+	  int x = sizeof(&dentry_open);
+	#endif
+	    dentry_open(NULL,NULL,0,NULL);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIDTYPE_TGID=yes
+	 cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIDTYPE_TGID=no
+	 cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PIDTYPE_TGID
+  cr_result=$cr_cv_kconfig_HAVE_4_ARG_DENTRY_OPEN
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIDTYPE_TGID 1
-_ACEOF
+    $as_echo "#define HAVE_4_ARG_DENTRY_OPEN 1" >>confdefs.h
 
-     HAVE_PIDTYPE_TGID=1
+     HAVE_4_ARG_DENTRY_OPEN=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIDTYPE_TGID 0
-_ACEOF
+    $as_echo "#define HAVE_4_ARG_DENTRY_OPEN 0" >>confdefs.h
 
-     HAVE_PIDTYPE_TGID=''
+     HAVE_4_ARG_DENTRY_OPEN=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
+fi
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for task.thread_group" >&5
-$as_echo_n "checking kernel for task.thread_group... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_THREAD_GROUP+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.group_info" >&5
+$as_echo_n "checking kernel for task.group_info... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_TASK_GROUP_INFO+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -40724,11 +32234,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40741,184 +32247,54 @@
 main ()
 {
 struct task_struct x;
-          struct list_head tc_1 = x.thread_group;
+          struct group_info  tc_1 = *(x.group_info);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_THREAD_GROUP=yes
+	 cr_cv_kconfig_HAVE_TASK_GROUP_INFO=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_THREAD_GROUP=no
+	 cr_cv_kconfig_HAVE_TASK_GROUP_INFO=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_THREAD_GROUP
+  cr_result=$cr_cv_kconfig_HAVE_TASK_GROUP_INFO
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_THREAD_GROUP 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_GROUP_INFO 1" >>confdefs.h
 
-     HAVE_TASK_THREAD_GROUP=1
+     HAVE_TASK_GROUP_INFO=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_THREAD_GROUP 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_GROUP_INFO 0" >>confdefs.h
 
-     HAVE_TASK_THREAD_GROUP=''
+     HAVE_TASK_GROUP_INFO=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test "${HAVE_PIDTYPE_TGID}${HAVE_TASK_THREAD_GROUP}" != "1"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
-
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
-
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine thread group list" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine thread group list" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
-
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for suid_dumpable" >&5
+$as_echo_n "checking kernel for suid_dumpable... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for detach_pid" >&5
-$as_echo_n "checking kernel symbol table for detach_pid... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_detach_pid+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SUID_DUMPABLE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_detach_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}detach_pid$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_detach_pid"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_detach_pid\$" >/dev/null ; then
-        cr_cv_ksymtab_detach_pid=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_detach_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_detach_pid';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -40927,11 +32303,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -40939,102 +32311,71 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/binfmts.h>
 int
 main ()
 {
-int x = sizeof(&detach_pid);
+
+     int x = sizeof(&suid_dumpable);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_detach_pid="Y$cr_cv_ksymtab_detach_pid"
+	 cr_cv_kconfig_HAVE_SUID_DUMPABLE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_detach_pid="N$cr_cv_ksymtab_detach_pid"
+	 cr_cv_kconfig_HAVE_SUID_DUMPABLE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_detach_pid"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_detach_pid" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol detach_pid but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol detach_pid but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_detach_pid | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(detach_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_SUID_DUMPABLE
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_detach_pid $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_SUID_DUMPABLE 1" >>confdefs.h
+
+     HAVE_SUID_DUMPABLE=1
+  else
+    $as_echo "#define HAVE_SUID_DUMPABLE 0" >>confdefs.h
 
+     HAVE_SUID_DUMPABLE=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test -n "${HAVE_SUID_DUMPABLE}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for attach_pid" >&5
-$as_echo_n "checking kernel symbol table for attach_pid... " >&6; }
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for suid_dumpable" >&5
+$as_echo_n "checking kernel symbol table for suid_dumpable... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_attach_pid+set}" = set; then
+    if ${cr_cv_ksymtab_suid_dumpable+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_attach_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}attach_pid$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_attach_pid"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_attach_pid\$" >/dev/null ; then
-        cr_cv_ksymtab_attach_pid=0
+    cr_cv_ksymtab_suid_dumpable=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}suid_dumpable$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_suid_dumpable"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_suid_dumpable\$" >/dev/null ; then
+        cr_cv_ksymtab_suid_dumpable=0
       else
 
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_attach_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_attach_pid';"`
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_suid_dumpable=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_suid_dumpable';"`
   fi
 
       fi
@@ -41046,11 +32387,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41065,43 +32402,22 @@
 int
 main ()
 {
-int x = sizeof(&attach_pid);
+int x = sizeof(&suid_dumpable);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_attach_pid="Y$cr_cv_ksymtab_attach_pid"
+	 cr_cv_ksymtab_suid_dumpable="Y$cr_cv_ksymtab_suid_dumpable"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_attach_pid="N$cr_cv_ksymtab_attach_pid"
+	 cr_cv_ksymtab_suid_dumpable="N$cr_cv_ksymtab_suid_dumpable"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -41109,54 +32425,40 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_attach_pid"; then
+  if test -z "$cr_cv_ksymtab_suid_dumpable"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_attach_pid" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol attach_pid but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol attach_pid but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_suid_dumpable" : N >/dev/null; then
+      as_fn_error $? "Found symbol suid_dumpable but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_attach_pid | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_suid_dumpable | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(attach_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KDATA(suid_dumpable, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_attach_pid $cr_addr
+#define CR_KDATA_suid_dumpable $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+fi
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for set_dumpable" >&5
+$as_echo_n "checking kernel for set_dumpable... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for change_pid" >&5
-$as_echo_n "checking kernel symbol table for change_pid... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_change_pid+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SET_DUMPABLE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_change_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}change_pid$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_change_pid"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_change_pid\$" >/dev/null ; then
-        cr_cv_ksymtab_change_pid=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_change_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_change_pid';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -41165,11 +32467,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41177,102 +32475,76 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&change_pid);
+
+   #ifdef set_dumpable
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&set_dumpable);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_change_pid="Y$cr_cv_ksymtab_change_pid"
+	 cr_cv_kconfig_HAVE_SET_DUMPABLE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_change_pid="N$cr_cv_ksymtab_change_pid"
+	 cr_cv_kconfig_HAVE_SET_DUMPABLE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_change_pid"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_change_pid" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol change_pid but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol change_pid but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_change_pid | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(change_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_SET_DUMPABLE
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_change_pid $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_SET_DUMPABLE 1" >>confdefs.h
+
+     HAVE_SET_DUMPABLE=1
+  else
+    $as_echo "#define HAVE_SET_DUMPABLE 0" >>confdefs.h
 
+     HAVE_SET_DUMPABLE=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test -n "${HAVE_SET_DUMPABLE}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for find_pid" >&5
-$as_echo_n "checking kernel symbol table for find_pid... " >&6; }
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for set_dumpable" >&5
+$as_echo_n "checking kernel symbol table for set_dumpable... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_find_pid+set}" = set; then
+    if ${cr_cv_ksymtab_set_dumpable+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_find_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}find_pid$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_find_pid"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_find_pid\$" >/dev/null ; then
-        cr_cv_ksymtab_find_pid=0
+    cr_cv_ksymtab_set_dumpable=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}set_dumpable$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_set_dumpable"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_set_dumpable\$" >/dev/null ; then
+        cr_cv_ksymtab_set_dumpable=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_find_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_find_pid';"`
+    cr_cv_ksymtab_set_dumpable=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_set_dumpable';"`
   fi
 
       fi
@@ -41284,11 +32556,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41303,43 +32571,22 @@
 int
 main ()
 {
-int x = sizeof(&find_pid);
+int x = sizeof(&set_dumpable);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_find_pid="Y$cr_cv_ksymtab_find_pid"
+	 cr_cv_ksymtab_set_dumpable="Y$cr_cv_ksymtab_set_dumpable"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_find_pid="N$cr_cv_ksymtab_find_pid"
+	 cr_cv_ksymtab_set_dumpable="N$cr_cv_ksymtab_set_dumpable"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -41347,51 +32594,50 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_find_pid"; then
+  if test -z "$cr_cv_ksymtab_set_dumpable"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_find_pid" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol find_pid but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol find_pid but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_set_dumpable" : N >/dev/null; then
+      as_fn_error $? "Found symbol set_dumpable but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_find_pid | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_set_dumpable | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(find_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(set_dumpable, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_find_pid $cr_addr
+#define CR_KCODE_set_dumpable $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for link_pid" >&5
-$as_echo_n "checking kernel symbol table for link_pid... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for groups_search" >&5
+$as_echo_n "checking kernel symbol table for groups_search... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_link_pid+set}" = set; then
+    if ${cr_cv_ksymtab_groups_search+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_link_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}link_pid$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_link_pid"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_link_pid\$" >/dev/null ; then
-        cr_cv_ksymtab_link_pid=0
+    cr_cv_ksymtab_groups_search=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}groups_search$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_groups_search"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_groups_search\$" >/dev/null ; then
+        cr_cv_ksymtab_groups_search=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_link_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_link_pid';"`
+    cr_cv_ksymtab_groups_search=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_groups_search';"`
   fi
 
       fi
@@ -41403,11 +32649,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41422,43 +32664,22 @@
 int
 main ()
 {
-int x = sizeof(&link_pid);
+int x = sizeof(&groups_search);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_link_pid="Y$cr_cv_ksymtab_link_pid"
+	 cr_cv_ksymtab_groups_search="Y$cr_cv_ksymtab_groups_search"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_link_pid="N$cr_cv_ksymtab_link_pid"
+	 cr_cv_ksymtab_groups_search="N$cr_cv_ksymtab_groups_search"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -41466,46 +32687,55 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_link_pid"; then
+  if test -z "$cr_cv_ksymtab_groups_search"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_link_pid" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol link_pid but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol link_pid but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_groups_search" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int groups_search(struct group_info *, gid_t);
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_link_pid | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_groups_search | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(link_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(groups_search, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_link_pid $cr_addr
+#define CR_KCODE_groups_search $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 1-arg find_pid" >&5
-$as_echo_n "checking kernel for 1-arg find_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_1_ARG_FIND_PID+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for supplemental_group_member" >&5
+$as_echo_n "checking kernel symbol table for supplemental_group_member... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_supplemental_group_member+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_supplemental_group_member=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}supplemental_group_member$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_supplemental_group_member"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_supplemental_group_member\$" >/dev/null ; then
+        cr_cv_ksymtab_supplemental_group_member=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_supplemental_group_member=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_supplemental_group_member';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -41514,11 +32744,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41526,89 +32752,70 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-	#ifndef find_pid /* Must be macro or have a decl */
-	  int x = sizeof(&find_pid);
-	#endif
-	    find_pid(0);
+int x = sizeof(&supplemental_group_member);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_1_ARG_FIND_PID=yes
+	 cr_cv_ksymtab_supplemental_group_member="Y$cr_cv_ksymtab_supplemental_group_member"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_1_ARG_FIND_PID=no
+	 cr_cv_ksymtab_supplemental_group_member="N$cr_cv_ksymtab_supplemental_group_member"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_1_ARG_FIND_PID
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_supplemental_group_member"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_supplemental_group_member" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int supplemental_group_member(gid_t);
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_1_ARG_FIND_PID 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_supplemental_group_member | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(supplemental_group_member, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_1_ARG_FIND_PID=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_1_ARG_FIND_PID 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_supplemental_group_member $cr_addr
 _ACEOF
 
-     HAVE_1_ARG_FIND_PID=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for PIDTYPE_TGID" >&5
+$as_echo_n "checking kernel for PIDTYPE_TGID... " >&6; }
 
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2-arg find_pid" >&5
-$as_echo_n "checking kernel for 2-arg find_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_ARG_FIND_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PIDTYPE_TGID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -41620,11 +32827,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41637,82 +32840,53 @@
 main ()
 {
 
-	#ifndef find_pid /* Must be macro or have a decl */
-	  int x = sizeof(&find_pid);
-	#endif
-	    find_pid(0,0);
+     typeof(PIDTYPE_TGID) y;
+     int x = sizeof(y);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_ARG_FIND_PID=yes
+	 cr_cv_kconfig_HAVE_PIDTYPE_TGID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_ARG_FIND_PID=no
+	 cr_cv_kconfig_HAVE_PIDTYPE_TGID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_ARG_FIND_PID
+  cr_result=$cr_cv_kconfig_HAVE_PIDTYPE_TGID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_ARG_FIND_PID 1
-_ACEOF
+    $as_echo "#define HAVE_PIDTYPE_TGID 1" >>confdefs.h
 
-     HAVE_2_ARG_FIND_PID=1
+     HAVE_PIDTYPE_TGID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_ARG_FIND_PID 0
-_ACEOF
+    $as_echo "#define HAVE_PIDTYPE_TGID 0" >>confdefs.h
 
-     HAVE_2_ARG_FIND_PID=''
+     HAVE_PIDTYPE_TGID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.thread_group" >&5
+$as_echo_n "checking kernel for task.thread_group... " >&6; }
 
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for find_pid_ns" >&5
-$as_echo_n "checking kernel for find_pid_ns... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_FIND_PID_NS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_THREAD_GROUP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -41724,11 +32898,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41740,77 +32910,46 @@
 int
 main ()
 {
-
-   #ifdef find_pid_ns
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&find_pid_ns);
-   #endif
-
+struct task_struct x;
+          struct list_head tc_1 = x.thread_group;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_PID_NS=yes
+	 cr_cv_kconfig_HAVE_TASK_THREAD_GROUP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_PID_NS=no
+	 cr_cv_kconfig_HAVE_TASK_THREAD_GROUP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FIND_PID_NS
+  cr_result=$cr_cv_kconfig_HAVE_TASK_THREAD_GROUP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_PID_NS 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_THREAD_GROUP 1" >>confdefs.h
 
-     HAVE_FIND_PID_NS=1
+     HAVE_TASK_THREAD_GROUP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_PID_NS 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_THREAD_GROUP 0" >>confdefs.h
 
-     HAVE_FIND_PID_NS=''
+     HAVE_TASK_THREAD_GROUP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -z "${HAVE_1_ARG_FIND_PID}${HAVE_2_ARG_FIND_PID}${HAVE_FIND_PID_NS}"; then
+if test "${HAVE_PIDTYPE_TGID}${HAVE_TASK_THREAD_GROUP}" != "1"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -41839,13 +32978,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -41853,8 +32992,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -41876,12 +33015,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -41896,9 +33046,7 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to map pid_nr -> struct pid" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to map pid_nr -> struct pid" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine thread group list" "$LINENO" 5
 
 fi
 
@@ -41906,13 +33054,301 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for find_task_by_pid" >&5
-$as_echo_n "checking kernel for find_task_by_pid... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for detach_pid" >&5
+$as_echo_n "checking kernel symbol table for detach_pid... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_detach_pid+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    cr_cv_ksymtab_detach_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}detach_pid$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_detach_pid"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_detach_pid\$" >/dev/null ; then
+        cr_cv_ksymtab_detach_pid=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_detach_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_detach_pid';"`
+  fi
+
+      fi
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
+int
+main ()
+{
+int x = sizeof(&detach_pid);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_detach_pid="Y$cr_cv_ksymtab_detach_pid"
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_detach_pid="N$cr_cv_ksymtab_detach_pid"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+    fi
+
+fi
+
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_detach_pid"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_detach_pid" : N >/dev/null; then
+      as_fn_error $? "Found symbol detach_pid but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_detach_pid | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(detach_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_detach_pid $cr_addr
+_ACEOF
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for attach_pid" >&5
+$as_echo_n "checking kernel symbol table for attach_pid... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_attach_pid+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    cr_cv_ksymtab_attach_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}attach_pid$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_attach_pid"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_attach_pid\$" >/dev/null ; then
+        cr_cv_ksymtab_attach_pid=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_attach_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_attach_pid';"`
+  fi
+
+      fi
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
+int
+main ()
+{
+int x = sizeof(&attach_pid);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_attach_pid="Y$cr_cv_ksymtab_attach_pid"
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_attach_pid="N$cr_cv_ksymtab_attach_pid"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+    fi
+
+fi
+
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_attach_pid"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_attach_pid" : N >/dev/null; then
+      as_fn_error $? "Found symbol attach_pid but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_attach_pid | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(attach_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_attach_pid $cr_addr
+_ACEOF
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for change_pid" >&5
+$as_echo_n "checking kernel symbol table for change_pid... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_change_pid+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    cr_cv_ksymtab_change_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}change_pid$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_change_pid"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_change_pid\$" >/dev/null ; then
+        cr_cv_ksymtab_change_pid=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_change_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_change_pid';"`
+  fi
+
+      fi
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
+int
+main ()
+{
+int x = sizeof(&change_pid);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_change_pid="Y$cr_cv_ksymtab_change_pid"
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_change_pid="N$cr_cv_ksymtab_change_pid"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+    fi
+
+fi
+
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_change_pid"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_change_pid" : N >/dev/null; then
+      as_fn_error $? "Found symbol change_pid but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_change_pid | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(change_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_change_pid $cr_addr
+_ACEOF
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for find_pid" >&5
+$as_echo_n "checking kernel symbol table for find_pid... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_find_pid+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    cr_cv_ksymtab_find_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}find_pid$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_find_pid"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_find_pid\$" >/dev/null ; then
+        cr_cv_ksymtab_find_pid=0
+      else
 
-    if test "${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_find_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_find_pid';"`
+  fi
 
+      fi
 
 
   SAVE_CC=$CC
@@ -41921,11 +33357,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -41933,91 +33365,82 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifdef find_task_by_pid
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&find_task_by_pid);
-   #endif
-
+int x = sizeof(&find_pid);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID=yes
+	 cr_cv_ksymtab_find_pid="Y$cr_cv_ksymtab_find_pid"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID=no
+	 cr_cv_ksymtab_find_pid="N$cr_cv_ksymtab_find_pid"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID 1
-_ACEOF
-
-     HAVE_FIND_TASK_BY_PID=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_find_pid"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID 0
+    if expr "$cr_cv_ksymtab_find_pid" : N >/dev/null; then
+      as_fn_error $? "Found symbol find_pid but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_find_pid | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(find_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_find_pid $cr_addr
 _ACEOF
 
-     HAVE_FIND_TASK_BY_PID=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for find_task_by_pid_ns" >&5
-$as_echo_n "checking kernel for find_task_by_pid_ns... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for link_pid" >&5
+$as_echo_n "checking kernel symbol table for link_pid... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_link_pid+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_link_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}link_pid$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_link_pid"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_link_pid\$" >/dev/null ; then
+        cr_cv_ksymtab_link_pid=0
+      else
+
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_link_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_link_pid';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -42026,11 +33449,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -42038,194 +33457,73 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifdef find_task_by_pid_ns
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&find_task_by_pid_ns);
-   #endif
-
+int x = sizeof(&link_pid);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS=yes
+	 cr_cv_ksymtab_link_pid="Y$cr_cv_ksymtab_link_pid"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS=no
+	 cr_cv_ksymtab_link_pid="N$cr_cv_ksymtab_link_pid"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID_NS 1
-_ACEOF
-
-     HAVE_FIND_TASK_BY_PID_NS=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_link_pid"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID_NS 0
+    if expr "$cr_cv_ksymtab_link_pid" : N >/dev/null; then
+      as_fn_error $? "Found symbol link_pid but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_link_pid | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(link_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_link_pid $cr_addr
 _ACEOF
 
-     HAVE_FIND_TASK_BY_PID_NS=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -z "${HAVE_FIND_TASK_BY_PID}${HAVE_FIND_TASK_BY_PID_NS}"; then
-
-  cat >confcache <<\_ACEOF
-# This file is a shell script that caches the results of configure
-# tests run on this system so they can be shared between configure
-# scripts and configure runs, see configure's option --config-cache.
-# It is not useful on other systems.  If it contains results you don't
-# want to keep, you may remove or edit it.
-#
-# config.status only pays attention to the cache file if you give it
-# the --recheck option to rerun configure.
-#
-# `ac_cv_env_foo' variables (set or unset) will be overridden when
-# loading this file, other *unset* `ac_cv_foo' will be assigned the
-# following values.
-
-_ACEOF
-
-# The following way of writing the cache mishandles newlines in values,
-# but we know of no workaround that is simple, portable, and efficient.
-# So, we kill variables containing newlines.
-# Ultrix sh set writes to stderr and can't be redirected directly,
-# and sets the high bit in the cache file unless we assign to the vars.
-(
-  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
-    eval ac_val=\$$ac_var
-    case $ac_val in #(
-    *${as_nl}*)
-      case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
-$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
-      esac
-      case $ac_var in #(
-      _ | IFS | as_nl) ;; #(
-      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
-      esac ;;
-    esac
-  done
-
-  (set) 2>&1 |
-    case $as_nl`(ac_space=' '; set) 2>&1` in #(
-    *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
-      sed -n \
-	"s/'/'\\\\''/g;
-	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
-      ;; #(
-    *)
-      # `set' quotes correctly as required by POSIX, so do not add quotes.
-      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
-      ;;
-    esac |
-    sort
-) |
-  sed '
-     /^ac_cv_env_/b end
-     t clear
-     :clear
-     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
-     t end
-     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
-     :end' >>confcache
-if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
-  if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
-$as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
-  else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
-$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
-  fi
-fi
-rm -f confcache
 
-  echo "======================================================================"
-  echo "Please review the following configuration information:"
-  echo "  Kernel source directory = $LINUX_SRC"
-  echo "  Kernel build directory = $LINUX_OBJ"
-  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
-  echo "  Kernel version probed from kernel build = $LINUX_VER"
-  echo "  Kernel running currently = `uname -r`"
-  echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to map pid_nr -> struct task" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to map pid_nr -> struct task" >&2;}
-   { (exit 1); exit 1; }; }
 
-fi
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 1-arg find_pid" >&5
+$as_echo_n "checking kernel for 1-arg find_pid... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for find_task_by_pid_ns" >&5
-$as_echo_n "checking kernel symbol table for find_task_by_pid_ns... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_find_task_by_pid_ns+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_1_ARG_FIND_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_find_task_by_pid_ns=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}find_task_by_pid_ns$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_find_task_by_pid_ns"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_find_task_by_pid_ns\$" >/dev/null ; then
-        cr_cv_ksymtab_find_task_by_pid_ns=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_find_task_by_pid_ns=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_find_task_by_pid_ns';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -42234,11 +33532,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -42246,80 +33540,49 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&find_task_by_pid_ns);
+
+	#ifndef find_pid /* Must be macro or have a decl */
+	  int x = sizeof(&find_pid);
+	#endif
+	    find_pid(0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_find_task_by_pid_ns="Y$cr_cv_ksymtab_find_task_by_pid_ns"
+	 cr_cv_kconfig_HAVE_1_ARG_FIND_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_find_task_by_pid_ns="N$cr_cv_ksymtab_find_task_by_pid_ns"
+	 cr_cv_kconfig_HAVE_1_ARG_FIND_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_find_task_by_pid_ns"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_find_task_by_pid_ns" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol find_task_by_pid_ns but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol find_task_by_pid_ns but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    cr_result=`echo $cr_cv_ksymtab_find_task_by_pid_ns | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(find_task_by_pid_ns, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  cr_result=$cr_cv_kconfig_HAVE_1_ARG_FIND_PID
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_find_task_by_pid_ns $cr_addr
-_ACEOF
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_1_ARG_FIND_PID 1" >>confdefs.h
+
+     HAVE_1_ARG_FIND_PID=1
+  else
+    $as_echo "#define HAVE_1_ARG_FIND_PID 0" >>confdefs.h
 
+     HAVE_1_ARG_FIND_PID=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -42327,10 +33590,13 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for find_task_by_pid_type" >&5
-$as_echo_n "checking kernel for find_task_by_pid_type... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE+set}" = set; then
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2-arg find_pid" >&5
+$as_echo_n "checking kernel for 2-arg find_pid... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_2_ARG_FIND_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -42342,11 +33608,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -42359,72 +33621,44 @@
 main ()
 {
 
-   #ifdef find_task_by_pid_type
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&find_task_by_pid_type);
-   #endif
-
+	#ifndef find_pid /* Must be macro or have a decl */
+	  int x = sizeof(&find_pid);
+	#endif
+	    find_pid(0,0);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE=yes
+	 cr_cv_kconfig_HAVE_2_ARG_FIND_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE=no
+	 cr_cv_kconfig_HAVE_2_ARG_FIND_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE
+  cr_result=$cr_cv_kconfig_HAVE_2_ARG_FIND_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID_TYPE 1
-_ACEOF
+    $as_echo "#define HAVE_2_ARG_FIND_PID 1" >>confdefs.h
 
-     HAVE_FIND_TASK_BY_PID_TYPE=1
+     HAVE_2_ARG_FIND_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID_TYPE 0
-_ACEOF
+    $as_echo "#define HAVE_2_ARG_FIND_PID 0" >>confdefs.h
 
-     HAVE_FIND_TASK_BY_PID_TYPE=''
+     HAVE_2_ARG_FIND_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -42432,10 +33666,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for find_task_by_pid_type_ns" >&5
-$as_echo_n "checking kernel for find_task_by_pid_type_ns... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for find_pid_ns" >&5
+$as_echo_n "checking kernel for find_pid_ns... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_FIND_PID_NS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -42447,11 +33682,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -42464,76 +33695,51 @@
 main ()
 {
 
-   #ifdef find_task_by_pid_type_ns
+   #ifdef find_pid_ns
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&find_task_by_pid_type_ns);
+     int x = sizeof(&find_pid_ns);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS=yes
+	 cr_cv_kconfig_HAVE_FIND_PID_NS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS=no
+	 cr_cv_kconfig_HAVE_FIND_PID_NS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS
+  cr_result=$cr_cv_kconfig_HAVE_FIND_PID_NS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID_TYPE_NS 1
-_ACEOF
+    $as_echo "#define HAVE_FIND_PID_NS 1" >>confdefs.h
 
-     HAVE_FIND_TASK_BY_PID_TYPE_NS=1
+     HAVE_FIND_PID_NS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FIND_TASK_BY_PID_TYPE_NS 0
-_ACEOF
+    $as_echo "#define HAVE_FIND_PID_NS 0" >>confdefs.h
 
-     HAVE_FIND_TASK_BY_PID_TYPE_NS=''
+     HAVE_FIND_PID_NS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -z "${HAVE_2_ARG_FIND_PID}${HAVE_FIND_TASK_BY_PID}${HAVE_FIND_TASK_BY_PID_NS}"; then
+if test -z "${HAVE_1_ARG_FIND_PID}${HAVE_2_ARG_FIND_PID}${HAVE_FIND_PID_NS}"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -42562,13 +33768,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -42576,8 +33782,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -42599,12 +33805,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -42619,20 +33836,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to map (type, pid_nr) -> struct task" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to map (type, pid_nr) -> struct task" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to map pid_nr -> struct pid" "$LINENO" 5
 
 fi
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for find_task_by_pid" >&5
+$as_echo_n "checking kernel for find_task_by_pid... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for alloc_pid" >&5
-$as_echo_n "checking kernel for alloc_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_ALLOC_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -42644,11 +33858,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -42661,193 +33871,57 @@
 main ()
 {
 
-   #ifdef alloc_pid
+   #ifdef find_task_by_pid
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&alloc_pid);
+     int x = sizeof(&find_task_by_pid);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ALLOC_PID=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_ALLOC_PID=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_ALLOC_PID
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ALLOC_PID 1
-_ACEOF
-
-     HAVE_ALLOC_PID=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_ALLOC_PID 0
-_ACEOF
-
-     HAVE_ALLOC_PID=''
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-if test -n "${HAVE_ALLOC_PID}"; then
-
-
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 0-arg alloc_pid" >&5
-$as_echo_n "checking kernel for 0-arg alloc_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID+set}" = set; then
-  $as_echo_n "(cached) " >&6
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID=yes
 else
-
-
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-		 #include <linux/sched.h>
-int
-main ()
-{
-
-	#ifndef alloc_pid /* Must be macro or have a decl */
-	  int x = sizeof(&alloc_pid);
-	#endif
-	    alloc_pid();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID=no
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID
+  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_0_ARG_ALLOC_PID 1
-_ACEOF
+    $as_echo "#define HAVE_FIND_TASK_BY_PID 1" >>confdefs.h
 
-     HAVE_0_ARG_ALLOC_PID=1
+     HAVE_FIND_TASK_BY_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_0_ARG_ALLOC_PID 0
-_ACEOF
+    $as_echo "#define HAVE_FIND_TASK_BY_PID 0" >>confdefs.h
 
-     HAVE_0_ARG_ALLOC_PID=''
+     HAVE_FIND_TASK_BY_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for find_task_by_pid_ns" >&5
+$as_echo_n "checking kernel for find_task_by_pid_ns... " >&6; }
 
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 1-arg alloc_pid" >&5
-$as_echo_n "checking kernel for 1-arg alloc_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -42859,11 +33933,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -42876,75 +33946,51 @@
 main ()
 {
 
-	#ifndef alloc_pid /* Must be macro or have a decl */
-	  int x = sizeof(&alloc_pid);
-	#endif
-	    alloc_pid(NULL);
+   #ifdef find_task_by_pid_ns
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&find_task_by_pid_ns);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID=yes
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID=no
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID
+  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_NS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_1_ARG_ALLOC_PID 1
-_ACEOF
+    $as_echo "#define HAVE_FIND_TASK_BY_PID_NS 1" >>confdefs.h
 
-     HAVE_1_ARG_ALLOC_PID=1
+     HAVE_FIND_TASK_BY_PID_NS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_1_ARG_ALLOC_PID 0
-_ACEOF
+    $as_echo "#define HAVE_FIND_TASK_BY_PID_NS 0" >>confdefs.h
 
-     HAVE_1_ARG_ALLOC_PID=''
+     HAVE_FIND_TASK_BY_PID_NS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-
-
-  if test "${HAVE_0_ARG_ALLOC_PID}${HAVE_1_ARG_ALLOC_PID}" != "1"; then
+if test -z "${HAVE_FIND_TASK_BY_PID}${HAVE_FIND_TASK_BY_PID_NS}"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -42973,13 +34019,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -42987,8 +34033,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -43010,12 +34056,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -43030,31 +34087,29 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to call alloc_pid()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to call alloc_pid()" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to map pid_nr -> struct task" "$LINENO" 5
 
-  fi
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for free_pid" >&5
-$as_echo_n "checking kernel symbol table for free_pid... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for find_task_by_pid_ns" >&5
+$as_echo_n "checking kernel symbol table for find_task_by_pid_ns... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_free_pid+set}" = set; then
+    if ${cr_cv_ksymtab_find_task_by_pid_ns+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_free_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}free_pid$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_free_pid"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_free_pid\$" >/dev/null ; then
-        cr_cv_ksymtab_free_pid=0
+    cr_cv_ksymtab_find_task_by_pid_ns=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}find_task_by_pid_ns$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_find_task_by_pid_ns"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_find_task_by_pid_ns\$" >/dev/null ; then
+        cr_cv_ksymtab_find_task_by_pid_ns=0
       else
 
   if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_free_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_free_pid';"`
+    cr_cv_ksymtab_find_task_by_pid_ns=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_find_task_by_pid_ns';"`
   fi
 
       fi
@@ -43066,11 +34121,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43085,43 +34136,22 @@
 int
 main ()
 {
-int x = sizeof(&free_pid);
+int x = sizeof(&find_task_by_pid_ns);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_free_pid="Y$cr_cv_ksymtab_free_pid"
+	 cr_cv_ksymtab_find_task_by_pid_ns="Y$cr_cv_ksymtab_find_task_by_pid_ns"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_free_pid="N$cr_cv_ksymtab_free_pid"
+	 cr_cv_ksymtab_find_task_by_pid_ns="N$cr_cv_ksymtab_find_task_by_pid_ns"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -43129,54 +34159,40 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_free_pid"; then
+  if test -z "$cr_cv_ksymtab_find_task_by_pid_ns"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_free_pid" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol free_pid but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol free_pid but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_find_task_by_pid_ns" : N >/dev/null; then
+      as_fn_error $? "Found symbol find_task_by_pid_ns but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_free_pid | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_find_task_by_pid_ns | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(free_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(find_task_by_pid_ns, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_free_pid $cr_addr
+#define CR_KCODE_find_task_by_pid_ns $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pid_hash" >&5
-$as_echo_n "checking kernel symbol table for pid_hash... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pid_hash+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for find_task_by_pid_type" >&5
+$as_echo_n "checking kernel for find_task_by_pid_type... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_pid_hash=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pid_hash$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pid_hash"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pid_hash\$" >/dev/null ; then
-        cr_cv_ksymtab_pid_hash=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pid_hash=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pid_hash';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -43185,11 +34201,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43197,106 +34209,65 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&pid_hash);
+
+   #ifdef find_task_by_pid_type
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&find_task_by_pid_type);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pid_hash="Y$cr_cv_ksymtab_pid_hash"
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pid_hash="N$cr_cv_ksymtab_pid_hash"
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_pid_hash"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_pid_hash" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern struct hlist_head *pid_hash;
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_pid_hash | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(pid_hash, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_FIND_TASK_BY_PID_TYPE 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_pid_hash $cr_addr
-_ACEOF
+     HAVE_FIND_TASK_BY_PID_TYPE=1
+  else
+    $as_echo "#define HAVE_FIND_TASK_BY_PID_TYPE 0" >>confdefs.h
 
+     HAVE_FIND_TASK_BY_PID_TYPE=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pidhash_shift" >&5
-$as_echo_n "checking kernel symbol table for pidhash_shift... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pidhash_shift+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for find_task_by_pid_type_ns" >&5
+$as_echo_n "checking kernel for find_task_by_pid_type_ns... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_pidhash_shift=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pidhash_shift$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pidhash_shift"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pidhash_shift\$" >/dev/null ; then
-        cr_cv_ksymtab_pidhash_shift=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pidhash_shift=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pidhash_shift';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -43305,11 +34276,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43317,92 +34284,163 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&pidhash_shift);
+
+   #ifdef find_task_by_pid_type_ns
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&find_task_by_pid_type_ns);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pidhash_shift="Y$cr_cv_ksymtab_pidhash_shift"
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pidhash_shift="N$cr_cv_ksymtab_pidhash_shift"
+	 cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_pidhash_shift"; then
-    cr_result='not found'
+  cr_result=$cr_cv_kconfig_HAVE_FIND_TASK_BY_PID_TYPE_NS
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_FIND_TASK_BY_PID_TYPE_NS 1" >>confdefs.h
+
+     HAVE_FIND_TASK_BY_PID_TYPE_NS=1
   else
-    if expr "$cr_cv_ksymtab_pidhash_shift" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern int pidhash_shift;
-_EOF
+    $as_echo "#define HAVE_FIND_TASK_BY_PID_TYPE_NS 0" >>confdefs.h
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_pidhash_shift | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(pidhash_shift, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+     HAVE_FIND_TASK_BY_PID_TYPE_NS=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+if test -z "${HAVE_2_ARG_FIND_PID}${HAVE_FIND_TASK_BY_PID}${HAVE_FIND_TASK_BY_PID_NS}"; then
+
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_pidhash_shift $cr_addr
 _ACEOF
 
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+fi
+rm -f confcache
 
-  # Can't use true type because 'struct kmem_cache' is opaque by design
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
 
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to map (type, pid_nr) -> struct task" "$LINENO" 5
 
+fi
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pid_namespace.pid_cachep" >&5
-$as_echo_n "checking kernel for pid_namespace.pid_cachep... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for alloc_pid" >&5
+$as_echo_n "checking kernel for alloc_pid... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_ALLOC_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -43414,11 +34452,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43426,100 +34460,69 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-	#include <linux/slab.h>
-	#include <linux/pid_namespace.h>
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct pid_namespace x;
-          void * tc_1 = x.pid_cachep;
+
+   #ifdef alloc_pid
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&alloc_pid);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP=yes
+	 cr_cv_kconfig_HAVE_ALLOC_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP=no
+	 cr_cv_kconfig_HAVE_ALLOC_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP
+  cr_result=$cr_cv_kconfig_HAVE_ALLOC_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PID_NAMESPACE_PID_CACHEP 1
-_ACEOF
+    $as_echo "#define HAVE_ALLOC_PID 1" >>confdefs.h
 
-     HAVE_PID_NAMESPACE_PID_CACHEP=1
+     HAVE_ALLOC_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PID_NAMESPACE_PID_CACHEP 0
-_ACEOF
+    $as_echo "#define HAVE_ALLOC_PID 0" >>confdefs.h
 
-     HAVE_PID_NAMESPACE_PID_CACHEP=''
+     HAVE_ALLOC_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+if test -n "${HAVE_ALLOC_PID}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pid_cachep" >&5
-$as_echo_n "checking kernel symbol table for pid_cachep... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pid_cachep+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
 
-    cr_cv_ksymtab_pid_cachep=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pid_cachep$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pid_cachep"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pid_cachep\$" >/dev/null ; then
-        cr_cv_ksymtab_pid_cachep=0
-      else
 
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pid_cachep=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pid_cachep';"`
-  fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 0-arg alloc_pid" >&5
+$as_echo_n "checking kernel for 0-arg alloc_pid... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
-      fi
 
 
   SAVE_CC=$CC
@@ -43528,11 +34531,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43540,90 +34539,131 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-int x = sizeof(&pid_cachep);
+
+	#ifndef alloc_pid /* Must be macro or have a decl */
+	  int x = sizeof(&alloc_pid);
+	#endif
+	    alloc_pid();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pid_cachep="Y$cr_cv_ksymtab_pid_cachep"
+	 cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pid_cachep="N$cr_cv_ksymtab_pid_cachep"
+	 cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_pid_cachep"; then
-    cr_result='not found'
+  cr_result=$cr_cv_kconfig_HAVE_0_ARG_ALLOC_PID
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_0_ARG_ALLOC_PID 1" >>confdefs.h
+
+     HAVE_0_ARG_ALLOC_PID=1
   else
-    if expr "$cr_cv_ksymtab_pid_cachep" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+    $as_echo "#define HAVE_0_ARG_ALLOC_PID 0" >>confdefs.h
 
-    #if HAVE_KMEM_CACHE_T
-      extern kmem_cache_t *pid_cachep;
-    #else
-      extern struct kmem_cache *pid_cachep;
-    #endif
+     HAVE_0_ARG_ALLOC_PID=''
+  fi
 
-_EOF
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_pid_cachep | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(pid_cachep, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_pid_cachep $cr_addr
+
+
+
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 1-arg alloc_pid" >&5
+$as_echo_n "checking kernel for 1-arg alloc_pid... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/sched.h>
+int
+main ()
+{
+
+	#ifndef alloc_pid /* Must be macro or have a decl */
+	  int x = sizeof(&alloc_pid);
+	#endif
+	    alloc_pid(NULL);
+  ;
+  return 0;
+}
 _ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID=yes
+else
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+fi
+
+  cr_result=$cr_cv_kconfig_HAVE_1_ARG_ALLOC_PID
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_1_ARG_ALLOC_PID 1" >>confdefs.h
+
+     HAVE_1_ARG_ALLOC_PID=1
+  else
+    $as_echo "#define HAVE_1_ARG_ALLOC_PID 0" >>confdefs.h
 
+     HAVE_1_ARG_ALLOC_PID=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-  if test -z "${cr_addr}${HAVE_PID_NAMESPACE_PID_CACHEP}"; then
+
+
+
+  if test "${HAVE_0_ARG_ALLOC_PID}${HAVE_1_ARG_ALLOC_PID}" != "1"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -43652,13 +34692,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -43666,8 +34706,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -43689,12 +34729,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -43709,32 +34760,29 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine where to find pid_cachep" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine where to find pid_cachep" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to call alloc_pid()" "$LINENO" 5
 
   fi
-  if test -n "${HAVE_LINUX_PSPACE_H}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for init_pspace" >&5
-$as_echo_n "checking kernel symbol table for init_pspace... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for free_pid" >&5
+$as_echo_n "checking kernel symbol table for free_pid... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_init_pspace+set}" = set; then
+    if ${cr_cv_ksymtab_free_pid+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_init_pspace=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}init_pspace$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_init_pspace"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_init_pspace\$" >/dev/null ; then
-        cr_cv_ksymtab_init_pspace=0
+    cr_cv_ksymtab_free_pid=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}free_pid$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_free_pid"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_free_pid\$" >/dev/null ; then
+        cr_cv_ksymtab_free_pid=0
       else
 
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_init_pspace=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_init_pspace';"`
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_free_pid=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_free_pid';"`
   fi
 
       fi
@@ -43746,11 +34794,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43765,43 +34809,22 @@
 int
 main ()
 {
-int x = sizeof(&init_pspace);
+int x = sizeof(&free_pid);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_init_pspace="Y$cr_cv_ksymtab_init_pspace"
+	 cr_cv_ksymtab_free_pid="Y$cr_cv_ksymtab_free_pid"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_init_pspace="N$cr_cv_ksymtab_init_pspace"
+	 cr_cv_ksymtab_free_pid="N$cr_cv_ksymtab_free_pid"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -43809,52 +34832,49 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_init_pspace"; then
+  if test -z "$cr_cv_ksymtab_free_pid"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_init_pspace" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol init_pspace but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol init_pspace but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_free_pid" : N >/dev/null; then
+      as_fn_error $? "Found symbol free_pid but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_init_pspace | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_free_pid | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(init_pspace, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KCODE(free_pid, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_init_pspace $cr_addr
+#define CR_KCODE_free_pid $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-  elif test -n "${HAVE_LINUX_PID_NAMESPACE_H}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for init_pid_ns" >&5
-$as_echo_n "checking kernel symbol table for init_pid_ns... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pid_hash" >&5
+$as_echo_n "checking kernel symbol table for pid_hash... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_init_pid_ns+set}" = set; then
+    if ${cr_cv_ksymtab_pid_hash+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_init_pid_ns=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}init_pid_ns$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_init_pid_ns"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_init_pid_ns\$" >/dev/null ; then
-        cr_cv_ksymtab_init_pid_ns=0
+    cr_cv_ksymtab_pid_hash=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pid_hash$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pid_hash"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pid_hash\$" >/dev/null ; then
+        cr_cv_ksymtab_pid_hash=0
       else
 
   if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_init_pid_ns=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_init_pid_ns';"`
+    cr_cv_ksymtab_pid_hash=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pid_hash';"`
   fi
 
       fi
@@ -43866,11 +34886,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43885,43 +34901,22 @@
 int
 main ()
 {
-int x = sizeof(&init_pid_ns);
+int x = sizeof(&pid_hash);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_init_pid_ns="Y$cr_cv_ksymtab_init_pid_ns"
+	 cr_cv_ksymtab_pid_hash="Y$cr_cv_ksymtab_pid_hash"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_init_pid_ns="N$cr_cv_ksymtab_init_pid_ns"
+	 cr_cv_ksymtab_pid_hash="N$cr_cv_ksymtab_pid_hash"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -43929,45 +34924,55 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_init_pid_ns"; then
+  if test -z "$cr_cv_ksymtab_pid_hash"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_init_pid_ns" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol init_pid_ns but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol init_pid_ns but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+    if expr "$cr_cv_ksymtab_pid_hash" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern struct hlist_head *pid_hash;
+_EOF
+
     fi
-    cr_result=`echo $cr_cv_ksymtab_init_pid_ns | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_pid_hash | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(init_pid_ns, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KDATA(pid_hash, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_init_pid_ns $cr_addr
+#define CR_KDATA_pid_hash $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-  fi
-fi
-
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.0 attach_pid" >&5
-$as_echo_n "checking kernel for 2.6.0 attach_pid... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pidhash_shift" >&5
+$as_echo_n "checking kernel symbol table for pidhash_shift... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_pidhash_shift+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_pidhash_shift=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pidhash_shift$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pidhash_shift"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pidhash_shift\$" >/dev/null ; then
+        cr_cv_ksymtab_pidhash_shift=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_pidhash_shift=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pidhash_shift';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -43976,11 +34981,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -43988,83 +34989,70 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
-	 #include <linux/pid.h>
-   extern int FASTCALL(attach_pid(struct task_struct *task, enum pid_type type, int nr));
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-int x = sizeof(&attach_pid)
+int x = sizeof(&pidhash_shift);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID=yes
+	 cr_cv_ksymtab_pidhash_shift="Y$cr_cv_ksymtab_pidhash_shift"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID=no
+	 cr_cv_ksymtab_pidhash_shift="N$cr_cv_ksymtab_pidhash_shift"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_pidhash_shift"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_pidhash_shift" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern int pidhash_shift;
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_0_ATTACH_PID 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_pidhash_shift | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(pidhash_shift, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_2_6_0_ATTACH_PID=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_0_ATTACH_PID 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_pidhash_shift $cr_addr
 _ACEOF
 
-     HAVE_2_6_0_ATTACH_PID=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+  # Can't use true type because 'struct kmem_cache' is opaque by design
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pid_namespace.pid_cachep" >&5
+$as_echo_n "checking kernel for pid_namespace.pid_cachep... " >&6; }
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.22 attach_pid" >&5
-$as_echo_n "checking kernel for 2.6.22 attach_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -44076,11 +35064,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44088,72 +35072,49 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
-	 #include <linux/pid.h>
-   extern int FASTCALL(attach_pid(struct task_struct *task, enum pid_type type, struct pid *pid));
+
+	#include <linux/slab.h>
+	#include <linux/pid_namespace.h>
+
 int
 main ()
 {
-int x = sizeof(&attach_pid)
+struct pid_namespace x;
+          void * tc_1 = x.pid_cachep;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID=yes
+	 cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID=no
+	 cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID
+  cr_result=$cr_cv_kconfig_HAVE_PID_NAMESPACE_PID_CACHEP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_22_ATTACH_PID 1
-_ACEOF
+    $as_echo "#define HAVE_PID_NAMESPACE_PID_CACHEP 1" >>confdefs.h
 
-     HAVE_2_6_22_ATTACH_PID=1
+     HAVE_PID_NAMESPACE_PID_CACHEP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_22_ATTACH_PID 0
-_ACEOF
+    $as_echo "#define HAVE_PID_NAMESPACE_PID_CACHEP 0" >>confdefs.h
 
-     HAVE_2_6_22_ATTACH_PID=''
+     HAVE_PID_NAMESPACE_PID_CACHEP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -44161,13 +35122,25 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.26 attach_pid" >&5
-$as_echo_n "checking kernel for 2.6.26 attach_pid... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pid_cachep" >&5
+$as_echo_n "checking kernel symbol table for pid_cachep... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_pid_cachep+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_pid_cachep=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pid_cachep$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pid_cachep"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pid_cachep\$" >/dev/null ; then
+        cr_cv_ksymtab_pid_cachep=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_pid_cachep=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pid_cachep';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -44176,11 +35149,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44188,78 +35157,69 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/sched.h>
-	 #include <linux/pid.h>
-   extern void attach_pid(struct task_struct *task, enum pid_type type, struct pid *pid);
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-int x = sizeof(&attach_pid)
+int x = sizeof(&pid_cachep);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID=yes
+	 cr_cv_ksymtab_pid_cachep="Y$cr_cv_ksymtab_pid_cachep"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID=no
+	 cr_cv_ksymtab_pid_cachep="N$cr_cv_ksymtab_pid_cachep"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_26_ATTACH_PID 1
-_ACEOF
-
-     HAVE_2_6_26_ATTACH_PID=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_pid_cachep"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_26_ATTACH_PID 0
-_ACEOF
+    if expr "$cr_cv_ksymtab_pid_cachep" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
 
-     HAVE_2_6_26_ATTACH_PID=''
-  fi
+    #if HAVE_KMEM_CACHE_T
+      extern kmem_cache_t *pid_cachep;
+    #else
+      extern struct kmem_cache *pid_cachep;
+    #endif
 
+_EOF
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
+    fi
+    cr_result=`echo $cr_cv_ksymtab_pid_cachep | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(pid_cachep, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_pid_cachep $cr_addr
+_ACEOF
 
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
-# Require exactly one match
-if test "${HAVE_2_6_0_ATTACH_PID}${HAVE_2_6_22_ATTACH_PID}${HAVE_2_6_26_ATTACH_PID}" != "1"; then
+  if test -z "${cr_addr}${HAVE_PID_NAMESPACE_PID_CACHEP}"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -44288,13 +35248,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -44302,8 +35262,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -44325,12 +35285,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -44345,132 +35316,33 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to call attach_pid()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to call attach_pid()" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
-
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine where to find pid_cachep" "$LINENO" 5
 
+  fi
+  if test -n "${HAVE_LINUX_PSPACE_H}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for change_pid" >&5
-$as_echo_n "checking kernel for change_pid... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_CHANGE_PID+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for init_pspace" >&5
+$as_echo_n "checking kernel symbol table for init_pspace... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_init_pspace+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_init_pspace=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}init_pspace$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_init_pspace"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_init_pspace\$" >/dev/null ; then
+        cr_cv_ksymtab_init_pspace=0
+      else
 
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-
-	#include <linux/sched.h>
-	#include <linux/pid.h>
-int
-main ()
-{
-
-   #ifdef change_pid
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&change_pid);
-   #endif
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CHANGE_PID=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CHANGE_PID=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_CHANGE_PID
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CHANGE_PID 1
-_ACEOF
-
-     HAVE_CHANGE_PID=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CHANGE_PID 0
-_ACEOF
-
-     HAVE_CHANGE_PID=''
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_init_pspace=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_init_pspace';"`
   fi
 
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-# OK if missing
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for struct pidmap" >&5
-$as_echo_n "checking kernel for struct pidmap... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_STRUCT_PIDMAP+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
+      fi
 
 
   SAVE_CC=$CC
@@ -44479,11 +35351,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44492,102 +35360,79 @@
 		 #endif
 		 #include <linux/types.h>
 
-  #if HAVE_LINUX_PSPACE_H
-    #include <linux/pspace.h>
-  #endif
-  #if HAVE_LINUX_PID_NAMESPACE_H
-    #include <linux/pid_namespace.h>
-  #endif
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
 
 int
 main ()
 {
-
-     struct pidmap y;
-     int x = sizeof(y);
-
+int x = sizeof(&init_pspace);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_PIDMAP=yes
+	 cr_cv_ksymtab_init_pspace="Y$cr_cv_ksymtab_init_pspace"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_STRUCT_PIDMAP=no
+	 cr_cv_ksymtab_init_pspace="N$cr_cv_ksymtab_init_pspace"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_STRUCT_PIDMAP
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_PIDMAP 1
-_ACEOF
-
-     HAVE_STRUCT_PIDMAP=1
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_init_pspace"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_STRUCT_PIDMAP 0
+    if expr "$cr_cv_ksymtab_init_pspace" : N >/dev/null; then
+      as_fn_error $? "Found symbol init_pspace but no declaration -- please file a bug report." "$LINENO" 5
+    fi
+    cr_result=`echo $cr_cv_ksymtab_init_pspace | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(init_pspace, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_init_pspace $cr_addr
 _ACEOF
 
-     HAVE_STRUCT_PIDMAP=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+  elif test -n "${HAVE_LINUX_PID_NAMESPACE_H}"; then
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pidmap_array" >&5
-$as_echo_n "checking kernel symbol table for pidmap_array... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for init_pid_ns" >&5
+$as_echo_n "checking kernel symbol table for init_pid_ns... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pidmap_array+set}" = set; then
+    if ${cr_cv_ksymtab_init_pid_ns+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_pidmap_array=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pidmap_array$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pidmap_array"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pidmap_array\$" >/dev/null ; then
-        cr_cv_ksymtab_pidmap_array=0
+    cr_cv_ksymtab_init_pid_ns=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}init_pid_ns$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_init_pid_ns"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_init_pid_ns\$" >/dev/null ; then
+        cr_cv_ksymtab_init_pid_ns=0
       else
 
   if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pidmap_array=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pidmap_array';"`
+    cr_cv_ksymtab_init_pid_ns=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_init_pid_ns';"`
   fi
 
       fi
@@ -44599,11 +35444,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44618,43 +35459,22 @@
 int
 main ()
 {
-int x = sizeof(&pidmap_array);
+int x = sizeof(&init_pid_ns);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pidmap_array="Y$cr_cv_ksymtab_pidmap_array"
+	 cr_cv_ksymtab_init_pid_ns="Y$cr_cv_ksymtab_init_pid_ns"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pidmap_array="N$cr_cv_ksymtab_pidmap_array"
+	 cr_cv_ksymtab_init_pid_ns="N$cr_cv_ksymtab_init_pid_ns"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -44662,64 +35482,42 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_pidmap_array"; then
+  if test -z "$cr_cv_ksymtab_init_pid_ns"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_pidmap_array" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-
-  #if !HAVE_STRUCT_PIDMAP
-    struct pidmap {
-        atomic_t nr_free;
-        void *page;
-    };
-  #endif
-  extern struct pidmap pidmap_array[];
-
-_EOF
-
+    if expr "$cr_cv_ksymtab_init_pid_ns" : N >/dev/null; then
+      as_fn_error $? "Found symbol init_pid_ns but no declaration -- please file a bug report." "$LINENO" 5
     fi
-    cr_result=`echo $cr_cv_ksymtab_pidmap_array | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_init_pid_ns | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(pidmap_array, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KDATA(init_pid_ns, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_pidmap_array $cr_addr
+#define CR_KDATA_init_pid_ns $cr_addr
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-if test x"$cr_kernel_smp" = xyes; then
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pidmap_lock" >&5
-$as_echo_n "checking kernel symbol table for pidmap_lock... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pidmap_lock+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-    cr_cv_ksymtab_pidmap_lock=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pidmap_lock$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pidmap_lock"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pidmap_lock\$" >/dev/null ; then
-        cr_cv_ksymtab_pidmap_lock=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pidmap_lock=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pidmap_lock';"`
   fi
+fi
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.0 attach_pid" >&5
+$as_echo_n "checking kernel for 2.6.0 attach_pid... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
 
-      fi
 
 
   SAVE_CC=$CC
@@ -44728,11 +35526,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44740,98 +35534,57 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/sched.h>
+	 #include <linux/pid.h>
+   extern int FASTCALL(attach_pid(struct task_struct *task, enum pid_type type, int nr));
 int
 main ()
 {
-int x = sizeof(&pidmap_lock);
+int x = sizeof(&attach_pid)
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pidmap_lock="Y$cr_cv_ksymtab_pidmap_lock"
+	 cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pidmap_lock="N$cr_cv_ksymtab_pidmap_lock"
+	 cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_pidmap_lock"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_pidmap_lock" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern spinlock_t pidmap_lock;
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_2_6_0_ATTACH_PID
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_pidmap_lock | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(pidmap_lock, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_2_6_0_ATTACH_PID 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_pidmap_lock $cr_addr
-_ACEOF
+     HAVE_2_6_0_ATTACH_PID=1
+  else
+    $as_echo "#define HAVE_2_6_0_ATTACH_PID 0" >>confdefs.h
 
+     HAVE_2_6_0_ATTACH_PID=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
 
-  if test -z "$cr_addr"; then
-    { { $as_echo "$as_me:$LINENO: error: failed to find symbol pidmap_lock" >&5
-$as_echo "$as_me: error: failed to find symbol pidmap_lock" >&2;}
-   { (exit 1); exit 1; }; }
-  fi
-fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for kill_pid" >&5
-$as_echo_n "checking kernel for kill_pid... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.22 attach_pid" >&5
+$as_echo_n "checking kernel for 2.6.22 attach_pid... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_KILL_PID+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -44843,11 +35596,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44856,87 +35605,56 @@
 		 #endif
 		 #include <linux/types.h>
 		 #include <linux/sched.h>
+	 #include <linux/pid.h>
+   extern int FASTCALL(attach_pid(struct task_struct *task, enum pid_type type, struct pid *pid));
 int
 main ()
 {
-
-   #ifdef kill_pid
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&kill_pid);
-   #endif
-
+int x = sizeof(&attach_pid)
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KILL_PID=yes
+	 cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KILL_PID=no
+	 cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_KILL_PID
+  cr_result=$cr_cv_kconfig_HAVE_2_6_22_ATTACH_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KILL_PID 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_22_ATTACH_PID 1" >>confdefs.h
 
-     HAVE_KILL_PID=1
+     HAVE_2_6_22_ATTACH_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KILL_PID 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_22_ATTACH_PID 0" >>confdefs.h
 
-     HAVE_KILL_PID=''
+     HAVE_2_6_22_ATTACH_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.26 attach_pid" >&5
+$as_echo_n "checking kernel for 2.6.26 attach_pid... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for kill_proc" >&5
-$as_echo_n "checking kernel for kill_proc... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_KILL_PROC+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -44948,11 +35666,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -44961,81 +35675,52 @@
 		 #endif
 		 #include <linux/types.h>
 		 #include <linux/sched.h>
+	 #include <linux/pid.h>
+   extern void attach_pid(struct task_struct *task, enum pid_type type, struct pid *pid);
 int
 main ()
 {
-
-   #ifdef kill_proc
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&kill_proc);
-   #endif
-
+int x = sizeof(&attach_pid)
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KILL_PROC=yes
+	 cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KILL_PROC=no
+	 cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_KILL_PROC
+  cr_result=$cr_cv_kconfig_HAVE_2_6_26_ATTACH_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KILL_PROC 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_26_ATTACH_PID 1" >>confdefs.h
 
-     HAVE_KILL_PROC=1
+     HAVE_2_6_26_ATTACH_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KILL_PROC 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_26_ATTACH_PID 0" >>confdefs.h
 
-     HAVE_KILL_PROC=''
+     HAVE_2_6_26_ATTACH_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# Require at least one
-if test -z "${HAVE_KILL_PID}${HAVE_KILL_PROC}"; then
+
+# Require exactly one match
+if test "${HAVE_2_6_0_ATTACH_PID}${HAVE_2_6_22_ATTACH_PID}${HAVE_2_6_26_ATTACH_PID}" != "1"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -45064,13 +35749,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -45078,8 +35763,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -45101,12 +35786,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -45121,20 +35817,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to find kill_pid() or kill_proc()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to find kill_pid() or kill_proc()" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to call attach_pid()" "$LINENO" 5
 
 fi
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for change_pid" >&5
+$as_echo_n "checking kernel for change_pid... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for child_reaper" >&5
-$as_echo_n "checking kernel for child_reaper... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_CHILD_REAPER+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CHANGE_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -45146,11 +35839,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -45158,88 +35847,66 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/pid_namespace.h>
+
+	#include <linux/sched.h>
+	#include <linux/pid.h>
 int
 main ()
 {
 
-   #ifdef child_reaper
+   #ifdef change_pid
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&child_reaper);
+     int x = sizeof(&change_pid);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CHILD_REAPER=yes
+	 cr_cv_kconfig_HAVE_CHANGE_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_CHILD_REAPER=no
+	 cr_cv_kconfig_HAVE_CHANGE_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_CHILD_REAPER
+  cr_result=$cr_cv_kconfig_HAVE_CHANGE_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CHILD_REAPER 1
-_ACEOF
+    $as_echo "#define HAVE_CHANGE_PID 1" >>confdefs.h
 
-     HAVE_CHILD_REAPER=1
+     HAVE_CHANGE_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CHILD_REAPER 0
-_ACEOF
+    $as_echo "#define HAVE_CHANGE_PID 0" >>confdefs.h
 
-     HAVE_CHILD_REAPER=''
+     HAVE_CHANGE_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# OK if missing
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for task_child_reaper" >&5
-$as_echo_n "checking kernel for task_child_reaper... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for struct pidmap" >&5
+$as_echo_n "checking kernel for struct pidmap... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_CHILD_REAPER+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_STRUCT_PIDMAP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -45251,11 +35918,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -45263,101 +35926,78 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/pid_namespace.h>
+
+  #if HAVE_LINUX_PSPACE_H
+    #include <linux/pspace.h>
+  #endif
+  #if HAVE_LINUX_PID_NAMESPACE_H
+    #include <linux/pid_namespace.h>
+  #endif
+
 int
 main ()
 {
 
-   #ifdef task_child_reaper
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&task_child_reaper);
-   #endif
+     struct pidmap y;
+     int x = sizeof(y);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_CHILD_REAPER=yes
+	 cr_cv_kconfig_HAVE_STRUCT_PIDMAP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_CHILD_REAPER=no
+	 cr_cv_kconfig_HAVE_STRUCT_PIDMAP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_TASK_CHILD_REAPER
+  cr_result=$cr_cv_kconfig_HAVE_STRUCT_PIDMAP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_CHILD_REAPER 1
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_PIDMAP 1" >>confdefs.h
 
-     HAVE_TASK_CHILD_REAPER=1
+     HAVE_STRUCT_PIDMAP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_CHILD_REAPER 0
-_ACEOF
+    $as_echo "#define HAVE_STRUCT_PIDMAP 0" >>confdefs.h
 
-     HAVE_TASK_CHILD_REAPER=''
+     HAVE_STRUCT_PIDMAP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test -z "${HAVE_CHILD_REAPER}${HAVE_TASK_CHILD_REAPER}"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for child_reaper" >&5
-$as_echo_n "checking kernel symbol table for child_reaper... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pidmap_array" >&5
+$as_echo_n "checking kernel symbol table for pidmap_array... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_child_reaper+set}" = set; then
+    if ${cr_cv_ksymtab_pidmap_array+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_child_reaper=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}child_reaper$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_child_reaper"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_child_reaper\$" >/dev/null ; then
-        cr_cv_ksymtab_child_reaper=0
+    cr_cv_ksymtab_pidmap_array=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pidmap_array$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pidmap_array"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pidmap_array\$" >/dev/null ; then
+        cr_cv_ksymtab_pidmap_array=0
       else
 
   if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_child_reaper=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_child_reaper';"`
+    cr_cv_ksymtab_pidmap_array=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pidmap_array';"`
   fi
 
       fi
@@ -45369,11 +36009,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -45388,43 +36024,22 @@
 int
 main ()
 {
-int x = sizeof(&child_reaper);
+int x = sizeof(&pidmap_array);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_child_reaper="Y$cr_cv_ksymtab_child_reaper"
+	 cr_cv_ksymtab_pidmap_array="Y$cr_cv_ksymtab_pidmap_array"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_child_reaper="N$cr_cv_ksymtab_child_reaper"
+	 cr_cv_ksymtab_pidmap_array="N$cr_cv_ksymtab_pidmap_array"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -45432,242 +36047,64 @@
 fi
 
   cr_addr=''
-  if test -z "$cr_cv_ksymtab_child_reaper"; then
+  if test -z "$cr_cv_ksymtab_pidmap_array"; then
     cr_result='not found'
   else
-    if expr "$cr_cv_ksymtab_child_reaper" : N >/dev/null; then
+    if expr "$cr_cv_ksymtab_pidmap_array" : N >/dev/null; then
       cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern struct task_struct *child_reaper;
+
+  #if !HAVE_STRUCT_PIDMAP
+    struct pidmap {
+        atomic_t nr_free;
+        void *page;
+    };
+  #endif
+  extern struct pidmap pidmap_array[];
+
 _EOF
 
     fi
-    cr_result=`echo $cr_cv_ksymtab_child_reaper | tr -d 'YN'`
+    cr_result=`echo $cr_cv_ksymtab_pidmap_array | tr -d 'YN'`
     if test $cr_result = 0; then
       cr_result=exported
       cr_addr=0
     else
       cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(child_reaper, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+      echo "_CR_IMPORT_KDATA(pidmap_array, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
     fi
 
 cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_child_reaper $cr_addr
-_ACEOF
-
-  fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-fi
-
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for task.parent" >&5
-$as_echo_n "checking kernel for task.parent... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_TASK_PARENT+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
-
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-		 #include <linux/sched.h>
-int
-main ()
-{
-struct task_struct x;
-          struct task_struct  tc_1 = *(x.parent);
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_PARENT=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_PARENT=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_TASK_PARENT
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PARENT 1
-_ACEOF
-
-     HAVE_TASK_PARENT=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PARENT 0
+#define CR_KDATA_pidmap_array $cr_addr
 _ACEOF
 
-     HAVE_TASK_PARENT=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
+if test x"$cr_kernel_smp" = xyes; then
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for task.real_parent" >&5
-$as_echo_n "checking kernel for task.real_parent... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_TASK_REAL_PARENT+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pidmap_lock" >&5
+$as_echo_n "checking kernel symbol table for pidmap_lock... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_pidmap_lock+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_pidmap_lock=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}pidmap_lock$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pidmap_lock"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pidmap_lock\$" >/dev/null ; then
+        cr_cv_ksymtab_pidmap_lock=0
+      else
 
-
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-		 #include <linux/sched.h>
-int
-main ()
-{
-struct task_struct x;
-          struct task_struct  tc_1 = *(x.real_parent);
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_REAL_PARENT=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_TASK_REAL_PARENT=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_TASK_REAL_PARENT
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_REAL_PARENT 1
-_ACEOF
-
-     HAVE_TASK_REAL_PARENT=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_REAL_PARENT 0
-_ACEOF
-
-     HAVE_TASK_REAL_PARENT=''
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_pidmap_lock=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pidmap_lock';"`
   fi
 
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
-
-
-# Look for non-deprecated "typedef struct SOMETHING kmem_cache_t".
-# This is slightly complicated by the fact that this is an opaque type (with
-# the struct itself forward-declared but not defined in the public headers).
-{ $as_echo "$as_me:$LINENO: checking kernel for kmem_cache_t" >&5
-$as_echo_n "checking kernel for kmem_cache_t... " >&6; }
-if test "${cr_cv_kconfig_HAVE_KMEM_CACHE_T+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-
+      fi
 
 
   SAVE_CC=$CC
@@ -45676,61 +36113,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-		 #include <linux/kernel.h>
-		 #ifndef FASTCALL
-		   #define FASTCALL(_decl) _decl
-		 #endif
-		 #include <linux/types.h>
-		 #include <linux/slab.h>
-int
-main ()
-{
-kmem_cache_t *x = NULL;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-
-
-
-
-  SAVE_CPP=$CPP
-  SAVE_CPPFLAGS=$CPPFLAGS
-  CPP="$KCC -E"
-  CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -45738,64 +36121,74 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/slab.h>
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "typedef.+[[:space:]]kmem_cache_t[[:space:]].+deprecated" >/dev/null 2>&1; then
-  CPP=$SAVE_CPP
-	CPPFLAGS=$SAVE_CPPFLAGS
-	cr_cv_kconfig_HAVE_KMEM_CACHE_T=no
-else
-  CPP=$SAVE_CPP
-	CPPFLAGS=$SAVE_CPPFLAGS
-	cr_cv_kconfig_HAVE_KMEM_CACHE_T=yes
-fi
-rm -f conftest*
 
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
 
- # Want *not* found
-
+int
+main ()
+{
+int x = sizeof(&pidmap_lock);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_pidmap_lock="Y$cr_cv_ksymtab_pidmap_lock"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KMEM_CACHE_T=no
+	 cr_cv_ksymtab_pidmap_lock="N$cr_cv_ksymtab_pidmap_lock"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_kconfig_HAVE_KMEM_CACHE_T" >&5
-$as_echo "$cr_cv_kconfig_HAVE_KMEM_CACHE_T" >&6; }
-
-  if test x$cr_cv_kconfig_HAVE_KMEM_CACHE_T = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KMEM_CACHE_T 1
-_ACEOF
 
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_pidmap_lock"; then
+    cr_result='not found'
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KMEM_CACHE_T 0
-_ACEOF
-
-  fi
+    if expr "$cr_cv_ksymtab_pidmap_lock" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern spinlock_t pidmap_lock;
+_EOF
 
+    fi
+    cr_result=`echo $cr_cv_ksymtab_pidmap_lock | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(pidmap_lock, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_pidmap_lock $cr_addr
+_ACEOF
 
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
-# type of (struct fs_struct).lock
+  if test -z "$cr_addr"; then
+    as_fn_error $? "failed to find symbol pidmap_lock" "$LINENO" 5
+  fi
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for fs_struct rwlock" >&5
-$as_echo_n "checking kernel for fs_struct rwlock... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kill_pid" >&5
+$as_echo_n "checking kernel for kill_pid... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_KILL_PID+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -45807,11 +36200,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -45819,85 +36208,62 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/fs_struct.h>
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct fs_struct x;
-          rwlock_t tc_1 = x.lock;
+
+   #ifdef kill_pid
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&kill_pid);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK=yes
+	 cr_cv_kconfig_HAVE_KILL_PID=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK=no
+	 cr_cv_kconfig_HAVE_KILL_PID=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK
+  cr_result=$cr_cv_kconfig_HAVE_KILL_PID
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FS_STRUCT_RWLOCK 1
-_ACEOF
+    $as_echo "#define HAVE_KILL_PID 1" >>confdefs.h
 
-     HAVE_FS_STRUCT_RWLOCK=1
+     HAVE_KILL_PID=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FS_STRUCT_RWLOCK 0
-_ACEOF
+    $as_echo "#define HAVE_KILL_PID 0" >>confdefs.h
 
-     HAVE_FS_STRUCT_RWLOCK=''
+     HAVE_KILL_PID=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kill_proc" >&5
+$as_echo_n "checking kernel for kill_proc... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for fs_struct spinlock" >&5
-$as_echo_n "checking kernel for fs_struct spinlock... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_KILL_PROC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -45909,11 +36275,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -45921,79 +36283,57 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/fs_struct.h>
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct fs_struct x;
-          spinlock_t tc_1 = x.lock;
+
+   #ifdef kill_proc
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&kill_proc);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK=yes
+	 cr_cv_kconfig_HAVE_KILL_PROC=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK=no
+	 cr_cv_kconfig_HAVE_KILL_PROC=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK
+  cr_result=$cr_cv_kconfig_HAVE_KILL_PROC
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FS_STRUCT_SPINLOCK 1
-_ACEOF
+    $as_echo "#define HAVE_KILL_PROC 1" >>confdefs.h
 
-     HAVE_FS_STRUCT_SPINLOCK=1
+     HAVE_KILL_PROC=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FS_STRUCT_SPINLOCK 0
-_ACEOF
+    $as_echo "#define HAVE_KILL_PROC 0" >>confdefs.h
 
-     HAVE_FS_STRUCT_SPINLOCK=''
+     HAVE_KILL_PROC=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test "$HAVE_FS_STRUCT_RWLOCK$HAVE_FS_STRUCT_SPINLOCK" = "11" \
-     -o "$HAVE_FS_STRUCT_RWLOCK$HAVE_FS_STRUCT_SPINLOCK" = "00" ; then
+# Require at least one
+if test -z "${HAVE_KILL_PID}${HAVE_KILL_PROC}"; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -46022,13 +36362,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -46036,8 +36376,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -46059,12 +36399,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -46079,20 +36430,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unrecognized type for fs_struct.lock" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unrecognized type for fs_struct.lock" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to find kill_pid() or kill_proc()" "$LINENO" 5
 
 fi
 
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for child_reaper" >&5
+$as_echo_n "checking kernel for child_reaper... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel for gfp_t" >&5
-$as_echo_n "checking kernel for gfp_t... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_GFP_T+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CHILD_REAPER+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46104,11 +36452,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46116,85 +36460,62 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/slab.h>
+		 #include <linux/pid_namespace.h>
 int
 main ()
 {
 
-     gfp_t y;
-     int x = sizeof(y);
+   #ifdef child_reaper
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&child_reaper);
+   #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_GFP_T=yes
+	 cr_cv_kconfig_HAVE_CHILD_REAPER=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_GFP_T=no
+	 cr_cv_kconfig_HAVE_CHILD_REAPER=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_GFP_T
+  cr_result=$cr_cv_kconfig_HAVE_CHILD_REAPER
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_GFP_T 1
-_ACEOF
+    $as_echo "#define HAVE_CHILD_REAPER 1" >>confdefs.h
 
-     HAVE_GFP_T=1
+     HAVE_CHILD_REAPER=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_GFP_T 0
-_ACEOF
+    $as_echo "#define HAVE_CHILD_REAPER 0" >>confdefs.h
 
-     HAVE_GFP_T=''
+     HAVE_CHILD_REAPER=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# OK if missing
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for kzalloc" >&5
-$as_echo_n "checking kernel for kzalloc... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task_child_reaper" >&5
+$as_echo_n "checking kernel for task_child_reaper... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_KZALLOC+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_CHILD_REAPER+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46206,11 +36527,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46218,92 +36535,79 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/slab.h>
+		 #include <linux/pid_namespace.h>
 int
 main ()
 {
 
-   #ifdef kzalloc
+   #ifdef task_child_reaper
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&kzalloc);
+     int x = sizeof(&task_child_reaper);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KZALLOC=yes
+	 cr_cv_kconfig_HAVE_TASK_CHILD_REAPER=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KZALLOC=no
+	 cr_cv_kconfig_HAVE_TASK_CHILD_REAPER=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_KZALLOC
+  cr_result=$cr_cv_kconfig_HAVE_TASK_CHILD_REAPER
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KZALLOC 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_CHILD_REAPER 1" >>confdefs.h
 
-     HAVE_KZALLOC=1
+     HAVE_TASK_CHILD_REAPER=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KZALLOC 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_CHILD_REAPER 0" >>confdefs.h
 
-     HAVE_KZALLOC=''
+     HAVE_TASK_CHILD_REAPER=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# OK if missing
-
+if test -z "${HAVE_CHILD_REAPER}${HAVE_TASK_CHILD_REAPER}"; then
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for kmem_cache_zalloc" >&5
-$as_echo_n "checking kernel for kmem_cache_zalloc... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for child_reaper" >&5
+$as_echo_n "checking kernel symbol table for child_reaper... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_child_reaper+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
+    cr_cv_ksymtab_child_reaper=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}child_reaper$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_child_reaper"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_child_reaper\$" >/dev/null ; then
+        cr_cv_ksymtab_child_reaper=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_child_reaper=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_child_reaper';"`
+  fi
+
+      fi
 
 
   SAVE_CC=$CC
@@ -46312,11 +36616,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46324,89 +36624,71 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/slab.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-   #ifdef kmem_cache_zalloc
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&kmem_cache_zalloc);
-   #endif
-
+int x = sizeof(&child_reaper);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC=yes
+	 cr_cv_ksymtab_child_reaper="Y$cr_cv_ksymtab_child_reaper"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC=no
+	 cr_cv_ksymtab_child_reaper="N$cr_cv_ksymtab_child_reaper"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
+    fi
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_child_reaper"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_child_reaper" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern struct task_struct *child_reaper;
+_EOF
 
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KMEM_CACHE_ZALLOC 1
-_ACEOF
+    fi
+    cr_result=`echo $cr_cv_ksymtab_child_reaper | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(child_reaper, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
 
-     HAVE_KMEM_CACHE_ZALLOC=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KMEM_CACHE_ZALLOC 0
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_child_reaper $cr_addr
 _ACEOF
 
-     HAVE_KMEM_CACHE_ZALLOC=''
   fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-
-# OK if missing
+fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for kmemdup" >&5
-$as_echo_n "checking kernel for kmemdup... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.parent" >&5
+$as_echo_n "checking kernel for task.parent... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_KMEMDUP+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_PARENT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46418,11 +36700,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46430,90 +36708,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/string.h>
+		 #include <linux/sched.h>
 int
 main ()
 {
-
-   #ifdef kmemdup
-     /* OK, it exists and is a macro */
-   #else
-     /* Check for function case */
-     int x = sizeof(&kmemdup);
-   #endif
-
+struct task_struct x;
+          struct task_struct  tc_1 = *(x.parent);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KMEMDUP=yes
+	 cr_cv_kconfig_HAVE_TASK_PARENT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_KMEMDUP=no
+	 cr_cv_kconfig_HAVE_TASK_PARENT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_KMEMDUP
+  cr_result=$cr_cv_kconfig_HAVE_TASK_PARENT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KMEMDUP 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_PARENT 1" >>confdefs.h
 
-     HAVE_KMEMDUP=1
+     HAVE_TASK_PARENT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_KMEMDUP 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_PARENT 0" >>confdefs.h
 
-     HAVE_KMEMDUP=''
+     HAVE_TASK_PARENT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# OK if missing
-
-
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pipe_inode_info.base" >&5
-$as_echo_n "checking kernel for pipe_inode_info.base... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.real_parent" >&5
+$as_echo_n "checking kernel for task.real_parent... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_REAL_PARENT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46525,11 +36769,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46537,86 +36777,56 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/pipe_fs_i.h>
-
+		 #include <linux/sched.h>
 int
 main ()
 {
-struct pipe_inode_info x;
-          char tc_1 = *(x.base);
+struct task_struct x;
+          struct task_struct  tc_1 = *(x.real_parent);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE=yes
+	 cr_cv_kconfig_HAVE_TASK_REAL_PARENT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE=no
+	 cr_cv_kconfig_HAVE_TASK_REAL_PARENT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE
+  cr_result=$cr_cv_kconfig_HAVE_TASK_REAL_PARENT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_INODE_INFO_BASE 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_REAL_PARENT 1" >>confdefs.h
 
-     HAVE_PIPE_INODE_INFO_BASE=1
+     HAVE_TASK_REAL_PARENT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_INODE_INFO_BASE 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_REAL_PARENT 0" >>confdefs.h
 
-     HAVE_PIPE_INODE_INFO_BASE=''
+     HAVE_TASK_REAL_PARENT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-# OK if missing.
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for pipe_inode_info.buffers" >&5
-$as_echo_n "checking kernel for pipe_inode_info.buffers... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS+set}" = set; then
+# Look for non-deprecated "typedef struct SOMETHING kmem_cache_t".
+# This is slightly complicated by the fact that this is an opaque type (with
+# the struct itself forward-declared but not defined in the public headers).
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kmem_cache_t" >&5
+$as_echo_n "checking kernel for kmem_cache_t... " >&6; }
+if ${cr_cv_kconfig_HAVE_KMEM_CACHE_T+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46628,11 +36838,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46640,102 +36846,28 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/wait.h>
-    #include <linux/pipe_fs_i.h>
-
+		 #include <linux/slab.h>
 int
 main ()
 {
-struct pipe_inode_info x;
-          unsigned int tc_1 = x.buffers;
+kmem_cache_t *x = NULL;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-
-fi
-
-  cr_result=$cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_INODE_INFO_BUFFERS 1
-_ACEOF
-
-     HAVE_PIPE_INODE_INFO_BUFFERS=1
-  else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_INODE_INFO_BUFFERS 0
-_ACEOF
-
-     HAVE_PIPE_INODE_INFO_BUFFERS=''
-  fi
-
-
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
 
-# OK if missing.
-
-
-
-
-  { $as_echo "$as_me:$LINENO: checking kernel for pipe_buf_operations.pin" >&5
-$as_echo_n "checking kernel for pipe_buf_operations.pin... " >&6; }
-
-    if test "${cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
 
 
 
-  SAVE_CC=$CC
-  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPP=$CPP
   SAVE_CPPFLAGS=$CPPFLAGS
-  CC=$KCC
-  CFLAGS=""
+  CPP="$KCC -E"
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46743,85 +36875,54 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/pipe_fs_i.h>
-
-int
-main ()
-{
-struct pipe_buf_operations x;
-          x.pin;
-  ;
-  return 0;
-}
+		 #include <linux/slab.h>
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  CC=$SAVE_CC
-	 CFLAGS=$SAVE_CFLAGS
-	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN=yes
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "typedef.+[[:space:]]kmem_cache_t[[:space:]].+deprecated" >/dev/null 2>&1; then :
+  CPP=$SAVE_CPP
+	CPPFLAGS=$SAVE_CPPFLAGS
+	cr_cv_kconfig_HAVE_KMEM_CACHE_T=no
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CPP=$SAVE_CPP
+	CPPFLAGS=$SAVE_CPPFLAGS
+	cr_cv_kconfig_HAVE_KMEM_CACHE_T=yes
+fi
+rm -f conftest*
 
-	CC=$SAVE_CC
+
+ # Want *not* found
+
+else
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN=no
+	 cr_cv_kconfig_HAVE_KMEM_CACHE_T=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_kconfig_HAVE_KMEM_CACHE_T" >&5
+$as_echo "$cr_cv_kconfig_HAVE_KMEM_CACHE_T" >&6; }
 
-  cr_result=$cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN
-
-  if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_BUF_OPERATIONS_PIN 1
-_ACEOF
+  if test x$cr_cv_kconfig_HAVE_KMEM_CACHE_T = xyes; then
+    $as_echo "#define HAVE_KMEM_CACHE_T 1" >>confdefs.h
 
-     HAVE_PIPE_BUF_OPERATIONS_PIN=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_BUF_OPERATIONS_PIN 0
-_ACEOF
+    $as_echo "#define HAVE_KMEM_CACHE_T 0" >>confdefs.h
 
-     HAVE_PIPE_BUF_OPERATIONS_PIN=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
-$as_echo "$cr_result" >&6; }
-
 
-if test -z "${HAVE_PIPE_BUF_OPERATIONS_PIN}"; then
+# type of (struct fs_struct).lock
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 2-arg pipe_ops.unmap" >&5
-$as_echo_n "checking kernel for 2-arg pipe_ops.unmap... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for fs_struct rwlock" >&5
+$as_echo_n "checking kernel for fs_struct rwlock... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46833,11 +36934,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46846,84 +36943,58 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/pipe_fs_i.h>
+    #include <linux/sched.h>
+    #include <linux/fs_struct.h>
 
 int
 main ()
 {
-
-      struct pipe_buf_operations p;
-      (void)p.unmap(NULL,NULL);
-
+struct fs_struct x;
+          rwlock_t tc_1 = x.lock;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP=yes
+	 cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP=no
+	 cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP
+  cr_result=$cr_cv_kconfig_HAVE_FS_STRUCT_RWLOCK
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_ARG_PIPE_OPS_UNMAP 1
-_ACEOF
+    $as_echo "#define HAVE_FS_STRUCT_RWLOCK 1" >>confdefs.h
 
-     HAVE_2_ARG_PIPE_OPS_UNMAP=1
+     HAVE_FS_STRUCT_RWLOCK=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_ARG_PIPE_OPS_UNMAP 0
-_ACEOF
+    $as_echo "#define HAVE_FS_STRUCT_RWLOCK 0" >>confdefs.h
 
-     HAVE_2_ARG_PIPE_OPS_UNMAP=''
+     HAVE_FS_STRUCT_RWLOCK=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for 3-arg pipe_ops.unmap" >&5
-$as_echo_n "checking kernel for 3-arg pipe_ops.unmap... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for fs_struct spinlock" >&5
+$as_echo_n "checking kernel for fs_struct spinlock... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -46935,11 +37006,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -46948,80 +37015,53 @@
 		 #endif
 		 #include <linux/types.h>
 
-      #include <linux/sched.h>
-      #include <linux/pipe_fs_i.h>
+    #include <linux/sched.h>
+    #include <linux/fs_struct.h>
 
 int
 main ()
 {
-
-      struct pipe_buf_operations p;
-      (void)p.unmap(NULL,NULL,NULL);
-
+struct fs_struct x;
+          spinlock_t tc_1 = x.lock;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP=yes
+	 cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP=no
+	 cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP
+  cr_result=$cr_cv_kconfig_HAVE_FS_STRUCT_SPINLOCK
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_PIPE_OPS_UNMAP 1
-_ACEOF
+    $as_echo "#define HAVE_FS_STRUCT_SPINLOCK 1" >>confdefs.h
 
-     HAVE_3_ARG_PIPE_OPS_UNMAP=1
+     HAVE_FS_STRUCT_SPINLOCK=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_3_ARG_PIPE_OPS_UNMAP 0
-_ACEOF
+    $as_echo "#define HAVE_FS_STRUCT_SPINLOCK 0" >>confdefs.h
 
-     HAVE_3_ARG_PIPE_OPS_UNMAP=''
+     HAVE_FS_STRUCT_SPINLOCK=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
-# Require exactly one match
-if test "${HAVE_PIPE_INODE_INFO_BASE}${HAVE_PIPE_BUF_OPERATIONS_PIN}${HAVE_2_ARG_PIPE_OPS_UNMAP}${HAVE_3_ARG_PIPE_OPS_UNMAP}" != "1"; then
+
+if test "$HAVE_FS_STRUCT_RWLOCK$HAVE_FS_STRUCT_SPINLOCK" = "11" \
+     -o "$HAVE_FS_STRUCT_RWLOCK$HAVE_FS_STRUCT_SPINLOCK" = "00" ; then
 
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -47050,13 +37090,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -47064,8 +37104,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -47087,12 +37127,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -47107,34 +37158,20 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unrecognized pipe buf operations" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unrecognized pipe buf operations" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unrecognized type for fs_struct.lock" "$LINENO" 5
 
 fi
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for anon_pipe_buf_ops" >&5
-$as_echo_n "checking kernel symbol table for anon_pipe_buf_ops... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_anon_pipe_buf_ops+set}" = set; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for gfp_t" >&5
+$as_echo_n "checking kernel for gfp_t... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_GFP_T+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_anon_pipe_buf_ops=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}anon_pipe_buf_ops$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_anon_pipe_buf_ops"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_anon_pipe_buf_ops\$" >/dev/null ; then
-        cr_cv_ksymtab_anon_pipe_buf_ops=0
-      else
-
-  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_anon_pipe_buf_ops=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_anon_pipe_buf_ops';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -47143,11 +37180,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -47155,91 +37188,59 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/slab.h>
 int
 main ()
 {
-int x = sizeof(&anon_pipe_buf_ops);
+
+     gfp_t y;
+     int x = sizeof(y);
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_anon_pipe_buf_ops="Y$cr_cv_ksymtab_anon_pipe_buf_ops"
+	 cr_cv_kconfig_HAVE_GFP_T=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_anon_pipe_buf_ops="N$cr_cv_ksymtab_anon_pipe_buf_ops"
+	 cr_cv_kconfig_HAVE_GFP_T=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_anon_pipe_buf_ops"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_anon_pipe_buf_ops" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-extern struct pipe_buf_operations anon_pipe_buf_ops;
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_GFP_T
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_anon_pipe_buf_ops | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KDATA(anon_pipe_buf_ops, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_GFP_T 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KDATA_anon_pipe_buf_ops $cr_addr
-_ACEOF
+     HAVE_GFP_T=1
+  else
+    $as_echo "#define HAVE_GFP_T 0" >>confdefs.h
 
+     HAVE_GFP_T=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# OK if missing
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for pipe_fcntl" >&5
-$as_echo_n "checking kernel for pipe_fcntl... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kzalloc" >&5
+$as_echo_n "checking kernel for kzalloc... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PIPE_FCNTL+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_KZALLOC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -47251,11 +37252,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -47263,107 +37260,66 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-    #include <linux/sched.h>
-    #include <linux/pipe_fs_i.h>
-
+		 #include <linux/slab.h>
 int
 main ()
 {
 
-   #ifdef pipe_fcntl
+   #ifdef kzalloc
      /* OK, it exists and is a macro */
    #else
      /* Check for function case */
-     int x = sizeof(&pipe_fcntl);
+     int x = sizeof(&kzalloc);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_FCNTL=yes
+	 cr_cv_kconfig_HAVE_KZALLOC=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_PIPE_FCNTL=no
+	 cr_cv_kconfig_HAVE_KZALLOC=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_PIPE_FCNTL
+  cr_result=$cr_cv_kconfig_HAVE_KZALLOC
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_FCNTL 1
-_ACEOF
+    $as_echo "#define HAVE_KZALLOC 1" >>confdefs.h
 
-     HAVE_PIPE_FCNTL=1
+     HAVE_KZALLOC=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PIPE_FCNTL 0
-_ACEOF
+    $as_echo "#define HAVE_KZALLOC 0" >>confdefs.h
 
-     HAVE_PIPE_FCNTL=''
+     HAVE_KZALLOC=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test "${HAVE_PIPE_FCNTL}" = "1"; then
+# OK if missing
 
 
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kmem_cache_zalloc" >&5
+$as_echo_n "checking kernel for kmem_cache_zalloc... " >&6; }
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for pipe_fcntl" >&5
-$as_echo_n "checking kernel symbol table for pipe_fcntl... " >&6; }
-  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
-  # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_pipe_fcntl+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_ksymtab_pipe_fcntl=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}pipe_fcntl$/ {s/ .*//p;q;}"`
-    if test -n "$cr_cv_ksymtab_pipe_fcntl"; then
-      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pipe_fcntl\$" >/dev/null ; then
-        cr_cv_ksymtab_pipe_fcntl=0
-      else
-
-  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
-    cr_cv_ksymtab_pipe_fcntl=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pipe_fcntl';"`
-  fi
-
-      fi
 
 
   SAVE_CC=$CC
@@ -47372,11 +37328,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -47384,100 +37336,63 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-
-		#define IN_CONFIGURE 1
-		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
-
+		 #include <linux/slab.h>
 int
 main ()
 {
-int x = sizeof(&pipe_fcntl);
+
+   #ifdef kmem_cache_zalloc
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&kmem_cache_zalloc);
+   #endif
+
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pipe_fcntl="Y$cr_cv_ksymtab_pipe_fcntl"
+	 cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_ksymtab_pipe_fcntl="N$cr_cv_ksymtab_pipe_fcntl"
+	 cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-    fi
 
 fi
 
-  cr_addr=''
-  if test -z "$cr_cv_ksymtab_pipe_fcntl"; then
-    cr_result='not found'
-  else
-    if expr "$cr_cv_ksymtab_pipe_fcntl" : N >/dev/null; then
-      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
-long pipe_fcntl(struct file *file, unsigned int cmd, unsigned long arg);
-_EOF
+  cr_result=$cr_cv_kconfig_HAVE_KMEM_CACHE_ZALLOC
 
-    fi
-    cr_result=`echo $cr_cv_ksymtab_pipe_fcntl | tr -d 'YN'`
-    if test $cr_result = 0; then
-      cr_result=exported
-      cr_addr=0
-    else
-      cr_addr="0x$cr_result"
-      echo "_CR_IMPORT_KCODE(pipe_fcntl, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
-    fi
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_KMEM_CACHE_ZALLOC 1" >>confdefs.h
 
-cat >>confdefs.h <<_ACEOF
-#define CR_KCODE_pipe_fcntl $cr_addr
-_ACEOF
+     HAVE_KMEM_CACHE_ZALLOC=1
+  else
+    $as_echo "#define HAVE_KMEM_CACHE_ZALLOC 0" >>confdefs.h
 
+     HAVE_KMEM_CACHE_ZALLOC=''
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
-fi
-# Now try to define CR_F_SETPIPE_SZ and CR_F_GETPIPE_SZ, for the pipe test.
-#
-# We try the user space headers first.  If we don't find a definition, then we
-# poke around the kernel headers for the definition.
-#
-# If we still don't have a definition at this point, the crut test also
-# uses an #ifdef F_SETPIPE_SZ before using CR_F_SETPIPE_SZ, so we have
-# one more chance.
 
+# OK if missing
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for F_SETPIPE_SZ" >&5
-$as_echo_n "checking kernel for F_SETPIPE_SZ... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for kmemdup" >&5
+$as_echo_n "checking kernel for kmemdup... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_F_SETPIPE_SZ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_KMEMDUP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -47489,11 +37404,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -47501,85 +37412,64 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fcntl.h>
+		 #include <linux/string.h>
 int
 main ()
 {
 
-   #ifndef F_SETPIPE_SZ
-     choke me
+   #ifdef kmemdup
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&kmemdup);
    #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_F_SETPIPE_SZ=yes
+	 cr_cv_kconfig_HAVE_KMEMDUP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_F_SETPIPE_SZ=no
+	 cr_cv_kconfig_HAVE_KMEMDUP=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_F_SETPIPE_SZ
+  cr_result=$cr_cv_kconfig_HAVE_KMEMDUP
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_F_SETPIPE_SZ 1
-_ACEOF
+    $as_echo "#define HAVE_KMEMDUP 1" >>confdefs.h
 
-     HAVE_F_SETPIPE_SZ=1
+     HAVE_KMEMDUP=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_F_SETPIPE_SZ 0
-_ACEOF
+    $as_echo "#define HAVE_KMEMDUP 0" >>confdefs.h
 
-     HAVE_F_SETPIPE_SZ=''
+     HAVE_KMEMDUP=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
+# OK if missing
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel for F_GETPIPE_SZ" >&5
-$as_echo_n "checking kernel for F_GETPIPE_SZ... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pipe_inode_info.base" >&5
+$as_echo_n "checking kernel for pipe_inode_info.base... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_F_GETPIPE_SZ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -47591,11 +37481,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -47603,1460 +37489,995 @@
 		   #define FASTCALL(_decl) _decl
 		 #endif
 		 #include <linux/types.h>
-		 #include <linux/fcntl.h>
+
+    #include <linux/sched.h>
+    #include <linux/pipe_fs_i.h>
+
 int
 main ()
 {
-
-   #ifndef F_GETPIPE_SZ
-     choke me
-   #endif
-
+struct pipe_inode_info x;
+          char tc_1 = *(x.base);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_F_GETPIPE_SZ=yes
+	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
-	 cr_cv_kconfig_HAVE_F_GETPIPE_SZ=no
+	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 fi
 
-  cr_result=$cr_cv_kconfig_HAVE_F_GETPIPE_SZ
+  cr_result=$cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BASE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_F_GETPIPE_SZ 1
-_ACEOF
+    $as_echo "#define HAVE_PIPE_INODE_INFO_BASE 1" >>confdefs.h
 
-     HAVE_F_GETPIPE_SZ=1
+     HAVE_PIPE_INODE_INFO_BASE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_F_GETPIPE_SZ 0
-_ACEOF
+    $as_echo "#define HAVE_PIPE_INODE_INFO_BASE 0" >>confdefs.h
 
-     HAVE_F_GETPIPE_SZ=''
+     HAVE_PIPE_INODE_INFO_BASE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
-if test "${HAVE_F_SETPIPE_SZ}${HAVE_F_GETPIPE_SZ}" = "11"; then
+# OK if missing.
 
-    CR_F_SETPIPE_SZ=""
 
-    { $as_echo "$as_me:$LINENO: checking for value for CR_F_SETPIPE_SZ" >&5
-$as_echo_n "checking for value for CR_F_SETPIPE_SZ... " >&6; }
-if test "${cr_cv_compute_int_CR_F_SETPIPE_SZ+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pipe_inode_info.buffers" >&5
+$as_echo_n "checking kernel for pipe_inode_info.buffers... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_compute_int_CR_F_SETPIPE_SZ="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) >= 0)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <fcntl.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+    #include <linux/wait.h>
+    #include <linux/pipe_fs_i.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
-
+struct pipe_inode_info x;
+          unsigned int tc_1 = x.buffers;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  cr_result=$cr_cv_kconfig_HAVE_PIPE_INODE_INFO_BUFFERS
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) < 0)];
-test_array [0] = 0
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_PIPE_INODE_INFO_BUFFERS 1" >>confdefs.h
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) >= $ac_mid)];
-test_array [0] = 0
+     HAVE_PIPE_INODE_INFO_BUFFERS=1
+  else
+    $as_echo "#define HAVE_PIPE_INODE_INFO_BUFFERS 0" >>confdefs.h
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+     HAVE_PIPE_INODE_INFO_BUFFERS=''
+  fi
 
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+# OK if missing.
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pipe_buf_operations.pin" >&5
+$as_echo_n "checking kernel for pipe_buf_operations.pin... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+    #include <linux/sched.h>
+    #include <linux/pipe_fs_i.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
-
+struct pipe_buf_operations x;
+          x.pin;
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_F_SETPIPE_SZ=$ac_lo;;
-'')  ;;
-esac
+  cr_result=$cr_cv_kconfig_HAVE_PIPE_BUF_OPERATIONS_PIN
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_PIPE_BUF_OPERATIONS_PIN 1" >>confdefs.h
+
+     HAVE_PIPE_BUF_OPERATIONS_PIN=1
+  else
+    $as_echo "#define HAVE_PIPE_BUF_OPERATIONS_PIN 0" >>confdefs.h
+
+     HAVE_PIPE_BUF_OPERATIONS_PIN=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+if test -z "${HAVE_PIPE_BUF_OPERATIONS_PIN}"; then
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2-arg pipe_ops.unmap" >&5
+$as_echo_n "checking kernel for 2-arg pipe_ops.unmap... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <fcntl.h>
-static long int longval () { return F_SETPIPE_SZ; }
-static unsigned long int ulongval () { return F_SETPIPE_SZ; }
-#include <stdio.h>
-#include <stdlib.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+      #include <linux/sched.h>
+      #include <linux/pipe_fs_i.h>
+
 int
 main ()
 {
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((F_SETPIPE_SZ) < 0)
-    {
-      long int i = longval ();
-      if (i != (F_SETPIPE_SZ))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (F_SETPIPE_SZ))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
+      struct pipe_buf_operations p;
+      (void)p.unmap(NULL,NULL);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_F_SETPIPE_SZ=`cat conftest.val`
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP=no
 fi
-rm -f conftest.val
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_F_SETPIPE_SZ" >&5
-$as_echo "$cr_cv_compute_int_CR_F_SETPIPE_SZ" >&6; }
-  if test "$cr_cv_compute_int_CR_F_SETPIPE_SZ" != "not found"; then
-    CR_F_SETPIPE_SZ="$cr_cv_compute_int_CR_F_SETPIPE_SZ"
-  fi
 
-  if test -n "$CR_F_SETPIPE_SZ"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_F_SETPIPE_SZ $CR_F_SETPIPE_SZ
-_ACEOF
+  cr_result=$cr_cv_kconfig_HAVE_2_ARG_PIPE_OPS_UNMAP
 
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_2_ARG_PIPE_OPS_UNMAP 1" >>confdefs.h
 
+     HAVE_2_ARG_PIPE_OPS_UNMAP=1
+  else
+    $as_echo "#define HAVE_2_ARG_PIPE_OPS_UNMAP 0" >>confdefs.h
 
+     HAVE_2_ARG_PIPE_OPS_UNMAP=''
   fi
 
-    if test -z "${CR_F_SETPIPE_SZ}"; then
 
-    CR_F_SETPIPE_SZ=""
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
 
-    SAVE_CPP=$CPP
-  SAVE_CPPFLAGS=$CPPFLAGS
-  SAVE_cross_compiling="$cross_compiling"
-  CPP="$KCC -E"
-  CPPFLAGS="$KCFLAGS"
-  cross_compiling="yes"
-  { $as_echo "$as_me:$LINENO: checking kernel for value for CR_F_SETPIPE_SZ" >&5
-$as_echo_n "checking kernel for value for CR_F_SETPIPE_SZ... " >&6; }
-if test "${cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ+set}" = set; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 3-arg pipe_ops.unmap" >&5
+$as_echo_n "checking kernel for 3-arg pipe_ops.unmap... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) >= 0)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fcntl.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+      #include <linux/sched.h>
+      #include <linux/pipe_fs_i.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
+
+      struct pipe_buf_operations p;
+      (void)p.unmap(NULL,NULL,NULL);
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  cr_result=$cr_cv_kconfig_HAVE_3_ARG_PIPE_OPS_UNMAP
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) < 0)];
-test_array [0] = 0
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_3_ARG_PIPE_OPS_UNMAP 1" >>confdefs.h
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) >= $ac_mid)];
-test_array [0] = 0
+     HAVE_3_ARG_PIPE_OPS_UNMAP=1
+  else
+    $as_echo "#define HAVE_3_ARG_PIPE_OPS_UNMAP 0" >>confdefs.h
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+     HAVE_3_ARG_PIPE_OPS_UNMAP=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
 fi
+# Require exactly one match
+if test "${HAVE_PIPE_INODE_INFO_BASE}${HAVE_PIPE_BUF_OPERATIONS_PIN}${HAVE_2_ARG_PIPE_OPS_UNMAP}${HAVE_3_ARG_PIPE_OPS_UNMAP}" != "1"; then
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
   done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
 fi
+rm -f confcache
+
+  echo "======================================================================"
+  echo "Please review the following configuration information:"
+  echo "  Kernel source directory = $LINUX_SRC"
+  echo "  Kernel build directory = $LINUX_OBJ"
+  echo "  Kernel symbol table = ${LINUX_SYSTEM_MAP}${LINUX_VMLINUX}"
+  echo "  Kernel version probed from kernel build = $LINUX_VER"
+  echo "  Kernel running currently = `uname -r`"
+  echo "======================================================================"
+
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unrecognized pipe buf operations" "$LINENO" 5
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_SETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
-fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ=$ac_lo;;
-'')  ;;
-esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for anon_pipe_buf_ops" >&5
+$as_echo_n "checking kernel symbol table for anon_pipe_buf_ops... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_anon_pipe_buf_ops+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+    cr_cv_ksymtab_anon_pipe_buf_ops=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_DATA}anon_pipe_buf_ops$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_anon_pipe_buf_ops"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_anon_pipe_buf_ops\$" >/dev/null ; then
+        cr_cv_ksymtab_anon_pipe_buf_ops=0
+      else
+
+  if test "DATA${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_anon_pipe_buf_ops=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_anon_pipe_buf_ops';"`
+  fi
+
+      fi
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fcntl.h>
-static long int longval () { return F_SETPIPE_SZ; }
-static unsigned long int ulongval () { return F_SETPIPE_SZ; }
-#include <stdio.h>
-#include <stdlib.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((F_SETPIPE_SZ) < 0)
-    {
-      long int i = longval ();
-      if (i != (F_SETPIPE_SZ))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (F_SETPIPE_SZ))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
-
+int x = sizeof(&anon_pipe_buf_ops);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ=`cat conftest.val`
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_anon_pipe_buf_ops="Y$cr_cv_ksymtab_anon_pipe_buf_ops"
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_anon_pipe_buf_ops="N$cr_cv_ksymtab_anon_pipe_buf_ops"
 fi
-rm -f conftest.val
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+    fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ" >&5
-$as_echo "$cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ" >&6; }
-  CPP=$SAVE_CPP
-  CPPFLAGS=$SAVE_CPPFLAGS
-  cross_compiling="$SAVE_cross_compiling"
-  if test "$cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ" != "not found"; then
-    CR_F_SETPIPE_SZ="$cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ"
-  fi
 
-  if test -n "$CR_F_SETPIPE_SZ"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_F_SETPIPE_SZ $CR_F_SETPIPE_SZ
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_anon_pipe_buf_ops"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_anon_pipe_buf_ops" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+extern struct pipe_buf_operations anon_pipe_buf_ops;
+_EOF
+
+    fi
+    cr_result=`echo $cr_cv_ksymtab_anon_pipe_buf_ops | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KDATA(anon_pipe_buf_ops, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KDATA_anon_pipe_buf_ops $cr_addr
 _ACEOF
 
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
 
-  fi
 
-    fi
 
-    CR_F_GETPIPE_SZ=""
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for pipe_fcntl" >&5
+$as_echo_n "checking kernel for pipe_fcntl... " >&6; }
 
-    { $as_echo "$as_me:$LINENO: checking for value for CR_F_GETPIPE_SZ" >&5
-$as_echo_n "checking for value for CR_F_GETPIPE_SZ... " >&6; }
-if test "${cr_cv_compute_int_CR_F_GETPIPE_SZ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PIPE_FCNTL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_compute_int_CR_F_GETPIPE_SZ="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) >= 0)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <fcntl.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+    #include <linux/sched.h>
+    #include <linux/pipe_fs_i.h>
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
+
+   #ifdef pipe_fcntl
+     /* OK, it exists and is a macro */
+   #else
+     /* Check for function case */
+     int x = sizeof(&pipe_fcntl);
+   #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_PIPE_FCNTL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_PIPE_FCNTL=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+  cr_result=$cr_cv_kconfig_HAVE_PIPE_FCNTL
+
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_PIPE_FCNTL 1" >>confdefs.h
+
+     HAVE_PIPE_FCNTL=1
+  else
+    $as_echo "#define HAVE_PIPE_FCNTL 0" >>confdefs.h
+
+     HAVE_PIPE_FCNTL=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+if test "${HAVE_PIPE_FCNTL}" = "1"; then
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for pipe_fcntl" >&5
+$as_echo_n "checking kernel symbol table for pipe_fcntl... " >&6; }
+  # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
+  # if a declaration was found or not, and the address or 0 as the rest.
+    if ${cr_cv_ksymtab_pipe_fcntl+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) < 0)];
-test_array [0] = 0
+    cr_cv_ksymtab_pipe_fcntl=`eval $LINUX_SYMTAB_CMD | sed -n -e "/${CR_KSYM_PATTERN_CODE}pipe_fcntl$/ {s/ .*//p;q;}"`
+    if test -n "$cr_cv_ksymtab_pipe_fcntl"; then
+      if eval $LINUX_SYMTAB_CMD | grep " __ksymtab_pipe_fcntl\$" >/dev/null ; then
+        cr_cv_ksymtab_pipe_fcntl=0
+      else
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  if test "CODE${HAVE_CONFIG_THUMB2_KERNEL}" = 'CODE1'; then
+    cr_cv_ksymtab_pipe_fcntl=`$PERL -e "printf '%x', 1 | hex '$cr_cv_ksymtab_pipe_fcntl';"`
+  fi
+
+      fi
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <fcntl.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+
+		#define IN_CONFIGURE 1
+		#include "${TOP_SRCDIR}/include/blcr_imports.h.in"
+
 int
 main ()
 {
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) >= $ac_mid)];
-test_array [0] = 0
-
+int x = sizeof(&pipe_fcntl);
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_pipe_fcntl="Y$cr_cv_ksymtab_pipe_fcntl"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_ksymtab_pipe_fcntl="N$cr_cv_ksymtab_pipe_fcntl"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
-fi
+    fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
+  cr_addr=''
+  if test -z "$cr_cv_ksymtab_pipe_fcntl"; then
+    cr_result='not found'
+  else
+    if expr "$cr_cv_ksymtab_pipe_fcntl" : N >/dev/null; then
+      cat >>$CR_KSYM_IMPORT_DECLS <<_EOF
+long pipe_fcntl(struct file *file, unsigned int cmd, unsigned long arg);
+_EOF
 
-  ;
-  return 0;
-}
+    fi
+    cr_result=`echo $cr_cv_ksymtab_pipe_fcntl | tr -d 'YN'`
+    if test $cr_result = 0; then
+      cr_result=exported
+      cr_addr=0
+    else
+      cr_addr="0x$cr_result"
+      echo "_CR_IMPORT_KCODE(pipe_fcntl, $cr_addr)" >>$CR_KSYM_IMPORT_CALLS
+    fi
+
+cat >>confdefs.h <<_ACEOF
+#define CR_KCODE_pipe_fcntl $cr_addr
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
 fi
+# Now try to define CR_F_SETPIPE_SZ and CR_F_GETPIPE_SZ, for the pipe test.
+#
+# We try the user space headers first.  If we don't find a definition, then we
+# poke around the kernel headers for the definition.
+#
+# If we still don't have a definition at this point, the crut test also
+# uses an #ifdef F_SETPIPE_SZ before using CR_F_SETPIPE_SZ, so we have
+# one more chance.
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_int_CR_F_GETPIPE_SZ=$ac_lo;;
-'')  ;;
-esac
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for F_SETPIPE_SZ" >&5
+$as_echo_n "checking kernel for F_SETPIPE_SZ... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_F_SETPIPE_SZ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <fcntl.h>
-static long int longval () { return F_GETPIPE_SZ; }
-static unsigned long int ulongval () { return F_GETPIPE_SZ; }
-#include <stdio.h>
-#include <stdlib.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/fcntl.h>
 int
 main ()
 {
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((F_GETPIPE_SZ) < 0)
-    {
-      long int i = longval ();
-      if (i != (F_GETPIPE_SZ))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (F_GETPIPE_SZ))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
+   #ifndef F_SETPIPE_SZ
+     choke me
+   #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_int_CR_F_GETPIPE_SZ=`cat conftest.val`
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_F_SETPIPE_SZ=yes
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_F_SETPIPE_SZ=no
 fi
-rm -f conftest.val
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_int_CR_F_GETPIPE_SZ" >&5
-$as_echo "$cr_cv_compute_int_CR_F_GETPIPE_SZ" >&6; }
-  if test "$cr_cv_compute_int_CR_F_GETPIPE_SZ" != "not found"; then
-    CR_F_GETPIPE_SZ="$cr_cv_compute_int_CR_F_GETPIPE_SZ"
-  fi
 
-  if test -n "$CR_F_GETPIPE_SZ"; then
-    cat >>confdefs.h <<_ACEOF
-#define CR_F_GETPIPE_SZ $CR_F_GETPIPE_SZ
-_ACEOF
+  cr_result=$cr_cv_kconfig_HAVE_F_SETPIPE_SZ
 
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_F_SETPIPE_SZ 1" >>confdefs.h
 
+     HAVE_F_SETPIPE_SZ=1
+  else
+    $as_echo "#define HAVE_F_SETPIPE_SZ 0" >>confdefs.h
 
+     HAVE_F_SETPIPE_SZ=''
   fi
 
-    if test -z "${CR_F_GETPIPE_SZ}"; then
 
-    CR_F_GETPIPE_SZ=""
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
 
 
-    SAVE_CPP=$CPP
-  SAVE_CPPFLAGS=$CPPFLAGS
-  SAVE_cross_compiling="$cross_compiling"
-  CPP="$KCC -E"
-  CPPFLAGS="$KCFLAGS"
-  cross_compiling="yes"
-  { $as_echo "$as_me:$LINENO: checking kernel for value for CR_F_GETPIPE_SZ" >&5
-$as_echo_n "checking kernel for value for CR_F_GETPIPE_SZ... " >&6; }
-if test "${cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ+set}" = set; then
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for F_GETPIPE_SZ" >&5
+$as_echo_n "checking kernel for F_GETPIPE_SZ... " >&6; }
+
+    if ${cr_cv_kconfig_HAVE_F_GETPIPE_SZ+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
-    cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ="not found"
-    if test "$cross_compiling" = yes; then
-  # Depending upon the size, compute the lo and hi bounds.
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) >= 0)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=0 ac_mid=0
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+
+  SAVE_CC=$CC
+  SAVE_CFLAGS=$CFLAGS
+  SAVE_CPPFLAGS=$CPPFLAGS
+  CC=$KCC
+  CFLAGS=""
+  CPPFLAGS="$KCFLAGS"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <linux/fcntl.h>
+
+		 #include <linux/kernel.h>
+		 #ifndef FASTCALL
+		   #define FASTCALL(_decl) _decl
+		 #endif
+		 #include <linux/types.h>
+		 #include <linux/fcntl.h>
 int
 main ()
 {
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
+
+   #ifndef F_GETPIPE_SZ
+     choke me
+   #endif
 
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid; break
+if ac_fn_c_try_compile "$LINENO"; then :
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_F_GETPIPE_SZ=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  CC=$SAVE_CC
+	 CFLAGS=$SAVE_CFLAGS
+	 CPPFLAGS=$SAVE_CPPFLAGS
+	 cr_cv_kconfig_HAVE_F_GETPIPE_SZ=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 
-	ac_lo=`expr $ac_mid + 1`
-			if test $ac_lo -le $ac_mid; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid + 1`
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  cr_result=$cr_cv_kconfig_HAVE_F_GETPIPE_SZ
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) < 0)];
-test_array [0] = 0
+  if test $cr_result = yes; then
+    $as_echo "#define HAVE_F_GETPIPE_SZ 1" >>confdefs.h
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=-1 ac_mid=-1
-  while :; do
-    cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) >= $ac_mid)];
-test_array [0] = 0
+     HAVE_F_GETPIPE_SZ=1
+  else
+    $as_echo "#define HAVE_F_GETPIPE_SZ 0" >>confdefs.h
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_lo=$ac_mid; break
+     HAVE_F_GETPIPE_SZ=''
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
+$as_echo "$cr_result" >&6; }
+
+
+if test "${HAVE_F_SETPIPE_SZ}${HAVE_F_GETPIPE_SZ}" = "11"; then
+
+    CR_F_SETPIPE_SZ=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_F_SETPIPE_SZ" >&5
+$as_echo_n "checking for value for CR_F_SETPIPE_SZ... " >&6; }
+if ${cr_cv_compute_int_CR_F_SETPIPE_SZ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_hi=`expr '(' $ac_mid ')' - 1`
-			if test $ac_mid -le $ac_hi; then
-			  ac_lo= ac_hi=
-			  break
-			fi
-			ac_mid=`expr 2 '*' $ac_mid`
+    cr_cv_compute_int_CR_F_SETPIPE_SZ="not found"
+    if ac_fn_c_compute_int "$LINENO" "F_SETPIPE_SZ" "cr_cv_compute_int_CR_F_SETPIPE_SZ"        "#include <fcntl.h>"; then :
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  done
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_F_SETPIPE_SZ" >&5
+$as_echo "$cr_cv_compute_int_CR_F_SETPIPE_SZ" >&6; }
+  if test "$cr_cv_compute_int_CR_F_SETPIPE_SZ" != "not found"; then
+    CR_F_SETPIPE_SZ="$cr_cv_compute_int_CR_F_SETPIPE_SZ"
+  fi
+
+  if test -n "$CR_F_SETPIPE_SZ"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_F_SETPIPE_SZ $CR_F_SETPIPE_SZ
+_ACEOF
+
+
+  fi
+
+    if test -z "${CR_F_SETPIPE_SZ}"; then
+
+    CR_F_SETPIPE_SZ=""
+
+
+    SAVE_CPP=$CPP
+  SAVE_CPPFLAGS=$CPPFLAGS
+  SAVE_cross_compiling="$cross_compiling"
+  CPP="$KCC -E"
+  CPPFLAGS="$KCFLAGS"
+  cross_compiling="yes"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for value for CR_F_SETPIPE_SZ" >&5
+$as_echo_n "checking kernel for value for CR_F_SETPIPE_SZ... " >&6; }
+if ${cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo= ac_hi=
+    cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ="not found"
+    if ac_fn_c_compute_int "$LINENO" "F_SETPIPE_SZ" "cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ"        "#include <linux/fcntl.h>"; then :
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ" >&5
+$as_echo "$cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ" >&6; }
+  CPP=$SAVE_CPP
+  CPPFLAGS=$SAVE_CPPFLAGS
+  cross_compiling="$SAVE_cross_compiling"
+  if test "$cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ" != "not found"; then
+    CR_F_SETPIPE_SZ="$cr_cv_compute_kernel_int_CR_F_SETPIPE_SZ"
+  fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-# Binary search between lo and hi bounds.
-while test "x$ac_lo" != "x$ac_hi"; do
-  ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+  if test -n "$CR_F_SETPIPE_SZ"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_F_SETPIPE_SZ $CR_F_SETPIPE_SZ
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-int
-main ()
-{
-static int test_array [1 - 2 * !((F_GETPIPE_SZ) <= $ac_mid)];
-test_array [0] = 0
 
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_hi=$ac_mid
+
+  fi
+
+    fi
+
+    CR_F_GETPIPE_SZ=""
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for value for CR_F_GETPIPE_SZ" >&5
+$as_echo_n "checking for value for CR_F_GETPIPE_SZ... " >&6; }
+if ${cr_cv_compute_int_CR_F_GETPIPE_SZ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_lo=`expr '(' $ac_mid ')' + 1`
+    cr_cv_compute_int_CR_F_GETPIPE_SZ="not found"
+    if ac_fn_c_compute_int "$LINENO" "F_GETPIPE_SZ" "cr_cv_compute_int_CR_F_GETPIPE_SZ"        "#include <fcntl.h>"; then :
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-done
-case $ac_lo in
-?*) cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ=$ac_lo;;
-'')  ;;
-esac
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <linux/fcntl.h>
-static long int longval () { return F_GETPIPE_SZ; }
-static unsigned long int ulongval () { return F_GETPIPE_SZ; }
-#include <stdio.h>
-#include <stdlib.h>
-int
-main ()
-{
 
-  FILE *f = fopen ("conftest.val", "w");
-  if (! f)
-    return 1;
-  if ((F_GETPIPE_SZ) < 0)
-    {
-      long int i = longval ();
-      if (i != (F_GETPIPE_SZ))
-	return 1;
-      fprintf (f, "%ld", i);
-    }
-  else
-    {
-      unsigned long int i = ulongval ();
-      if (i != (F_GETPIPE_SZ))
-	return 1;
-      fprintf (f, "%lu", i);
-    }
-  /* Do not output a trailing newline, as this causes \r\n confusion
-     on some platforms.  */
-  return ferror (f) || fclose (f) != 0;
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_int_CR_F_GETPIPE_SZ" >&5
+$as_echo "$cr_cv_compute_int_CR_F_GETPIPE_SZ" >&6; }
+  if test "$cr_cv_compute_int_CR_F_GETPIPE_SZ" != "not found"; then
+    CR_F_GETPIPE_SZ="$cr_cv_compute_int_CR_F_GETPIPE_SZ"
+  fi
 
-  ;
-  return 0;
-}
+  if test -n "$CR_F_GETPIPE_SZ"; then
+    cat >>confdefs.h <<_ACEOF
+#define CR_F_GETPIPE_SZ $CR_F_GETPIPE_SZ
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ=`cat conftest.val`
+
+
+  fi
+
+    if test -z "${CR_F_GETPIPE_SZ}"; then
+
+    CR_F_GETPIPE_SZ=""
+
+
+    SAVE_CPP=$CPP
+  SAVE_CPPFLAGS=$CPPFLAGS
+  SAVE_cross_compiling="$cross_compiling"
+  CPP="$KCC -E"
+  CPPFLAGS="$KCFLAGS"
+  cross_compiling="yes"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for value for CR_F_GETPIPE_SZ" >&5
+$as_echo_n "checking kernel for value for CR_F_GETPIPE_SZ... " >&6; }
+if ${cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+
+    cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ="not found"
+    if ac_fn_c_compute_int "$LINENO" "F_GETPIPE_SZ" "cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ"        "#include <linux/fcntl.h>"; then :
 
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f conftest.val
+
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ" >&5
 $as_echo "$cr_cv_compute_kernel_int_CR_F_GETPIPE_SZ" >&6; }
   CPP=$SAVE_CPP
   CPPFLAGS=$SAVE_CPPFLAGS
@@ -49071,7 +38492,6 @@
 _ACEOF
 
 
-
   fi
 
     fi
@@ -49085,11 +38505,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for file_operations.check_flags" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for file_operations.check_flags" >&5
 $as_echo_n "checking kernel for file_operations.check_flags... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FILE_OPERATIONS_CHECK_FLAGS+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FILE_OPERATIONS_CHECK_FLAGS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49101,11 +38520,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49123,38 +38538,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_OPERATIONS_CHECK_FLAGS=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_OPERATIONS_CHECK_FLAGS=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49163,32 +38557,27 @@
   cr_result=$cr_cv_kconfig_HAVE_FILE_OPERATIONS_CHECK_FLAGS
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_OPERATIONS_CHECK_FLAGS 1
-_ACEOF
+    $as_echo "#define HAVE_FILE_OPERATIONS_CHECK_FLAGS 1" >>confdefs.h
 
      HAVE_FILE_OPERATIONS_CHECK_FLAGS=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_OPERATIONS_CHECK_FLAGS 0
-_ACEOF
+    $as_echo "#define HAVE_FILE_OPERATIONS_CHECK_FLAGS 0" >>confdefs.h
 
      HAVE_FILE_OPERATIONS_CHECK_FLAGS=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for file.f_lock" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for file.f_lock" >&5
 $as_echo_n "checking kernel for file.f_lock... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FILE_F_LOCK+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FILE_F_LOCK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49200,11 +38589,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49222,38 +38607,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_F_LOCK=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_F_LOCK=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49262,32 +38626,27 @@
   cr_result=$cr_cv_kconfig_HAVE_FILE_F_LOCK
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_F_LOCK 1
-_ACEOF
+    $as_echo "#define HAVE_FILE_F_LOCK 1" >>confdefs.h
 
      HAVE_FILE_F_LOCK=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_F_LOCK 0
-_ACEOF
+    $as_echo "#define HAVE_FILE_F_LOCK 0" >>confdefs.h
 
      HAVE_FILE_F_LOCK=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for inode.i_mapping" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for inode.i_mapping" >&5
 $as_echo_n "checking kernel for inode.i_mapping... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_INODE_I_MAPPING+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_INODE_I_MAPPING+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49299,11 +38658,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49321,38 +38676,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_INODE_I_MAPPING=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_INODE_I_MAPPING=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49361,32 +38695,27 @@
   cr_result=$cr_cv_kconfig_HAVE_INODE_I_MAPPING
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_I_MAPPING 1
-_ACEOF
+    $as_echo "#define HAVE_INODE_I_MAPPING 1" >>confdefs.h
 
      HAVE_INODE_I_MAPPING=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INODE_I_MAPPING 0
-_ACEOF
+    $as_echo "#define HAVE_INODE_I_MAPPING 0" >>confdefs.h
 
      HAVE_INODE_I_MAPPING=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for file.f_mapping" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for file.f_mapping" >&5
 $as_echo_n "checking kernel for file.f_mapping... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FILE_F_MAPPING+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FILE_F_MAPPING+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49398,11 +38727,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49420,38 +38745,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_F_MAPPING=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_F_MAPPING=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49460,21 +38764,17 @@
   cr_result=$cr_cv_kconfig_HAVE_FILE_F_MAPPING
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_F_MAPPING 1
-_ACEOF
+    $as_echo "#define HAVE_FILE_F_MAPPING 1" >>confdefs.h
 
      HAVE_FILE_F_MAPPING=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_F_MAPPING 0
-_ACEOF
+    $as_echo "#define HAVE_FILE_F_MAPPING 0" >>confdefs.h
 
      HAVE_FILE_F_MAPPING=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -49508,13 +38808,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -49522,8 +38822,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -49545,12 +38845,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -49565,20 +38876,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - could not locate address_space in inode or file structs" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - could not locate address_space in inode or file structs" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - could not locate address_space in inode or file structs" "$LINENO" 5
 
 fi
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for file_operations.unlocked_ioctl" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for file_operations.unlocked_ioctl" >&5
 $as_echo_n "checking kernel for file_operations.unlocked_ioctl... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49590,11 +38898,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49612,38 +38916,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49652,21 +38935,17 @@
   cr_result=$cr_cv_kconfig_HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL 1
-_ACEOF
+    $as_echo "#define HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL 1" >>confdefs.h
 
      HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL 0
-_ACEOF
+    $as_echo "#define HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL 0" >>confdefs.h
 
      HAVE_FILE_OPERATIONS_UNLOCKED_IOCTL=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -49677,11 +38956,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 4-arg do_generic_file_read" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 4-arg do_generic_file_read" >&5
 $as_echo_n "checking kernel for 4-arg do_generic_file_read... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_4_ARG_DO_GENERIC_FILE_READ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_4_ARG_DO_GENERIC_FILE_READ+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49693,11 +38971,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49718,38 +38992,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_4_ARG_DO_GENERIC_FILE_READ=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_4_ARG_DO_GENERIC_FILE_READ=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49758,21 +39011,17 @@
   cr_result=$cr_cv_kconfig_HAVE_4_ARG_DO_GENERIC_FILE_READ
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_DO_GENERIC_FILE_READ 1
-_ACEOF
+    $as_echo "#define HAVE_4_ARG_DO_GENERIC_FILE_READ 1" >>confdefs.h
 
      HAVE_4_ARG_DO_GENERIC_FILE_READ=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_4_ARG_DO_GENERIC_FILE_READ 0
-_ACEOF
+    $as_echo "#define HAVE_4_ARG_DO_GENERIC_FILE_READ 0" >>confdefs.h
 
      HAVE_4_ARG_DO_GENERIC_FILE_READ=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -49783,11 +39032,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 5-arg do_generic_file_read" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 5-arg do_generic_file_read" >&5
 $as_echo_n "checking kernel for 5-arg do_generic_file_read... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_5_ARG_DO_GENERIC_FILE_READ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_5_ARG_DO_GENERIC_FILE_READ+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49799,11 +39047,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49824,38 +39068,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_5_ARG_DO_GENERIC_FILE_READ=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_5_ARG_DO_GENERIC_FILE_READ=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49864,21 +39087,17 @@
   cr_result=$cr_cv_kconfig_HAVE_5_ARG_DO_GENERIC_FILE_READ
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_5_ARG_DO_GENERIC_FILE_READ 1
-_ACEOF
+    $as_echo "#define HAVE_5_ARG_DO_GENERIC_FILE_READ 1" >>confdefs.h
 
      HAVE_5_ARG_DO_GENERIC_FILE_READ=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_5_ARG_DO_GENERIC_FILE_READ 0
-_ACEOF
+    $as_echo "#define HAVE_5_ARG_DO_GENERIC_FILE_READ 0" >>confdefs.h
 
      HAVE_5_ARG_DO_GENERIC_FILE_READ=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -49887,11 +39106,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for read_descriptor_t.arg.data" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for read_descriptor_t.arg.data" >&5
 $as_echo_n "checking kernel for read_descriptor_t.arg.data... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_ARG_DATA+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_ARG_DATA+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -49903,11 +39121,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -49925,38 +39139,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_ARG_DATA=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_ARG_DATA=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -49965,32 +39158,27 @@
   cr_result=$cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_ARG_DATA
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_READ_DESCRIPTOR_T_ARG_DATA 1
-_ACEOF
+    $as_echo "#define HAVE_READ_DESCRIPTOR_T_ARG_DATA 1" >>confdefs.h
 
      HAVE_READ_DESCRIPTOR_T_ARG_DATA=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_READ_DESCRIPTOR_T_ARG_DATA 0
-_ACEOF
+    $as_echo "#define HAVE_READ_DESCRIPTOR_T_ARG_DATA 0" >>confdefs.h
 
      HAVE_READ_DESCRIPTOR_T_ARG_DATA=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for read_descriptor_t.buf" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for read_descriptor_t.buf" >&5
 $as_echo_n "checking kernel for read_descriptor_t.buf... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_BUF+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_BUF+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50002,11 +39190,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50024,38 +39208,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_BUF=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_BUF=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -50064,21 +39227,17 @@
   cr_result=$cr_cv_kconfig_HAVE_READ_DESCRIPTOR_T_BUF
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_READ_DESCRIPTOR_T_BUF 1
-_ACEOF
+    $as_echo "#define HAVE_READ_DESCRIPTOR_T_BUF 1" >>confdefs.h
 
      HAVE_READ_DESCRIPTOR_T_BUF=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_READ_DESCRIPTOR_T_BUF 0
-_ACEOF
+    $as_echo "#define HAVE_READ_DESCRIPTOR_T_BUF 0" >>confdefs.h
 
      HAVE_READ_DESCRIPTOR_T_BUF=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -50111,13 +39270,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -50125,8 +39284,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -50148,12 +39307,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -50168,20 +39338,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to use do_generic_file_read()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to use do_generic_file_read()" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to use do_generic_file_read()" "$LINENO" 5
 
 fi
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for splice_direct_to_actor" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for splice_direct_to_actor" >&5
 $as_echo_n "checking kernel for splice_direct_to_actor... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_SPLICE_DIRECT_TO_ACTOR+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SPLICE_DIRECT_TO_ACTOR+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50193,11 +39360,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50223,38 +39386,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_SPLICE_DIRECT_TO_ACTOR=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_SPLICE_DIRECT_TO_ACTOR=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -50263,21 +39405,17 @@
   cr_result=$cr_cv_kconfig_HAVE_SPLICE_DIRECT_TO_ACTOR
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SPLICE_DIRECT_TO_ACTOR 1
-_ACEOF
+    $as_echo "#define HAVE_SPLICE_DIRECT_TO_ACTOR 1" >>confdefs.h
 
      HAVE_SPLICE_DIRECT_TO_ACTOR=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SPLICE_DIRECT_TO_ACTOR 0
-_ACEOF
+    $as_echo "#define HAVE_SPLICE_DIRECT_TO_ACTOR 0" >>confdefs.h
 
      HAVE_SPLICE_DIRECT_TO_ACTOR=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -50285,11 +39423,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for task.ptrace" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.ptrace" >&5
 $as_echo_n "checking kernel for task.ptrace... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_PTRACE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_PTRACE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50301,11 +39438,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50323,38 +39456,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_TASK_PTRACE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_TASK_PTRACE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -50363,32 +39475,27 @@
   cr_result=$cr_cv_kconfig_HAVE_TASK_PTRACE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PTRACE 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_PTRACE 1" >>confdefs.h
 
      HAVE_TASK_PTRACE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PTRACE 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_PTRACE 0" >>confdefs.h
 
      HAVE_TASK_PTRACE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for task.ptracees" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.ptracees" >&5
 $as_echo_n "checking kernel for task.ptracees... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_PTRACEES+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_PTRACEES+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50400,11 +39507,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50422,38 +39525,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_TASK_PTRACEES=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_TASK_PTRACEES=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -50462,32 +39544,27 @@
   cr_result=$cr_cv_kconfig_HAVE_TASK_PTRACEES
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PTRACEES 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_PTRACEES 1" >>confdefs.h
 
      HAVE_TASK_PTRACEES=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PTRACEES 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_PTRACEES 0" >>confdefs.h
 
      HAVE_TASK_PTRACEES=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for task.ptraced" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for task.ptraced" >&5
 $as_echo_n "checking kernel for task.ptraced... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_TASK_PTRACED+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_TASK_PTRACED+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50499,11 +39576,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50521,38 +39594,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_TASK_PTRACED=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_TASK_PTRACED=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -50561,21 +39613,17 @@
   cr_result=$cr_cv_kconfig_HAVE_TASK_PTRACED
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PTRACED 1
-_ACEOF
+    $as_echo "#define HAVE_TASK_PTRACED 1" >>confdefs.h
 
      HAVE_TASK_PTRACED=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_TASK_PTRACED 0
-_ACEOF
+    $as_echo "#define HAVE_TASK_PTRACED 0" >>confdefs.h
 
      HAVE_TASK_PTRACED=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -50584,11 +39632,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for ptrace_utrace_ops" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for ptrace_utrace_ops" >&5
 $as_echo_n "checking kernel symbol table for ptrace_utrace_ops... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_ptrace_utrace_ops+set}" = set; then
+    if ${cr_cv_ksymtab_ptrace_utrace_ops+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50611,11 +39659,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50635,38 +39679,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_ptrace_utrace_ops="Y$cr_cv_ksymtab_ptrace_utrace_ops"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_ptrace_utrace_ops="N$cr_cv_ksymtab_ptrace_utrace_ops"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -50697,13 +39720,11 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   if test -z "$cr_addr"; then
-    { { $as_echo "$as_me:$LINENO: error: failed to find symbol ptrace_utrace_ops" >&5
-$as_echo "$as_me: error: failed to find symbol ptrace_utrace_ops" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "failed to find symbol ptrace_utrace_ops" "$LINENO" 5
   fi
 fi
 if test "${HAVE_TASK_PTRACE}${HAVE_TASK_PTRACEES}" != "1"; then
@@ -50735,13 +39756,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -50749,8 +39770,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -50772,12 +39793,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -50792,20 +39824,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to identify ptrace()ed/ing processes" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to identify ptrace()ed/ing processes" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to identify ptrace()ed/ing processes" "$LINENO" 5
 
 fi
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for proc_root" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for proc_root" >&5
 $as_echo_n "checking kernel for proc_root... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PROC_ROOT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PROC_ROOT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50817,11 +39846,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50840,38 +39865,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_PROC_ROOT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_PROC_ROOT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -50880,30 +39884,26 @@
   cr_result=$cr_cv_kconfig_HAVE_PROC_ROOT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PROC_ROOT 1
-_ACEOF
+    $as_echo "#define HAVE_PROC_ROOT 1" >>confdefs.h
 
      HAVE_PROC_ROOT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PROC_ROOT 0
-_ACEOF
+    $as_echo "#define HAVE_PROC_ROOT 0" >>confdefs.h
 
      HAVE_PROC_ROOT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 # check kmalloc max size
 
-    { $as_echo "$as_me:$LINENO: checking kernel for maximum kmalloc() allocation" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for maximum kmalloc() allocation" >&5
 $as_echo_n "checking kernel for maximum kmalloc() allocation... " >&6; }
-if test "${cr_cv_kconfig_kmalloc_max+set}" = set; then
+if ${cr_cv_kconfig_kmalloc_max+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50923,7 +39923,7 @@
     fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $cr_cv_kconfig_kmalloc_max" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_cv_kconfig_kmalloc_max" >&5
 $as_echo "$cr_cv_kconfig_kmalloc_max" >&6; }
   cr_kmalloc_max=`echo $cr_cv_kconfig_kmalloc_max | cut -d' ' -f1`
 
@@ -50940,11 +39940,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for tasklist_lock" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for tasklist_lock" >&5
 $as_echo_n "checking kernel symbol table for tasklist_lock... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_tasklist_lock+set}" = set; then
+    if ${cr_cv_ksymtab_tasklist_lock+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -50967,11 +39967,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -50991,38 +39987,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_tasklist_lock="Y$cr_cv_ksymtab_tasklist_lock"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_tasklist_lock="N$cr_cv_ksymtab_tasklist_lock"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51034,9 +40009,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_tasklist_lock" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol tasklist_lock but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol tasklist_lock but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol tasklist_lock but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_tasklist_lock | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -51052,18 +40025,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for shmem_file_operations" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for shmem_file_operations" >&5
 $as_echo_n "checking kernel symbol table for shmem_file_operations... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_shmem_file_operations+set}" = set; then
+    if ${cr_cv_ksymtab_shmem_file_operations+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51086,11 +40059,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51110,38 +40079,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_shmem_file_operations="Y$cr_cv_ksymtab_shmem_file_operations"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_shmem_file_operations="N$cr_cv_ksymtab_shmem_file_operations"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51172,18 +40120,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for ramfs_file_operations" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for ramfs_file_operations" >&5
 $as_echo_n "checking kernel symbol table for ramfs_file_operations... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_ramfs_file_operations+set}" = set; then
+    if ${cr_cv_ksymtab_ramfs_file_operations+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51206,11 +40154,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51230,38 +40174,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_ramfs_file_operations="Y$cr_cv_ksymtab_ramfs_file_operations"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_ramfs_file_operations="N$cr_cv_ksymtab_ramfs_file_operations"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51292,18 +40215,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for HPAGE_SHIFT" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for HPAGE_SHIFT" >&5
 $as_echo_n "checking kernel symbol table for HPAGE_SHIFT... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_HPAGE_SHIFT+set}" = set; then
+    if ${cr_cv_ksymtab_HPAGE_SHIFT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51326,11 +40249,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51350,38 +40269,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_HPAGE_SHIFT="Y$cr_cv_ksymtab_HPAGE_SHIFT"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_HPAGE_SHIFT="N$cr_cv_ksymtab_HPAGE_SHIFT"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51412,18 +40310,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for phys_base" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for phys_base" >&5
 $as_echo_n "checking kernel symbol table for phys_base... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_phys_base+set}" = set; then
+    if ${cr_cv_ksymtab_phys_base+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51446,11 +40344,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51470,38 +40364,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_phys_base="Y$cr_cv_ksymtab_phys_base"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_phys_base="N$cr_cv_ksymtab_phys_base"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51532,7 +40405,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -51541,11 +40414,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_pipe" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_pipe" >&5
 $as_echo_n "checking kernel symbol table for do_pipe... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_pipe+set}" = set; then
+    if ${cr_cv_ksymtab_do_pipe+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51568,11 +40441,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51592,38 +40461,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_do_pipe="Y$cr_cv_ksymtab_do_pipe"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_do_pipe="N$cr_cv_ksymtab_do_pipe"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51635,9 +40483,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_do_pipe" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol do_pipe but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol do_pipe but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol do_pipe but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_do_pipe | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -51653,18 +40499,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_pipe_flags" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_pipe_flags" >&5
 $as_echo_n "checking kernel symbol table for do_pipe_flags... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_pipe_flags+set}" = set; then
+    if ${cr_cv_ksymtab_do_pipe_flags+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51687,11 +40533,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51711,38 +40553,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_do_pipe_flags="Y$cr_cv_ksymtab_do_pipe_flags"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_do_pipe_flags="N$cr_cv_ksymtab_do_pipe_flags"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51754,9 +40575,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_do_pipe_flags" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol do_pipe_flags but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol do_pipe_flags but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol do_pipe_flags but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_do_pipe_flags | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -51772,18 +40591,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_munmap" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_munmap" >&5
 $as_echo_n "checking kernel symbol table for sys_munmap... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_munmap+set}" = set; then
+    if ${cr_cv_ksymtab_sys_munmap+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51806,11 +40625,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51830,38 +40645,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_munmap="Y$cr_cv_ksymtab_sys_munmap"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_munmap="N$cr_cv_ksymtab_sys_munmap"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -51892,18 +40686,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_dup2" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_dup2" >&5
 $as_echo_n "checking kernel symbol table for sys_dup2... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_dup2+set}" = set; then
+    if ${cr_cv_ksymtab_sys_dup2+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -51926,11 +40720,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -51944,44 +40734,23 @@
 
 int
 main ()
-{
-int x = sizeof(&sys_dup2);
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+{
+int x = sizeof(&sys_dup2);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_dup2="Y$cr_cv_ksymtab_sys_dup2"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_dup2="N$cr_cv_ksymtab_sys_dup2"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52012,18 +40781,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_lseek" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_lseek" >&5
 $as_echo_n "checking kernel symbol table for sys_lseek... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_lseek+set}" = set; then
+    if ${cr_cv_ksymtab_sys_lseek+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52046,11 +40815,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52070,38 +40835,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_lseek="Y$cr_cv_ksymtab_sys_lseek"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_lseek="N$cr_cv_ksymtab_sys_lseek"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52132,18 +40876,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_ftruncate" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_ftruncate" >&5
 $as_echo_n "checking kernel symbol table for sys_ftruncate... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_ftruncate+set}" = set; then
+    if ${cr_cv_ksymtab_sys_ftruncate+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52166,11 +40910,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52190,38 +40930,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_ftruncate="Y$cr_cv_ksymtab_sys_ftruncate"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_ftruncate="N$cr_cv_ksymtab_sys_ftruncate"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52252,18 +40971,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_mprotect" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_mprotect" >&5
 $as_echo_n "checking kernel symbol table for sys_mprotect... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_mprotect+set}" = set; then
+    if ${cr_cv_ksymtab_sys_mprotect+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52286,11 +41005,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52310,38 +41025,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_mprotect="Y$cr_cv_ksymtab_sys_mprotect"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_mprotect="N$cr_cv_ksymtab_sys_mprotect"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52372,18 +41066,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_setitimer" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_setitimer" >&5
 $as_echo_n "checking kernel symbol table for sys_setitimer... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_setitimer+set}" = set; then
+    if ${cr_cv_ksymtab_sys_setitimer+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52406,11 +41100,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52430,38 +41120,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setitimer="Y$cr_cv_ksymtab_sys_setitimer"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setitimer="N$cr_cv_ksymtab_sys_setitimer"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52492,18 +41161,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_prctl" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_prctl" >&5
 $as_echo_n "checking kernel symbol table for sys_prctl... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_prctl+set}" = set; then
+    if ${cr_cv_ksymtab_sys_prctl+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52526,11 +41195,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52550,38 +41215,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_prctl="Y$cr_cv_ksymtab_sys_prctl"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_prctl="N$cr_cv_ksymtab_sys_prctl"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52612,7 +41256,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -52620,11 +41264,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for copy_fs_struct" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for copy_fs_struct" >&5
 $as_echo_n "checking kernel symbol table for copy_fs_struct... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_copy_fs_struct+set}" = set; then
+    if ${cr_cv_ksymtab_copy_fs_struct+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52647,11 +41291,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52671,38 +41311,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_copy_fs_struct="Y$cr_cv_ksymtab_copy_fs_struct"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_copy_fs_struct="N$cr_cv_ksymtab_copy_fs_struct"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52714,9 +41333,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_copy_fs_struct" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol copy_fs_struct but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol copy_fs_struct but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol copy_fs_struct but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_copy_fs_struct | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -52732,18 +41349,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for put_fs_struct" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for put_fs_struct" >&5
 $as_echo_n "checking kernel symbol table for put_fs_struct... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_put_fs_struct+set}" = set; then
+    if ${cr_cv_ksymtab_put_fs_struct+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52766,11 +41383,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52790,38 +41403,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_put_fs_struct="Y$cr_cv_ksymtab_put_fs_struct"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_put_fs_struct="N$cr_cv_ksymtab_put_fs_struct"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52833,9 +41425,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_put_fs_struct" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol put_fs_struct but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol put_fs_struct but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol put_fs_struct but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_put_fs_struct | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -52851,7 +41441,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 if test -z "$cr_addr"; then
@@ -52859,11 +41449,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for free_fs_struct" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for free_fs_struct" >&5
 $as_echo_n "checking kernel symbol table for free_fs_struct... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_free_fs_struct+set}" = set; then
+    if ${cr_cv_ksymtab_free_fs_struct+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -52886,11 +41476,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -52910,38 +41496,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_free_fs_struct="Y$cr_cv_ksymtab_free_fs_struct"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_free_fs_struct="N$cr_cv_ksymtab_free_fs_struct"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -52953,9 +41518,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_free_fs_struct" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol free_fs_struct but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol free_fs_struct but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol free_fs_struct but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_free_fs_struct | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -52971,13 +41534,11 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   if test -z "$cr_addr"; then
-    { { $as_echo "$as_me:$LINENO: error: failed to find either symbol put_fs_struct or free_fs_struct" >&5
-$as_echo "$as_me: error: failed to find either symbol put_fs_struct or free_fs_struct" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "failed to find either symbol put_fs_struct or free_fs_struct" "$LINENO" 5
   fi
 fi
 
@@ -52985,11 +41546,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for CONFIG_AUDITSYSCALL" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for CONFIG_AUDITSYSCALL" >&5
 $as_echo_n "checking kernel for CONFIG_AUDITSYSCALL... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_CONFIG_AUDITSYSCALL+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_CONFIG_AUDITSYSCALL+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53001,11 +41561,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53026,38 +41582,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_CONFIG_AUDITSYSCALL=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_CONFIG_AUDITSYSCALL=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -53066,21 +41601,17 @@
   cr_result=$cr_cv_kconfig_HAVE_CONFIG_AUDITSYSCALL
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CONFIG_AUDITSYSCALL 1
-_ACEOF
+    $as_echo "#define HAVE_CONFIG_AUDITSYSCALL 1" >>confdefs.h
 
      HAVE_CONFIG_AUDITSYSCALL=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_CONFIG_AUDITSYSCALL 0
-_ACEOF
+    $as_echo "#define HAVE_CONFIG_AUDITSYSCALL 0" >>confdefs.h
 
      HAVE_CONFIG_AUDITSYSCALL=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -53088,11 +41619,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for audit_dummy_context" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for audit_dummy_context" >&5
 $as_echo_n "checking kernel for audit_dummy_context... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_AUDIT_DUMMY_CONTEXT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_AUDIT_DUMMY_CONTEXT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53104,11 +41634,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53132,38 +41658,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_AUDIT_DUMMY_CONTEXT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_AUDIT_DUMMY_CONTEXT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -53172,32 +41677,27 @@
   cr_result=$cr_cv_kconfig_HAVE_AUDIT_DUMMY_CONTEXT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_AUDIT_DUMMY_CONTEXT 1
-_ACEOF
+    $as_echo "#define HAVE_AUDIT_DUMMY_CONTEXT 1" >>confdefs.h
 
      HAVE_AUDIT_DUMMY_CONTEXT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_AUDIT_DUMMY_CONTEXT 0
-_ACEOF
+    $as_echo "#define HAVE_AUDIT_DUMMY_CONTEXT 0" >>confdefs.h
 
      HAVE_AUDIT_DUMMY_CONTEXT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.6 audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.6 audit_syscall_exit" >&5
 $as_echo_n "checking kernel for 2.6.6 audit_syscall_exit... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_6_6_AUDIT_SYSCALL_EXIT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_6_AUDIT_SYSCALL_EXIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53209,11 +41709,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53239,38 +41735,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_2_6_6_AUDIT_SYSCALL_EXIT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_2_6_6_AUDIT_SYSCALL_EXIT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -53279,32 +41754,27 @@
   cr_result=$cr_cv_kconfig_HAVE_2_6_6_AUDIT_SYSCALL_EXIT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_6_AUDIT_SYSCALL_EXIT 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_6_AUDIT_SYSCALL_EXIT 1" >>confdefs.h
 
      HAVE_2_6_6_AUDIT_SYSCALL_EXIT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_6_AUDIT_SYSCALL_EXIT 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_6_AUDIT_SYSCALL_EXIT 0" >>confdefs.h
 
      HAVE_2_6_6_AUDIT_SYSCALL_EXIT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.12 audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.12 audit_syscall_exit" >&5
 $as_echo_n "checking kernel for 2.6.12 audit_syscall_exit... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_6_12_AUDIT_SYSCALL_EXIT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_12_AUDIT_SYSCALL_EXIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53316,11 +41786,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53346,38 +41812,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_2_6_12_AUDIT_SYSCALL_EXIT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_2_6_12_AUDIT_SYSCALL_EXIT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -53386,32 +41831,27 @@
   cr_result=$cr_cv_kconfig_HAVE_2_6_12_AUDIT_SYSCALL_EXIT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_12_AUDIT_SYSCALL_EXIT 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_12_AUDIT_SYSCALL_EXIT 1" >>confdefs.h
 
      HAVE_2_6_12_AUDIT_SYSCALL_EXIT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_12_AUDIT_SYSCALL_EXIT 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_12_AUDIT_SYSCALL_EXIT 0" >>confdefs.h
 
      HAVE_2_6_12_AUDIT_SYSCALL_EXIT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for 2.6.17 audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for 2.6.17 audit_syscall_exit" >&5
 $as_echo_n "checking kernel for 2.6.17 audit_syscall_exit... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_2_6_17_AUDIT_SYSCALL_EXIT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_2_6_17_AUDIT_SYSCALL_EXIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53423,11 +41863,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53453,38 +41889,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_2_6_17_AUDIT_SYSCALL_EXIT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_2_6_17_AUDIT_SYSCALL_EXIT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -53493,32 +41908,27 @@
   cr_result=$cr_cv_kconfig_HAVE_2_6_17_AUDIT_SYSCALL_EXIT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_17_AUDIT_SYSCALL_EXIT 1
-_ACEOF
+    $as_echo "#define HAVE_2_6_17_AUDIT_SYSCALL_EXIT 1" >>confdefs.h
 
      HAVE_2_6_17_AUDIT_SYSCALL_EXIT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_2_6_17_AUDIT_SYSCALL_EXIT 0
-_ACEOF
+    $as_echo "#define HAVE_2_6_17_AUDIT_SYSCALL_EXIT 0" >>confdefs.h
 
      HAVE_2_6_17_AUDIT_SYSCALL_EXIT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for __audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for __audit_syscall_exit" >&5
 $as_echo_n "checking kernel for __audit_syscall_exit... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE___AUDIT_SYSCALL_EXIT+set}" = set; then
+    if ${cr_cv_kconfig_HAVE___AUDIT_SYSCALL_EXIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53530,11 +41940,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53558,38 +41964,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE___AUDIT_SYSCALL_EXIT=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE___AUDIT_SYSCALL_EXIT=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -53598,39 +41983,33 @@
   cr_result=$cr_cv_kconfig_HAVE___AUDIT_SYSCALL_EXIT
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___AUDIT_SYSCALL_EXIT 1
-_ACEOF
+    $as_echo "#define HAVE___AUDIT_SYSCALL_EXIT 1" >>confdefs.h
 
      HAVE___AUDIT_SYSCALL_EXIT=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE___AUDIT_SYSCALL_EXIT 0
-_ACEOF
+    $as_echo "#define HAVE___AUDIT_SYSCALL_EXIT 0" >>confdefs.h
 
      HAVE___AUDIT_SYSCALL_EXIT=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
   if test x"${HAVE_2_6_6_AUDIT_SYSCALL_EXIT}${HAVE_2_6_12_AUDIT_SYSCALL_EXIT}${HAVE_2_6_17_AUDIT_SYSCALL_EXIT}${HAVE___AUDIT_SYSCALL_EXIT}" != x"1"; then
-    { { $as_echo "$as_me:$LINENO: error: failed to determine arguments to audit_syscall_exit()" >&5
-$as_echo "$as_me: error: failed to determine arguments to audit_syscall_exit()" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "failed to determine arguments to audit_syscall_exit()" "$LINENO" 5
   fi
   if test x"${HAVE_2_6_17_AUDIT_SYSCALL_EXIT}" = x"1"; then
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for audit_syscall_exit" >&5
 $as_echo_n "checking kernel symbol table for audit_syscall_exit... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_audit_syscall_exit+set}" = set; then
+    if ${cr_cv_ksymtab_audit_syscall_exit+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53653,11 +42032,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53677,38 +42052,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_audit_syscall_exit="Y$cr_cv_ksymtab_audit_syscall_exit"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_audit_syscall_exit="N$cr_cv_ksymtab_audit_syscall_exit"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -53739,7 +42093,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   elif test x"${HAVE_2_6_12_AUDIT_SYSCALL_EXIT}" = x"1"; then
@@ -53747,11 +42101,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for audit_syscall_exit" >&5
 $as_echo_n "checking kernel symbol table for audit_syscall_exit... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_audit_syscall_exit+set}" = set; then
+    if ${cr_cv_ksymtab_audit_syscall_exit+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53774,11 +42128,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53798,38 +42148,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_audit_syscall_exit="Y$cr_cv_ksymtab_audit_syscall_exit"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_audit_syscall_exit="N$cr_cv_ksymtab_audit_syscall_exit"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -53860,7 +42189,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   elif test x"${HAVE_2_6_6_AUDIT_SYSCALL_EXIT}" = x"1"; then
@@ -53868,11 +42197,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for audit_syscall_exit" >&5
 $as_echo_n "checking kernel symbol table for audit_syscall_exit... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_audit_syscall_exit+set}" = set; then
+    if ${cr_cv_ksymtab_audit_syscall_exit+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -53895,11 +42224,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -53919,38 +42244,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_audit_syscall_exit="Y$cr_cv_ksymtab_audit_syscall_exit"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_audit_syscall_exit="N$cr_cv_ksymtab_audit_syscall_exit"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -53981,7 +42285,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   elif test x"${HAVE___AUDIT_SYSCALL_EXIT}" = x"1"; then
@@ -53989,11 +42293,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for __audit_syscall_exit" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for __audit_syscall_exit" >&5
 $as_echo_n "checking kernel symbol table for __audit_syscall_exit... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab___audit_syscall_exit+set}" = set; then
+    if ${cr_cv_ksymtab___audit_syscall_exit+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54016,11 +42320,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54040,38 +42340,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab___audit_syscall_exit="Y$cr_cv_ksymtab___audit_syscall_exit"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab___audit_syscall_exit="N$cr_cv_ksymtab___audit_syscall_exit"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -54102,19 +42381,15 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   else
     : # Unreachable?
-    { { $as_echo "$as_me:$LINENO: error: failed to determine arguments to audit_syscall_exit()" >&5
-$as_echo "$as_me: error: failed to determine arguments to audit_syscall_exit()" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "failed to determine arguments to audit_syscall_exit()" "$LINENO" 5
   fi
   if test -z "$cr_addr"; then
-    { { $as_echo "$as_me:$LINENO: error: failed to find symbol audit_syscall_exit()" >&5
-$as_echo "$as_me: error: failed to find symbol audit_syscall_exit()" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "failed to find symbol audit_syscall_exit()" "$LINENO" 5
   fi
 fi
 
@@ -54123,11 +42398,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for set_fs_pwd" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for set_fs_pwd" >&5
 $as_echo_n "checking kernel symbol table for set_fs_pwd... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_set_fs_pwd+set}" = set; then
+    if ${cr_cv_ksymtab_set_fs_pwd+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54150,11 +42425,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54174,38 +42445,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_set_fs_pwd="Y$cr_cv_ksymtab_set_fs_pwd"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_set_fs_pwd="N$cr_cv_ksymtab_set_fs_pwd"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -54217,9 +42467,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_set_fs_pwd" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol set_fs_pwd but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol set_fs_pwd but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol set_fs_pwd but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_set_fs_pwd | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -54235,7 +42483,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 # For vmadump4
@@ -54243,11 +42491,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_mremap" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_mremap" >&5
 $as_echo_n "checking kernel symbol table for sys_mremap... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_mremap+set}" = set; then
+    if ${cr_cv_ksymtab_sys_mremap+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54270,11 +42518,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54294,38 +42538,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_mremap="Y$cr_cv_ksymtab_sys_mremap"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_mremap="N$cr_cv_ksymtab_sys_mremap"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -54356,18 +42579,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for do_sigaction" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for do_sigaction" >&5
 $as_echo_n "checking kernel symbol table for do_sigaction... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_do_sigaction+set}" = set; then
+    if ${cr_cv_ksymtab_do_sigaction+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54390,11 +42613,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54414,38 +42633,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_do_sigaction="Y$cr_cv_ksymtab_do_sigaction"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_do_sigaction="N$cr_cv_ksymtab_do_sigaction"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -54457,9 +42655,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_do_sigaction" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol do_sigaction but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol do_sigaction but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol do_sigaction but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_do_sigaction | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -54475,7 +42671,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 if test $CR_KARCH = x86_64; then
@@ -54483,11 +42679,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for load_gs_index" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for load_gs_index" >&5
 $as_echo_n "checking kernel symbol table for load_gs_index... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_load_gs_index+set}" = set; then
+    if ${cr_cv_ksymtab_load_gs_index+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54510,11 +42706,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54534,38 +42726,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_load_gs_index="Y$cr_cv_ksymtab_load_gs_index"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_load_gs_index="N$cr_cv_ksymtab_load_gs_index"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -54577,9 +42748,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab_load_gs_index" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol load_gs_index but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol load_gs_index but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol load_gs_index but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab_load_gs_index | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -54595,18 +42764,17 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for read_pda" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for read_pda" >&5
 $as_echo_n "checking kernel for read_pda... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_READ_PDA+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_READ_PDA+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54618,11 +42786,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54646,38 +42810,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_READ_PDA=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_READ_PDA=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -54686,32 +42829,27 @@
   cr_result=$cr_cv_kconfig_HAVE_READ_PDA
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_READ_PDA 1
-_ACEOF
+    $as_echo "#define HAVE_READ_PDA 1" >>confdefs.h
 
      HAVE_READ_PDA=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_READ_PDA 0
-_ACEOF
+    $as_echo "#define HAVE_READ_PDA 0" >>confdefs.h
 
      HAVE_READ_PDA=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for write_pda" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for write_pda" >&5
 $as_echo_n "checking kernel for write_pda... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_WRITE_PDA+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_WRITE_PDA+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54723,11 +42861,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54751,38 +42885,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_WRITE_PDA=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_WRITE_PDA=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -54791,21 +42904,17 @@
   cr_result=$cr_cv_kconfig_HAVE_WRITE_PDA
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_WRITE_PDA 1
-_ACEOF
+    $as_echo "#define HAVE_WRITE_PDA 1" >>confdefs.h
 
      HAVE_WRITE_PDA=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_WRITE_PDA 0
-_ACEOF
+    $as_echo "#define HAVE_WRITE_PDA 0" >>confdefs.h
 
      HAVE_WRITE_PDA=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -54813,11 +42922,10 @@
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for percpu_read" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for percpu_read" >&5
 $as_echo_n "checking kernel for percpu_read... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PERCPU_READ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PERCPU_READ+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54829,11 +42937,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54857,38 +42961,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_PERCPU_READ=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_PERCPU_READ=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -54897,32 +42980,27 @@
   cr_result=$cr_cv_kconfig_HAVE_PERCPU_READ
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERCPU_READ 1
-_ACEOF
+    $as_echo "#define HAVE_PERCPU_READ 1" >>confdefs.h
 
      HAVE_PERCPU_READ=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERCPU_READ 0
-_ACEOF
+    $as_echo "#define HAVE_PERCPU_READ 0" >>confdefs.h
 
      HAVE_PERCPU_READ=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for percpu_write" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for percpu_write" >&5
 $as_echo_n "checking kernel for percpu_write... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_PERCPU_WRITE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_PERCPU_WRITE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -54934,11 +43012,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -54962,38 +43036,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_PERCPU_WRITE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_PERCPU_WRITE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -55002,32 +43055,27 @@
   cr_result=$cr_cv_kconfig_HAVE_PERCPU_WRITE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERCPU_WRITE 1
-_ACEOF
+    $as_echo "#define HAVE_PERCPU_WRITE 1" >>confdefs.h
 
      HAVE_PERCPU_WRITE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERCPU_WRITE 0
-_ACEOF
+    $as_echo "#define HAVE_PERCPU_WRITE 0" >>confdefs.h
 
      HAVE_PERCPU_WRITE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for this_cpu_read" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for this_cpu_read" >&5
 $as_echo_n "checking kernel for this_cpu_read... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_THIS_CPU_READ+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THIS_CPU_READ+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55039,11 +43087,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55067,38 +43111,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_THIS_CPU_READ=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_THIS_CPU_READ=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -55107,32 +43130,27 @@
   cr_result=$cr_cv_kconfig_HAVE_THIS_CPU_READ
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THIS_CPU_READ 1
-_ACEOF
+    $as_echo "#define HAVE_THIS_CPU_READ 1" >>confdefs.h
 
      HAVE_THIS_CPU_READ=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THIS_CPU_READ 0
-_ACEOF
+    $as_echo "#define HAVE_THIS_CPU_READ 0" >>confdefs.h
 
      HAVE_THIS_CPU_READ=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for this_cpu_write" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for this_cpu_write" >&5
 $as_echo_n "checking kernel for this_cpu_write... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_THIS_CPU_WRITE+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_THIS_CPU_WRITE+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55144,11 +43162,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55172,38 +43186,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_THIS_CPU_WRITE=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_THIS_CPU_WRITE=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -55212,21 +43205,17 @@
   cr_result=$cr_cv_kconfig_HAVE_THIS_CPU_WRITE
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THIS_CPU_WRITE 1
-_ACEOF
+    $as_echo "#define HAVE_THIS_CPU_WRITE 1" >>confdefs.h
 
      HAVE_THIS_CPU_WRITE=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_THIS_CPU_WRITE 0
-_ACEOF
+    $as_echo "#define HAVE_THIS_CPU_WRITE 0" >>confdefs.h
 
      HAVE_THIS_CPU_WRITE=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -55260,13 +43249,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -55274,8 +43263,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -55297,12 +43286,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -55317,20 +43317,18 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - found neither {read,write}_pda() nor percpu_{read,write}() nor this_cpu_{read,write}()" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - found neither {read,write}_pda() nor percpu_{read,write}() nor this_cpu_{read,write}()" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - found neither {read,write}_pda() nor percpu_{read,write}() nor this_cpu_{read,write}()" "$LINENO" 5
 
     else
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for per_cpu__old_rsp" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for per_cpu__old_rsp" >&5
 $as_echo_n "checking kernel symbol table for per_cpu__old_rsp... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_per_cpu__old_rsp+set}" = set; then
+    if ${cr_cv_ksymtab_per_cpu__old_rsp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55353,11 +43351,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55377,38 +43371,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_per_cpu__old_rsp="Y$cr_cv_ksymtab_per_cpu__old_rsp"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_per_cpu__old_rsp="N$cr_cv_ksymtab_per_cpu__old_rsp"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -55439,7 +43412,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
       if test -z "$cr_addr"; then
@@ -55447,11 +43420,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for old_rsp" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for old_rsp" >&5
 $as_echo_n "checking kernel symbol table for old_rsp... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_old_rsp+set}" = set; then
+    if ${cr_cv_ksymtab_old_rsp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55474,11 +43447,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55498,38 +43467,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_old_rsp="Y$cr_cv_ksymtab_old_rsp"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_old_rsp="N$cr_cv_ksymtab_old_rsp"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -55560,13 +43508,11 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
         if test -z "$cr_addr"; then
-          { { $as_echo "$as_me:$LINENO: error: failed to locate either symbol per_cpu__old_rsp or old_rsp" >&5
-$as_echo "$as_me: error: failed to locate either symbol per_cpu__old_rsp or old_rsp" >&2;}
-   { (exit 1); exit 1; }; }
+          as_fn_error $? "failed to locate either symbol per_cpu__old_rsp or old_rsp" "$LINENO" 5
         fi
       fi
     fi
@@ -55577,11 +43523,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_setgroups" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_setgroups" >&5
 $as_echo_n "checking kernel symbol table for sys_setgroups... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_setgroups+set}" = set; then
+    if ${cr_cv_ksymtab_sys_setgroups+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55604,11 +43550,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55628,38 +43570,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setgroups="Y$cr_cv_ksymtab_sys_setgroups"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setgroups="N$cr_cv_ksymtab_sys_setgroups"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -55690,18 +43611,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_setresuid" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_setresuid" >&5
 $as_echo_n "checking kernel symbol table for sys_setresuid... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_setresuid+set}" = set; then
+    if ${cr_cv_ksymtab_sys_setresuid+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55724,11 +43645,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55748,38 +43665,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setresuid="Y$cr_cv_ksymtab_sys_setresuid"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setresuid="N$cr_cv_ksymtab_sys_setresuid"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -55810,18 +43706,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_setresgid" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_setresgid" >&5
 $as_echo_n "checking kernel symbol table for sys_setresgid... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_setresgid+set}" = set; then
+    if ${cr_cv_ksymtab_sys_setresgid+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55844,11 +43740,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55864,42 +43756,21 @@
 main ()
 {
 int x = sizeof(&sys_setresgid);
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setresgid="Y$cr_cv_ksymtab_sys_setresgid"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_setresgid="N$cr_cv_ksymtab_sys_setresgid"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -55930,7 +43801,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 fi
@@ -55938,11 +43809,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for expand_files" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for expand_files" >&5
 $as_echo_n "checking kernel symbol table for expand_files... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_expand_files+set}" = set; then
+    if ${cr_cv_ksymtab_expand_files+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -55965,11 +43836,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -55989,38 +43856,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_expand_files="Y$cr_cv_ksymtab_expand_files"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_expand_files="N$cr_cv_ksymtab_expand_files"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -56051,18 +43897,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for __flush_icache_range" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for __flush_icache_range" >&5
 $as_echo_n "checking kernel symbol table for __flush_icache_range... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab___flush_icache_range+set}" = set; then
+    if ${cr_cv_ksymtab___flush_icache_range+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56085,11 +43931,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -56109,38 +43951,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab___flush_icache_range="Y$cr_cv_ksymtab___flush_icache_range"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab___flush_icache_range="N$cr_cv_ksymtab___flush_icache_range"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -56152,9 +43973,7 @@
     cr_result='not found'
   else
     if expr "$cr_cv_ksymtab___flush_icache_range" : N >/dev/null; then
-      { { $as_echo "$as_me:$LINENO: error: Found symbol __flush_icache_range but no declaration -- please file a bug report." >&5
-$as_echo "$as_me: error: Found symbol __flush_icache_range but no declaration -- please file a bug report." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Found symbol __flush_icache_range but no declaration -- please file a bug report." "$LINENO" 5
     fi
     cr_result=`echo $cr_cv_ksymtab___flush_icache_range | tr -d 'YN'`
     if test $cr_result = 0; then
@@ -56170,7 +43989,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -56178,11 +43997,11 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_fchmod" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_fchmod" >&5
 $as_echo_n "checking kernel symbol table for sys_fchmod... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_fchmod+set}" = set; then
+    if ${cr_cv_ksymtab_sys_fchmod+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56205,11 +44024,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -56229,38 +44044,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_fchmod="Y$cr_cv_ksymtab_sys_fchmod"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_fchmod="N$cr_cv_ksymtab_sys_fchmod"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -56291,18 +44085,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_link" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_link" >&5
 $as_echo_n "checking kernel symbol table for sys_link... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_link+set}" = set; then
+    if ${cr_cv_ksymtab_sys_link+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56325,11 +44119,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -56349,38 +44139,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_link="Y$cr_cv_ksymtab_sys_link"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_link="N$cr_cv_ksymtab_sys_link"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -56411,18 +44180,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_unlink" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_unlink" >&5
 $as_echo_n "checking kernel symbol table for sys_unlink... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_unlink+set}" = set; then
+    if ${cr_cv_ksymtab_sys_unlink+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56445,11 +44214,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -56469,38 +44234,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_unlink="Y$cr_cv_ksymtab_sys_unlink"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_unlink="N$cr_cv_ksymtab_sys_unlink"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -56531,18 +44275,18 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for sys_mknod" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for sys_mknod" >&5
 $as_echo_n "checking kernel symbol table for sys_mknod... " >&6; }
   # Our cacheval is encoded with 'Y' or 'N' as the first char to indicate
   # if a declaration was found or not, and the address or 0 as the rest.
-    if test "${cr_cv_ksymtab_sys_mknod+set}" = set; then
+    if ${cr_cv_ksymtab_sys_mknod+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56565,11 +44309,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -56589,38 +44329,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_mknod="Y$cr_cv_ksymtab_sys_mknod"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_ksymtab_sys_mknod="N$cr_cv_ksymtab_sys_mknod"
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
     fi
@@ -56651,7 +44370,7 @@
 _ACEOF
 
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -56667,9 +44386,9 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for exported register_chrdev" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for exported register_chrdev" >&5
 $as_echo_n "checking kernel symbol table for exported register_chrdev... " >&6; }
-    if test "${cr_cv_ksymtab_exp_register_chrdev+set}" = set; then
+    if ${cr_cv_ksymtab_exp_register_chrdev+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56698,7 +44417,7 @@
     cr_result='not found'
     cr_addr=0
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 if test "$cr_addr" = "0"; then
@@ -56706,9 +44425,9 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for exported __register_chrdev" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for exported __register_chrdev" >&5
 $as_echo_n "checking kernel symbol table for exported __register_chrdev... " >&6; }
-    if test "${cr_cv_ksymtab_exp___register_chrdev+set}" = set; then
+    if ${cr_cv_ksymtab_exp___register_chrdev+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56737,7 +44456,7 @@
     cr_result='not found'
     cr_addr=0
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
   if test "$cr_addr" = "0"; then
@@ -56769,13 +44488,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -56783,8 +44502,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -56806,12 +44525,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -56826,9 +44556,7 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - kernel does not export register_chrdev or __register_chrdev" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - kernel does not export register_chrdev or __register_chrdev" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - kernel does not export register_chrdev or __register_chrdev" "$LINENO" 5
 
   fi
 fi
@@ -56836,9 +44564,9 @@
 
 
 
-  { $as_echo "$as_me:$LINENO: checking kernel symbol table for exported register_blkdev" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel symbol table for exported register_blkdev" >&5
 $as_echo_n "checking kernel symbol table for exported register_blkdev... " >&6; }
-    if test "${cr_cv_ksymtab_exp_register_blkdev+set}" = set; then
+    if ${cr_cv_ksymtab_exp_register_blkdev+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56867,7 +44595,7 @@
     cr_result='not found'
     cr_addr=0
   fi
-    { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 if test "$cr_addr" = "0"; then
@@ -56899,13 +44627,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -56913,8 +44641,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -56936,12 +44664,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -56956,20 +44695,17 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - kernel does not export register_blkdev" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - kernel does not export register_blkdev" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - kernel does not export register_blkdev" "$LINENO" 5
 
 fi
 # One of {init,system}_utsname is used to validate UTS_RELEASE
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for init_utsname" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for init_utsname" >&5
 $as_echo_n "checking kernel for init_utsname... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_INIT_UTSNAME+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_INIT_UTSNAME+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -56981,11 +44717,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -57009,38 +44741,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_INIT_UTSNAME=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_INIT_UTSNAME=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -57049,32 +44760,27 @@
   cr_result=$cr_cv_kconfig_HAVE_INIT_UTSNAME
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INIT_UTSNAME 1
-_ACEOF
+    $as_echo "#define HAVE_INIT_UTSNAME 1" >>confdefs.h
 
      HAVE_INIT_UTSNAME=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_INIT_UTSNAME 0
-_ACEOF
+    $as_echo "#define HAVE_INIT_UTSNAME 0" >>confdefs.h
 
      HAVE_INIT_UTSNAME=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
 
 
 
-
-  { $as_echo "$as_me:$LINENO: checking kernel for system_utsname" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking kernel for system_utsname" >&5
 $as_echo_n "checking kernel for system_utsname... " >&6; }
 
-    if test "${cr_cv_kconfig_HAVE_SYSTEM_UTSNAME+set}" = set; then
+    if ${cr_cv_kconfig_HAVE_SYSTEM_UTSNAME+:} false; then :
   $as_echo_n "(cached) " >&6
 else
 
@@ -57086,11 +44792,7 @@
   CC=$KCC
   CFLAGS=""
   CPPFLAGS="$KCFLAGS"
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 		 #include <linux/kernel.h>
@@ -57109,38 +44811,17 @@
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_SYSTEM_UTSNAME=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CC=$SAVE_CC
+  CC=$SAVE_CC
 	 CFLAGS=$SAVE_CFLAGS
 	 CPPFLAGS=$SAVE_CPPFLAGS
 	 cr_cv_kconfig_HAVE_SYSTEM_UTSNAME=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
@@ -57149,21 +44830,17 @@
   cr_result=$cr_cv_kconfig_HAVE_SYSTEM_UTSNAME
 
   if test $cr_result = yes; then
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SYSTEM_UTSNAME 1
-_ACEOF
+    $as_echo "#define HAVE_SYSTEM_UTSNAME 1" >>confdefs.h
 
      HAVE_SYSTEM_UTSNAME=1
   else
-    cat >>confdefs.h <<\_ACEOF
-#define HAVE_SYSTEM_UTSNAME 0
-_ACEOF
+    $as_echo "#define HAVE_SYSTEM_UTSNAME 0" >>confdefs.h
 
      HAVE_SYSTEM_UTSNAME=''
   fi
 
 
-  { $as_echo "$as_me:$LINENO: result: $cr_result" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $cr_result" >&5
 $as_echo "$cr_result" >&6; }
 
 
@@ -57196,13 +44873,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -57210,8 +44887,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -57233,12 +44910,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -57253,9 +44941,7 @@
   echo "  Kernel running currently = `uname -r`"
   echo "======================================================================"
 
-   { { $as_echo "$as_me:$LINENO: error: Unable to use kernel $LINUX_VER - unable to determine how to query UTSNAME" >&5
-$as_echo "$as_me: error: Unable to use kernel $LINUX_VER - unable to determine how to query UTSNAME" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unable to use kernel $LINUX_VER - unable to determine how to query UTSNAME" "$LINENO" 5
 
 fi
 
@@ -57269,39 +44955,30 @@
 
 
 if test x"$cr_build_libcr" = xyes && expr $CR_ARCH : ppc >/dev/null; then
-  { $as_echo "$as_me:$LINENO: checking for work around for bug 2524" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for work around for bug 2524" >&5
 $as_echo_n "checking for work around for bug 2524... " >&6; }
   if test "$cr_build_modules,$force_bug2524" = "yes,"; then
     if test `echo $LINUX_VER | sed -e 's/^2\.6\.\([0-9]*\).*/\1/;' -e 's/^3\..*/999/;'` -le 15; then
-      { { $as_echo "$as_me:$LINENO: error: Because you are building for a PowerPC kernel 2.6.15 or older, you must specify either --with-bug2524 or --without-bug2524.  If in doubt --with-bug2524 is the safe option (with a small performance penalty)." >&5
-$as_echo "$as_me: error: Because you are building for a PowerPC kernel 2.6.15 or older, you must specify either --with-bug2524 or --without-bug2524.  If in doubt --with-bug2524 is the safe option (with a small performance penalty)." >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "Because you are building for a PowerPC kernel 2.6.15 or older, you must specify either --with-bug2524 or --without-bug2524.  If in doubt --with-bug2524 is the safe option (with a small performance penalty)." "$LINENO" 5
     fi
   fi
   case "$force_bug2524" in
     yes|no) ;; # nothing to do
     '') force_bug2524=no ;; # empty is no
-    *) { { $as_echo "$as_me:$LINENO: error: Argument to --with-bug2524 must be 'yes', 'no' or empty" >&5
-$as_echo "$as_me: error: Argument to --with-bug2524 must be 'yes', 'no' or empty" >&2;}
-   { (exit 1); exit 1; }; } ;;
+    *) as_fn_error $? "Argument to --with-bug2524 must be 'yes', 'no' or empty" "$LINENO" 5 ;;
   esac
-  { $as_echo "$as_me:$LINENO: result: $force_bug2524" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $force_bug2524" >&5
 $as_echo "$force_bug2524" >&6; }
 
   if test x$force_bug2524 = xyes; then
-    cat >>confdefs.h <<\_ACEOF
-#define CR_HAVE_BUG2524 1
-_ACEOF
+    $as_echo "#define CR_HAVE_BUG2524 1" >>confdefs.h
 
   else
-    cat >>confdefs.h <<\_ACEOF
-#define CR_HAVE_BUG2524 0
-_ACEOF
+    $as_echo "#define CR_HAVE_BUG2524 0" >>confdefs.h
 
   fi
 
 
-
 fi
 
 ################################################################################
@@ -57501,13 +45178,13 @@
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -57515,8 +45192,8 @@
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -57538,12 +45215,23 @@
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -57557,14 +45245,15 @@
 
 ac_libobjs=
 ac_ltlibobjs=
+U=
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
   ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
   # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
   #    will be set to the directory where LIBOBJS objects are built.
-  ac_libobjs="$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext"
-  ac_ltlibobjs="$ac_ltlibobjs \${LIBOBJDIR}$ac_i"'$U.lo'
+  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
+  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
 done
 LIBOBJS=$ac_libobjs
 
@@ -57579,217 +45268,131 @@
   am__EXEEXT_FALSE=
 fi
 
+if test -z "${MAINTAINER_MODE_TRUE}" && test -z "${MAINTAINER_MODE_FALSE}"; then
+  as_fn_error $? "conditional \"MAINTAINER_MODE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${CRI_DEBUG_TRUE}" && test -z "${CRI_DEBUG_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CRI_DEBUG\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CRI_DEBUG\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CRI_DEBUG\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${LIBCR_TRACING_TRUE}" && test -z "${LIBCR_TRACING_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"LIBCR_TRACING\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"LIBCR_TRACING\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"LIBCR_TRACING\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_KERNEL_TRACING_TRUE}" && test -z "${CR_KERNEL_TRACING_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_KERNEL_TRACING\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_KERNEL_TRACING\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_KERNEL_TRACING\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_ETC_TRUE}" && test -z "${CR_BUILD_ETC_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_ETC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_ETC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_ETC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_INSTALLED_LIBCR_TRUE}" && test -z "${CR_INSTALLED_LIBCR_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_INSTALLED_LIBCR\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_INSTALLED_LIBCR\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_INSTALLED_LIBCR\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_INSTALLED_UTIL_TRUE}" && test -z "${CR_INSTALLED_UTIL_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_INSTALLED_UTIL\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_INSTALLED_UTIL\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_INSTALLED_UTIL\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_TESTSUITE_TRUE}" && test -z "${CR_BUILD_TESTSUITE_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_TESTSUITE\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_TESTSUITE\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_TESTSUITE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${AMDEP_TRUE}" && test -z "${AMDEP_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"AMDEP\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"AMDEP\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${am__fastdepCC_TRUE}" && test -z "${am__fastdepCC_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"am__fastdepCC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"am__fastdepCC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
-fi
-if test -z "${am__fastdepCXX_TRUE}" && test -z "${am__fastdepCXX_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"am__fastdepCXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"am__fastdepCXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${am__fastdepCXX_TRUE}" && test -z "${am__fastdepCXX_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"am__fastdepCXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"am__fastdepCXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"am__fastdepCXX\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_ENABLE_STATIC_TRUE}" && test -z "${CR_ENABLE_STATIC_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_ENABLE_STATIC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_ENABLE_STATIC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_ENABLE_STATIC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_ENABLE_SHARED_TRUE}" && test -z "${CR_ENABLE_SHARED_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_ENABLE_SHARED\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_ENABLE_SHARED\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_ENABLE_SHARED\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${HAVE_RPMBUILD_TRUE}" && test -z "${HAVE_RPMBUILD_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"HAVE_RPMBUILD\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"HAVE_RPMBUILD\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"HAVE_RPMBUILD\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${am__fastdepCC_TRUE}" && test -z "${am__fastdepCC_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"am__fastdepCC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"am__fastdepCC\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_LIBCR32_TRUE}" && test -z "${CR_BUILD_LIBCR32_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_LIBCR32\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_LIBCR32\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_LIBCR32\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_HAVE_SYSTEM_MAP_TRUE}" && test -z "${CR_HAVE_SYSTEM_MAP_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_HAVE_SYSTEM_MAP\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_HAVE_SYSTEM_MAP\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_HAVE_SYSTEM_MAP\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_MAN_TRUE}" && test -z "${CR_BUILD_MAN_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_MAN\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_MAN\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_MAN\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_HAVE_FTB_TRUE}" && test -z "${CR_HAVE_FTB_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_HAVE_FTB\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_HAVE_FTB\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_HAVE_FTB\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_HAVE_CXX_TRUE}" && test -z "${CR_HAVE_CXX_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_HAVE_CXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_HAVE_CXX\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_HAVE_CXX\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_CR_INFO_TRUE}" && test -z "${BUILD_CR_INFO_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"BUILD_CR_INFO\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"BUILD_CR_INFO\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"BUILD_CR_INFO\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_VMADLIB_TRUE}" && test -z "${BUILD_VMADLIB_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"BUILD_VMADLIB\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"BUILD_VMADLIB\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"BUILD_VMADLIB\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_MODULES_TRUE}" && test -z "${CR_BUILD_MODULES_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_MODULES\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_MODULES\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_MODULES\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_UTIL_TRUE}" && test -z "${CR_BUILD_UTIL_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_UTIL\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_UTIL\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_UTIL\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_LIBCR_TRUE}" && test -z "${CR_BUILD_LIBCR_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_LIBCR\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_LIBCR\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_LIBCR\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_INCLUDE_TRUE}" && test -z "${CR_BUILD_INCLUDE_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_INCLUDE\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_INCLUDE\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_INCLUDE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_TESTS_TRUE}" && test -z "${CR_BUILD_TESTS_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_TESTS\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_TESTS\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_TESTS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_EXAMPLES_TRUE}" && test -z "${CR_BUILD_EXAMPLES_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_EXAMPLES\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_EXAMPLES\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_EXAMPLES\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${CR_BUILD_CONTRIB_TRUE}" && test -z "${CR_BUILD_CONTRIB_FALSE}"; then
-  { { $as_echo "$as_me:$LINENO: error: conditional \"CR_BUILD_CONTRIB\" was never defined.
-Usually this means the macro was only invoked conditionally." >&5
-$as_echo "$as_me: error: conditional \"CR_BUILD_CONTRIB\" was never defined.
-Usually this means the macro was only invoked conditionally." >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "conditional \"CR_BUILD_CONTRIB\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 
-: ${CONFIG_STATUS=./config.status}
+: "${CONFIG_STATUS=./config.status}"
 ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ $as_echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
 $as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
-cat >$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+as_write_fail=0
+cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
 #! $SHELL
 # Generated by $as_me.
 # Run this file to recreate the current configuration.
@@ -57799,17 +45402,18 @@
 debug=false
 ac_cs_recheck=false
 ac_cs_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -57817,23 +45421,15 @@
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -57841,7 +45437,13 @@
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -57852,7 +45454,7 @@
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -57875,13 +45477,6 @@
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -57891,15 +45486,16 @@
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -57911,12 +45507,16 @@
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -57928,7 +45528,89 @@
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
 if expr a : '\(a\)' >/dev/null 2>&1 &&
    test "X`expr 00001 : '.*\(...\)'`" = X001; then
   as_expr=expr
@@ -57942,8 +45624,12 @@
   as_basename=false
 fi
 
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
 
-# Name of the executable.
 as_me=`$as_basename -- "$0" ||
 $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
 	 X"$0" : 'X\(//\)$' \| \
@@ -57963,76 +45649,25 @@
 	  }
 	  s/.*/./; q'`
 
-# CDPATH.
-$as_unset CDPATH
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -58047,49 +45682,85 @@
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -58099,13 +45770,19 @@
 
 
 exec 6>&1
+## ----------------------------------- ##
+## Main body of $CONFIG_STATUS script. ##
+## ----------------------------------- ##
+_ASEOF
+test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
 
-# Save the log message, to keep $[0] and so on meaningful, and to
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# Save the log message, to keep $0 and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
 This file was extended by blcr $as_me 0.8.5, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -58137,13 +45814,15 @@
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 ac_cs_usage="\
-\`$as_me' instantiates files from templates according to the
-current configuration.
+\`$as_me' instantiates files and other configuration actions
+from templates according to the current configuration.  Unless the files
+and actions are specified as TAGs, all are instantiated by default.
 
-Usage: $0 [OPTION]... [FILE]...
+Usage: $0 [OPTION]... [TAG]...
 
   -h, --help       print this help, then exit
   -V, --version    print version number and configuration settings, then exit
+      --config     print configuration, then exit
   -q, --quiet, --silent
                    do not print progress messages
   -d, --debug      don't remove temporary files
@@ -58162,16 +45841,17 @@
 Configuration commands:
 $config_commands
 
-Report bugs to <bug-autoconf@gnu.org>."
+Report bugs to <http://ftg.lbl.gov/checkpoint>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 blcr config.status 0.8.5
-configured by $0, generated by GNU Autoconf 2.63,
-  with options \\"`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
+configured by $0, generated by GNU Autoconf 2.69,
+  with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2008 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -58189,11 +45869,16 @@
 while test $# != 0
 do
   case $1 in
-  --*=*)
+  --*=?*)
     ac_option=`expr "X$1" : 'X\([^=]*\)='`
     ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
   *)
     ac_option=$1
     ac_optarg=$2
@@ -58207,27 +45892,29 @@
     ac_cs_recheck=: ;;
   --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
     $as_echo "$ac_cs_version"; exit ;;
+  --config | --confi | --conf | --con | --co | --c )
+    $as_echo "$ac_cs_config"; exit ;;
   --debug | --debu | --deb | --de | --d | -d )
     debug=: ;;
   --file | --fil | --fi | --f )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
     esac
-    CONFIG_FILES="$CONFIG_FILES '$ac_optarg'"
+    as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
   --header | --heade | --head | --hea )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
-    CONFIG_HEADERS="$CONFIG_HEADERS '$ac_optarg'"
+    as_fn_append CONFIG_HEADERS " '$ac_optarg'"
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    { $as_echo "$as_me: error: ambiguous option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; };;
+    as_fn_error $? "ambiguous option: \`$1'
+Try \`$0 --help' for more information.";;
   --help | --hel | -h )
     $as_echo "$ac_cs_usage"; exit ;;
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
@@ -58235,11 +45922,10 @@
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) { $as_echo "$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; } ;;
+  -*) as_fn_error $? "unrecognized option: \`$1'
+Try \`$0 --help' for more information." ;;
 
-  *) ac_config_targets="$ac_config_targets $1"
+  *) as_fn_append ac_config_targets " $1"
      ac_need_defaults=false ;;
 
   esac
@@ -58256,7 +45942,7 @@
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
@@ -58290,184 +45976,208 @@
 sed_quote_subst='$sed_quote_subst'
 double_quote_subst='$double_quote_subst'
 delay_variable_subst='$delay_variable_subst'
-enable_static='`$ECHO "X$enable_static" | $Xsed -e "$delay_single_quote_subst"`'
-macro_version='`$ECHO "X$macro_version" | $Xsed -e "$delay_single_quote_subst"`'
-macro_revision='`$ECHO "X$macro_revision" | $Xsed -e "$delay_single_quote_subst"`'
-enable_shared='`$ECHO "X$enable_shared" | $Xsed -e "$delay_single_quote_subst"`'
-pic_mode='`$ECHO "X$pic_mode" | $Xsed -e "$delay_single_quote_subst"`'
-enable_fast_install='`$ECHO "X$enable_fast_install" | $Xsed -e "$delay_single_quote_subst"`'
-host_alias='`$ECHO "X$host_alias" | $Xsed -e "$delay_single_quote_subst"`'
-host='`$ECHO "X$host" | $Xsed -e "$delay_single_quote_subst"`'
-host_os='`$ECHO "X$host_os" | $Xsed -e "$delay_single_quote_subst"`'
-build_alias='`$ECHO "X$build_alias" | $Xsed -e "$delay_single_quote_subst"`'
-build='`$ECHO "X$build" | $Xsed -e "$delay_single_quote_subst"`'
-build_os='`$ECHO "X$build_os" | $Xsed -e "$delay_single_quote_subst"`'
-SED='`$ECHO "X$SED" | $Xsed -e "$delay_single_quote_subst"`'
-Xsed='`$ECHO "X$Xsed" | $Xsed -e "$delay_single_quote_subst"`'
-GREP='`$ECHO "X$GREP" | $Xsed -e "$delay_single_quote_subst"`'
-EGREP='`$ECHO "X$EGREP" | $Xsed -e "$delay_single_quote_subst"`'
-FGREP='`$ECHO "X$FGREP" | $Xsed -e "$delay_single_quote_subst"`'
-LD='`$ECHO "X$LD" | $Xsed -e "$delay_single_quote_subst"`'
-NM='`$ECHO "X$NM" | $Xsed -e "$delay_single_quote_subst"`'
-LN_S='`$ECHO "X$LN_S" | $Xsed -e "$delay_single_quote_subst"`'
-max_cmd_len='`$ECHO "X$max_cmd_len" | $Xsed -e "$delay_single_quote_subst"`'
-ac_objext='`$ECHO "X$ac_objext" | $Xsed -e "$delay_single_quote_subst"`'
-exeext='`$ECHO "X$exeext" | $Xsed -e "$delay_single_quote_subst"`'
-lt_unset='`$ECHO "X$lt_unset" | $Xsed -e "$delay_single_quote_subst"`'
-lt_SP2NL='`$ECHO "X$lt_SP2NL" | $Xsed -e "$delay_single_quote_subst"`'
-lt_NL2SP='`$ECHO "X$lt_NL2SP" | $Xsed -e "$delay_single_quote_subst"`'
-reload_flag='`$ECHO "X$reload_flag" | $Xsed -e "$delay_single_quote_subst"`'
-reload_cmds='`$ECHO "X$reload_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-OBJDUMP='`$ECHO "X$OBJDUMP" | $Xsed -e "$delay_single_quote_subst"`'
-deplibs_check_method='`$ECHO "X$deplibs_check_method" | $Xsed -e "$delay_single_quote_subst"`'
-file_magic_cmd='`$ECHO "X$file_magic_cmd" | $Xsed -e "$delay_single_quote_subst"`'
-AR='`$ECHO "X$AR" | $Xsed -e "$delay_single_quote_subst"`'
-AR_FLAGS='`$ECHO "X$AR_FLAGS" | $Xsed -e "$delay_single_quote_subst"`'
-STRIP='`$ECHO "X$STRIP" | $Xsed -e "$delay_single_quote_subst"`'
-RANLIB='`$ECHO "X$RANLIB" | $Xsed -e "$delay_single_quote_subst"`'
-old_postinstall_cmds='`$ECHO "X$old_postinstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-old_postuninstall_cmds='`$ECHO "X$old_postuninstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_cmds='`$ECHO "X$old_archive_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-CC='`$ECHO "X$CC" | $Xsed -e "$delay_single_quote_subst"`'
-CFLAGS='`$ECHO "X$CFLAGS" | $Xsed -e "$delay_single_quote_subst"`'
-compiler='`$ECHO "X$compiler" | $Xsed -e "$delay_single_quote_subst"`'
-GCC='`$ECHO "X$GCC" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_pipe='`$ECHO "X$lt_cv_sys_global_symbol_pipe" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_to_cdecl='`$ECHO "X$lt_cv_sys_global_symbol_to_cdecl" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_to_c_name_address='`$ECHO "X$lt_cv_sys_global_symbol_to_c_name_address" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix='`$ECHO "X$lt_cv_sys_global_symbol_to_c_name_address_lib_prefix" | $Xsed -e "$delay_single_quote_subst"`'
-objdir='`$ECHO "X$objdir" | $Xsed -e "$delay_single_quote_subst"`'
-SHELL='`$ECHO "X$SHELL" | $Xsed -e "$delay_single_quote_subst"`'
-ECHO='`$ECHO "X$ECHO" | $Xsed -e "$delay_single_quote_subst"`'
-MAGIC_CMD='`$ECHO "X$MAGIC_CMD" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_no_builtin_flag='`$ECHO "X$lt_prog_compiler_no_builtin_flag" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_wl='`$ECHO "X$lt_prog_compiler_wl" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_pic='`$ECHO "X$lt_prog_compiler_pic" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_static='`$ECHO "X$lt_prog_compiler_static" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_prog_compiler_c_o='`$ECHO "X$lt_cv_prog_compiler_c_o" | $Xsed -e "$delay_single_quote_subst"`'
-need_locks='`$ECHO "X$need_locks" | $Xsed -e "$delay_single_quote_subst"`'
-DSYMUTIL='`$ECHO "X$DSYMUTIL" | $Xsed -e "$delay_single_quote_subst"`'
-NMEDIT='`$ECHO "X$NMEDIT" | $Xsed -e "$delay_single_quote_subst"`'
-LIPO='`$ECHO "X$LIPO" | $Xsed -e "$delay_single_quote_subst"`'
-OTOOL='`$ECHO "X$OTOOL" | $Xsed -e "$delay_single_quote_subst"`'
-OTOOL64='`$ECHO "X$OTOOL64" | $Xsed -e "$delay_single_quote_subst"`'
-libext='`$ECHO "X$libext" | $Xsed -e "$delay_single_quote_subst"`'
-shrext_cmds='`$ECHO "X$shrext_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-extract_expsyms_cmds='`$ECHO "X$extract_expsyms_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-archive_cmds_need_lc='`$ECHO "X$archive_cmds_need_lc" | $Xsed -e "$delay_single_quote_subst"`'
-enable_shared_with_static_runtimes='`$ECHO "X$enable_shared_with_static_runtimes" | $Xsed -e "$delay_single_quote_subst"`'
-export_dynamic_flag_spec='`$ECHO "X$export_dynamic_flag_spec" | $Xsed -e "$delay_single_quote_subst"`'
-whole_archive_flag_spec='`$ECHO "X$whole_archive_flag_spec" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_needs_object='`$ECHO "X$compiler_needs_object" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_from_new_cmds='`$ECHO "X$old_archive_from_new_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_from_expsyms_cmds='`$ECHO "X$old_archive_from_expsyms_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-archive_cmds='`$ECHO "X$archive_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-archive_expsym_cmds='`$ECHO "X$archive_expsym_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-module_cmds='`$ECHO "X$module_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-module_expsym_cmds='`$ECHO "X$module_expsym_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-with_gnu_ld='`$ECHO "X$with_gnu_ld" | $Xsed -e "$delay_single_quote_subst"`'
-allow_undefined_flag='`$ECHO "X$allow_undefined_flag" | $Xsed -e "$delay_single_quote_subst"`'
-no_undefined_flag='`$ECHO "X$no_undefined_flag" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec='`$ECHO "X$hardcode_libdir_flag_spec" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec_ld='`$ECHO "X$hardcode_libdir_flag_spec_ld" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_separator='`$ECHO "X$hardcode_libdir_separator" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_direct='`$ECHO "X$hardcode_direct" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_direct_absolute='`$ECHO "X$hardcode_direct_absolute" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_minus_L='`$ECHO "X$hardcode_minus_L" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_shlibpath_var='`$ECHO "X$hardcode_shlibpath_var" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_automatic='`$ECHO "X$hardcode_automatic" | $Xsed -e "$delay_single_quote_subst"`'
-inherit_rpath='`$ECHO "X$inherit_rpath" | $Xsed -e "$delay_single_quote_subst"`'
-link_all_deplibs='`$ECHO "X$link_all_deplibs" | $Xsed -e "$delay_single_quote_subst"`'
-fix_srcfile_path='`$ECHO "X$fix_srcfile_path" | $Xsed -e "$delay_single_quote_subst"`'
-always_export_symbols='`$ECHO "X$always_export_symbols" | $Xsed -e "$delay_single_quote_subst"`'
-export_symbols_cmds='`$ECHO "X$export_symbols_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-exclude_expsyms='`$ECHO "X$exclude_expsyms" | $Xsed -e "$delay_single_quote_subst"`'
-include_expsyms='`$ECHO "X$include_expsyms" | $Xsed -e "$delay_single_quote_subst"`'
-prelink_cmds='`$ECHO "X$prelink_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-file_list_spec='`$ECHO "X$file_list_spec" | $Xsed -e "$delay_single_quote_subst"`'
-variables_saved_for_relink='`$ECHO "X$variables_saved_for_relink" | $Xsed -e "$delay_single_quote_subst"`'
-need_lib_prefix='`$ECHO "X$need_lib_prefix" | $Xsed -e "$delay_single_quote_subst"`'
-need_version='`$ECHO "X$need_version" | $Xsed -e "$delay_single_quote_subst"`'
-version_type='`$ECHO "X$version_type" | $Xsed -e "$delay_single_quote_subst"`'
-runpath_var='`$ECHO "X$runpath_var" | $Xsed -e "$delay_single_quote_subst"`'
-shlibpath_var='`$ECHO "X$shlibpath_var" | $Xsed -e "$delay_single_quote_subst"`'
-shlibpath_overrides_runpath='`$ECHO "X$shlibpath_overrides_runpath" | $Xsed -e "$delay_single_quote_subst"`'
-libname_spec='`$ECHO "X$libname_spec" | $Xsed -e "$delay_single_quote_subst"`'
-library_names_spec='`$ECHO "X$library_names_spec" | $Xsed -e "$delay_single_quote_subst"`'
-soname_spec='`$ECHO "X$soname_spec" | $Xsed -e "$delay_single_quote_subst"`'
-postinstall_cmds='`$ECHO "X$postinstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-postuninstall_cmds='`$ECHO "X$postuninstall_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-finish_cmds='`$ECHO "X$finish_cmds" | $Xsed -e "$delay_single_quote_subst"`'
-finish_eval='`$ECHO "X$finish_eval" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_into_libs='`$ECHO "X$hardcode_into_libs" | $Xsed -e "$delay_single_quote_subst"`'
-sys_lib_search_path_spec='`$ECHO "X$sys_lib_search_path_spec" | $Xsed -e "$delay_single_quote_subst"`'
-sys_lib_dlsearch_path_spec='`$ECHO "X$sys_lib_dlsearch_path_spec" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_action='`$ECHO "X$hardcode_action" | $Xsed -e "$delay_single_quote_subst"`'
-enable_dlopen='`$ECHO "X$enable_dlopen" | $Xsed -e "$delay_single_quote_subst"`'
-enable_dlopen_self='`$ECHO "X$enable_dlopen_self" | $Xsed -e "$delay_single_quote_subst"`'
-enable_dlopen_self_static='`$ECHO "X$enable_dlopen_self_static" | $Xsed -e "$delay_single_quote_subst"`'
-old_striplib='`$ECHO "X$old_striplib" | $Xsed -e "$delay_single_quote_subst"`'
-striplib='`$ECHO "X$striplib" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_lib_search_dirs='`$ECHO "X$compiler_lib_search_dirs" | $Xsed -e "$delay_single_quote_subst"`'
-predep_objects='`$ECHO "X$predep_objects" | $Xsed -e "$delay_single_quote_subst"`'
-postdep_objects='`$ECHO "X$postdep_objects" | $Xsed -e "$delay_single_quote_subst"`'
-predeps='`$ECHO "X$predeps" | $Xsed -e "$delay_single_quote_subst"`'
-postdeps='`$ECHO "X$postdeps" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_lib_search_path='`$ECHO "X$compiler_lib_search_path" | $Xsed -e "$delay_single_quote_subst"`'
-LD_CXX='`$ECHO "X$LD_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_cmds_CXX='`$ECHO "X$old_archive_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_CXX='`$ECHO "X$compiler_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-GCC_CXX='`$ECHO "X$GCC_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_no_builtin_flag_CXX='`$ECHO "X$lt_prog_compiler_no_builtin_flag_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_wl_CXX='`$ECHO "X$lt_prog_compiler_wl_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_pic_CXX='`$ECHO "X$lt_prog_compiler_pic_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-lt_prog_compiler_static_CXX='`$ECHO "X$lt_prog_compiler_static_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-lt_cv_prog_compiler_c_o_CXX='`$ECHO "X$lt_cv_prog_compiler_c_o_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-archive_cmds_need_lc_CXX='`$ECHO "X$archive_cmds_need_lc_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-enable_shared_with_static_runtimes_CXX='`$ECHO "X$enable_shared_with_static_runtimes_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-export_dynamic_flag_spec_CXX='`$ECHO "X$export_dynamic_flag_spec_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-whole_archive_flag_spec_CXX='`$ECHO "X$whole_archive_flag_spec_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_needs_object_CXX='`$ECHO "X$compiler_needs_object_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_from_new_cmds_CXX='`$ECHO "X$old_archive_from_new_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-old_archive_from_expsyms_cmds_CXX='`$ECHO "X$old_archive_from_expsyms_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-archive_cmds_CXX='`$ECHO "X$archive_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-archive_expsym_cmds_CXX='`$ECHO "X$archive_expsym_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-module_cmds_CXX='`$ECHO "X$module_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-module_expsym_cmds_CXX='`$ECHO "X$module_expsym_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-with_gnu_ld_CXX='`$ECHO "X$with_gnu_ld_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-allow_undefined_flag_CXX='`$ECHO "X$allow_undefined_flag_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-no_undefined_flag_CXX='`$ECHO "X$no_undefined_flag_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec_CXX='`$ECHO "X$hardcode_libdir_flag_spec_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec_ld_CXX='`$ECHO "X$hardcode_libdir_flag_spec_ld_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_libdir_separator_CXX='`$ECHO "X$hardcode_libdir_separator_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_direct_CXX='`$ECHO "X$hardcode_direct_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_direct_absolute_CXX='`$ECHO "X$hardcode_direct_absolute_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_minus_L_CXX='`$ECHO "X$hardcode_minus_L_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_shlibpath_var_CXX='`$ECHO "X$hardcode_shlibpath_var_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_automatic_CXX='`$ECHO "X$hardcode_automatic_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-inherit_rpath_CXX='`$ECHO "X$inherit_rpath_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-link_all_deplibs_CXX='`$ECHO "X$link_all_deplibs_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-fix_srcfile_path_CXX='`$ECHO "X$fix_srcfile_path_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-always_export_symbols_CXX='`$ECHO "X$always_export_symbols_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-export_symbols_cmds_CXX='`$ECHO "X$export_symbols_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-exclude_expsyms_CXX='`$ECHO "X$exclude_expsyms_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-include_expsyms_CXX='`$ECHO "X$include_expsyms_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-prelink_cmds_CXX='`$ECHO "X$prelink_cmds_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-file_list_spec_CXX='`$ECHO "X$file_list_spec_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-hardcode_action_CXX='`$ECHO "X$hardcode_action_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_lib_search_dirs_CXX='`$ECHO "X$compiler_lib_search_dirs_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-predep_objects_CXX='`$ECHO "X$predep_objects_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-postdep_objects_CXX='`$ECHO "X$postdep_objects_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-predeps_CXX='`$ECHO "X$predeps_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-postdeps_CXX='`$ECHO "X$postdeps_CXX" | $Xsed -e "$delay_single_quote_subst"`'
-compiler_lib_search_path_CXX='`$ECHO "X$compiler_lib_search_path_CXX" | $Xsed -e "$delay_single_quote_subst"`'
+enable_static='`$ECHO "$enable_static" | $SED "$delay_single_quote_subst"`'
+macro_version='`$ECHO "$macro_version" | $SED "$delay_single_quote_subst"`'
+macro_revision='`$ECHO "$macro_revision" | $SED "$delay_single_quote_subst"`'
+enable_shared='`$ECHO "$enable_shared" | $SED "$delay_single_quote_subst"`'
+pic_mode='`$ECHO "$pic_mode" | $SED "$delay_single_quote_subst"`'
+enable_fast_install='`$ECHO "$enable_fast_install" | $SED "$delay_single_quote_subst"`'
+SHELL='`$ECHO "$SHELL" | $SED "$delay_single_quote_subst"`'
+ECHO='`$ECHO "$ECHO" | $SED "$delay_single_quote_subst"`'
+PATH_SEPARATOR='`$ECHO "$PATH_SEPARATOR" | $SED "$delay_single_quote_subst"`'
+host_alias='`$ECHO "$host_alias" | $SED "$delay_single_quote_subst"`'
+host='`$ECHO "$host" | $SED "$delay_single_quote_subst"`'
+host_os='`$ECHO "$host_os" | $SED "$delay_single_quote_subst"`'
+build_alias='`$ECHO "$build_alias" | $SED "$delay_single_quote_subst"`'
+build='`$ECHO "$build" | $SED "$delay_single_quote_subst"`'
+build_os='`$ECHO "$build_os" | $SED "$delay_single_quote_subst"`'
+SED='`$ECHO "$SED" | $SED "$delay_single_quote_subst"`'
+Xsed='`$ECHO "$Xsed" | $SED "$delay_single_quote_subst"`'
+GREP='`$ECHO "$GREP" | $SED "$delay_single_quote_subst"`'
+EGREP='`$ECHO "$EGREP" | $SED "$delay_single_quote_subst"`'
+FGREP='`$ECHO "$FGREP" | $SED "$delay_single_quote_subst"`'
+LD='`$ECHO "$LD" | $SED "$delay_single_quote_subst"`'
+NM='`$ECHO "$NM" | $SED "$delay_single_quote_subst"`'
+LN_S='`$ECHO "$LN_S" | $SED "$delay_single_quote_subst"`'
+max_cmd_len='`$ECHO "$max_cmd_len" | $SED "$delay_single_quote_subst"`'
+ac_objext='`$ECHO "$ac_objext" | $SED "$delay_single_quote_subst"`'
+exeext='`$ECHO "$exeext" | $SED "$delay_single_quote_subst"`'
+lt_unset='`$ECHO "$lt_unset" | $SED "$delay_single_quote_subst"`'
+lt_SP2NL='`$ECHO "$lt_SP2NL" | $SED "$delay_single_quote_subst"`'
+lt_NL2SP='`$ECHO "$lt_NL2SP" | $SED "$delay_single_quote_subst"`'
+lt_cv_to_host_file_cmd='`$ECHO "$lt_cv_to_host_file_cmd" | $SED "$delay_single_quote_subst"`'
+lt_cv_to_tool_file_cmd='`$ECHO "$lt_cv_to_tool_file_cmd" | $SED "$delay_single_quote_subst"`'
+reload_flag='`$ECHO "$reload_flag" | $SED "$delay_single_quote_subst"`'
+reload_cmds='`$ECHO "$reload_cmds" | $SED "$delay_single_quote_subst"`'
+OBJDUMP='`$ECHO "$OBJDUMP" | $SED "$delay_single_quote_subst"`'
+deplibs_check_method='`$ECHO "$deplibs_check_method" | $SED "$delay_single_quote_subst"`'
+file_magic_cmd='`$ECHO "$file_magic_cmd" | $SED "$delay_single_quote_subst"`'
+file_magic_glob='`$ECHO "$file_magic_glob" | $SED "$delay_single_quote_subst"`'
+want_nocaseglob='`$ECHO "$want_nocaseglob" | $SED "$delay_single_quote_subst"`'
+DLLTOOL='`$ECHO "$DLLTOOL" | $SED "$delay_single_quote_subst"`'
+sharedlib_from_linklib_cmd='`$ECHO "$sharedlib_from_linklib_cmd" | $SED "$delay_single_quote_subst"`'
+AR='`$ECHO "$AR" | $SED "$delay_single_quote_subst"`'
+AR_FLAGS='`$ECHO "$AR_FLAGS" | $SED "$delay_single_quote_subst"`'
+archiver_list_spec='`$ECHO "$archiver_list_spec" | $SED "$delay_single_quote_subst"`'
+STRIP='`$ECHO "$STRIP" | $SED "$delay_single_quote_subst"`'
+RANLIB='`$ECHO "$RANLIB" | $SED "$delay_single_quote_subst"`'
+old_postinstall_cmds='`$ECHO "$old_postinstall_cmds" | $SED "$delay_single_quote_subst"`'
+old_postuninstall_cmds='`$ECHO "$old_postuninstall_cmds" | $SED "$delay_single_quote_subst"`'
+old_archive_cmds='`$ECHO "$old_archive_cmds" | $SED "$delay_single_quote_subst"`'
+lock_old_archive_extraction='`$ECHO "$lock_old_archive_extraction" | $SED "$delay_single_quote_subst"`'
+CC='`$ECHO "$CC" | $SED "$delay_single_quote_subst"`'
+CFLAGS='`$ECHO "$CFLAGS" | $SED "$delay_single_quote_subst"`'
+compiler='`$ECHO "$compiler" | $SED "$delay_single_quote_subst"`'
+GCC='`$ECHO "$GCC" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_pipe='`$ECHO "$lt_cv_sys_global_symbol_pipe" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_cdecl='`$ECHO "$lt_cv_sys_global_symbol_to_cdecl" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_c_name_address='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address_lib_prefix" | $SED "$delay_single_quote_subst"`'
+nm_file_list_spec='`$ECHO "$nm_file_list_spec" | $SED "$delay_single_quote_subst"`'
+lt_sysroot='`$ECHO "$lt_sysroot" | $SED "$delay_single_quote_subst"`'
+objdir='`$ECHO "$objdir" | $SED "$delay_single_quote_subst"`'
+MAGIC_CMD='`$ECHO "$MAGIC_CMD" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_no_builtin_flag='`$ECHO "$lt_prog_compiler_no_builtin_flag" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_pic='`$ECHO "$lt_prog_compiler_pic" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_wl='`$ECHO "$lt_prog_compiler_wl" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_static='`$ECHO "$lt_prog_compiler_static" | $SED "$delay_single_quote_subst"`'
+lt_cv_prog_compiler_c_o='`$ECHO "$lt_cv_prog_compiler_c_o" | $SED "$delay_single_quote_subst"`'
+need_locks='`$ECHO "$need_locks" | $SED "$delay_single_quote_subst"`'
+MANIFEST_TOOL='`$ECHO "$MANIFEST_TOOL" | $SED "$delay_single_quote_subst"`'
+DSYMUTIL='`$ECHO "$DSYMUTIL" | $SED "$delay_single_quote_subst"`'
+NMEDIT='`$ECHO "$NMEDIT" | $SED "$delay_single_quote_subst"`'
+LIPO='`$ECHO "$LIPO" | $SED "$delay_single_quote_subst"`'
+OTOOL='`$ECHO "$OTOOL" | $SED "$delay_single_quote_subst"`'
+OTOOL64='`$ECHO "$OTOOL64" | $SED "$delay_single_quote_subst"`'
+libext='`$ECHO "$libext" | $SED "$delay_single_quote_subst"`'
+shrext_cmds='`$ECHO "$shrext_cmds" | $SED "$delay_single_quote_subst"`'
+extract_expsyms_cmds='`$ECHO "$extract_expsyms_cmds" | $SED "$delay_single_quote_subst"`'
+archive_cmds_need_lc='`$ECHO "$archive_cmds_need_lc" | $SED "$delay_single_quote_subst"`'
+enable_shared_with_static_runtimes='`$ECHO "$enable_shared_with_static_runtimes" | $SED "$delay_single_quote_subst"`'
+export_dynamic_flag_spec='`$ECHO "$export_dynamic_flag_spec" | $SED "$delay_single_quote_subst"`'
+whole_archive_flag_spec='`$ECHO "$whole_archive_flag_spec" | $SED "$delay_single_quote_subst"`'
+compiler_needs_object='`$ECHO "$compiler_needs_object" | $SED "$delay_single_quote_subst"`'
+old_archive_from_new_cmds='`$ECHO "$old_archive_from_new_cmds" | $SED "$delay_single_quote_subst"`'
+old_archive_from_expsyms_cmds='`$ECHO "$old_archive_from_expsyms_cmds" | $SED "$delay_single_quote_subst"`'
+archive_cmds='`$ECHO "$archive_cmds" | $SED "$delay_single_quote_subst"`'
+archive_expsym_cmds='`$ECHO "$archive_expsym_cmds" | $SED "$delay_single_quote_subst"`'
+module_cmds='`$ECHO "$module_cmds" | $SED "$delay_single_quote_subst"`'
+module_expsym_cmds='`$ECHO "$module_expsym_cmds" | $SED "$delay_single_quote_subst"`'
+with_gnu_ld='`$ECHO "$with_gnu_ld" | $SED "$delay_single_quote_subst"`'
+allow_undefined_flag='`$ECHO "$allow_undefined_flag" | $SED "$delay_single_quote_subst"`'
+no_undefined_flag='`$ECHO "$no_undefined_flag" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_flag_spec='`$ECHO "$hardcode_libdir_flag_spec" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_separator='`$ECHO "$hardcode_libdir_separator" | $SED "$delay_single_quote_subst"`'
+hardcode_direct='`$ECHO "$hardcode_direct" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_absolute='`$ECHO "$hardcode_direct_absolute" | $SED "$delay_single_quote_subst"`'
+hardcode_minus_L='`$ECHO "$hardcode_minus_L" | $SED "$delay_single_quote_subst"`'
+hardcode_shlibpath_var='`$ECHO "$hardcode_shlibpath_var" | $SED "$delay_single_quote_subst"`'
+hardcode_automatic='`$ECHO "$hardcode_automatic" | $SED "$delay_single_quote_subst"`'
+inherit_rpath='`$ECHO "$inherit_rpath" | $SED "$delay_single_quote_subst"`'
+link_all_deplibs='`$ECHO "$link_all_deplibs" | $SED "$delay_single_quote_subst"`'
+always_export_symbols='`$ECHO "$always_export_symbols" | $SED "$delay_single_quote_subst"`'
+export_symbols_cmds='`$ECHO "$export_symbols_cmds" | $SED "$delay_single_quote_subst"`'
+exclude_expsyms='`$ECHO "$exclude_expsyms" | $SED "$delay_single_quote_subst"`'
+include_expsyms='`$ECHO "$include_expsyms" | $SED "$delay_single_quote_subst"`'
+prelink_cmds='`$ECHO "$prelink_cmds" | $SED "$delay_single_quote_subst"`'
+postlink_cmds='`$ECHO "$postlink_cmds" | $SED "$delay_single_quote_subst"`'
+file_list_spec='`$ECHO "$file_list_spec" | $SED "$delay_single_quote_subst"`'
+variables_saved_for_relink='`$ECHO "$variables_saved_for_relink" | $SED "$delay_single_quote_subst"`'
+need_lib_prefix='`$ECHO "$need_lib_prefix" | $SED "$delay_single_quote_subst"`'
+need_version='`$ECHO "$need_version" | $SED "$delay_single_quote_subst"`'
+version_type='`$ECHO "$version_type" | $SED "$delay_single_quote_subst"`'
+runpath_var='`$ECHO "$runpath_var" | $SED "$delay_single_quote_subst"`'
+shlibpath_var='`$ECHO "$shlibpath_var" | $SED "$delay_single_quote_subst"`'
+shlibpath_overrides_runpath='`$ECHO "$shlibpath_overrides_runpath" | $SED "$delay_single_quote_subst"`'
+libname_spec='`$ECHO "$libname_spec" | $SED "$delay_single_quote_subst"`'
+library_names_spec='`$ECHO "$library_names_spec" | $SED "$delay_single_quote_subst"`'
+soname_spec='`$ECHO "$soname_spec" | $SED "$delay_single_quote_subst"`'
+install_override_mode='`$ECHO "$install_override_mode" | $SED "$delay_single_quote_subst"`'
+postinstall_cmds='`$ECHO "$postinstall_cmds" | $SED "$delay_single_quote_subst"`'
+postuninstall_cmds='`$ECHO "$postuninstall_cmds" | $SED "$delay_single_quote_subst"`'
+finish_cmds='`$ECHO "$finish_cmds" | $SED "$delay_single_quote_subst"`'
+finish_eval='`$ECHO "$finish_eval" | $SED "$delay_single_quote_subst"`'
+hardcode_into_libs='`$ECHO "$hardcode_into_libs" | $SED "$delay_single_quote_subst"`'
+sys_lib_search_path_spec='`$ECHO "$sys_lib_search_path_spec" | $SED "$delay_single_quote_subst"`'
+sys_lib_dlsearch_path_spec='`$ECHO "$sys_lib_dlsearch_path_spec" | $SED "$delay_single_quote_subst"`'
+hardcode_action='`$ECHO "$hardcode_action" | $SED "$delay_single_quote_subst"`'
+enable_dlopen='`$ECHO "$enable_dlopen" | $SED "$delay_single_quote_subst"`'
+enable_dlopen_self='`$ECHO "$enable_dlopen_self" | $SED "$delay_single_quote_subst"`'
+enable_dlopen_self_static='`$ECHO "$enable_dlopen_self_static" | $SED "$delay_single_quote_subst"`'
+old_striplib='`$ECHO "$old_striplib" | $SED "$delay_single_quote_subst"`'
+striplib='`$ECHO "$striplib" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_dirs='`$ECHO "$compiler_lib_search_dirs" | $SED "$delay_single_quote_subst"`'
+predep_objects='`$ECHO "$predep_objects" | $SED "$delay_single_quote_subst"`'
+postdep_objects='`$ECHO "$postdep_objects" | $SED "$delay_single_quote_subst"`'
+predeps='`$ECHO "$predeps" | $SED "$delay_single_quote_subst"`'
+postdeps='`$ECHO "$postdeps" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_path='`$ECHO "$compiler_lib_search_path" | $SED "$delay_single_quote_subst"`'
+LD_CXX='`$ECHO "$LD_CXX" | $SED "$delay_single_quote_subst"`'
+reload_flag_CXX='`$ECHO "$reload_flag_CXX" | $SED "$delay_single_quote_subst"`'
+reload_cmds_CXX='`$ECHO "$reload_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+old_archive_cmds_CXX='`$ECHO "$old_archive_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_CXX='`$ECHO "$compiler_CXX" | $SED "$delay_single_quote_subst"`'
+GCC_CXX='`$ECHO "$GCC_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_no_builtin_flag_CXX='`$ECHO "$lt_prog_compiler_no_builtin_flag_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_pic_CXX='`$ECHO "$lt_prog_compiler_pic_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_wl_CXX='`$ECHO "$lt_prog_compiler_wl_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_static_CXX='`$ECHO "$lt_prog_compiler_static_CXX" | $SED "$delay_single_quote_subst"`'
+lt_cv_prog_compiler_c_o_CXX='`$ECHO "$lt_cv_prog_compiler_c_o_CXX" | $SED "$delay_single_quote_subst"`'
+archive_cmds_need_lc_CXX='`$ECHO "$archive_cmds_need_lc_CXX" | $SED "$delay_single_quote_subst"`'
+enable_shared_with_static_runtimes_CXX='`$ECHO "$enable_shared_with_static_runtimes_CXX" | $SED "$delay_single_quote_subst"`'
+export_dynamic_flag_spec_CXX='`$ECHO "$export_dynamic_flag_spec_CXX" | $SED "$delay_single_quote_subst"`'
+whole_archive_flag_spec_CXX='`$ECHO "$whole_archive_flag_spec_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_needs_object_CXX='`$ECHO "$compiler_needs_object_CXX" | $SED "$delay_single_quote_subst"`'
+old_archive_from_new_cmds_CXX='`$ECHO "$old_archive_from_new_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+old_archive_from_expsyms_cmds_CXX='`$ECHO "$old_archive_from_expsyms_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+archive_cmds_CXX='`$ECHO "$archive_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+archive_expsym_cmds_CXX='`$ECHO "$archive_expsym_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+module_cmds_CXX='`$ECHO "$module_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+module_expsym_cmds_CXX='`$ECHO "$module_expsym_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+with_gnu_ld_CXX='`$ECHO "$with_gnu_ld_CXX" | $SED "$delay_single_quote_subst"`'
+allow_undefined_flag_CXX='`$ECHO "$allow_undefined_flag_CXX" | $SED "$delay_single_quote_subst"`'
+no_undefined_flag_CXX='`$ECHO "$no_undefined_flag_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_flag_spec_CXX='`$ECHO "$hardcode_libdir_flag_spec_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_separator_CXX='`$ECHO "$hardcode_libdir_separator_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_CXX='`$ECHO "$hardcode_direct_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_absolute_CXX='`$ECHO "$hardcode_direct_absolute_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_minus_L_CXX='`$ECHO "$hardcode_minus_L_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_shlibpath_var_CXX='`$ECHO "$hardcode_shlibpath_var_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_automatic_CXX='`$ECHO "$hardcode_automatic_CXX" | $SED "$delay_single_quote_subst"`'
+inherit_rpath_CXX='`$ECHO "$inherit_rpath_CXX" | $SED "$delay_single_quote_subst"`'
+link_all_deplibs_CXX='`$ECHO "$link_all_deplibs_CXX" | $SED "$delay_single_quote_subst"`'
+always_export_symbols_CXX='`$ECHO "$always_export_symbols_CXX" | $SED "$delay_single_quote_subst"`'
+export_symbols_cmds_CXX='`$ECHO "$export_symbols_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+exclude_expsyms_CXX='`$ECHO "$exclude_expsyms_CXX" | $SED "$delay_single_quote_subst"`'
+include_expsyms_CXX='`$ECHO "$include_expsyms_CXX" | $SED "$delay_single_quote_subst"`'
+prelink_cmds_CXX='`$ECHO "$prelink_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+postlink_cmds_CXX='`$ECHO "$postlink_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+file_list_spec_CXX='`$ECHO "$file_list_spec_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_action_CXX='`$ECHO "$hardcode_action_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_dirs_CXX='`$ECHO "$compiler_lib_search_dirs_CXX" | $SED "$delay_single_quote_subst"`'
+predep_objects_CXX='`$ECHO "$predep_objects_CXX" | $SED "$delay_single_quote_subst"`'
+postdep_objects_CXX='`$ECHO "$postdep_objects_CXX" | $SED "$delay_single_quote_subst"`'
+predeps_CXX='`$ECHO "$predeps_CXX" | $SED "$delay_single_quote_subst"`'
+postdeps_CXX='`$ECHO "$postdeps_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_path_CXX='`$ECHO "$compiler_lib_search_path_CXX" | $SED "$delay_single_quote_subst"`'
 
 LTCC='$LTCC'
 LTCFLAGS='$LTCFLAGS'
 compiler='$compiler_DEFAULT'
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+\$1
+_LTECHO_EOF'
+}
+
 # Quote evaled strings.
-for var in SED \
+for var in SHELL \
+ECHO \
+PATH_SEPARATOR \
+SED \
 GREP \
 EGREP \
 FGREP \
@@ -58480,8 +46190,13 @@
 OBJDUMP \
 deplibs_check_method \
 file_magic_cmd \
+file_magic_glob \
+want_nocaseglob \
+DLLTOOL \
+sharedlib_from_linklib_cmd \
 AR \
 AR_FLAGS \
+archiver_list_spec \
 STRIP \
 RANLIB \
 CC \
@@ -58491,14 +46206,14 @@
 lt_cv_sys_global_symbol_to_cdecl \
 lt_cv_sys_global_symbol_to_c_name_address \
 lt_cv_sys_global_symbol_to_c_name_address_lib_prefix \
-SHELL \
-ECHO \
+nm_file_list_spec \
 lt_prog_compiler_no_builtin_flag \
-lt_prog_compiler_wl \
 lt_prog_compiler_pic \
+lt_prog_compiler_wl \
 lt_prog_compiler_static \
 lt_cv_prog_compiler_c_o \
 need_locks \
+MANIFEST_TOOL \
 DSYMUTIL \
 NMEDIT \
 LIPO \
@@ -58512,9 +46227,7 @@
 allow_undefined_flag \
 no_undefined_flag \
 hardcode_libdir_flag_spec \
-hardcode_libdir_flag_spec_ld \
 hardcode_libdir_separator \
-fix_srcfile_path \
 exclude_expsyms \
 include_expsyms \
 file_list_spec \
@@ -58522,6 +46235,7 @@
 libname_spec \
 library_names_spec \
 soname_spec \
+install_override_mode \
 finish_eval \
 old_striplib \
 striplib \
@@ -58532,10 +46246,11 @@
 postdeps \
 compiler_lib_search_path \
 LD_CXX \
+reload_flag_CXX \
 compiler_CXX \
 lt_prog_compiler_no_builtin_flag_CXX \
-lt_prog_compiler_wl_CXX \
 lt_prog_compiler_pic_CXX \
+lt_prog_compiler_wl_CXX \
 lt_prog_compiler_static_CXX \
 lt_cv_prog_compiler_c_o_CXX \
 export_dynamic_flag_spec_CXX \
@@ -58545,9 +46260,7 @@
 allow_undefined_flag_CXX \
 no_undefined_flag_CXX \
 hardcode_libdir_flag_spec_CXX \
-hardcode_libdir_flag_spec_ld_CXX \
 hardcode_libdir_separator_CXX \
-fix_srcfile_path_CXX \
 exclude_expsyms_CXX \
 include_expsyms_CXX \
 file_list_spec_CXX \
@@ -58557,9 +46270,9 @@
 predeps_CXX \
 postdeps_CXX \
 compiler_lib_search_path_CXX; do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -58581,11 +46294,13 @@
 module_expsym_cmds \
 export_symbols_cmds \
 prelink_cmds \
+postlink_cmds \
 postinstall_cmds \
 postuninstall_cmds \
 finish_cmds \
 sys_lib_search_path_spec \
 sys_lib_dlsearch_path_spec \
+reload_cmds_CXX \
 old_archive_cmds_CXX \
 old_archive_from_new_cmds_CXX \
 old_archive_from_expsyms_cmds_CXX \
@@ -58594,10 +46309,11 @@
 module_cmds_CXX \
 module_expsym_cmds_CXX \
 export_symbols_cmds_CXX \
-prelink_cmds_CXX; do
-    case \`eval \\\\\$ECHO "X\\\\\$\$var"\` in
+prelink_cmds_CXX \
+postlink_cmds_CXX; do
+    case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"X\\\$\$var\\" | \\\$Xsed -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -58605,12 +46321,6 @@
     esac
 done
 
-# Fix-up fallback echo if it was mangled by the above quoting rules.
-case \$lt_ECHO in
-*'\\\$0 --fallback-echo"')  lt_ECHO=\`\$ECHO "X\$lt_ECHO" | \$Xsed -e 's/\\\\\\\\\\\\\\\$0 --fallback-echo"\$/\$0 --fallback-echo"/'\`
-  ;;
-esac
-
 ac_aux_dir='$ac_aux_dir'
 xsi_shell='$xsi_shell'
 lt_shell_append='$lt_shell_append'
@@ -58680,9 +46390,7 @@
     "include/blcr_common.h") CONFIG_FILES="$CONFIG_FILES include/blcr_common.h" ;;
     "doc/Makefile") CONFIG_FILES="$CONFIG_FILES doc/Makefile" ;;
 
-  *) { { $as_echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
-$as_echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
-   { (exit 1); exit 1; }; };;
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
   esac
 done
 
@@ -58705,26 +46413,24 @@
 # after its creation but before its name has been assigned to `$tmp'.
 $debug ||
 {
-  tmp=
+  tmp= ac_tmp=
   trap 'exit_status=$?
-  { test -z "$tmp" || test ! -d "$tmp" || rm -fr "$tmp"; } && exit $exit_status
+  : "${ac_tmp:=$tmp}"
+  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
 ' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
+  trap 'as_fn_exit 1' 1 2 13 15
 }
 # Create a (secure) tmp directory for tmp files.
 
 {
   tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
+  test -d "$tmp"
 }  ||
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} ||
-{
-   $as_echo "$as_me: cannot create a temporary directory in ." >&2
-   { (exit 1); exit 1; }
-}
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
+ac_tmp=$tmp
 
 # Set up the scripts for CONFIG_FILES section.
 # No need to generate them if there are no CONFIG_FILES.
@@ -58749,7 +46455,13 @@
   # The final `:' finishes the AND list.
   ac_cs_awk_pipe_fini='END { print "|#_!!_#|"; print ":" }'
 fi
-ac_cr=''
+ac_cr=`echo X | tr X '\015'`
+# On cygwin, bash can eat \r inside `` if the user requested igncr.
+# But we know of no other shell where ac_cr would be empty at this
+# point, so we can use a bashism as a fallback.
+if test "x$ac_cr" = x; then
+  eval ac_cr=\$\'\\r\'
+fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
   ac_cs_awk_cr='\\r'
@@ -58757,21 +46469,19 @@
   ac_cs_awk_cr=$ac_cr
 fi
 
-echo 'BEGIN {' >"$tmp/subs1.awk" &&
+echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
 _ACEOF
 
 # Create commands to substitute file output variables.
 {
   echo "cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1" &&
-  echo 'cat >>"\$tmp/subs1.awk" <<\\_ACAWK &&' &&
+  echo 'cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&' &&
   echo "$ac_subst_files" | sed 's/.*/F["&"]="$&"/' &&
   echo "_ACAWK" &&
   echo "_ACEOF"
 } >conf$$files.sh &&
 . ./conf$$files.sh ||
-  { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 rm -f conf$$files.sh
 
 {
@@ -58779,24 +46489,18 @@
   echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
   echo "_ACEOF"
 } >conf$$subs.sh ||
-  { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
-ac_delim_num=`echo "$ac_subst_vars" | grep -c '$'`
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   . ./conf$$subs.sh ||
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 
   ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
   if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -58804,7 +46508,7 @@
 rm -f conf$$subs.sh
 
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-cat >>"\$tmp/subs1.awk" <<\\_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
 _ACEOF
 sed -n '
 h
@@ -58818,7 +46522,7 @@
 t delim
 :nl
 h
-s/\(.\{148\}\).*/\1/
+s/\(.\{148\}\)..*/\1/
 t more1
 s/["\\]/\\&/g; s/^/"/; s/$/\\n"\\/
 p
@@ -58832,7 +46536,7 @@
 t nl
 :delim
 h
-s/\(.\{148\}\).*/\1/
+s/\(.\{148\}\)..*/\1/
 t more2
 s/["\\]/\\&/g; s/^/"/; s/$/"/
 p
@@ -58852,7 +46556,7 @@
 rm -f conf$$subs.awk
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 _ACAWK
-cat >>"\$tmp/subs1.awk" <<_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
   for (key in S) S_is_set[key] = 1
   FS = ""
   \$ac_cs_awk_pipe_init
@@ -58890,23 +46594,29 @@
   sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
 else
   cat
-fi < "$tmp/subs1.awk" > "$tmp/subs.awk" \
-  || { { $as_echo "$as_me:$LINENO: error: could not setup config files machinery" >&5
-$as_echo "$as_me: error: could not setup config files machinery" >&2;}
-   { (exit 1); exit 1; }; }
+fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
 _ACEOF
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
 s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
 s/^[^=]*=[	 ]*$//
 }'
 fi
@@ -58918,7 +46628,7 @@
 # No need to generate them if there are no CONFIG_HEADERS.
 # This happens for instance with `./config.status Makefile'.
 if test -n "$CONFIG_HEADERS"; then
-cat >"$tmp/defines.awk" <<\_ACAWK ||
+cat >"$ac_tmp/defines.awk" <<\_ACAWK ||
 BEGIN {
 _ACEOF
 
@@ -58930,13 +46640,11 @@
 # handling of long lines.
 ac_delim='%!_!# '
 for ac_last_try in false false :; do
-  ac_t=`sed -n "/$ac_delim/p" confdefs.h`
-  if test -z "$ac_t"; then
+  ac_tt=`sed -n "/$ac_delim/p" confdefs.h`
+  if test -z "$ac_tt"; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_HEADERS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_HEADERS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -59021,9 +46729,7 @@
 _ACAWK
 _ACEOF
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-  { { $as_echo "$as_me:$LINENO: error: could not setup config headers machinery" >&5
-$as_echo "$as_me: error: could not setup config headers machinery" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
 fi # test -n "$CONFIG_HEADERS"
 
 
@@ -59036,9 +46742,7 @@
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) { { $as_echo "$as_me:$LINENO: error: invalid tag $ac_tag" >&5
-$as_echo "$as_me: error: invalid tag $ac_tag" >&2;}
-   { (exit 1); exit 1; }; };;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -59057,7 +46761,7 @@
     for ac_f
     do
       case $ac_f in
-      -) ac_f="$tmp/stdin";;
+      -) ac_f="$ac_tmp/stdin";;
       *) # Look for the file first in the build tree, then in the source tree
 	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
 	 # because $ac_f cannot contain `:'.
@@ -59066,12 +46770,10 @@
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   { { $as_echo "$as_me:$LINENO: error: cannot find input file: $ac_f" >&5
-$as_echo "$as_me: error: cannot find input file: $ac_f" >&2;}
-   { (exit 1); exit 1; }; };;
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
       esac
       case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
-      ac_file_inputs="$ac_file_inputs '$ac_f'"
+      as_fn_append ac_file_inputs " '$ac_f'"
     done
 
     # Let's still pretend it is `configure' which instantiates (i.e., don't
@@ -59082,7 +46784,7 @@
 	`' by configure.'
     if test x"$ac_file" != x-; then
       configure_input="$ac_file.  $configure_input"
-      { $as_echo "$as_me:$LINENO: creating $ac_file" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
 $as_echo "$as_me: creating $ac_file" >&6;}
     fi
     # Neutralize special characters interpreted by sed in replacement strings.
@@ -59094,10 +46796,8 @@
     esac
 
     case $ac_tag in
-    *:-:* | *:-) cat >"$tmp/stdin" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; } ;;
+    *:-:* | *:-) cat >"$ac_tmp/stdin" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
     esac
     ;;
   esac
@@ -59125,47 +46825,7 @@
 	    q
 	  }
 	  s/.*/./; q'`
-  { as_dir="$ac_dir"
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { $as_echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-$as_echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+  as_dir="$ac_dir"; as_fn_mkdir_p
   ac_builddir=.
 
 case "$ac_dir" in
@@ -59222,7 +46882,6 @@
 # If the template does not know about datarootdir, expand it.
 # FIXME: This hack should be removed a few years after 2.60.
 ac_datarootdir_hack=; ac_datarootdir_seen=
-
 ac_sed_dataroot='
 /datarootdir/ {
   p
@@ -59232,12 +46891,11 @@
 /@docdir@/p
 /@infodir@/p
 /@localedir@/p
-/@mandir@/p
-'
+/@mandir@/p'
 case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
 *datarootdir*) ac_datarootdir_seen=yes;;
 *@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
 $as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
@@ -59247,7 +46905,7 @@
   s&@infodir@&$infodir&g
   s&@localedir@&$localedir&g
   s&@mandir@&$mandir&g
-    s&\\\${datarootdir}&$datarootdir&g' ;;
+  s&\\\${datarootdir}&$datarootdir&g' ;;
 esac
 _ACEOF
 
@@ -59277,30 +46935,27 @@
 "
 eval sed \"\$ac_sed_extra\" "$ac_file_inputs" |
 if $ac_cs_awk_getline; then
-  $AWK -f "$tmp/subs.awk"
+  $AWK -f "$ac_tmp/subs.awk"
 else
-  $AWK -f "$tmp/subs.awk" | $SHELL
-fi >$tmp/out \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+  $AWK -f "$ac_tmp/subs.awk" | $SHELL
+fi \
+  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
-  { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&5
+  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
+  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
+      "$ac_tmp/out"`; test -z "$ac_out"; } &&
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&5
 $as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&2;}
+which seems to be undefined.  Please make sure it is defined" >&2;}
 
-  rm -f "$tmp/stdin"
+  rm -f "$ac_tmp/stdin"
   case $ac_file in
-  -) cat "$tmp/out" && rm -f "$tmp/out";;
-  *) rm -f "$ac_file" && mv "$tmp/out" "$ac_file";;
+  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
+  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
   esac \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
@@ -59309,27 +46964,21 @@
   if test x"$ac_file" != x-; then
     {
       $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs"
-    } >"$tmp/config.h" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
-    if diff "$ac_file" "$tmp/config.h" >/dev/null 2>&1; then
-      { $as_echo "$as_me:$LINENO: $ac_file is unchanged" >&5
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs"
+    } >"$ac_tmp/config.h" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    if diff "$ac_file" "$ac_tmp/config.h" >/dev/null 2>&1; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
 $as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
       rm -f "$ac_file"
-      mv "$tmp/config.h" "$ac_file" \
-	|| { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+      mv "$ac_tmp/config.h" "$ac_file" \
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
     fi
   else
     $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create -" >&5
-$as_echo "$as_me: error: could not create -" >&2;}
-   { (exit 1); exit 1; }; }
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs" \
+      || as_fn_error $? "could not create -" "$LINENO" 5
   fi
 # Compute "$ac_file"'s index in $config_headers.
 _am_arg="$ac_file"
@@ -59367,7 +47016,7 @@
 	  s/.*/./; q'`/stamp-h$_am_stamp_count
  ;;
 
-  :C)  { $as_echo "$as_me:$LINENO: executing $ac_file commands" >&5
+  :C)  { $as_echo "$as_me:${as_lineno-$LINENO}: executing $ac_file commands" >&5
 $as_echo "$as_me: executing $ac_file commands" >&6;}
  ;;
   esac
@@ -59462,47 +47111,7 @@
 	    q
 	  }
 	  s/.*/./; q'`
-      { as_dir=$dirpart/$fdir
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { $as_echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-$as_echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+      as_dir=$dirpart/$fdir; as_fn_mkdir_p
       # echo "creating $dirpart/$file"
       echo '# dummy' > "$dirpart/$file"
     done
@@ -59530,7 +47139,8 @@
 # NOTE: Changes made to this file will be lost: look at ltmain.sh.
 #
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008 Free Software Foundation, Inc.
+#                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+#                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 #   This file is part of GNU Libtool.
@@ -59578,6 +47188,15 @@
 # Whether or not to optimize for fast installation.
 fast_install=$enable_fast_install
 
+# Shell to use when invoking shell scripts.
+SHELL=$lt_SHELL
+
+# An echo program that protects backslashes.
+ECHO=$lt_ECHO
+
+# The PATH separator for the build system.
+PATH_SEPARATOR=$lt_PATH_SEPARATOR
+
 # The host system.
 host_alias=$host_alias
 host=$host
@@ -59627,9 +47246,11 @@
 # turn newlines into spaces.
 NL2SP=$lt_lt_NL2SP
 
-# How to create reloadable object files.
-reload_flag=$lt_reload_flag
-reload_cmds=$lt_reload_cmds
+# convert \$build file names to \$host format.
+to_host_file_cmd=$lt_cv_to_host_file_cmd
+
+# convert \$build files to toolchain format.
+to_tool_file_cmd=$lt_cv_to_tool_file_cmd
 
 # An object symbol dumper.
 OBJDUMP=$lt_OBJDUMP
@@ -59637,13 +47258,30 @@
 # Method to check whether dependent libraries are shared objects.
 deplibs_check_method=$lt_deplibs_check_method
 
-# Command to use when deplibs_check_method == "file_magic".
+# Command to use when deplibs_check_method = "file_magic".
 file_magic_cmd=$lt_file_magic_cmd
 
+# How to find potential files when deplibs_check_method = "file_magic".
+file_magic_glob=$lt_file_magic_glob
+
+# Find potential files using nocaseglob when deplibs_check_method = "file_magic".
+want_nocaseglob=$lt_want_nocaseglob
+
+# DLL creation program.
+DLLTOOL=$lt_DLLTOOL
+
+# Command to associate shared and link libraries.
+sharedlib_from_linklib_cmd=$lt_sharedlib_from_linklib_cmd
+
 # The archiver.
 AR=$lt_AR
+
+# Flags to create an archive.
 AR_FLAGS=$lt_AR_FLAGS
 
+# How to feed a file listing to the archiver.
+archiver_list_spec=$lt_archiver_list_spec
+
 # A symbol stripping program.
 STRIP=$lt_STRIP
 
@@ -59652,6 +47290,9 @@
 old_postinstall_cmds=$lt_old_postinstall_cmds
 old_postuninstall_cmds=$lt_old_postuninstall_cmds
 
+# Whether to use a lock for old archive extraction.
+lock_old_archive_extraction=$lock_old_archive_extraction
+
 # A C compiler.
 LTCC=$lt_CC
 
@@ -59670,14 +47311,14 @@
 # Transform the output of nm in a C name address pair when lib prefix is needed.
 global_symbol_to_c_name_address_lib_prefix=$lt_lt_cv_sys_global_symbol_to_c_name_address_lib_prefix
 
-# The name of the directory that contains temporary libtool files.
-objdir=$objdir
+# Specify filename containing input files for \$NM.
+nm_file_list_spec=$lt_nm_file_list_spec
 
-# Shell to use when invoking shell scripts.
-SHELL=$lt_SHELL
+# The root where to search for dependent libraries,and in which our libraries should be installed.
+lt_sysroot=$lt_sysroot
 
-# An echo program that does not interpret backslashes.
-ECHO=$lt_ECHO
+# The name of the directory that contains temporary libtool files.
+objdir=$objdir
 
 # Used to examine libraries when file_magic_cmd begins with "file".
 MAGIC_CMD=$MAGIC_CMD
@@ -59685,6 +47326,9 @@
 # Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
+# Manifest tool.
+MANIFEST_TOOL=$lt_MANIFEST_TOOL
+
 # Tool to manipulate archived DWARF debug symbol files on Mac OS X.
 DSYMUTIL=$lt_DSYMUTIL
 
@@ -59741,6 +47385,9 @@
 # The coded name of the library, if different from the real name.
 soname_spec=$lt_soname_spec
 
+# Permission mode override for installation of shared libraries.
+install_override_mode=$lt_install_override_mode
+
 # Command to use after installation of a shared archive.
 postinstall_cmds=$lt_postinstall_cmds
 
@@ -59780,6 +47427,10 @@
 # The linker used to build libraries.
 LD=$lt_LD
 
+# How to create reloadable object files.
+reload_flag=$lt_reload_flag
+reload_cmds=$lt_reload_cmds
+
 # Commands used to build an old-style archive.
 old_archive_cmds=$lt_old_archive_cmds
 
@@ -59792,12 +47443,12 @@
 # Compiler flag to turn off builtin functions.
 no_builtin_flag=$lt_lt_prog_compiler_no_builtin_flag
 
-# How to pass a linker flag through the compiler.
-wl=$lt_lt_prog_compiler_wl
-
 # Additional compiler flags for building library objects.
 pic_flag=$lt_lt_prog_compiler_pic
 
+# How to pass a linker flag through the compiler.
+wl=$lt_lt_prog_compiler_wl
+
 # Compiler flag to prevent dynamic linking.
 link_static_flag=$lt_lt_prog_compiler_static
 
@@ -59847,10 +47498,6 @@
 # This must work even if \$libdir does not exist
 hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec
 
-# If ld is used when linking, flag to hardcode \$libdir into a binary
-# during linking.  This must work even if \$libdir does not exist.
-hardcode_libdir_flag_spec_ld=$lt_hardcode_libdir_flag_spec_ld
-
 # Whether we need a single "-rpath" flag with a separated argument.
 hardcode_libdir_separator=$lt_hardcode_libdir_separator
 
@@ -59884,9 +47531,6 @@
 # Whether libtool must link a program against all its dependency libraries.
 link_all_deplibs=$link_all_deplibs
 
-# Fix the shell variable \$srcfile for the compiler.
-fix_srcfile_path=$lt_fix_srcfile_path
-
 # Set to "yes" if exported symbols are required.
 always_export_symbols=$always_export_symbols
 
@@ -59902,6 +47546,9 @@
 # Commands necessary for linking programs (against libraries) with templates.
 prelink_cmds=$lt_prelink_cmds
 
+# Commands necessary for finishing linking programs.
+postlink_cmds=$lt_postlink_cmds
+
 # Specify filename containing input files.
 file_list_spec=$lt_file_list_spec
 
@@ -59948,212 +47595,169 @@
   # if finds mixed CR/LF and LF-only lines.  Since sed operates in
   # text mode, it properly converts lines to CR/LF.  This bash problem
   # is reportedly fixed, but why not run on old versions too?
-  sed '/^# Generated shell functions inserted here/q' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
-
-  case $xsi_shell in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result="${1##*/}"
-}
-
-# func_dirname_and_basename file append nondir_replacement
-# perform func_basename and func_dirname in a single function
-# call:
-#   dirname:  Compute the dirname of FILE.  If nonempty,
-#             add APPEND to the result, otherwise set result
-#             to NONDIR_REPLACEMENT.
-#             value returned in "$func_dirname_result"
-#   basename: Compute filename of FILE.
-#             value retuned in "$func_basename_result"
-# Implementation must be kept synchronized with func_dirname
-# and func_basename. For efficiency, we do not delegate to
-# those functions but instead duplicate the functionality here.
-func_dirname_and_basename ()
-{
-  case ${1} in
-    */*) func_dirname_result="${1%/*}${2}" ;;
-    *  ) func_dirname_result="${3}" ;;
-  esac
-  func_basename_result="${1##*/}"
-}
-
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-func_stripname ()
-{
-  # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
-  # positional parameters, so assign one to ordinary parameter first.
-  func_stripname_result=${3}
-  func_stripname_result=${func_stripname_result#"${1}"}
-  func_stripname_result=${func_stripname_result%"${2}"}
-}
-
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=${1%%=*}
-  func_opt_split_arg=${1#*=}
-}
-
-# func_lo2o object
-func_lo2o ()
-{
-  case ${1} in
-    *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
-    *)    func_lo2o_result=${1} ;;
-  esac
-}
-
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=${1%.*}.lo
-}
-
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=$(( $* ))
-}
-
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=${#1}
-}
-
-_LT_EOF
-    ;;
-  *) # Bourne compatible functions.
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-  # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO "X${1}" | $Xsed -e "$dirname"`
-  if test "X$func_dirname_result" = "X${1}"; then
-    func_dirname_result="${3}"
-  else
-    func_dirname_result="$func_dirname_result${2}"
-  fi
-}
-
-# func_basename file
-func_basename ()
-{
-  func_basename_result=`$ECHO "X${1}" | $Xsed -e "$basename"`
-}
-
-
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-# func_strip_suffix prefix name
-func_stripname ()
-{
-  case ${2} in
-    .*) func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%\\\\${2}\$%%"`;;
-    *)  func_stripname_result=`$ECHO "X${3}" \
-           | $Xsed -e "s%^${1}%%" -e "s%${2}\$%%"`;;
-  esac
-}
-
-# sed scripts:
-my_sed_long_opt='1s/^\(-[^=]*\)=.*/\1/;q'
-my_sed_long_arg='1s/^-[^=]*=//'
-
-# func_opt_split
-func_opt_split ()
-{
-  func_opt_split_opt=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_opt"`
-  func_opt_split_arg=`$ECHO "X${1}" | $Xsed -e "$my_sed_long_arg"`
-}
-
-# func_lo2o object
-func_lo2o ()
-{
-  func_lo2o_result=`$ECHO "X${1}" | $Xsed -e "$lo2o"`
-}
-
-# func_xform libobj-or-source
-func_xform ()
-{
-  func_xform_result=`$ECHO "X${1}" | $Xsed -e 's/\.[^.]*$/.lo/'`
-}
-
-# func_arith arithmetic-term...
-func_arith ()
-{
-  func_arith_result=`expr "$@"`
-}
-
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-  func_len_result=`expr "$1" : ".*" 2>/dev/null || echo $max_cmd_len`
-}
-
-_LT_EOF
-esac
-
-case $lt_shell_append in
-  yes)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$1+=\$2"
-}
-_LT_EOF
-    ;;
-  *)
-    cat << \_LT_EOF >> "$cfgfile"
-
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
-{
-  eval "$1=\$$1\$2"
-}
-
-_LT_EOF
-    ;;
-  esac
+  sed '$q' "$ltmain" >> "$cfgfile" \
+     || (rm -f "$cfgfile"; exit 1)
 
+  if test x"$xsi_shell" = xyes; then
+  sed -e '/^func_dirname ()$/,/^} # func_dirname /c\
+func_dirname ()\
+{\
+\    case ${1} in\
+\      */*) func_dirname_result="${1%/*}${2}" ;;\
+\      *  ) func_dirname_result="${3}" ;;\
+\    esac\
+} # Extended-shell func_dirname implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_basename ()$/,/^} # func_basename /c\
+func_basename ()\
+{\
+\    func_basename_result="${1##*/}"\
+} # Extended-shell func_basename implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_dirname_and_basename ()$/,/^} # func_dirname_and_basename /c\
+func_dirname_and_basename ()\
+{\
+\    case ${1} in\
+\      */*) func_dirname_result="${1%/*}${2}" ;;\
+\      *  ) func_dirname_result="${3}" ;;\
+\    esac\
+\    func_basename_result="${1##*/}"\
+} # Extended-shell func_dirname_and_basename implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_stripname ()$/,/^} # func_stripname /c\
+func_stripname ()\
+{\
+\    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are\
+\    # positional parameters, so assign one to ordinary parameter first.\
+\    func_stripname_result=${3}\
+\    func_stripname_result=${func_stripname_result#"${1}"}\
+\    func_stripname_result=${func_stripname_result%"${2}"}\
+} # Extended-shell func_stripname implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_split_long_opt ()$/,/^} # func_split_long_opt /c\
+func_split_long_opt ()\
+{\
+\    func_split_long_opt_name=${1%%=*}\
+\    func_split_long_opt_arg=${1#*=}\
+} # Extended-shell func_split_long_opt implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_split_short_opt ()$/,/^} # func_split_short_opt /c\
+func_split_short_opt ()\
+{\
+\    func_split_short_opt_arg=${1#??}\
+\    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}\
+} # Extended-shell func_split_short_opt implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_lo2o ()$/,/^} # func_lo2o /c\
+func_lo2o ()\
+{\
+\    case ${1} in\
+\      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;\
+\      *)    func_lo2o_result=${1} ;;\
+\    esac\
+} # Extended-shell func_lo2o implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_xform ()$/,/^} # func_xform /c\
+func_xform ()\
+{\
+    func_xform_result=${1%.*}.lo\
+} # Extended-shell func_xform implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_arith ()$/,/^} # func_arith /c\
+func_arith ()\
+{\
+    func_arith_result=$(( $* ))\
+} # Extended-shell func_arith implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_len ()$/,/^} # func_len /c\
+func_len ()\
+{\
+    func_len_result=${#1}\
+} # Extended-shell func_len implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+fi
+
+if test x"$lt_shell_append" = xyes; then
+  sed -e '/^func_append ()$/,/^} # func_append /c\
+func_append ()\
+{\
+    eval "${1}+=\\${2}"\
+} # Extended-shell func_append implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  sed -e '/^func_append_quoted ()$/,/^} # func_append_quoted /c\
+func_append_quoted ()\
+{\
+\    func_quote_for_eval "${2}"\
+\    eval "${1}+=\\\\ \\$func_quote_for_eval_result"\
+} # Extended-shell func_append_quoted implementation' "$cfgfile" > $cfgfile.tmp \
+  && mv -f "$cfgfile.tmp" "$cfgfile" \
+    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+test 0 -eq $? || _lt_function_replace_fail=:
+
+
+  # Save a `func_append' function call where possible by direct use of '+='
+  sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+else
+  # Save a `func_append' function call even when '+=' is not available
+  sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
+    && mv -f "$cfgfile.tmp" "$cfgfile" \
+      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
+  test 0 -eq $? || _lt_function_replace_fail=:
+fi
+
+if test x"$_lt_function_replace_fail" = x":"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Unable to substitute extended shell functions in $ofile" >&5
+$as_echo "$as_me: WARNING: Unable to substitute extended shell functions in $ofile" >&2;}
+fi
 
-  sed -n '/^# Generated shell functions inserted here/,$p' "$ltmain" >> "$cfgfile" \
-    || (rm -f "$cfgfile"; exit 1)
 
-  mv -f "$cfgfile" "$ofile" ||
+   mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
 
@@ -60165,6 +47769,10 @@
 # The linker used to build libraries.
 LD=$lt_LD_CXX
 
+# How to create reloadable object files.
+reload_flag=$lt_reload_flag_CXX
+reload_cmds=$lt_reload_cmds_CXX
+
 # Commands used to build an old-style archive.
 old_archive_cmds=$lt_old_archive_cmds_CXX
 
@@ -60177,12 +47785,12 @@
 # Compiler flag to turn off builtin functions.
 no_builtin_flag=$lt_lt_prog_compiler_no_builtin_flag_CXX
 
-# How to pass a linker flag through the compiler.
-wl=$lt_lt_prog_compiler_wl_CXX
-
 # Additional compiler flags for building library objects.
 pic_flag=$lt_lt_prog_compiler_pic_CXX
 
+# How to pass a linker flag through the compiler.
+wl=$lt_lt_prog_compiler_wl_CXX
+
 # Compiler flag to prevent dynamic linking.
 link_static_flag=$lt_lt_prog_compiler_static_CXX
 
@@ -60232,10 +47840,6 @@
 # This must work even if \$libdir does not exist
 hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec_CXX
 
-# If ld is used when linking, flag to hardcode \$libdir into a binary
-# during linking.  This must work even if \$libdir does not exist.
-hardcode_libdir_flag_spec_ld=$lt_hardcode_libdir_flag_spec_ld_CXX
-
 # Whether we need a single "-rpath" flag with a separated argument.
 hardcode_libdir_separator=$lt_hardcode_libdir_separator_CXX
 
@@ -60269,9 +47873,6 @@
 # Whether libtool must link a program against all its dependency libraries.
 link_all_deplibs=$link_all_deplibs_CXX
 
-# Fix the shell variable \$srcfile for the compiler.
-fix_srcfile_path=$lt_fix_srcfile_path_CXX
-
 # Set to "yes" if exported symbols are required.
 always_export_symbols=$always_export_symbols_CXX
 
@@ -60287,6 +47888,9 @@
 # Commands necessary for linking programs (against libraries) with templates.
 prelink_cmds=$lt_prelink_cmds_CXX
 
+# Commands necessary for finishing linking programs.
+postlink_cmds=$lt_postlink_cmds_CXX
+
 # Specify filename containing input files.
 file_list_spec=$lt_file_list_spec_CXX
 
@@ -60320,15 +47924,12 @@
 done # for ac_tag
 
 
-{ (exit 0); exit 0; }
+as_fn_exit 0
 _ACEOF
-chmod +x $CONFIG_STATUS
 ac_clean_files=$ac_clean_files_save
 
 test $ac_write_fail = 0 ||
-  { { $as_echo "$as_me:$LINENO: error: write failure creating $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: write failure creating $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
 
 
 # configure is writing to config.log, and then calls config.status.
@@ -60349,10 +47950,10 @@
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || { (exit 1); exit 1; }
+  $ac_cs_success || as_fn_exit 1
 fi
 if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
-  { $as_echo "$as_me:$LINENO: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
 $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
 fi
 
Index: blcr-0.8.5/contrib/Makefile.in
===================================================================
--- blcr-0.8.5.orig/contrib/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/contrib/Makefile.in	2013-03-26 22:50:49.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -50,6 +67,11 @@
 SCRIPTS = $(noinst_SCRIPTS)
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -93,6 +115,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -136,8 +159,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -150,6 +175,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -167,6 +193,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -200,7 +227,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -224,7 +250,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -249,9 +275,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 cr_insmod: $(top_builddir)/config.status $(srcdir)/cr_insmod.in
@@ -317,10 +343,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/cr_module/Makefile.in
===================================================================
--- blcr-0.8.5.orig/cr_module/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/cr_module/Makefile.in	2013-03-26 22:50:49.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -53,6 +70,11 @@
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -129,6 +151,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -172,8 +195,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -186,6 +211,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -203,6 +229,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -236,7 +263,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -299,7 +325,7 @@
 all: all-recursive
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -324,9 +350,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -503,13 +529,10 @@
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -544,10 +567,15 @@
 
 installcheck: installcheck-recursive
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/doc/Makefile.in
===================================================================
--- blcr-0.8.5.orig/doc/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/doc/Makefile.in	2013-03-26 22:50:49.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -46,6 +63,11 @@
 CONFIG_CLEAN_VPATH_FILES =
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -89,6 +111,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -132,8 +155,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -146,6 +171,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -163,6 +189,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -196,7 +223,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -223,7 +249,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -248,9 +274,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -310,10 +336,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/etc/Makefile.in
===================================================================
--- blcr-0.8.5.orig/etc/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/etc/Makefile.in	2013-03-26 22:50:49.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -46,6 +63,11 @@
 CONFIG_CLEAN_VPATH_FILES =
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -89,6 +111,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -132,8 +155,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -146,6 +171,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -163,6 +189,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -196,7 +223,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -217,7 +243,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -242,9 +268,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -304,10 +330,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/examples/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -53,6 +70,11 @@
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -129,6 +151,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -172,8 +195,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -186,6 +211,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -203,6 +229,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -236,7 +263,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -258,7 +284,7 @@
 all: all-recursive
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -283,9 +309,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -462,13 +488,10 @@
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -503,10 +526,15 @@
 
 installcheck: installcheck-recursive
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/examples/counting/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/counting/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/counting/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = counting.c
 DIST_SOURCES = counting.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -113,6 +135,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +179,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +195,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +213,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +247,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -246,7 +272,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -271,9 +297,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -285,7 +311,7 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-counting$(EXEEXT): $(counting_OBJECTS) $(counting_DEPENDENCIES) 
+counting$(EXEEXT): $(counting_OBJECTS) $(counting_DEPENDENCIES) $(EXTRA_counting_DEPENDENCIES) 
 	@rm -f counting$(EXEEXT)
 	$(LINK) $(counting_OBJECTS) $(counting_LDADD) $(LIBS)
 
@@ -420,10 +446,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/examples/file_counting/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/file_counting/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/file_counting/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = file_counting.c
 DIST_SOURCES = file_counting.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -113,6 +135,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +179,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +195,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +213,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +247,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -246,7 +272,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -271,9 +297,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -285,7 +311,7 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-file_counting$(EXEEXT): $(file_counting_OBJECTS) $(file_counting_DEPENDENCIES) 
+file_counting$(EXEEXT): $(file_counting_OBJECTS) $(file_counting_DEPENDENCIES) $(EXTRA_file_counting_DEPENDENCIES) 
 	@rm -f file_counting$(EXEEXT)
 	$(LINK) $(file_counting_OBJECTS) $(file_counting_LDADD) $(LIBS)
 
@@ -420,10 +446,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/examples/io_bench/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/io_bench/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/io_bench/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = io_bench.c
 DIST_SOURCES = io_bench.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -113,6 +135,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +179,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +195,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +213,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +247,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -249,7 +275,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -274,9 +300,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -288,7 +314,7 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-io_bench$(EXEEXT): $(io_bench_OBJECTS) $(io_bench_DEPENDENCIES) 
+io_bench$(EXEEXT): $(io_bench_OBJECTS) $(io_bench_DEPENDENCIES) $(EXTRA_io_bench_DEPENDENCIES) 
 	@rm -f io_bench$(EXEEXT)
 	$(LINK) $(io_bench_OBJECTS) $(io_bench_LDADD) $(LIBS)
 
@@ -423,10 +449,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/examples/pipe_counting/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/pipe_counting/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/pipe_counting/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = pipe_counting.c
 DIST_SOURCES = pipe_counting.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -113,6 +135,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +179,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +195,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +213,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +247,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -246,7 +272,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -271,9 +297,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -285,7 +311,7 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-pipe_counting$(EXEEXT): $(pipe_counting_OBJECTS) $(pipe_counting_DEPENDENCIES) 
+pipe_counting$(EXEEXT): $(pipe_counting_OBJECTS) $(pipe_counting_DEPENDENCIES) $(EXTRA_pipe_counting_DEPENDENCIES) 
 	@rm -f pipe_counting$(EXEEXT)
 	$(LINK) $(pipe_counting_OBJECTS) $(pipe_counting_LDADD) $(LIBS)
 
@@ -420,10 +446,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/examples/pthread_counting/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/pthread_counting/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/pthread_counting/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = pthread_counting.c
 DIST_SOURCES = pthread_counting.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -113,6 +135,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +179,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +195,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +213,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +247,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -247,7 +273,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -272,9 +298,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -286,7 +312,7 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-pthread_counting$(EXEEXT): $(pthread_counting_OBJECTS) $(pthread_counting_DEPENDENCIES) 
+pthread_counting$(EXEEXT): $(pthread_counting_OBJECTS) $(pthread_counting_DEPENDENCIES) $(EXTRA_pthread_counting_DEPENDENCIES) 
 	@rm -f pthread_counting$(EXEEXT)
 	$(LINK) $(pthread_counting_OBJECTS) $(pthread_counting_LDADD) $(LIBS)
 
@@ -421,10 +447,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/examples/pthread_misc/Makefile.in
===================================================================
--- blcr-0.8.5.orig/examples/pthread_misc/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/examples/pthread_misc/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = pthread_misc.c
 DIST_SOURCES = pthread_misc.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -113,6 +135,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +179,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +195,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +213,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +247,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -249,7 +275,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -274,9 +300,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -288,7 +314,7 @@
 	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
 	echo " rm -f" $$list; \
 	rm -f $$list
-pthread_misc$(EXEEXT): $(pthread_misc_OBJECTS) $(pthread_misc_DEPENDENCIES) 
+pthread_misc$(EXEEXT): $(pthread_misc_OBJECTS) $(pthread_misc_DEPENDENCIES) $(EXTRA_pthread_misc_DEPENDENCIES) 
 	@rm -f pthread_misc$(EXEEXT)
 	$(LINK) $(pthread_misc_OBJECTS) $(pthread_misc_LDADD) $(LIBS)
 
@@ -423,10 +449,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/include/Makefile.in
===================================================================
--- blcr-0.8.5.orig/include/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/include/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -49,6 +66,11 @@
 CONFIG_CLEAN_VPATH_FILES =
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__include_HEADERS_DIST = blcr_ioctl.h blcr_proc.h blcr_errcodes.h \
 	libcr.h
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
@@ -72,6 +94,12 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 am__installdirs = "$(DESTDIR)$(includedir)" "$(DESTDIR)$(includedir)"
 am__noinst_HEADERS_DIST = blcr_ksyms.h blcr_vmadump.h
 HEADERS = $(include_HEADERS) $(nodist_include_HEADERS) \
@@ -121,6 +149,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -164,8 +193,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -178,6 +209,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -195,6 +227,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -228,7 +261,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -252,7 +284,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -277,9 +309,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 blcr_imports.h: $(top_builddir)/config.status $(srcdir)/blcr_imports.h.in
@@ -294,8 +326,11 @@
 	-rm -rf .libs _libs
 install-includeHEADERS: $(include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(includedir)" || $(MKDIR_P) "$(DESTDIR)$(includedir)"
 	@list='$(include_HEADERS)'; test -n "$(includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -309,13 +344,14 @@
 	@$(NORMAL_UNINSTALL)
 	@list='$(include_HEADERS)'; test -n "$(includedir)" || list=; \
 	files=`for p in $$list; do echo $$p; done | sed -e 's|^.*/||'`; \
-	test -n "$$files" || exit 0; \
-	echo " ( cd '$(DESTDIR)$(includedir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(includedir)" && rm -f $$files
+	dir='$(DESTDIR)$(includedir)'; $(am__uninstall_files_from_dir)
 install-nodist_includeHEADERS: $(nodist_include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(includedir)" || $(MKDIR_P) "$(DESTDIR)$(includedir)"
 	@list='$(nodist_include_HEADERS)'; test -n "$(includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -329,9 +365,7 @@
 	@$(NORMAL_UNINSTALL)
 	@list='$(nodist_include_HEADERS)'; test -n "$(includedir)" || list=; \
 	files=`for p in $$list; do echo $$p; done | sed -e 's|^.*/||'`; \
-	test -n "$$files" || exit 0; \
-	echo " ( cd '$(DESTDIR)$(includedir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(includedir)" && rm -f $$files
+	dir='$(DESTDIR)$(includedir)'; $(am__uninstall_files_from_dir)
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -432,10 +466,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/libcr/Makefile.in
===================================================================
--- blcr-0.8.5.orig/libcr/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/libcr/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -68,6 +85,12 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 am__installdirs = "$(DESTDIR)$(libdir)"
 LTLIBRARIES = $(lib_LTLIBRARIES)
 libcr_la_DEPENDENCIES =
@@ -120,6 +143,11 @@
 DIST_SOURCES = $(am__libcr_la_SOURCES_DIST) \
 	$(am__libcr_omit_la_SOURCES_DIST) \
 	$(am__libcr_run_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -166,6 +194,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -209,8 +238,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -223,6 +254,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -240,6 +272,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -273,7 +306,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -341,7 +373,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -366,14 +398,13 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -381,6 +412,8 @@
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -402,11 +435,11 @@
 	  echo "rm -f \"$${dir}/so_locations\""; \
 	  rm -f "$${dir}/so_locations"; \
 	done
-libcr.la: $(libcr_la_OBJECTS) $(libcr_la_DEPENDENCIES) 
+libcr.la: $(libcr_la_OBJECTS) $(libcr_la_DEPENDENCIES) $(EXTRA_libcr_la_DEPENDENCIES) 
 	$(libcr_la_LINK) -rpath $(libdir) $(libcr_la_OBJECTS) $(libcr_la_LIBADD) $(LIBS)
-libcr_omit.la: $(libcr_omit_la_OBJECTS) $(libcr_omit_la_DEPENDENCIES) 
+libcr_omit.la: $(libcr_omit_la_OBJECTS) $(libcr_omit_la_DEPENDENCIES) $(EXTRA_libcr_omit_la_DEPENDENCIES) 
 	$(libcr_omit_la_LINK) -rpath $(libdir) $(libcr_omit_la_OBJECTS) $(libcr_omit_la_LIBADD) $(LIBS)
-libcr_run.la: $(libcr_run_la_OBJECTS) $(libcr_run_la_DEPENDENCIES) 
+libcr_run.la: $(libcr_run_la_OBJECTS) $(libcr_run_la_DEPENDENCIES) $(EXTRA_libcr_run_la_DEPENDENCIES) 
 	$(libcr_run_la_LINK) -rpath $(libdir) $(libcr_run_la_OBJECTS) $(libcr_run_la_LIBADD) $(LIBS)
 
 mostlyclean-compile:
@@ -689,10 +722,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/man/Makefile.in
===================================================================
--- blcr-0.8.5.orig/man/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/man/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -46,6 +63,11 @@
 CONFIG_CLEAN_VPATH_FILES =
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -89,6 +111,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -132,8 +155,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -146,6 +171,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -163,6 +189,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -196,7 +223,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -216,7 +242,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -241,9 +267,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -303,10 +329,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/rpm/Makefile.in
===================================================================
--- blcr-0.8.5.orig/rpm/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/rpm/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -47,6 +64,11 @@
 CONFIG_CLEAN_VPATH_FILES =
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -90,6 +112,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -133,8 +156,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -147,6 +172,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -164,6 +190,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -197,7 +224,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -231,7 +257,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -256,9 +282,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 specfile: $(top_builddir)/config.status $(srcdir)/specfile.in
@@ -320,10 +346,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/tests/Makefile.in
===================================================================
--- blcr-0.8.5.orig/tests/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/tests/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -360,6 +377,12 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 SCRIPTS = $(testsexec_SCRIPTS)
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/./config/depcomp
@@ -409,6 +432,11 @@
 	sigaltstack.c sigpending.c simple.c simple_pthread.c \
 	stage0001.c stage0002.c stage0003.c stage0004.c stopped.c \
 	$(am__testcxx_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 am__tty_colors = \
@@ -457,6 +485,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -500,8 +529,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -514,6 +545,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -531,6 +563,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -564,7 +597,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -761,7 +793,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .cc .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -786,9 +818,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 shellinit: $(top_builddir)/config.status $(srcdir)/shellinit.in
@@ -796,7 +828,7 @@
 
 clean-checkLIBRARIES:
 	-test -z "$(check_LIBRARIES)" || rm -f $(check_LIBRARIES)
-libtest.a: $(libtest_a_OBJECTS) $(libtest_a_DEPENDENCIES) 
+libtest.a: $(libtest_a_OBJECTS) $(libtest_a_DEPENDENCIES) $(EXTRA_libtest_a_DEPENDENCIES) 
 	-rm -f libtest.a
 	$(libtest_a_AR) libtest.a $(libtest_a_OBJECTS) $(libtest_a_LIBADD)
 	$(RANLIB) libtest.a
@@ -811,8 +843,11 @@
 	rm -f $$list
 install-testsexecPROGRAMS: $(testsexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	test -z "$(testsexecdir)" || $(MKDIR_P) "$(DESTDIR)$(testsexecdir)"
 	@list='$(testsexec_PROGRAMS)'; test -n "$(testsexecdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(testsexecdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(testsexecdir)" || exit 1; \
+	fi; \
 	for p in $$list; do echo "$$p $$p"; done | \
 	sed 's/$(EXEEXT)$$//' | \
 	while read p p1; do if test -f $$p || test -f $$p1; \
@@ -868,181 +903,184 @@
 	    else echo "$$f does not support $$opt" 1>&2; bad=1; fi; \
 	  done; \
 	done; rm -f c$${pid}_.???; exit $$bad
-atomics$(EXEEXT): $(atomics_OBJECTS) $(atomics_DEPENDENCIES) 
+atomics$(EXEEXT): $(atomics_OBJECTS) $(atomics_DEPENDENCIES) $(EXTRA_atomics_DEPENDENCIES) 
 	@rm -f atomics$(EXEEXT)
 	$(atomics_LINK) $(atomics_OBJECTS) $(atomics_LDADD) $(LIBS)
-atomics_stress$(EXEEXT): $(atomics_stress_OBJECTS) $(atomics_stress_DEPENDENCIES) 
+atomics_stress$(EXEEXT): $(atomics_stress_OBJECTS) $(atomics_stress_DEPENDENCIES) $(EXTRA_atomics_stress_DEPENDENCIES) 
 	@rm -f atomics_stress$(EXEEXT)
 	$(atomics_stress_LINK) $(atomics_stress_OBJECTS) $(atomics_stress_LDADD) $(LIBS)
-bug2003_aux$(EXEEXT): $(bug2003_aux_OBJECTS) $(bug2003_aux_DEPENDENCIES) 
+bug2003_aux$(EXEEXT): $(bug2003_aux_OBJECTS) $(bug2003_aux_DEPENDENCIES) $(EXTRA_bug2003_aux_DEPENDENCIES) 
 	@rm -f bug2003_aux$(EXEEXT)
 	$(bug2003_aux_LINK) $(bug2003_aux_OBJECTS) $(bug2003_aux_LDADD) $(LIBS)
-bug2524$(EXEEXT): $(bug2524_OBJECTS) $(bug2524_DEPENDENCIES) 
+bug2524$(EXEEXT): $(bug2524_OBJECTS) $(bug2524_DEPENDENCIES) $(EXTRA_bug2524_DEPENDENCIES) 
 	@rm -f bug2524$(EXEEXT)
 	$(LINK) $(bug2524_OBJECTS) $(bug2524_LDADD) $(LIBS)
-cb_exit$(EXEEXT): $(cb_exit_OBJECTS) $(cb_exit_DEPENDENCIES) 
+cb_exit$(EXEEXT): $(cb_exit_OBJECTS) $(cb_exit_DEPENDENCIES) $(EXTRA_cb_exit_DEPENDENCIES) 
 	@rm -f cb_exit$(EXEEXT)
 	$(LINK) $(cb_exit_OBJECTS) $(cb_exit_LDADD) $(LIBS)
-child$(EXEEXT): $(child_OBJECTS) $(child_DEPENDENCIES) 
+child$(EXEEXT): $(child_OBJECTS) $(child_DEPENDENCIES) $(EXTRA_child_DEPENDENCIES) 
 	@rm -f child$(EXEEXT)
 	$(LINK) $(child_OBJECTS) $(child_LDADD) $(LIBS)
-cloexec$(EXEEXT): $(cloexec_OBJECTS) $(cloexec_DEPENDENCIES) 
+cloexec$(EXEEXT): $(cloexec_OBJECTS) $(cloexec_DEPENDENCIES) $(EXTRA_cloexec_DEPENDENCIES) 
 	@rm -f cloexec$(EXEEXT)
 	$(LINK) $(cloexec_OBJECTS) $(cloexec_LDADD) $(LIBS)
-cr_signal$(EXEEXT): $(cr_signal_OBJECTS) $(cr_signal_DEPENDENCIES) 
+cr_signal$(EXEEXT): $(cr_signal_OBJECTS) $(cr_signal_DEPENDENCIES) $(EXTRA_cr_signal_DEPENDENCIES) 
 	@rm -f cr_signal$(EXEEXT)
 	$(LINK) $(cr_signal_OBJECTS) $(cr_signal_LDADD) $(LIBS)
-cr_tryenter_cs$(EXEEXT): $(cr_tryenter_cs_OBJECTS) $(cr_tryenter_cs_DEPENDENCIES) 
+cr_tryenter_cs$(EXEEXT): $(cr_tryenter_cs_OBJECTS) $(cr_tryenter_cs_DEPENDENCIES) $(EXTRA_cr_tryenter_cs_DEPENDENCIES) 
 	@rm -f cr_tryenter_cs$(EXEEXT)
 	$(LINK) $(cr_tryenter_cs_OBJECTS) $(cr_tryenter_cs_LDADD) $(LIBS)
-critical_sections$(EXEEXT): $(critical_sections_OBJECTS) $(critical_sections_DEPENDENCIES) 
+critical_sections$(EXEEXT): $(critical_sections_OBJECTS) $(critical_sections_DEPENDENCIES) $(EXTRA_critical_sections_DEPENDENCIES) 
 	@rm -f critical_sections$(EXEEXT)
 	$(LINK) $(critical_sections_OBJECTS) $(critical_sections_LDADD) $(LIBS)
-crut_wrapper$(EXEEXT): $(crut_wrapper_OBJECTS) $(crut_wrapper_DEPENDENCIES) 
+crut_wrapper$(EXEEXT): $(crut_wrapper_OBJECTS) $(crut_wrapper_DEPENDENCIES) $(EXTRA_crut_wrapper_DEPENDENCIES) 
 	@rm -f crut_wrapper$(EXEEXT)
 	$(LINK) $(crut_wrapper_OBJECTS) $(crut_wrapper_LDADD) $(LIBS)
-cs_enter_leave$(EXEEXT): $(cs_enter_leave_OBJECTS) $(cs_enter_leave_DEPENDENCIES) 
+cs_enter_leave$(EXEEXT): $(cs_enter_leave_OBJECTS) $(cs_enter_leave_DEPENDENCIES) $(EXTRA_cs_enter_leave_DEPENDENCIES) 
 	@rm -f cs_enter_leave$(EXEEXT)
 	$(LINK) $(cs_enter_leave_OBJECTS) $(cs_enter_leave_LDADD) $(LIBS)
-cs_enter_leave2$(EXEEXT): $(cs_enter_leave2_OBJECTS) $(cs_enter_leave2_DEPENDENCIES) 
+cs_enter_leave2$(EXEEXT): $(cs_enter_leave2_OBJECTS) $(cs_enter_leave2_DEPENDENCIES) $(EXTRA_cs_enter_leave2_DEPENDENCIES) 
 	@rm -f cs_enter_leave2$(EXEEXT)
 	$(LINK) $(cs_enter_leave2_OBJECTS) $(cs_enter_leave2_LDADD) $(LIBS)
-cwd$(EXEEXT): $(cwd_OBJECTS) $(cwd_DEPENDENCIES) 
+cwd$(EXEEXT): $(cwd_OBJECTS) $(cwd_DEPENDENCIES) $(EXTRA_cwd_DEPENDENCIES) 
 	@rm -f cwd$(EXEEXT)
 	$(LINK) $(cwd_OBJECTS) $(cwd_LDADD) $(LIBS)
-dev_null$(EXEEXT): $(dev_null_OBJECTS) $(dev_null_DEPENDENCIES) 
+dev_null$(EXEEXT): $(dev_null_OBJECTS) $(dev_null_DEPENDENCIES) $(EXTRA_dev_null_DEPENDENCIES) 
 	@rm -f dev_null$(EXEEXT)
 	$(LINK) $(dev_null_OBJECTS) $(dev_null_LDADD) $(LIBS)
-dlopen_aux$(EXEEXT): $(dlopen_aux_OBJECTS) $(dlopen_aux_DEPENDENCIES) 
+dlopen_aux$(EXEEXT): $(dlopen_aux_OBJECTS) $(dlopen_aux_DEPENDENCIES) $(EXTRA_dlopen_aux_DEPENDENCIES) 
 	@rm -f dlopen_aux$(EXEEXT)
 	$(LINK) $(dlopen_aux_OBJECTS) $(dlopen_aux_LDADD) $(LIBS)
-dpipe$(EXEEXT): $(dpipe_OBJECTS) $(dpipe_DEPENDENCIES) 
+dpipe$(EXEEXT): $(dpipe_OBJECTS) $(dpipe_DEPENDENCIES) $(EXTRA_dpipe_DEPENDENCIES) 
 	@rm -f dpipe$(EXEEXT)
 	$(LINK) $(dpipe_OBJECTS) $(dpipe_LDADD) $(LIBS)
-dup$(EXEEXT): $(dup_OBJECTS) $(dup_DEPENDENCIES) 
+dup$(EXEEXT): $(dup_OBJECTS) $(dup_DEPENDENCIES) $(EXTRA_dup_DEPENDENCIES) 
 	@rm -f dup$(EXEEXT)
 	$(LINK) $(dup_OBJECTS) $(dup_LDADD) $(LIBS)
-edeadlk$(EXEEXT): $(edeadlk_OBJECTS) $(edeadlk_DEPENDENCIES) 
+edeadlk$(EXEEXT): $(edeadlk_OBJECTS) $(edeadlk_DEPENDENCIES) $(EXTRA_edeadlk_DEPENDENCIES) 
 	@rm -f edeadlk$(EXEEXT)
 	$(LINK) $(edeadlk_OBJECTS) $(edeadlk_LDADD) $(LIBS)
-failed_cb$(EXEEXT): $(failed_cb_OBJECTS) $(failed_cb_DEPENDENCIES) 
+failed_cb$(EXEEXT): $(failed_cb_OBJECTS) $(failed_cb_DEPENDENCIES) $(EXTRA_failed_cb_DEPENDENCIES) 
 	@rm -f failed_cb$(EXEEXT)
 	$(LINK) $(failed_cb_OBJECTS) $(failed_cb_LDADD) $(LIBS)
-failed_cb2$(EXEEXT): $(failed_cb2_OBJECTS) $(failed_cb2_DEPENDENCIES) 
+failed_cb2$(EXEEXT): $(failed_cb2_OBJECTS) $(failed_cb2_DEPENDENCIES) $(EXTRA_failed_cb2_DEPENDENCIES) 
 	@rm -f failed_cb2$(EXEEXT)
 	$(LINK) $(failed_cb2_OBJECTS) $(failed_cb2_LDADD) $(LIBS)
-filedescriptors$(EXEEXT): $(filedescriptors_OBJECTS) $(filedescriptors_DEPENDENCIES) 
+filedescriptors$(EXEEXT): $(filedescriptors_OBJECTS) $(filedescriptors_DEPENDENCIES) $(EXTRA_filedescriptors_DEPENDENCIES) 
 	@rm -f filedescriptors$(EXEEXT)
 	$(LINK) $(filedescriptors_OBJECTS) $(filedescriptors_LDADD) $(LIBS)
-forward$(EXEEXT): $(forward_OBJECTS) $(forward_DEPENDENCIES) 
+forward$(EXEEXT): $(forward_OBJECTS) $(forward_DEPENDENCIES) $(EXTRA_forward_DEPENDENCIES) 
 	@rm -f forward$(EXEEXT)
 	$(LINK) $(forward_OBJECTS) $(forward_LDADD) $(LIBS)
-get_info$(EXEEXT): $(get_info_OBJECTS) $(get_info_DEPENDENCIES) 
+get_info$(EXEEXT): $(get_info_OBJECTS) $(get_info_DEPENDENCIES) $(EXTRA_get_info_DEPENDENCIES) 
 	@rm -f get_info$(EXEEXT)
 	$(LINK) $(get_info_OBJECTS) $(get_info_LDADD) $(LIBS)
-hello$(EXEEXT): $(hello_OBJECTS) $(hello_DEPENDENCIES) 
+hello$(EXEEXT): $(hello_OBJECTS) $(hello_DEPENDENCIES) $(EXTRA_hello_DEPENDENCIES) 
 	@rm -f hello$(EXEEXT)
 	$(LINK) $(hello_OBJECTS) $(hello_LDADD) $(LIBS)
-hooks$(EXEEXT): $(hooks_OBJECTS) $(hooks_DEPENDENCIES) 
+hooks$(EXEEXT): $(hooks_OBJECTS) $(hooks_DEPENDENCIES) $(EXTRA_hooks_DEPENDENCIES) 
 	@rm -f hooks$(EXEEXT)
 	$(LINK) $(hooks_OBJECTS) $(hooks_LDADD) $(LIBS)
-hugetlbfs$(EXEEXT): $(hugetlbfs_OBJECTS) $(hugetlbfs_DEPENDENCIES) 
+hugetlbfs$(EXEEXT): $(hugetlbfs_OBJECTS) $(hugetlbfs_DEPENDENCIES) $(EXTRA_hugetlbfs_DEPENDENCIES) 
 	@rm -f hugetlbfs$(EXEEXT)
 	$(LINK) $(hugetlbfs_OBJECTS) $(hugetlbfs_LDADD) $(LIBS)
-hugetlbfs2$(EXEEXT): $(hugetlbfs2_OBJECTS) $(hugetlbfs2_DEPENDENCIES) 
+hugetlbfs2$(EXEEXT): $(hugetlbfs2_OBJECTS) $(hugetlbfs2_DEPENDENCIES) $(EXTRA_hugetlbfs2_DEPENDENCIES) 
 	@rm -f hugetlbfs2$(EXEEXT)
 	$(LINK) $(hugetlbfs2_OBJECTS) $(hugetlbfs2_LDADD) $(LIBS)
-lam$(EXEEXT): $(lam_OBJECTS) $(lam_DEPENDENCIES) 
+lam$(EXEEXT): $(lam_OBJECTS) $(lam_DEPENDENCIES) $(EXTRA_lam_DEPENDENCIES) 
 	@rm -f lam$(EXEEXT)
 	$(LINK) $(lam_OBJECTS) $(lam_LDADD) $(LIBS)
-linked_fifo$(EXEEXT): $(linked_fifo_OBJECTS) $(linked_fifo_DEPENDENCIES) 
+linked_fifo$(EXEEXT): $(linked_fifo_OBJECTS) $(linked_fifo_DEPENDENCIES) $(EXTRA_linked_fifo_DEPENDENCIES) 
 	@rm -f linked_fifo$(EXEEXT)
 	$(LINK) $(linked_fifo_OBJECTS) $(linked_fifo_LDADD) $(LIBS)
-math$(EXEEXT): $(math_OBJECTS) $(math_DEPENDENCIES) 
+math$(EXEEXT): $(math_OBJECTS) $(math_DEPENDENCIES) $(EXTRA_math_DEPENDENCIES) 
 	@rm -f math$(EXEEXT)
 	$(LINK) $(math_OBJECTS) $(math_LDADD) $(LIBS)
-mmaps$(EXEEXT): $(mmaps_OBJECTS) $(mmaps_DEPENDENCIES) 
+mmaps$(EXEEXT): $(mmaps_OBJECTS) $(mmaps_DEPENDENCIES) $(EXTRA_mmaps_DEPENDENCIES) 
 	@rm -f mmaps$(EXEEXT)
 	$(LINK) $(mmaps_OBJECTS) $(mmaps_LDADD) $(LIBS)
-named_fifo$(EXEEXT): $(named_fifo_OBJECTS) $(named_fifo_DEPENDENCIES) 
+named_fifo$(EXEEXT): $(named_fifo_OBJECTS) $(named_fifo_DEPENDENCIES) $(EXTRA_named_fifo_DEPENDENCIES) 
 	@rm -f named_fifo$(EXEEXT)
 	$(LINK) $(named_fifo_OBJECTS) $(named_fifo_LDADD) $(LIBS)
-nscd$(EXEEXT): $(nscd_OBJECTS) $(nscd_DEPENDENCIES) 
+nscd$(EXEEXT): $(nscd_OBJECTS) $(nscd_DEPENDENCIES) $(EXTRA_nscd_DEPENDENCIES) 
 	@rm -f nscd$(EXEEXT)
 	$(LINK) $(nscd_OBJECTS) $(nscd_LDADD) $(LIBS)
-orphan$(EXEEXT): $(orphan_OBJECTS) $(orphan_DEPENDENCIES) 
+orphan$(EXEEXT): $(orphan_OBJECTS) $(orphan_DEPENDENCIES) $(EXTRA_orphan_DEPENDENCIES) 
 	@rm -f orphan$(EXEEXT)
 	$(LINK) $(orphan_OBJECTS) $(orphan_LDADD) $(LIBS)
-overlap$(EXEEXT): $(overlap_OBJECTS) $(overlap_DEPENDENCIES) 
+overlap$(EXEEXT): $(overlap_OBJECTS) $(overlap_DEPENDENCIES) $(EXTRA_overlap_DEPENDENCIES) 
 	@rm -f overlap$(EXEEXT)
 	$(LINK) $(overlap_OBJECTS) $(overlap_LDADD) $(LIBS)
-pause$(EXEEXT): $(pause_OBJECTS) $(pause_DEPENDENCIES) 
+pause$(EXEEXT): $(pause_OBJECTS) $(pause_DEPENDENCIES) $(EXTRA_pause_DEPENDENCIES) 
 	@rm -f pause$(EXEEXT)
 	$(pause_LINK) $(pause_OBJECTS) $(pause_LDADD) $(LIBS)
-pid_in_use$(EXEEXT): $(pid_in_use_OBJECTS) $(pid_in_use_DEPENDENCIES) 
+pid_in_use$(EXEEXT): $(pid_in_use_OBJECTS) $(pid_in_use_DEPENDENCIES) $(EXTRA_pid_in_use_DEPENDENCIES) 
 	@rm -f pid_in_use$(EXEEXT)
 	$(LINK) $(pid_in_use_OBJECTS) $(pid_in_use_LDADD) $(LIBS)
-pid_restore$(EXEEXT): $(pid_restore_OBJECTS) $(pid_restore_DEPENDENCIES) 
+pid_restore$(EXEEXT): $(pid_restore_OBJECTS) $(pid_restore_DEPENDENCIES) $(EXTRA_pid_restore_DEPENDENCIES) 
 	@rm -f pid_restore$(EXEEXT)
 	$(LINK) $(pid_restore_OBJECTS) $(pid_restore_LDADD) $(LIBS)
-pipe$(EXEEXT): $(pipe_OBJECTS) $(pipe_DEPENDENCIES) 
+pipe$(EXEEXT): $(pipe_OBJECTS) $(pipe_DEPENDENCIES) $(EXTRA_pipe_DEPENDENCIES) 
 	@rm -f pipe$(EXEEXT)
 	$(LINK) $(pipe_OBJECTS) $(pipe_LDADD) $(LIBS)
-prctl$(EXEEXT): $(prctl_OBJECTS) $(prctl_DEPENDENCIES) 
+prctl$(EXEEXT): $(prctl_OBJECTS) $(prctl_DEPENDENCIES) $(EXTRA_prctl_DEPENDENCIES) 
 	@rm -f prctl$(EXEEXT)
 	$(LINK) $(prctl_OBJECTS) $(prctl_LDADD) $(LIBS)
-ptrace$(EXEEXT): $(ptrace_OBJECTS) $(ptrace_DEPENDENCIES) 
+ptrace$(EXEEXT): $(ptrace_OBJECTS) $(ptrace_DEPENDENCIES) $(EXTRA_ptrace_DEPENDENCIES) 
 	@rm -f ptrace$(EXEEXT)
 	$(ptrace_LINK) $(ptrace_OBJECTS) $(ptrace_LDADD) $(LIBS)
-readdir$(EXEEXT): $(readdir_OBJECTS) $(readdir_DEPENDENCIES) 
+readdir$(EXEEXT): $(readdir_OBJECTS) $(readdir_DEPENDENCIES) $(EXTRA_readdir_DEPENDENCIES) 
 	@rm -f readdir$(EXEEXT)
 	$(LINK) $(readdir_OBJECTS) $(readdir_LDADD) $(LIBS)
-reloc_aux$(EXEEXT): $(reloc_aux_OBJECTS) $(reloc_aux_DEPENDENCIES) 
+reloc_aux$(EXEEXT): $(reloc_aux_OBJECTS) $(reloc_aux_DEPENDENCIES) $(EXTRA_reloc_aux_DEPENDENCIES) 
 	@rm -f reloc_aux$(EXEEXT)
 	$(reloc_aux_LINK) $(reloc_aux_OBJECTS) $(reloc_aux_LDADD) $(LIBS)
-replace_cb$(EXEEXT): $(replace_cb_OBJECTS) $(replace_cb_DEPENDENCIES) 
+replace_cb$(EXEEXT): $(replace_cb_OBJECTS) $(replace_cb_DEPENDENCIES) $(EXTRA_replace_cb_DEPENDENCIES) 
 	@rm -f replace_cb$(EXEEXT)
 	$(LINK) $(replace_cb_OBJECTS) $(replace_cb_LDADD) $(LIBS)
-save_aux$(EXEEXT): $(save_aux_OBJECTS) $(save_aux_DEPENDENCIES) 
+save_aux$(EXEEXT): $(save_aux_OBJECTS) $(save_aux_DEPENDENCIES) $(EXTRA_save_aux_DEPENDENCIES) 
 	@rm -f save_aux$(EXEEXT)
 	$(save_aux_LINK) $(save_aux_OBJECTS) $(save_aux_LDADD) $(LIBS)
-seq_wrapper$(EXEEXT): $(seq_wrapper_OBJECTS) $(seq_wrapper_DEPENDENCIES) 
+seq_wrapper$(EXEEXT): $(seq_wrapper_OBJECTS) $(seq_wrapper_DEPENDENCIES) $(EXTRA_seq_wrapper_DEPENDENCIES) 
 	@rm -f seq_wrapper$(EXEEXT)
 	$(LINK) $(seq_wrapper_OBJECTS) $(seq_wrapper_LDADD) $(LIBS)
-sigaltstack$(EXEEXT): $(sigaltstack_OBJECTS) $(sigaltstack_DEPENDENCIES) 
+sigaltstack$(EXEEXT): $(sigaltstack_OBJECTS) $(sigaltstack_DEPENDENCIES) $(EXTRA_sigaltstack_DEPENDENCIES) 
 	@rm -f sigaltstack$(EXEEXT)
 	$(LINK) $(sigaltstack_OBJECTS) $(sigaltstack_LDADD) $(LIBS)
-sigpending$(EXEEXT): $(sigpending_OBJECTS) $(sigpending_DEPENDENCIES) 
+sigpending$(EXEEXT): $(sigpending_OBJECTS) $(sigpending_DEPENDENCIES) $(EXTRA_sigpending_DEPENDENCIES) 
 	@rm -f sigpending$(EXEEXT)
 	$(LINK) $(sigpending_OBJECTS) $(sigpending_LDADD) $(LIBS)
-simple$(EXEEXT): $(simple_OBJECTS) $(simple_DEPENDENCIES) 
+simple$(EXEEXT): $(simple_OBJECTS) $(simple_DEPENDENCIES) $(EXTRA_simple_DEPENDENCIES) 
 	@rm -f simple$(EXEEXT)
 	$(LINK) $(simple_OBJECTS) $(simple_LDADD) $(LIBS)
-simple_pthread$(EXEEXT): $(simple_pthread_OBJECTS) $(simple_pthread_DEPENDENCIES) 
+simple_pthread$(EXEEXT): $(simple_pthread_OBJECTS) $(simple_pthread_DEPENDENCIES) $(EXTRA_simple_pthread_DEPENDENCIES) 
 	@rm -f simple_pthread$(EXEEXT)
 	$(LINK) $(simple_pthread_OBJECTS) $(simple_pthread_LDADD) $(LIBS)
-stage0001$(EXEEXT): $(stage0001_OBJECTS) $(stage0001_DEPENDENCIES) 
+stage0001$(EXEEXT): $(stage0001_OBJECTS) $(stage0001_DEPENDENCIES) $(EXTRA_stage0001_DEPENDENCIES) 
 	@rm -f stage0001$(EXEEXT)
 	$(LINK) $(stage0001_OBJECTS) $(stage0001_LDADD) $(LIBS)
-stage0002$(EXEEXT): $(stage0002_OBJECTS) $(stage0002_DEPENDENCIES) 
+stage0002$(EXEEXT): $(stage0002_OBJECTS) $(stage0002_DEPENDENCIES) $(EXTRA_stage0002_DEPENDENCIES) 
 	@rm -f stage0002$(EXEEXT)
 	$(LINK) $(stage0002_OBJECTS) $(stage0002_LDADD) $(LIBS)
-stage0003$(EXEEXT): $(stage0003_OBJECTS) $(stage0003_DEPENDENCIES) 
+stage0003$(EXEEXT): $(stage0003_OBJECTS) $(stage0003_DEPENDENCIES) $(EXTRA_stage0003_DEPENDENCIES) 
 	@rm -f stage0003$(EXEEXT)
 	$(LINK) $(stage0003_OBJECTS) $(stage0003_LDADD) $(LIBS)
-stage0004$(EXEEXT): $(stage0004_OBJECTS) $(stage0004_DEPENDENCIES) 
+stage0004$(EXEEXT): $(stage0004_OBJECTS) $(stage0004_DEPENDENCIES) $(EXTRA_stage0004_DEPENDENCIES) 
 	@rm -f stage0004$(EXEEXT)
 	$(LINK) $(stage0004_OBJECTS) $(stage0004_LDADD) $(LIBS)
-stopped$(EXEEXT): $(stopped_OBJECTS) $(stopped_DEPENDENCIES) 
+stopped$(EXEEXT): $(stopped_OBJECTS) $(stopped_DEPENDENCIES) $(EXTRA_stopped_DEPENDENCIES) 
 	@rm -f stopped$(EXEEXT)
 	$(LINK) $(stopped_OBJECTS) $(stopped_LDADD) $(LIBS)
-testcxx$(EXEEXT): $(testcxx_OBJECTS) $(testcxx_DEPENDENCIES) 
+testcxx$(EXEEXT): $(testcxx_OBJECTS) $(testcxx_DEPENDENCIES) $(EXTRA_testcxx_DEPENDENCIES) 
 	@rm -f testcxx$(EXEEXT)
 	$(CXXLINK) $(testcxx_OBJECTS) $(testcxx_LDADD) $(LIBS)
 install-testsexecSCRIPTS: $(testsexec_SCRIPTS)
 	@$(NORMAL_INSTALL)
-	test -z "$(testsexecdir)" || $(MKDIR_P) "$(DESTDIR)$(testsexecdir)"
 	@list='$(testsexec_SCRIPTS)'; test -n "$(testsexecdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(testsexecdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(testsexecdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  if test -f "$$d$$p"; then echo "$$d$$p"; echo "$$p"; else :; fi; \
@@ -1070,9 +1108,7 @@
 	@list='$(testsexec_SCRIPTS)'; test -n "$(testsexecdir)" || exit 0; \
 	files=`for p in $$list; do echo "$$p"; done | \
 	       sed -e 's,.*/,,;$(transform)'`; \
-	test -n "$$list" || exit 0; \
-	echo " ( cd '$(DESTDIR)$(testsexecdir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(testsexecdir)" && rm -f $$files
+	dir='$(DESTDIR)$(testsexecdir)'; $(am__uninstall_files_from_dir)
 
 installcheck-testsexecSCRIPTS: $(testsexec_SCRIPTS)
 	bad=0; pid=$$$$; list="$(testsexec_SCRIPTS)"; for p in $$list; do \
@@ -1366,14 +1402,15 @@
 	  fi; \
 	  dashes=`echo "$$dashes" | sed s/./=/g`; \
 	  if test "$$failed" -eq 0; then \
-	    echo "$$grn$$dashes"; \
+	    col="$$grn"; \
 	  else \
-	    echo "$$red$$dashes"; \
+	    col="$$red"; \
 	  fi; \
-	  echo "$$banner"; \
-	  test -z "$$skipped" || echo "$$skipped"; \
-	  test -z "$$report" || echo "$$report"; \
-	  echo "$$dashes$$std"; \
+	  echo "$${col}$$dashes$${std}"; \
+	  echo "$${col}$$banner$${std}"; \
+	  test -z "$$skipped" || echo "$${col}$$skipped$${std}"; \
+	  test -z "$$report" || echo "$${col}$$report$${std}"; \
+	  echo "$${col}$$dashes$${std}"; \
 	  test "$$failed" -eq 0; \
 	else :; fi
 
@@ -1427,10 +1464,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 	-test -z "$(MOSTLYCLEANFILES)" || rm -f $(MOSTLYCLEANFILES)
 
Index: blcr-0.8.5/util/Makefile.in
===================================================================
--- blcr-0.8.5.orig/util/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/util/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +15,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -53,6 +70,11 @@
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -129,6 +151,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -172,8 +195,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -186,6 +211,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -203,6 +229,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -236,7 +263,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -261,7 +287,7 @@
 all: all-recursive
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -286,9 +312,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -465,13 +491,10 @@
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -506,10 +529,15 @@
 
 installcheck: installcheck-recursive
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/util/cr_checkpoint/Makefile.in
===================================================================
--- blcr-0.8.5.orig/util/cr_checkpoint/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/util/cr_checkpoint/Makefile.in	2013-03-26 22:50:50.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -67,6 +84,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = cr_checkpoint.c
 DIST_SOURCES = cr_checkpoint.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -88,6 +110,12 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 man1dir = $(mandir)/man1
 NROFF = nroff
 MANS = $(man_MANS)
@@ -136,6 +164,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -179,8 +208,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -193,6 +224,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -210,6 +242,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -243,7 +276,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -277,7 +309,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -302,15 +334,18 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
 	@list='$(bin_PROGRAMS)'; test -n "$(bindir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(bindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(bindir)" || exit 1; \
+	fi; \
 	for p in $$list; do echo "$$p $$p"; done | \
 	sed 's/$(EXEEXT)$$//' | \
 	while read p p1; do if test -f $$p || test -f $$p1; \
@@ -366,7 +401,7 @@
 	    else echo "$$f does not support $$opt" 1>&2; bad=1; fi; \
 	  done; \
 	done; rm -f c$${pid}_.???; exit $$bad
-cr_checkpoint$(EXEEXT): $(cr_checkpoint_OBJECTS) $(cr_checkpoint_DEPENDENCIES) 
+cr_checkpoint$(EXEEXT): $(cr_checkpoint_OBJECTS) $(cr_checkpoint_DEPENDENCIES) $(EXTRA_cr_checkpoint_DEPENDENCIES) 
 	@rm -f cr_checkpoint$(EXEEXT)
 	$(LINK) $(cr_checkpoint_OBJECTS) $(cr_checkpoint_LDADD) $(LIBS)
 
@@ -406,11 +441,18 @@
 	-rm -rf .libs _libs
 install-man1: $(man_MANS)
 	@$(NORMAL_INSTALL)
-	test -z "$(man1dir)" || $(MKDIR_P) "$(DESTDIR)$(man1dir)"
-	@list=''; test -n "$(man1dir)" || exit 0; \
-	{ for i in $$list; do echo "$$i"; done; \
-	l2='$(man_MANS)'; for i in $$l2; do echo "$$i"; done | \
-	  sed -n '/\.1[a-z]*$$/p'; \
+	@list1=''; \
+	list2='$(man_MANS)'; \
+	test -n "$(man1dir)" \
+	  && test -n "`echo $$list1$$list2`" \
+	  || exit 0; \
+	echo " $(MKDIR_P) '$(DESTDIR)$(man1dir)'"; \
+	$(MKDIR_P) "$(DESTDIR)$(man1dir)" || exit 1; \
+	{ for i in $$list1; do echo "$$i"; done;  \
+	if test -n "$$list2"; then \
+	  for i in $$list2; do echo "$$i"; done \
+	    | sed -n '/\.1[a-z]*$$/p'; \
+	fi; \
 	} | while read p; do \
 	  if test -f $$p; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; echo "$$p"; \
@@ -439,9 +481,7 @@
 	  sed -n '/\.1[a-z]*$$/p'; \
 	} | sed -e 's,.*/,,;h;s,.*\.,,;s,^[^1][0-9a-z]*$$,1,;x' \
 	      -e 's,\.[0-9a-z]*$$,,;$(transform);G;s,\n,.,'`; \
-	test -z "$$files" || { \
-	  echo " ( cd '$(DESTDIR)$(man1dir)' && rm -f" $$files ")"; \
-	  cd "$(DESTDIR)$(man1dir)" && rm -f $$files; }
+	dir='$(DESTDIR)$(man1dir)'; $(am__uninstall_files_from_dir)
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -555,10 +595,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/util/cr_info/Makefile.in
===================================================================
--- blcr-0.8.5.orig/util/cr_info/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/util/cr_info/Makefile.in	2013-03-26 22:50:51.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -66,10 +83,21 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 am__installdirs = "$(DESTDIR)$(bindir)"
 SCRIPTS = $(bin_SCRIPTS)
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
@@ -113,6 +141,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -156,8 +185,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -170,6 +201,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -187,6 +219,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -220,7 +253,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -243,7 +275,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -268,15 +300,18 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 install-binSCRIPTS: $(bin_SCRIPTS)
 	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
 	@list='$(bin_SCRIPTS)'; test -n "$(bindir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(bindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(bindir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  if test -f "$$d$$p"; then echo "$$d$$p"; echo "$$p"; else :; fi; \
@@ -304,9 +339,7 @@
 	@list='$(bin_SCRIPTS)'; test -n "$(bindir)" || exit 0; \
 	files=`for p in $$list; do echo "$$p"; done | \
 	       sed -e 's,.*/,,;$(transform)'`; \
-	test -n "$$list" || exit 0; \
-	echo " ( cd '$(DESTDIR)$(bindir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(bindir)" && rm -f $$files
+	dir='$(DESTDIR)$(bindir)'; $(am__uninstall_files_from_dir)
 
 installcheck-binSCRIPTS: $(bin_SCRIPTS)
 	bad=0; pid=$$$$; list="$(bin_SCRIPTS)"; for p in $$list; do \
@@ -382,10 +415,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/util/cr_restart/Makefile.in
===================================================================
--- blcr-0.8.5.orig/util/cr_restart/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/util/cr_restart/Makefile.in	2013-03-26 22:50:51.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -67,6 +84,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = cr_restart.c
 DIST_SOURCES = cr_restart.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -88,6 +110,12 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 man1dir = $(mandir)/man1
 NROFF = nroff
 MANS = $(man_MANS)
@@ -136,6 +164,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -179,8 +208,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -193,6 +224,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -210,6 +242,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -243,7 +276,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -277,7 +309,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -302,15 +334,18 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
 	@list='$(bin_PROGRAMS)'; test -n "$(bindir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(bindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(bindir)" || exit 1; \
+	fi; \
 	for p in $$list; do echo "$$p $$p"; done | \
 	sed 's/$(EXEEXT)$$//' | \
 	while read p p1; do if test -f $$p || test -f $$p1; \
@@ -366,7 +401,7 @@
 	    else echo "$$f does not support $$opt" 1>&2; bad=1; fi; \
 	  done; \
 	done; rm -f c$${pid}_.???; exit $$bad
-cr_restart$(EXEEXT): $(cr_restart_OBJECTS) $(cr_restart_DEPENDENCIES) 
+cr_restart$(EXEEXT): $(cr_restart_OBJECTS) $(cr_restart_DEPENDENCIES) $(EXTRA_cr_restart_DEPENDENCIES) 
 	@rm -f cr_restart$(EXEEXT)
 	$(LINK) $(cr_restart_OBJECTS) $(cr_restart_LDADD) $(LIBS)
 
@@ -406,11 +441,18 @@
 	-rm -rf .libs _libs
 install-man1: $(man_MANS)
 	@$(NORMAL_INSTALL)
-	test -z "$(man1dir)" || $(MKDIR_P) "$(DESTDIR)$(man1dir)"
-	@list=''; test -n "$(man1dir)" || exit 0; \
-	{ for i in $$list; do echo "$$i"; done; \
-	l2='$(man_MANS)'; for i in $$l2; do echo "$$i"; done | \
-	  sed -n '/\.1[a-z]*$$/p'; \
+	@list1=''; \
+	list2='$(man_MANS)'; \
+	test -n "$(man1dir)" \
+	  && test -n "`echo $$list1$$list2`" \
+	  || exit 0; \
+	echo " $(MKDIR_P) '$(DESTDIR)$(man1dir)'"; \
+	$(MKDIR_P) "$(DESTDIR)$(man1dir)" || exit 1; \
+	{ for i in $$list1; do echo "$$i"; done;  \
+	if test -n "$$list2"; then \
+	  for i in $$list2; do echo "$$i"; done \
+	    | sed -n '/\.1[a-z]*$$/p'; \
+	fi; \
 	} | while read p; do \
 	  if test -f $$p; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; echo "$$p"; \
@@ -439,9 +481,7 @@
 	  sed -n '/\.1[a-z]*$$/p'; \
 	} | sed -e 's,.*/,,;h;s,.*\.,,;s,^[^1][0-9a-z]*$$,1,;x' \
 	      -e 's,\.[0-9a-z]*$$,,;$(transform);G;s,\n,.,'`; \
-	test -z "$$files" || { \
-	  echo " ( cd '$(DESTDIR)$(man1dir)' && rm -f" $$files ")"; \
-	  cd "$(DESTDIR)$(man1dir)" && rm -f $$files; }
+	dir='$(DESTDIR)$(man1dir)'; $(am__uninstall_files_from_dir)
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -555,10 +595,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/util/cr_run/Makefile.in
===================================================================
--- blcr-0.8.5.orig/util/cr_run/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/util/cr_run/Makefile.in	2013-03-26 22:50:51.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +16,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -66,10 +83,21 @@
 am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__uninstall_files_from_dir = { \
+  test -z "$$files" \
+    || { test ! -d "$$dir" && test ! -f "$$dir" && test ! -r "$$dir"; } \
+    || { echo " ( cd '$$dir' && rm -f" $$files ")"; \
+         $(am__cd) "$$dir" && rm -f $$files; }; \
+  }
 am__installdirs = "$(DESTDIR)$(bindir)" "$(DESTDIR)$(man1dir)"
 SCRIPTS = $(bin_SCRIPTS)
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 man1dir = $(mandir)/man1
 NROFF = nroff
 MANS = $(man_MANS)
@@ -116,6 +144,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -159,8 +188,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -173,6 +204,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -190,6 +222,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -223,7 +256,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -246,7 +278,7 @@
 all: all-am
 
 .SUFFIXES:
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -271,15 +303,18 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 install-binSCRIPTS: $(bin_SCRIPTS)
 	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
 	@list='$(bin_SCRIPTS)'; test -n "$(bindir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(bindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(bindir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  if test -f "$$d$$p"; then echo "$$d$$p"; echo "$$p"; else :; fi; \
@@ -307,9 +342,7 @@
 	@list='$(bin_SCRIPTS)'; test -n "$(bindir)" || exit 0; \
 	files=`for p in $$list; do echo "$$p"; done | \
 	       sed -e 's,.*/,,;$(transform)'`; \
-	test -n "$$list" || exit 0; \
-	echo " ( cd '$(DESTDIR)$(bindir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(bindir)" && rm -f $$files
+	dir='$(DESTDIR)$(bindir)'; $(am__uninstall_files_from_dir)
 
 installcheck-binSCRIPTS: $(bin_SCRIPTS)
 	bad=0; pid=$$$$; list="$(bin_SCRIPTS)"; for p in $$list; do \
@@ -333,11 +366,18 @@
 	-rm -rf .libs _libs
 install-man1: $(man_MANS)
 	@$(NORMAL_INSTALL)
-	test -z "$(man1dir)" || $(MKDIR_P) "$(DESTDIR)$(man1dir)"
-	@list=''; test -n "$(man1dir)" || exit 0; \
-	{ for i in $$list; do echo "$$i"; done; \
-	l2='$(man_MANS)'; for i in $$l2; do echo "$$i"; done | \
-	  sed -n '/\.1[a-z]*$$/p'; \
+	@list1=''; \
+	list2='$(man_MANS)'; \
+	test -n "$(man1dir)" \
+	  && test -n "`echo $$list1$$list2`" \
+	  || exit 0; \
+	echo " $(MKDIR_P) '$(DESTDIR)$(man1dir)'"; \
+	$(MKDIR_P) "$(DESTDIR)$(man1dir)" || exit 1; \
+	{ for i in $$list1; do echo "$$i"; done;  \
+	if test -n "$$list2"; then \
+	  for i in $$list2; do echo "$$i"; done \
+	    | sed -n '/\.1[a-z]*$$/p'; \
+	fi; \
 	} | while read p; do \
 	  if test -f $$p; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; echo "$$p"; \
@@ -366,9 +406,7 @@
 	  sed -n '/\.1[a-z]*$$/p'; \
 	} | sed -e 's,.*/,,;h;s,.*\.,,;s,^[^1][0-9a-z]*$$,1,;x' \
 	      -e 's,\.[0-9a-z]*$$,,;$(transform);G;s,\n,.,'`; \
-	test -z "$$files" || { \
-	  echo " ( cd '$(DESTDIR)$(man1dir)' && rm -f" $$files ")"; \
-	  cd "$(DESTDIR)$(man1dir)" && rm -f $$files; }
+	dir='$(DESTDIR)$(man1dir)'; $(am__uninstall_files_from_dir)
 tags: TAGS
 TAGS:
 
@@ -436,10 +474,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
Index: blcr-0.8.5/vmadump4/Makefile.in
===================================================================
--- blcr-0.8.5.orig/vmadump4/Makefile.in	2013-03-26 22:46:08.000000000 +0000
+++ blcr-0.8.5/vmadump4/Makefile.in	2013-03-26 22:50:51.000000000 +0000
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.11.1 from Makefile.am.
+# Makefile.in generated by automake 1.11.6 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009  Free Software Foundation,
-# Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
+# Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -19,6 +19,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -82,6 +99,11 @@
 	$(LDFLAGS) -o $@
 SOURCES = vmadcheck.c vmadlib.c vmadstress.c vmadtest.c
 DIST_SOURCES = vmadcheck.c vmadlib.c vmadstress.c vmadtest.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -128,6 +150,7 @@
 CYGPATH_W = @CYGPATH_W@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
+DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
 DUMPBIN = @DUMPBIN@
 ECHO_C = @ECHO_C@
@@ -171,8 +194,10 @@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
 MAKE = @MAKE@
 MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
@@ -185,6 +210,7 @@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
@@ -202,6 +228,7 @@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
@@ -235,7 +262,6 @@
 libexecdir = @libexecdir@
 localedir = @localedir@
 localstatedir = @localstatedir@
-lt_ECHO = @lt_ECHO@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
@@ -274,7 +300,7 @@
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -299,9 +325,9 @@
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-$(top_srcdir)/configure:  $(am__configure_deps)
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
 
@@ -315,8 +341,11 @@
 	rm -f $$list
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libexecdir)" || $(MKDIR_P) "$(DESTDIR)$(libexecdir)"
 	@list='$(libexec_PROGRAMS)'; test -n "$(libexecdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libexecdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libexecdir)" || exit 1; \
+	fi; \
 	for p in $$list; do echo "$$p $$p"; done | \
 	sed 's/$(EXEEXT)$$//' | \
 	while read p p1; do if test -f $$p || test -f $$p1; \
@@ -372,16 +401,16 @@
 	    else echo "$$f does not support $$opt" 1>&2; bad=1; fi; \
 	  done; \
 	done; rm -f c$${pid}_.???; exit $$bad
-vmadcheck$(EXEEXT): $(vmadcheck_OBJECTS) $(vmadcheck_DEPENDENCIES) 
+vmadcheck$(EXEEXT): $(vmadcheck_OBJECTS) $(vmadcheck_DEPENDENCIES) $(EXTRA_vmadcheck_DEPENDENCIES) 
 	@rm -f vmadcheck$(EXEEXT)
 	$(LINK) $(vmadcheck_OBJECTS) $(vmadcheck_LDADD) $(LIBS)
-vmadlib$(EXEEXT): $(vmadlib_OBJECTS) $(vmadlib_DEPENDENCIES) 
+vmadlib$(EXEEXT): $(vmadlib_OBJECTS) $(vmadlib_DEPENDENCIES) $(EXTRA_vmadlib_DEPENDENCIES) 
 	@rm -f vmadlib$(EXEEXT)
 	$(LINK) $(vmadlib_OBJECTS) $(vmadlib_LDADD) $(LIBS)
-vmadstress$(EXEEXT): $(vmadstress_OBJECTS) $(vmadstress_DEPENDENCIES) 
+vmadstress$(EXEEXT): $(vmadstress_OBJECTS) $(vmadstress_DEPENDENCIES) $(EXTRA_vmadstress_DEPENDENCIES) 
 	@rm -f vmadstress$(EXEEXT)
 	$(LINK) $(vmadstress_OBJECTS) $(vmadstress_LDADD) $(LIBS)
-vmadtest$(EXEEXT): $(vmadtest_OBJECTS) $(vmadtest_DEPENDENCIES) 
+vmadtest$(EXEEXT): $(vmadtest_OBJECTS) $(vmadtest_DEPENDENCIES) $(EXTRA_vmadtest_DEPENDENCIES) 
 	@rm -f vmadtest$(EXEEXT)
 	$(LINK) $(vmadtest_OBJECTS) $(vmadtest_LDADD) $(LIBS)
 
@@ -523,10 +552,15 @@
 
 installcheck: installcheck-am
 install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
-	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
-	  `test -z '$(STRIP)' || \
-	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
 mostlyclean-generic:
 
 clean-generic:
